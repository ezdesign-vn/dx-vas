
<!DOCTYPE html>

<html class="no-js" lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="TÃ i liá»‡u kiáº¿n trÃºc vÃ  phÃ¡t triá»ƒn cho dá»± Ã¡n Chuyá»ƒn Ä‘á»•i sá»‘ TrÆ°á»ng Viá»‡t Anh." name="description"/>
<meta content="DX VAS Team" name="author"/>
<link href="https://ezdesign-vn.github.io/dx-vas/services/auth-service/sub/interface-contract/" rel="canonical"/>
<link href="../../../../assets/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Auth Service (Sub) - Interface Contract - DX VAS - Docs</title>
<link href="../../../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="pink" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#auth-service-sub-interface-contract">
          Bá» qua
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Äáº§u trang" class="md-header__inner md-grid">
<a aria-label="DX VAS - Docs" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../../assets/images/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DX VAS - Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Auth Service (Sub) - Interface Contract
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="pink" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="lime" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="TÃ¬m kiáº¿m" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="TÃ¬m kiáº¿m" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="TÃ¬m kiáº¿m" class="md-search__options">
<button aria-label="XoÃ¡" class="md-search__icon md-icon" tabindex="-1" title="XoÃ¡" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../architecture/system-diagrams/">
          
  
  
    
  
  Kiáº¿n trÃºc Há»‡ thá»‘ng

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../dev-guide/">
        
  
  
    
  
  HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../">
        
  
  
    
  
  Thiáº¿t káº¿ Services

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../ADR/">
          
  
  
    
  
  Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Thanh Ä‘iá»u hÆ°á»›ng" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DX VAS - Docs" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../../assets/images/logo.png"/>
</a>
    DX VAS - Docs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Kiáº¿n trÃºc Há»‡ thá»‘ng
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Kiáº¿n trÃºc Há»‡ thá»‘ng
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../architecture/system-diagrams/">
<span class="md-ellipsis">
    SÆ¡ Ä‘á»“ Há»‡ thá»‘ng
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../architecture/rbac-deep-dive/">
<span class="md-ellipsis">
    RBAC Chi tiáº¿t
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../dev-guide/">
<span class="md-ellipsis">
    HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../">
<span class="md-ellipsis">
    Thiáº¿t káº¿ Services
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ADR/">
<span class="md-ellipsis">
    Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Má»¥c lá»¥c" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Má»¥c lá»¥c
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-muc-tieu-pham-vi-tai-lieu">
<span class="md-ellipsis">
      1. ğŸ¯ Má»¥c tiÃªu &amp; Pháº¡m vi tÃ i liá»‡u
    </span>
</a>
<nav aria-label="1. ğŸ¯ Má»¥c tiÃªu &amp; Pháº¡m vi tÃ i liá»‡u" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#muc-tieu-chinh">
<span class="md-ellipsis">
      ğŸ¯ Má»¥c tiÃªu chÃ­nh
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cac-api-uoc-inh-nghia-tai-ay">
<span class="md-ellipsis">
      ğŸ“¦ CÃ¡c API Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a táº¡i Ä‘Ã¢y
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ngoai-pham-vi-out-of-scope">
<span class="md-ellipsis">
      ğŸš« NgoÃ i pháº¡m vi (Out of Scope)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inh-huong-kien-truc">
<span class="md-ellipsis">
      ğŸ§­ Äá»‹nh hÆ°á»›ng kiáº¿n trÃºc
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-chinh-sach-bao-mat-phan-quyen">
<span class="md-ellipsis">
      2. ğŸ” ChÃ­nh sÃ¡ch Báº£o máº­t &amp; PhÃ¢n quyá»n
    </span>
</a>
<nav aria-label="2. ğŸ” ChÃ­nh sÃ¡ch Báº£o máº­t &amp; PhÃ¢n quyá»n" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#21-security-scheme">
<span class="md-ellipsis">
      2.1. ğŸ›¡ Security Scheme
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#22-co-che-kiem-soat-phan-quyen">
<span class="md-ellipsis">
      2.2. ğŸ§© CÆ¡ cháº¿ kiá»ƒm soÃ¡t phÃ¢n quyá»n
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#23-bang-mapping-permission">
<span class="md-ellipsis">
      2.3. ğŸ“‹ Báº£ng mapping permission
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#24-bao-ve-du-lieu-nhay-cam">
<span class="md-ellipsis">
      2.4. ğŸ” Báº£o vá»‡ dá»¯ liá»‡u nháº¡y cáº£m
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#25-goi-y-trien-khai">
<span class="md-ellipsis">
      2.5. ğŸ§  Gá»£i Ã½ triá»ƒn khai
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-tong-quan-api-luong-nghiep-vu">
<span class="md-ellipsis">
      3. ğŸ“Œ Tá»•ng quan API &amp; Luá»“ng nghiá»‡p vá»¥
    </span>
</a>
<nav aria-label="3. ğŸ“Œ Tá»•ng quan API &amp; Luá»“ng nghiá»‡p vá»¥" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-cac-nhom-chuc-nang-chinh">
<span class="md-ellipsis">
      3.1. ğŸ” CÃ¡c nhÃ³m chá»©c nÄƒng chÃ­nh
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-luong-xu-ly-chinh">
<span class="md-ellipsis">
      3.2. ğŸ§­ Luá»“ng xá»­ lÃ½ chÃ­nh
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#33-moi-lien-he-voi-cac-service-khac">
<span class="md-ellipsis">
      3.3. ğŸŒ Má»‘i liÃªn há»‡ vá»›i cÃ¡c service khÃ¡c
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#34-su-kien-uoc-phat-ra">
<span class="md-ellipsis">
      3.4. ğŸ“£ Sá»± kiá»‡n Ä‘Æ°á»£c phÃ¡t ra
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-chi-tiet-cac-endpoint">
<span class="md-ellipsis">
      4. ğŸ“¬ Chi tiáº¿t cÃ¡c Endpoint
    </span>
</a>
<nav aria-label="4. ğŸ“¬ Chi tiáº¿t cÃ¡c Endpoint" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-post-authlogin">
<span class="md-ellipsis">
      4.1. POST /auth/login
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-post-authlogout">
<span class="md-ellipsis">
      4.2. POST /auth/logout
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#43-get-authsessions">
<span class="md-ellipsis">
      4.3. GET /auth/sessions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#44-post-authsessionsidrevoke">
<span class="md-ellipsis">
      4.4. POST /auth/sessions/{id}/revoke
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-schema-su-dung-trong-requestresponse">
<span class="md-ellipsis">
      5. ğŸ“¦ Schema sá»­ dá»¥ng trong request/response
    </span>
</a>
<nav aria-label="5. ğŸ“¦ Schema sá»­ dá»¥ng trong request/response" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-loginrequest">
<span class="md-ellipsis">
      5.1. ğŸ“¨ LoginRequest
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-tokenenvelope">
<span class="md-ellipsis">
      5.2. ğŸ“¤ TokenEnvelope
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-logoutrequest">
<span class="md-ellipsis">
      5.3. ğŸ“¥ LogoutRequest
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#54-sessionout">
<span class="md-ellipsis">
      5.4. ğŸ“œ SessionOut
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#55-errorenvelope">
<span class="md-ellipsis">
      5.5. ğŸ›‘ ErrorEnvelope
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#56-responsemeta">
<span class="md-ellipsis">
      5.6. ğŸ“¦ ResponseMeta
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-quy-uoc-response-ma-loi">
<span class="md-ellipsis">
      6. ğŸ¯ Quy Æ°á»›c response &amp; mÃ£ lá»—i
    </span>
</a>
<nav aria-label="6. ğŸ¯ Quy Æ°á»›c response &amp; mÃ£ lá»—i" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-cau-truc-phan-hoi-thanh-cong">
<span class="md-ellipsis">
      6.1. ğŸ“¦ Cáº¥u trÃºc pháº£n há»“i thÃ nh cÃ´ng
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-cau-truc-phan-hoi-loi">
<span class="md-ellipsis">
      6.2. ğŸ›‘ Cáº¥u trÃºc pháº£n há»“i lá»—i
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-danh-sach-ma-loi-pho-bien">
<span class="md-ellipsis">
      6.3. ğŸ“‹ Danh sÃ¡ch mÃ£ lá»—i phá»• biáº¿n
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-contract-testing-yeu-cau">
<span class="md-ellipsis">
      6.4. ğŸ§ª Contract testing yÃªu cáº§u
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-ho-tro-kiem-thu-tich-hop">
<span class="md-ellipsis">
      7. ğŸ§ª Há»— trá»£ kiá»ƒm thá»­ &amp; tÃ­ch há»£p
    </span>
</a>
<nav aria-label="7. ğŸ§ª Há»— trá»£ kiá»ƒm thá»­ &amp; tÃ­ch há»£p" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-mau-request-thuc-te">
<span class="md-ellipsis">
      7.1. âœ… Máº«u request thá»±c táº¿
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-contract-testing">
<span class="md-ellipsis">
      7.2. ğŸ§ª Contract Testing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-kiem-thu-phan-quyen-ieu-kien">
<span class="md-ellipsis">
      7.3. ğŸ§ª Kiá»ƒm thá»­ phÃ¢n quyá»n &amp; Ä‘iá»u kiá»‡n
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#74-tich-hop-cicd">
<span class="md-ellipsis">
      7.4. ğŸ›  TÃ­ch há»£p CI/CD
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#75-tich-hop-observability">
<span class="md-ellipsis">
      7.5. ğŸ“¡ TÃ­ch há»£p observability
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-tai-lieu-lien-quan">
<span class="md-ellipsis">
      8. ğŸ“š TÃ i liá»‡u liÃªn quan
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="auth-service-sub-interface-contract">ğŸ“˜ Auth Service Sub â€“ Interface Contract<a class="headerlink" href="#auth-service-sub-interface-contract" title="Permanent link">Â¶</a></h1>
<h2 id="1-muc-tieu-pham-vi-tai-lieu">1. ğŸ¯ Má»¥c tiÃªu &amp; Pháº¡m vi tÃ i liá»‡u<a class="headerlink" href="#1-muc-tieu-pham-vi-tai-lieu" title="Permanent link">Â¶</a></h2>
<p>TÃ i liá»‡u nÃ y Ä‘á»‹nh nghÄ©a rÃµ cÃ¡c <strong>há»£p Ä‘á»“ng giao tiáº¿p (interface contract)</strong> cá»§a <code>auth-service/sub</code> â€“ má»™t service chá»‹u trÃ¡ch nhiá»‡m xÃ¡c thá»±c ngÆ°á»i dÃ¹ng theo tá»«ng tenant, bao gá»“m:</p>
<ul>
<li>ÄÄƒng nháº­p qua OTP hoáº·c tÃ i khoáº£n ná»™i bá»™ (Local login)</li>
<li>Quáº£n lÃ½ vÃ²ng Ä‘á»i phiÃªn Ä‘Äƒng nháº­p (<code>auth_sessions</code>)</li>
<li>Thu há»“i phiÃªn hoáº·c token Ä‘Ã£ cáº¥p</li>
<li>Cung cáº¥p metadata vÃ  audit cho cÃ¡c service khÃ¡c</li>
</ul>
<hr/>
<h3 id="muc-tieu-chinh">ğŸ¯ Má»¥c tiÃªu chÃ­nh<a class="headerlink" href="#muc-tieu-chinh" title="Permanent link">Â¶</a></h3>
<ul>
<li>LÃ  cÆ¡ sá»Ÿ chÃ­nh thá»©c cho viá»‡c <strong>triá»ƒn khai backend</strong> vÃ  <strong>frontend tÃ­ch há»£p</strong></li>
<li>Chuáº©n hoÃ¡ request/response theo OpenAPI</li>
<li>Ãp dá»¥ng cÃ¡c quy táº¯c phÃ¢n quyá»n vÃ  báº£o máº­t theo chuáº©n <code>RBAC Ä‘á»™ng</code></li>
<li>LÃ m cÆ¡ sá»Ÿ cho contract testing, CI/CD vÃ  monitoring</li>
</ul>
<hr/>
<h3 id="cac-api-uoc-inh-nghia-tai-ay">ğŸ“¦ CÃ¡c API Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a táº¡i Ä‘Ã¢y<a class="headerlink" href="#cac-api-uoc-inh-nghia-tai-ay" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>NhÃ³m chá»©c nÄƒng</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST /auth/login</code></td>
<td>ÄÄƒng nháº­p ngÆ°á»i dÃ¹ng (OTP / Local)</td>
</tr>
<tr>
<td><code>POST /auth/logout</code></td>
<td>ÄÄƒng xuáº¥t vÃ  thu há»“i token</td>
</tr>
<tr>
<td><code>GET /auth/sessions</code></td>
<td>Truy váº¥n lá»‹ch sá»­ phiÃªn Ä‘Äƒng nháº­p</td>
</tr>
<tr>
<td><code>POST /auth/sessions/{id}/revoke</code></td>
<td>Thu há»“i má»™t phiÃªn cá»¥ thá»ƒ</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="ngoai-pham-vi-out-of-scope">ğŸš« NgoÃ i pháº¡m vi (Out of Scope)<a class="headerlink" href="#ngoai-pham-vi-out-of-scope" title="Permanent link">Â¶</a></h3>
<p>CÃ¡c chá»©c nÄƒng sau <strong>khÃ´ng náº±m trong tÃ i liá»‡u nÃ y</strong> vÃ  Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ nÆ¡i khÃ¡c:</p>
<table>
<thead>
<tr>
<th>Chá»©c nÄƒng</th>
<th>NÆ¡i Ä‘á»‹nh nghÄ©a</th>
</tr>
</thead>
<tbody>
<tr>
<td>XÃ¡c thá»±c Google (OAuth2)</td>
<td><code>auth-service/master</code></td>
</tr>
<tr>
<td>Cáº¥p phÃ¡t JWT token</td>
<td><code>token-service</code></td>
</tr>
<tr>
<td>Kiá»ƒm tra RBAC Ä‘á»™ng</td>
<td><code>api-gateway</code></td>
</tr>
<tr>
<td>Quáº£n lÃ½ ngÆ°á»i dÃ¹ng</td>
<td><code>user-service</code></td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="inh-huong-kien-truc">ğŸ§­ Äá»‹nh hÆ°á»›ng kiáº¿n trÃºc<a class="headerlink" href="#inh-huong-kien-truc" title="Permanent link">Â¶</a></h3>
<p>TÃ i liá»‡u nÃ y Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn nguyÃªn lÃ½:</p>
<ul>
<li><strong>Stateless Service</strong>: má»i tráº¡ng thÃ¡i phiÃªn Ä‘á»u externalized</li>
<li><strong>Multi-tenant per-instance</strong>: má»i request báº¯t buá»™c Ä‘i kÃ¨m <code>X-Tenant-ID</code></li>
<li><strong>RBAC Externalized</strong>: má»i permission vÃ  Ä‘iá»u kiá»‡n truy cáº­p Ä‘Æ°á»£c xá»­ lÃ½ táº¡i gateway hoáº·c middleware</li>
<li><strong>Auditability</strong>: má»i hÃ nh vi phÃ¡t sinh Ä‘á»u gá»­i sá»± kiá»‡n Ä‘á»ƒ trace vÃ  giÃ¡m sÃ¡t</li>
</ul>
<blockquote>
<p>ğŸ“Œ Má»i API trong tÃ i liá»‡u Ä‘á»u Ä‘á»“ng bá»™ 100% vá»›i file OpenAPI (<code>openapi.yaml</code>) cá»§a <code>auth-service/sub</code>.</p>
</blockquote>
<hr/>
<h2 id="2-chinh-sach-bao-mat-phan-quyen">2. ğŸ” ChÃ­nh sÃ¡ch Báº£o máº­t &amp; PhÃ¢n quyá»n<a class="headerlink" href="#2-chinh-sach-bao-mat-phan-quyen" title="Permanent link">Â¶</a></h2>
<p>ToÃ n bá»™ cÃ¡c endpoint trong <code>auth-service/sub</code> yÃªu cáº§u xÃ¡c thá»±c vÃ  phÃ¢n quyá»n cháº·t cháº½ dá»±a trÃªn:</p>
<ul>
<li><strong>JWT token</strong> Ä‘Æ°á»£c cáº¥p tá»« <code>token-service</code></li>
<li><strong>X-Tenant-ID</strong> Ä‘á»ƒ Ä‘á»‹nh danh tenant hiá»‡n hÃ nh</li>
<li><strong>Permission Ä‘á»™ng (RBAC)</strong> Ä‘á»ƒ giá»›i háº¡n quyá»n truy cáº­p theo vai trÃ² vÃ  ngá»¯ cáº£nh</li>
</ul>
<hr/>
<h3 id="21-security-scheme">2.1. ğŸ›¡ Security Scheme<a class="headerlink" href="#21-security-scheme" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>ThÃ nh pháº§n</th>
<th>Báº¯t buá»™c</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Authorization</code> header</td>
<td>âœ…</td>
<td>Dáº¡ng Bearer JWT</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code> header</td>
<td>âœ…</td>
<td>Má»i request Ä‘á»u pháº£i xÃ¡c Ä‘á»‹nh tenant</td>
</tr>
<tr>
<td>JWT payload</td>
<td>âœ…</td>
<td>Chá»©a <code>user_id</code>, <code>roles</code>, <code>tenant_id</code>â€¦ theo chuáº©n há»‡ thá»‘ng</td>
</tr>
</tbody>
</table>
<blockquote>
<p>âš ï¸ Token pháº£i Ä‘Æ°á»£c cáº¥p há»£p lá»‡ tá»« <code>token-service</code>, kÃ½ báº±ng khÃ³a <code>RS256</code>.</p>
</blockquote>
<hr/>
<h3 id="22-co-che-kiem-soat-phan-quyen">2.2. ğŸ§© CÆ¡ cháº¿ kiá»ƒm soÃ¡t phÃ¢n quyá»n<a class="headerlink" href="#22-co-che-kiem-soat-phan-quyen" title="Permanent link">Â¶</a></h3>
<p>Há»‡ thá»‘ng RBAC theo mÃ´ hÃ¬nh <code>permission + condition</code>, Ä‘Æ°á»£c xá»­ lÃ½ <strong>ngoÃ i service</strong> (táº¡i <code>api-gateway</code> hoáº·c middleware) vÃ  Ä‘Æ°á»£c kiá»ƒm tra láº¡i trong audit/logic náº¿u cáº§n.</p>
<h4 id="vi-du">VÃ­ dá»¥:<a class="headerlink" href="#vi-du" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">"x-permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"session.read:self"</span><span class="p">],</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nt">"x-condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{current_user.id}}"</span><span class="p">,</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nt">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{X-Tenant-ID}}"</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h3 id="23-bang-mapping-permission">2.3. ğŸ“‹ Báº£ng mapping permission<a class="headerlink" href="#23-bang-mapping-permission" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Permission</th>
<th>x-condition</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST /auth/login</code></td>
<td><code>auth.login</code></td>
<td><code>{ "tenant_id": "{{X-Tenant-ID}}" }</code></td>
</tr>
<tr>
<td><code>POST /auth/logout</code></td>
<td><code>auth.logout</code></td>
<td><code>{ "tenant_id": "{{X-Tenant-ID}}" }</code></td>
</tr>
<tr>
<td><code>GET /auth/sessions</code></td>
<td><code>session.read:self</code> | <code>session.read:any</code></td>
<td><code>{ "user_id": ..., "tenant_id": ... }</code></td>
</tr>
<tr>
<td><code>POST /auth/sessions/{id}/revoke</code></td>
<td><code>session.revoke:any</code></td>
<td><code>{ "tenant_id": ... }</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>Náº¿u user khÃ´ng thoáº£ <code>x-condition</code>, há»‡ thá»‘ng sáº½ tráº£ lá»—i <code>403 Forbidden</code>.</p>
</blockquote>
<hr/>
<h3 id="24-bao-ve-du-lieu-nhay-cam">2.4. ğŸ” Báº£o vá»‡ dá»¯ liá»‡u nháº¡y cáº£m<a class="headerlink" href="#24-bao-ve-du-lieu-nhay-cam" title="Permanent link">Â¶</a></h3>
<ul>
<li>CÃ¡c trÆ°á»ng nhÆ° <code>ip_address</code>, <code>user_agent</code>, <code>location</code> trong session chá»‰ tráº£ vá» náº¿u cÃ³ quyá»n <code>session.read:any</code></li>
<li>Vá»›i quyá»n <code>session.read:self</code>, má»™t sá»‘ trÆ°á»ng cÃ³ thá»ƒ bá»‹ cáº¯t bá» Ä‘á»ƒ báº£o vá»‡ quyá»n riÃªng tÆ°</li>
</ul>
<hr/>
<h3 id="25-goi-y-trien-khai">2.5. ğŸ§  Gá»£i Ã½ triá»ƒn khai<a class="headerlink" href="#25-goi-y-trien-khai" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Váº¥n Ä‘á»</th>
<th>Giáº£i phÃ¡p</th>
</tr>
</thead>
<tbody>
<tr>
<td>NgÆ°á»i dÃ¹ng quÃªn gá»­i <code>X-Tenant-ID</code></td>
<td>Gateway tráº£ lá»—i 400 vá»›i lá»—i <code>missing_tenant_id</code></td>
</tr>
<tr>
<td>Quáº£n trá»‹ viÃªn muá»‘n xem session cá»§a user khÃ¡c</td>
<td>Cáº§n <code>session.read:any</code> vÃ  Ä‘iá»u kiá»‡n tenant match</td>
</tr>
<tr>
<td>Háº¡n cháº¿ truy cáº­p chÃ©o giá»¯a tenant</td>
<td>Má»i truy váº¥n Ä‘á»u báº¯t buá»™c <code>tenant_id = {{X-Tenant-ID}}</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>âœ… CÆ¡ cháº¿ báº£o máº­t vÃ  phÃ¢n quyá»n Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ hoáº¡t Ä‘á»™ng an toÃ n trong mÃ´i trÆ°á»ng multi-tenant, Ä‘á»“ng thá»i linh hoáº¡t cho quáº£n trá»‹ há»‡ thá»‘ng trÃªn tá»«ng tenant cá»¥ thá»ƒ.</p>
</blockquote>
<hr/>
<h2 id="3-tong-quan-api-luong-nghiep-vu">3. ğŸ“Œ Tá»•ng quan API &amp; Luá»“ng nghiá»‡p vá»¥<a class="headerlink" href="#3-tong-quan-api-luong-nghiep-vu" title="Permanent link">Â¶</a></h2>
<p>CÃ¡c API trong <code>auth-service/sub</code> táº­p trung phá»¥c vá»¥ viá»‡c xÃ¡c thá»±c ngÆ°á»i dÃ¹ng theo tá»«ng tenant. Táº¥t cáº£ Ä‘á»u tuÃ¢n thá»§ kiáº¿n trÃºc phÃ¢n táº§ng rÃµ rÃ ng, hoáº¡t Ä‘á»™ng theo luá»“ng chuáº©n xÃ¡c thá»±c â€“ phÃ¡t token â€“ quáº£n lÃ½ session â€“ thu há»“i token.</p>
<hr/>
<h3 id="31-cac-nhom-chuc-nang-chinh">3.1. ğŸ” CÃ¡c nhÃ³m chá»©c nÄƒng chÃ­nh<a class="headerlink" href="#31-cac-nhom-chuc-nang-chinh" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>NhÃ³m API</th>
<th>MÃ´ táº£</th>
<th>Endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ§‘â€ğŸ’¼ XÃ¡c thá»±c</td>
<td>ÄÄƒng nháº­p báº±ng OTP hoáº·c Local login</td>
<td><code>POST /auth/login</code></td>
</tr>
<tr>
<td>ğŸšª ÄÄƒng xuáº¥t</td>
<td>Thu há»“i token Ä‘ang dÃ¹ng (logout)</td>
<td><code>POST /auth/logout</code></td>
</tr>
<tr>
<td>ğŸ“œ Lá»‹ch sá»­ phiÃªn</td>
<td>Liá»‡t kÃª cÃ¡c phiÃªn Ä‘Äƒng nháº­p trÆ°á»›c Ä‘Ã³</td>
<td><code>GET /auth/sessions</code></td>
</tr>
<tr>
<td>ğŸ”’ Thu há»“i phiÃªn</td>
<td>Huá»· bá» session cá»¥ thá»ƒ (manual revoke)</td>
<td><code>POST /auth/sessions/{id}/revoke</code></td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="32-luong-xu-ly-chinh">3.2. ğŸ§­ Luá»“ng xá»­ lÃ½ chÃ­nh<a class="headerlink" href="#32-luong-xu-ly-chinh" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
  participant Frontend
  participant API Gateway
  participant Auth Sub
  participant Token Service
  participant Redis

  Frontend-&gt;&gt;+API Gateway: /auth/login (OTP/local)
  API Gateway-&gt;&gt;+Auth Sub: chuyá»ƒn tiáº¿p login
  Auth Sub-&gt;&gt;+Token Service: yÃªu cáº§u cáº¥p JWT
  Token Service--&gt;&gt;-Auth Sub: access_token + refresh_token
  Auth Sub-&gt;&gt;Redis: ghi revoked cache (náº¿u logout)
  Auth Sub--&gt;&gt;-API Gateway: tráº£ vá» JWT
  API Gateway--&gt;&gt;-Frontend: JWT

  note over Auth Sub,Redis: Emit: auth.token.issued
</code></pre>
<hr/>
<h3 id="33-moi-lien-he-voi-cac-service-khac">3.3. ğŸŒ Má»‘i liÃªn há»‡ vá»›i cÃ¡c service khÃ¡c<a class="headerlink" href="#33-moi-lien-he-voi-cac-service-khac" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Service liÃªn quan</th>
<th>Vai trÃ²</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token-service</code></td>
<td>Sinh &amp; thu há»“i access/refresh token</td>
</tr>
<tr>
<td><code>api-gateway</code></td>
<td>Enforce RBAC, forward <code>x-condition</code>, kiá»ƒm tra revoked token</td>
</tr>
<tr>
<td><code>user-service</code></td>
<td>Äá»“ng bá»™ thÃ´ng tin user (id, tráº¡ng thÃ¡i) náº¿u cáº§n</td>
</tr>
<tr>
<td><code>notification-service</code></td>
<td>Gá»­i OTP (trong tÆ°Æ¡ng lai náº¿u tÃ¡ch khá»i frontend)</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="34-su-kien-uoc-phat-ra">3.4. ğŸ“£ Sá»± kiá»‡n Ä‘Æ°á»£c phÃ¡t ra<a class="headerlink" href="#34-su-kien-uoc-phat-ra" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃªn sá»± kiá»‡n</th>
<th>Khi nÃ o?</th>
<th>Payload</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auth.token.issued</code></td>
<td>Sau khi login thÃ nh cÃ´ng</td>
<td>ThÃ´ng tin session, token, user metadata</td>
</tr>
<tr>
<td><code>auth.token.revoked</code></td>
<td>Khi logout hoáº·c bá»‹ revoke</td>
<td>Session ID, user ID, lÃ½ do</td>
</tr>
<tr>
<td><code>user.sync.triggered</code></td>
<td>(optional) Khi cáº§n Ä‘á»“ng bá»™ user qua tenant khÃ¡c</td>
<td>user_id, tenant_id</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ“Œ Luá»“ng nghiá»‡p vá»¥ trong <code>auth-service/sub</code> Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘Æ¡n giáº£n, dá»… má»Ÿ rá»™ng, vÃ  phÃ¹ há»£p tuyá»‡t Ä‘á»‘i vá»›i mÃ´ hÃ¬nh multi-tenant per-instance cá»§a <code>dx-vas</code>.</p>
</blockquote>
<hr/>
<h2 id="4-chi-tiet-cac-endpoint">4. ğŸ“¬ Chi tiáº¿t cÃ¡c Endpoint<a class="headerlink" href="#4-chi-tiet-cac-endpoint" title="Permanent link">Â¶</a></h2>
<h3 id="41-post-authlogin">4.1. <code>POST /auth/login</code><a class="headerlink" href="#41-post-authlogin" title="Permanent link">Â¶</a></h3>
<p>ÄÃ¢y lÃ  endpoint chÃ­nh Ä‘á»ƒ xÃ¡c thá»±c ngÆ°á»i dÃ¹ng thÃ´ng qua OTP hoáº·c tÃ i khoáº£n ná»™i bá»™ (local). Sau khi xÃ¡c thá»±c thÃ nh cÃ´ng, há»‡ thá»‘ng sáº½ táº¡o session, phÃ¡t JWT, lÆ°u metadata vÃ  phÃ¡t sá»± kiá»‡n <code>auth.token.issued</code>.</p>
<hr/>
<h4 id="request">ğŸ“¥ Request<a class="headerlink" href="#request" title="Permanent link">Â¶</a></h4>
<p><strong>Header yÃªu cáº§u</strong>:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Báº¯t buá»™c</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Authorization</code></td>
<td>âŒ</td>
<td>KhÃ´ng cáº§n (chÆ°a login)</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>XÃ¡c Ä‘á»‹nh tenant Ä‘ang xá»­ lÃ½</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong> (<code>LoginRequest</code>, dÃ¹ng discriminator <code>login_type</code>):</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="nt">"login_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"otp"</span><span class="p">,</span><span class="w">  </span><span class="c1">// hoáº·c "local"</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="nt">"phone_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+84901234567"</span><span class="p">,</span><span class="w"> </span><span class="c1">// OTP</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nt">"otp_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Hoáº·c:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nt">"login_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>CÃ¡c field cá»¥ thá»ƒ phá»¥ thuá»™c vÃ o <code>login_type</code>. TÃ i liá»‡u <code>schemas/LoginRequest</code> sáº½ Ä‘á»‹nh nghÄ©a cá»¥ thá»ƒ.</p>
</blockquote>
<hr/>
<h4 id="response">ğŸ“¤ Response<a class="headerlink" href="#response" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xyz"</span><span class="p">,</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;JWT&gt;"</span><span class="p">,</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="nt">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;JWT&gt;"</span><span class="p">,</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="nt">"session_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f2b9c6ae-...95c"</span><span class="p">,</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Response luÃ´n bá»c trong <code>ResponseMeta + TokenEnvelope</code></li>
<li><code>session_id</code> lÃ  UUID phiÃªn login Ä‘Æ°á»£c lÆ°u trong <code>auth_sessions</code></li>
<li>Token Ä‘Æ°á»£c phÃ¡t tá»« <code>token-service</code>, khÃ´ng pháº£i ná»™i bá»™ auth-sub</li>
</ul>
<hr/>
<h4 id="phan-quyen-ieu-kien">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Yáº¿u tá»‘</th>
<th>GiÃ¡ trá»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x-required-permission</code></td>
<td><code>auth.login</code></td>
</tr>
<tr>
<td><code>x-condition</code></td>
<td><code>{ "tenant_id": "{{X-Tenant-ID}}" }</code></td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="su-kien-phat-ra">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra" title="Permanent link">Â¶</a></h4>
<ul>
<li><code>auth.token.issued</code></li>
<li>Payload gá»“m: <code>user_id</code>, <code>tenant_id</code>, <code>auth_method</code>, <code>session_id</code>, <code>ip_address</code>, <code>user_agent</code>, <code>device_type</code>, <code>location</code></li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>error.code</th>
<th>HTTP</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auth.invalid_credentials</code></td>
<td>401</td>
<td>Sai username/password</td>
</tr>
<tr>
<td><code>auth.otp.invalid</code></td>
<td>400</td>
<td>MÃ£ OTP khÃ´ng Ä‘Ãºng</td>
</tr>
<tr>
<td><code>auth.otp.expired</code></td>
<td>400</td>
<td>MÃ£ OTP Ä‘Ã£ háº¿t háº¡n</td>
</tr>
<tr>
<td><code>auth.rate_limited</code></td>
<td>429</td>
<td>Gá»­i OTP quÃ¡ nhiá»u láº§n</td>
</tr>
<tr>
<td><code>auth.tenant_not_found</code></td>
<td>400</td>
<td>Thiáº¿u hoáº·c sai <code>X-Tenant-ID</code></td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu" title="Permanent link">Â¶</a></h4>
<ul>
<li>ÄÄƒng nháº­p Ä‘Ãºng/sai OTP</li>
<li>ÄÄƒng nháº­p local Ä‘Ãºng/sai</li>
<li>Thiáº¿u <code>X-Tenant-ID</code> â†’ lá»—i</li>
<li>Session pháº£i Ä‘Æ°á»£c ghi vÃ o báº£ng <code>auth_sessions</code></li>
<li>Token pháº£i cÃ³ claim Ä‘Ãºng (<code>sub</code>, <code>session_id</code>, <code>tenant_id</code>, <code>exp</code>...)</li>
</ul>
<blockquote>
<p>ğŸ“Œ ÄÃ¢y lÃ  endpoint duy nháº¥t táº¡o JWT trong <code>auth-service/sub</code>. Má»i cáº¥p phÃ¡t token Ä‘á»u Ä‘Æ°á»£c uá»· quyá»n sang <code>token-service</code>.</p>
</blockquote>
<hr/>
<h3 id="42-post-authlogout">4.2. <code>POST /auth/logout</code><a class="headerlink" href="#42-post-authlogout" title="Permanent link">Â¶</a></h3>
<p>Endpoint nÃ y cho phÃ©p ngÆ°á»i dÃ¹ng hoáº·c há»‡ thá»‘ng <strong>thu há»“i token hiá»‡n táº¡i</strong> (access hoáº·c refresh) vÃ  Ä‘Ã¡nh dáº¥u session tÆ°Æ¡ng á»©ng lÃ  Ä‘Ã£ bá»‹ huá»·. Äá»“ng thá»i phÃ¡t sá»± kiá»‡n <code>auth.token.revoked</code> Ä‘á»ƒ cÃ¡c service khÃ¡c cáº­p nháº­t tráº¡ng thÃ¡i.</p>
<hr/>
<h4 id="request_1">ğŸ“¥ Request<a class="headerlink" href="#request_1" title="Permanent link">Â¶</a></h4>
<p><strong>Header yÃªu cáº§u</strong>:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Báº¯t buá»™c</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Authorization</code></td>
<td>âœ…</td>
<td>JWT hiá»‡n táº¡i</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>Tenant tÆ°Æ¡ng á»©ng vá»›i token</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong> (<code>LogoutRequest</code>, optional):</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_logout"</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>Náº¿u khÃ´ng truyá»n <code>reason</code>, máº·c Ä‘á»‹nh lÃ  <code>"user_logout"</code>.</p>
</blockquote>
<hr/>
<h4 id="response_1">ğŸ“¤ Response<a class="headerlink" href="#response_1" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Tráº£ vá» 200 OK vá»›i success flag</li>
<li>KhÃ´ng cáº§n tráº£ láº¡i token</li>
</ul>
<hr/>
<h4 id="phan-quyen-ieu-kien_1">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_1" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Yáº¿u tá»‘</th>
<th>GiÃ¡ trá»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x-required-permission</code></td>
<td><code>auth.logout</code></td>
</tr>
<tr>
<td><code>x-condition</code></td>
<td><code>{ "tenant_id": "{{X-Tenant-ID}}" }</code></td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="hanh-vi-noi-bo">ğŸ§© HÃ nh vi ná»™i bá»™<a class="headerlink" href="#hanh-vi-noi-bo" title="Permanent link">Â¶</a></h4>
<ul>
<li>Token hiá»‡n táº¡i Ä‘Æ°á»£c decode â†’ láº¥y <code>jti</code> (JWT ID), <code>session_id</code>, <code>user_id</code></li>
<li>Táº¡o key <code>revoked:&lt;jti&gt;</code> trong Redis vá»›i TTL Ä‘Ãºng báº±ng thá»i gian cÃ²n láº¡i</li>
<li>Cáº­p nháº­t báº£n ghi <code>auth_sessions</code> tÆ°Æ¡ng á»©ng: <code>revoked_at</code>, <code>revoked_reason</code></li>
<li>Ghi log audit vÃ  phÃ¡t sá»± kiá»‡n <code>auth.token.revoked</code></li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_1">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_1" title="Permanent link">Â¶</a></h4>
<ul>
<li><code>auth.token.revoked</code></li>
<li>Payload gá»“m: <code>session_id</code>, <code>user_id</code>, <code>tenant_id</code>, <code>revoked_reason</code>, <code>revoked_at</code>, <code>ip_address</code>, <code>device_type</code></li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_1">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_1" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>error.code</th>
<th>HTTP</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auth.token.invalid</code></td>
<td>401</td>
<td>Token khÃ´ng há»£p lá»‡ hoáº·c Ä‘Ã£ háº¿t háº¡n</td>
</tr>
<tr>
<td><code>auth.token.already_revoked</code></td>
<td>400</td>
<td>Token Ä‘Ã£ bá»‹ thu há»“i trÆ°á»›c Ä‘Ã³</td>
</tr>
<tr>
<td><code>auth.tenant_mismatch</code></td>
<td>403</td>
<td>Token khÃ´ng thuá»™c tenant Ä‘ang gá»­i</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_1">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_1" title="Permanent link">Â¶</a></h4>
<ul>
<li>Logout access token Ä‘ang dÃ¹ng â†’ Redis cÃ³ key <code>revoked:&lt;jti&gt;</code></li>
<li>Logout refresh token â†’ cÅ©ng pháº£i bá»‹ revoke</li>
<li>Check Redis TTL vÃ  dá»¯ liá»‡u</li>
<li>Truy váº¥n <code>GET /auth/sessions</code> â†’ session Ä‘á»•i tráº¡ng thÃ¡i</li>
<li>Replay token sau logout â†’ pháº£i bá»‹ tá»« chá»‘i táº¡i Gateway</li>
</ul>
<blockquote>
<p>ğŸ“Œ ÄÃ¢y lÃ  cÆ¡ cháº¿ chÃ­nh Ä‘á»ƒ thá»±c hiá»‡n session termination chá»§ Ä‘á»™ng, phá»¥c vá»¥ cáº£ frontend vÃ  admin console. CÃ¡c revoke xáº£y ra táº¡i Ä‘Ã¢y lÃ  <strong>soft revoke</strong> (qua Redis), khÃ´ng xÃ³a token váº­t lÃ½.</p>
</blockquote>
<hr/>
<h3 id="43-get-authsessions">4.3. <code>GET /auth/sessions</code><a class="headerlink" href="#43-get-authsessions" title="Permanent link">Â¶</a></h3>
<p>Endpoint nÃ y cho phÃ©p ngÆ°á»i dÃ¹ng truy váº¥n danh sÃ¡ch phiÃªn Ä‘Äƒng nháº­p trÆ°á»›c Ä‘Ã³ cá»§a chÃ­nh mÃ¬nh, hoáº·c truy xuáº¥t cá»§a ngÆ°á»i dÃ¹ng khÃ¡c (náº¿u cÃ³ quyá»n). Há»— trá»£ lá»c theo <code>user_id</code>, <code>tráº¡ng thÃ¡i</code>, phÃ¢n trang.</p>
<hr/>
<h4 id="request_2">ğŸ“¥ Request<a class="headerlink" href="#request_2" title="Permanent link">Â¶</a></h4>
<p><strong>Header yÃªu cáº§u</strong>:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Báº¯t buá»™c</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Authorization</code></td>
<td>âœ…</td>
<td>JWT há»£p lá»‡</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>Tenant hiá»‡n hÃ nh</td>
</tr>
</tbody>
</table>
<p><strong>Query Parameters</strong> (tÃ¹y chá»n):</p>
<table>
<thead>
<tr>
<th>Tham sá»‘</th>
<th>Kiá»ƒu</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_id</code></td>
<td>UUID</td>
<td>Chá»‰ Ä‘á»‹nh user cá»¥ thá»ƒ (chá»‰ khi cÃ³ quyá»n <code>read:any</code>)</td>
</tr>
<tr>
<td><code>status</code></td>
<td>ENUM</td>
<td><code>active</code>, <code>revoked</code>, <code>expired</code>, <code>locked</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td>Integer</td>
<td>Sá»‘ dÃ²ng má»—i trang (default: 20)</td>
</tr>
<tr>
<td><code>offset</code></td>
<td>Integer</td>
<td>Bá» qua bao nhiÃªu dÃ²ng Ä‘áº§u tiÃªn</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="response_2">ğŸ“¤ Response<a class="headerlink" href="#response_2" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="nt">"pagination"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">      </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">      </span><span class="nt">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">      </span><span class="nt">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">      </span><span class="nt">"session_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f2b9c6ae-..."</span><span class="p">,</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">      </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"de56..."</span><span class="p">,</span>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">      </span><span class="nt">"auth_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"otp"</span><span class="p">,</span>
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">      </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-01T10:45:00Z"</span><span class="p">,</span>
</span><span id="__span-6-16"><a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">      </span><span class="nt">"revoked_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-6-17"><a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">      </span><span class="nt">"ip_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"203.113.12.1"</span><span class="p">,</span>
</span><span id="__span-6-18"><a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">      </span><span class="nt">"device_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"web"</span><span class="p">,</span>
</span><span id="__span-6-19"><a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">      </span><span class="nt">"user_agent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mozilla/5.0 ..."</span><span class="p">,</span>
</span><span id="__span-6-20"><a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">      </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ho Chi Minh, VN"</span><span class="p">,</span>
</span><span id="__span-6-21"><a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span>
</span><span id="__span-6-22"><a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-23"><a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-6-24"><a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Tráº£ vá» máº£ng <code>SessionOut</code> theo chuáº©n schema</li>
<li>Metadata gá»“m pagination info vÃ  <code>request_id</code></li>
</ul>
<hr/>
<h4 id="phan-quyen-ieu-kien_2">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_2" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Yáº¿u tá»‘</th>
<th>GiÃ¡ trá»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x-required-permission</code></td>
<td><code>session.read:self</code> hoáº·c <code>session.read:any</code></td>
</tr>
<tr>
<td><code>x-condition</code></td>
<td><code>{ "user_id": "{{current_user.id}}", "tenant_id": "{{X-Tenant-ID}}" }</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>Náº¿u user gá»­i <code>user_id</code> â‰  chÃ­nh há» â†’ cáº§n <code>session.read:any</code>.</p>
</blockquote>
<hr/>
<h4 id="luu-y-ve-bao-mat">ğŸ” LÆ°u Ã½ vá» báº£o máº­t<a class="headerlink" href="#luu-y-ve-bao-mat" title="Permanent link">Â¶</a></h4>
<ul>
<li>Náº¿u chá»‰ cÃ³ <code>read:self</code>, há»‡ thá»‘ng sáº½ <strong>áº©n</strong> hoáº·c <strong>mask</strong> má»™t sá»‘ metadata (<code>ip_address</code>, <code>location</code>, <code>user_agent</code>)</li>
<li>Náº¿u cÃ³ <code>read:any</code>, sáº½ tháº¥y Ä‘áº§y Ä‘á»§ thÃ´ng tin cÃ¡c session</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_2">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_2" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>error.code</th>
<th>HTTP</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auth.forbidden</code></td>
<td>403</td>
<td>KhÃ´ng Ä‘á»§ quyá»n truy cáº­p dá»¯ liá»‡u</td>
</tr>
<tr>
<td><code>auth.invalid_query</code></td>
<td>400</td>
<td>Truy váº¥n khÃ´ng há»£p lá»‡ (sai user_id, offset Ã¢m...)</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_2">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_2" title="Permanent link">Â¶</a></h4>
<ul>
<li>Gá»i khÃ´ng truyá»n <code>user_id</code> â†’ tráº£ session chÃ­nh mÃ¬nh</li>
<li>Gá»i <code>user_id = self</code> nhÆ°ng thiáº¿u quyá»n â†’ 403</li>
<li>PhÃ¢n trang: limit/offset hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c</li>
<li>So sÃ¡nh sá»‘ lÆ°á»£ng session khá»›p DB <code>auth_sessions</code></li>
<li>Mask metadata khi dÃ¹ng quyá»n <code>read:self</code></li>
</ul>
<blockquote>
<p>ğŸ“Œ ÄÃ¢y lÃ  API quan trá»ng Ä‘á»ƒ ngÆ°á»i dÃ¹ng tá»± kiá»ƒm tra lá»‹ch sá»­ hoáº¡t Ä‘á»™ng hoáº·c Ä‘á»ƒ quáº£n trá»‹ viÃªn giÃ¡m sÃ¡t Ä‘Äƒng nháº­p trong tenant cá»§a há».</p>
</blockquote>
<hr/>
<h3 id="44-post-authsessionsidrevoke">4.4. <code>POST /auth/sessions/{id}/revoke</code><a class="headerlink" href="#44-post-authsessionsidrevoke" title="Permanent link">Â¶</a></h3>
<p>Endpoint nÃ y cho phÃ©p quáº£n trá»‹ viÃªn thu há»“i má»™t phiÃªn Ä‘Äƒng nháº­p cá»¥ thá»ƒ cá»§a ngÆ°á»i dÃ¹ng trong tenant. HÃ nh Ä‘á»™ng nÃ y vÃ´ hiá»‡u hÃ³a token tÆ°Æ¡ng á»©ng náº¿u cÃ²n hiá»‡u lá»±c, cáº­p nháº­t tráº¡ng thÃ¡i session vÃ  phÃ¡t sá»± kiá»‡n <code>auth.token.revoked</code>.</p>
<hr/>
<h4 id="request_3">ğŸ“¥ Request<a class="headerlink" href="#request_3" title="Permanent link">Â¶</a></h4>
<p><strong>Header yÃªu cáº§u</strong>:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Báº¯t buá»™c</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Authorization</code></td>
<td>âœ…</td>
<td>JWT cÃ³ quyá»n quáº£n trá»‹</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>Tenant cá»§a phiÃªn cáº§n revoke</td>
</tr>
</tbody>
</table>
<p><strong>Path Parameter</strong>:</p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Kiá»ƒu</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>UUID</td>
<td>ID cá»§a session (<code>session_id</code>) cáº§n thu há»“i</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong> (<code>RevokeSessionRequest</code>, optional):</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin_forced"</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>Náº¿u khÃ´ng cung cáº¥p <code>reason</code>, há»‡ thá»‘ng dÃ¹ng máº·c Ä‘á»‹nh <code>"manual"</code>.</p>
</blockquote>
<hr/>
<h4 id="response_3">ğŸ“¤ Response<a class="headerlink" href="#response_3" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Tráº£ vá» 200 OK náº¿u thu há»“i thÃ nh cÃ´ng hoáº·c Ä‘Ã£ bá»‹ thu há»“i trÆ°á»›c Ä‘Ã³</li>
</ul>
<hr/>
<h4 id="phan-quyen-ieu-kien_3">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_3" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Yáº¿u tá»‘</th>
<th>GiÃ¡ trá»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x-required-permission</code></td>
<td><code>session.revoke:any</code></td>
</tr>
<tr>
<td><code>x-condition</code></td>
<td><code>{ "tenant_id": "{{X-Tenant-ID}}" }</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>Chá»‰ cho phÃ©p thao tÃ¡c vá»›i cÃ¡c session thuá»™c tenant hiá»‡n táº¡i.</p>
</blockquote>
<hr/>
<h4 id="hanh-vi-noi-bo_1">ğŸ§© HÃ nh vi ná»™i bá»™<a class="headerlink" href="#hanh-vi-noi-bo_1" title="Permanent link">Â¶</a></h4>
<ul>
<li>Truy váº¥n <code>auth_sessions</code> Ä‘á»ƒ xÃ¡c Ä‘á»‹nh session há»£p lá»‡</li>
<li>Náº¿u session Ä‘Ã£ bá»‹ revoke â†’ tráº£ success idempotent</li>
<li>Náº¿u session cÃ²n hoáº¡t Ä‘á»™ng:</li>
<li>Ghi <code>revoked_at</code>, <code>revoked_reason</code></li>
<li>Ghi Redis key <code>revoked:&lt;jti&gt;</code> náº¿u token cÃ²n hiá»‡u lá»±c</li>
<li>Emit sá»± kiá»‡n <code>auth.token.revoked</code></li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_2">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_2" title="Permanent link">Â¶</a></h4>
<ul>
<li><code>auth.token.revoked</code></li>
<li>Payload gá»“m: <code>session_id</code>, <code>user_id</code>, <code>tenant_id</code>, <code>revoked_reason</code>, <code>revoked_by</code>, <code>ip_address</code></li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_3">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_3" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>error.code</th>
<th>HTTP</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>session.not_found</code></td>
<td>404</td>
<td>KhÃ´ng tÃ¬m tháº¥y session</td>
</tr>
<tr>
<td><code>auth.forbidden</code></td>
<td>403</td>
<td>KhÃ´ng Ä‘á»§ quyá»n hoáº·c sai tenant</td>
</tr>
<tr>
<td><code>session.already_revoked</code></td>
<td>400</td>
<td>PhiÃªn Ä‘Ã£ bá»‹ thu há»“i tá»« trÆ°á»›c (cÃ³ thá»ƒ cho phÃ©p idempotent success)</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_3">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_3" title="Permanent link">Â¶</a></h4>
<ul>
<li>Revoke má»™t session chÆ°a bá»‹ thu há»“i â†’ cáº­p nháº­t DB, Redis</li>
<li>Revoke láº¡i cÃ¹ng session â†’ khÃ´ng lá»—i (idempotent)</li>
<li>Truy váº¥n <code>GET /auth/sessions</code> â†’ tháº¥y tráº¡ng thÃ¡i <code>revoked</code></li>
<li>XÃ¡c minh sá»± kiá»‡n <code>auth.token.revoked</code> Ä‘Æ°á»£c phÃ¡t Ä‘Ãºng metadata</li>
<li>Check token tÆ°Æ¡ng á»©ng â†’ bá»‹ tá»« chá»‘i khi dÃ¹ng láº¡i</li>
</ul>
<blockquote>
<p>ğŸ“Œ ÄÃ¢y lÃ  API quáº£n trá»‹ quan trá»ng cho phÃ©p vÃ´ hiá»‡u hÃ³a cÃ¡c phiÃªn nghi ngá» hoáº·c cháº¥m dá»©t truy cáº­p ngay láº­p tá»©c trong cÃ¡c tÃ¬nh huá»‘ng kháº©n cáº¥p vá» báº£o máº­t.</p>
</blockquote>
<hr/>
<h2 id="5-schema-su-dung-trong-requestresponse">5. ğŸ“¦ Schema sá»­ dá»¥ng trong request/response<a class="headerlink" href="#5-schema-su-dung-trong-requestresponse" title="Permanent link">Â¶</a></h2>
<p>TÃ i liá»‡u nÃ y mÃ´ táº£ cÃ¡c schema dá»¯ liá»‡u chÃ­nh Ä‘Æ°á»£c sá»­ dá»¥ng trong body cá»§a cÃ¡c request vÃ  response cá»§a <code>auth-service/sub</code>. Táº¥t cáº£ schema Ä‘á»u Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vÃ  version hÃ³a rÃµ rÃ ng trong file OpenAPI (<code>openapi.yaml</code>) Ä‘i kÃ¨m.</p>
<hr/>
<h3 id="51-loginrequest">5.1. ğŸ“¨ <code>LoginRequest</code><a class="headerlink" href="#51-loginrequest" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="nt">"login_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"otp"</span><span class="p">,</span><span class="w">  </span><span class="c1">// hoáº·c "local"</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="nt">"phone_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+84901234567"</span><span class="p">,</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">  </span><span class="nt">"otp_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li><code>login_type</code>: <code>enum</code> (<code>otp</code>, <code>local</code>)</li>
<li>Náº¿u <code>otp</code> â†’ yÃªu cáº§u <code>phone_number</code> vÃ  <code>otp_code</code></li>
<li>Náº¿u <code>local</code> â†’ yÃªu cáº§u <code>username</code> vÃ  <code>password</code></li>
<li>ÄÆ°á»£c Ä‘á»‹nh nghÄ©a báº±ng <code>oneOf</code> trong OpenAPI vá»›i discriminator <code>login_type</code></li>
</ul>
<hr/>
<h3 id="52-tokenenvelope">5.2. ğŸ“¤ <code>TokenEnvelope</code><a class="headerlink" href="#52-tokenenvelope" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJhbGciOiJSUzI1NiIsIn..."</span><span class="p">,</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="nt">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJhbGciOiJSUzI1NiIsIn..."</span><span class="p">,</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="nt">"session_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3b61237d-..."</span><span class="p">,</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">  </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Bao gÃ³i thÃ´ng tin token Ä‘Æ°á»£c cáº¥p</li>
<li>Tráº£ vá» trong má»i response <code>login</code></li>
</ul>
<hr/>
<h3 id="53-logoutrequest">5.3. ğŸ“¥ <code>LogoutRequest</code><a class="headerlink" href="#53-logoutrequest" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="p">{</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">  </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_logout"</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li><code>reason</code>: string, optional, cÃ¡c giÃ¡ trá»‹ gá»£i Ã½: <code>user_logout</code>, <code>expired</code>, <code>device_lost</code>, <code>admin_forced</code></li>
</ul>
<hr/>
<h3 id="54-sessionout">5.4. ğŸ“œ <code>SessionOut</code><a class="headerlink" href="#54-sessionout" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="p">{</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="nt">"session_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b6a1d437-..."</span><span class="p">,</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1e332..."</span><span class="p">,</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">  </span><span class="nt">"auth_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">  </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-01T10:45:00Z"</span><span class="p">,</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span><span class="nt">"revoked_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span><span class="nt">"ip_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.1.1"</span><span class="p">,</span>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">  </span><span class="nt">"device_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"web"</span><span class="p">,</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">  </span><span class="nt">"user_agent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mozilla/5.0 ..."</span><span class="p">,</span>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">  </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ho Chi Minh, VN"</span><span class="p">,</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Tráº£ vá» trong <code>GET /auth/sessions</code></li>
<li>CÃ³ thá»ƒ bá»‹ áº©n/mask bá»›t náº¿u quyá»n chá»‰ lÃ  <code>session.read:self</code></li>
</ul>
<hr/>
<h3 id="55-errorenvelope">5.5. ğŸ›‘ <code>ErrorEnvelope</code><a class="headerlink" href="#55-errorenvelope" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth.invalid_credentials"</span><span class="p">,</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng"</span><span class="p">,</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">      </span><span class="nt">"attempts_left"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-10"><a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xyz"</span><span class="p">,</span>
</span><span id="__span-13-11"><a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-13T07:22:30Z"</span>
</span><span id="__span-13-12"><a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-13"><a href="#__codelineno-13-13" id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>ÄÆ°á»£c chuáº©n hÃ³a theo <code>adr-011-api-error-format.md</code></li>
<li>Táº¥t cáº£ response lá»—i Ä‘á»u bá»c trong <code>ErrorEnvelope</code></li>
</ul>
<hr/>
<h3 id="56-responsemeta">5.6. ğŸ“¦ <code>ResponseMeta</code><a class="headerlink" href="#56-responsemeta" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="p">{</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"req_abc123"</span><span class="p">,</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-13T07:22:30Z"</span><span class="p">,</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span><span class="nt">"pagination"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="nt">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="nt">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>CÃ³ máº·t trong má»i response thÃ nh cÃ´ng</li>
<li><code>pagination</code> chá»‰ cÃ³ khi dÃ¹ng response dáº¡ng danh sÃ¡ch</li>
</ul>
<blockquote>
<p>ğŸ“Œ Táº¥t cáº£ schema Ä‘á»u versioned vÃ  test tá»± Ä‘á»™ng báº±ng contract testing tools (<code>schemathesis</code>, <code>dredd</code>, etc.) trong CI pipeline.</p>
</blockquote>
<hr/>
<h2 id="6-quy-uoc-response-ma-loi">6. ğŸ¯ Quy Æ°á»›c response &amp; mÃ£ lá»—i<a class="headerlink" href="#6-quy-uoc-response-ma-loi" title="Permanent link">Â¶</a></h2>
<p>Má»i API trong <code>auth-service/sub</code> tuÃ¢n thá»§ nghiÃªm ngáº·t Ä‘á»‹nh dáº¡ng pháº£n há»“i chuáº©n hoÃ¡ cá»§a há»‡ thá»‘ng VAS DX. Äiá»u nÃ y Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n, dá»… debug vÃ  kháº£ nÄƒng má»Ÿ rá»™ng cÃ¡c cÃ´ng cá»¥ tá»± Ä‘á»™ng hoÃ¡ (contract testing, monitoring, tracing).</p>
<hr/>
<h3 id="61-cau-truc-phan-hoi-thanh-cong">6.1. ğŸ“¦ Cáº¥u trÃºc pháº£n há»“i thÃ nh cÃ´ng<a class="headerlink" href="#61-cau-truc-phan-hoi-thanh-cong" title="Permanent link">Â¶</a></h3>
<p>Má»—i response thÃ nh cÃ´ng Ä‘á»u pháº£i bá»c trong:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="p">{</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc123"</span><span class="p">,</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-13T08:00:00Z"</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">    </span><span class="c1">// Ná»™i dung tuá»³ API</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li><code>meta</code>: luÃ´n cÃ³ <code>request_id</code> (traceable), <code>timestamp</code>, vÃ  optional <code>pagination</code></li>
<li><code>data</code>: chá»©a payload thá»±c táº¿ (token, session list, success flag...)</li>
</ul>
<blockquote>
<p>Cáº¥u trÃºc nÃ y Ä‘Æ°á»£c chuáº©n hÃ³a theo <code>adr-012-response-structure.md</code></p>
</blockquote>
<hr/>
<h3 id="62-cau-truc-phan-hoi-loi">6.2. ğŸ›‘ Cáº¥u trÃºc pháº£n há»“i lá»—i<a class="headerlink" href="#62-cau-truc-phan-hoi-loi" title="Permanent link">Â¶</a></h3>
<p>Táº¥t cáº£ lá»—i Ä‘á»u tráº£ vá» Ä‘á»‹nh dáº¡ng chuáº©n <code>ErrorEnvelope</code>:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="p">{</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth.invalid_credentials"</span><span class="p">,</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sai tÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u"</span><span class="p">,</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">      </span><span class="nt">"attempts_left"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc123"</span><span class="p">,</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-13T08:01:30Z"</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li><code>code</code>: mÃ£ lá»—i dáº¡ng snake-case (báº¯t buá»™c)</li>
<li><code>message</code>: mÃ´ táº£ ngáº¯n gá»n, cÃ³ thá»ƒ dÃ¹ng Ä‘a ngÃ´n ngá»¯</li>
<li><code>data</code>: optional â€“ dÃ¹ng Ä‘á»ƒ truyá»n thÃªm context (vÃ­ dá»¥: <code>attempts_left</code>, <code>lockout_duration</code>)</li>
</ul>
<hr/>
<h3 id="63-danh-sach-ma-loi-pho-bien">6.3. ğŸ“‹ Danh sÃ¡ch mÃ£ lá»—i phá»• biáº¿n<a class="headerlink" href="#63-danh-sach-ma-loi-pho-bien" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>HTTP</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auth.invalid_credentials</code></td>
<td>401</td>
<td>Sai username/password</td>
</tr>
<tr>
<td><code>auth.otp.invalid</code></td>
<td>400</td>
<td>MÃ£ OTP sai</td>
</tr>
<tr>
<td><code>auth.otp.expired</code></td>
<td>400</td>
<td>OTP Ä‘Ã£ háº¿t háº¡n</td>
</tr>
<tr>
<td><code>auth.token.invalid</code></td>
<td>401</td>
<td>Token khÃ´ng há»£p lá»‡ hoáº·c Ä‘Ã£ thu há»“i</td>
</tr>
<tr>
<td><code>auth.token.already_revoked</code></td>
<td>400</td>
<td>Token Ä‘Ã£ bá»‹ thu há»“i tá»« trÆ°á»›c</td>
</tr>
<tr>
<td><code>session.not_found</code></td>
<td>404</td>
<td>KhÃ´ng tÃ¬m tháº¥y phiÃªn</td>
</tr>
<tr>
<td><code>auth.forbidden</code></td>
<td>403</td>
<td>KhÃ´ng Ä‘á»§ quyá»n theo RBAC</td>
</tr>
<tr>
<td><code>auth.tenant_mismatch</code></td>
<td>403</td>
<td>Tenant khÃ´ng khá»›p</td>
</tr>
<tr>
<td><code>auth.rate_limited</code></td>
<td>429</td>
<td>Gá»­i OTP/quÃ¡ nhiá»u yÃªu cáº§u</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Danh sÃ¡ch Ä‘áº§y Ä‘á»§ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong file <code>error-codes.md</code> vÃ  <code>adr-011-api-error-format.md</code></p>
</blockquote>
<hr/>
<h3 id="64-contract-testing-yeu-cau">6.4. ğŸ§ª Contract testing yÃªu cáº§u<a class="headerlink" href="#64-contract-testing-yeu-cau" title="Permanent link">Â¶</a></h3>
<ul>
<li>Má»—i mÃ£ lá»—i Ä‘á»u pháº£i cÃ³ test tÆ°Æ¡ng á»©ng</li>
<li>HÃ nh vi sai pháº£i tráº£ Ä‘Ãºng mÃ£ HTTP + <code>error.code</code></li>
<li>CI pipeline khÃ´ng cho phÃ©p thay Ä‘á»•i <code>error.code</code> hoáº·c <code>ResponseMeta</code> format náº¿u khÃ´ng cÃ³ migration</li>
</ul>
<blockquote>
<p>âœ… CÃ¡ch tiáº¿p cáº­n nháº¥t quÃ¡n giÃºp tÄƒng kháº£ nÄƒng giÃ¡m sÃ¡t tá»± Ä‘á»™ng, phÃ¢n tÃ­ch lá»—i chÃ­nh xÃ¡c, há»— trá»£ frontend hiá»ƒn thá»‹ rÃµ rÃ ng vÃ  giáº£m thiá»ƒu lá»—i tÃ­ch há»£p giá»¯a cÃ¡c Ä‘á»™i.</p>
</blockquote>
<hr/>
<h2 id="7-ho-tro-kiem-thu-tich-hop">7. ğŸ§ª Há»— trá»£ kiá»ƒm thá»­ &amp; tÃ­ch há»£p<a class="headerlink" href="#7-ho-tro-kiem-thu-tich-hop" title="Permanent link">Â¶</a></h2>
<p>TÃ i liá»‡u nÃ y há»— trá»£ Ä‘áº§y Ä‘á»§ cho cÃ¡c hoáº¡t Ä‘á»™ng kiá»ƒm thá»­ thá»§ cÃ´ng, kiá»ƒm thá»­ tá»± Ä‘á»™ng, tÃ­ch há»£p CI/CD vÃ  contract testing nháº±m Ä‘áº£m báº£o Ä‘á»™ tin cáº­y vÃ  tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a <code>auth-service/sub</code>.</p>
<hr/>
<h3 id="71-mau-request-thuc-te">7.1. âœ… Máº«u request thá»±c táº¿<a class="headerlink" href="#71-mau-request-thuc-te" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Má»¥c Ä‘Ã­ch</th>
<th>Method &amp; URL</th>
<th>Gá»£i Ã½ curl</th>
</tr>
</thead>
<tbody>
<tr>
<td>ÄÄƒng nháº­p OTP</td>
<td><code>POST /auth/login</code></td>
<td><code>curl -X POST ... -H "X-Tenant-ID: t1" -d '{...}'</code></td>
</tr>
<tr>
<td>Logout</td>
<td><code>POST /auth/logout</code></td>
<td><code>curl -H "Authorization: Bearer ..."</code></td>
</tr>
<tr>
<td>Liá»‡t kÃª session</td>
<td><code>GET /auth/sessions</code></td>
<td><code>curl -G ... --data-urlencode 'user_id=...'</code></td>
</tr>
<tr>
<td>Thu há»“i phiÃªn</td>
<td><code>POST /auth/sessions/{id}/revoke</code></td>
<td><code>curl -X POST ... -d '{ "reason": "admin_forced" }'</code></td>
</tr>
</tbody>
</table>
<p>ğŸ“ Gá»£i Ã½: Sá»­ dá»¥ng [Postman Collection] hoáº·c [Insomnia Export] Ä‘Ã­nh kÃ¨m dá»± Ã¡n.</p>
<hr/>
<h3 id="72-contract-testing">7.2. ğŸ§ª Contract Testing<a class="headerlink" href="#72-contract-testing" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Má»¥c tiÃªu</th>
<th>CÃ´ng cá»¥ Ä‘á» xuáº¥t</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kiá»ƒm tra schema Ä‘Ãºng vá»›i OpenAPI</td>
<td><code>Dredd</code>, <code>Schemathesis</code>, <code>Stoplight Prism</code></td>
</tr>
<tr>
<td>Kiá»ƒm tra Ä‘á»‹nh dáº¡ng lá»—i &amp; mÃ£ lá»—i</td>
<td><code>pytest + snapshot test</code>, <code>jest + supertest</code></td>
</tr>
<tr>
<td>So khá»›p <code>response.meta</code> &amp; pagination</td>
<td>TÃ­ch há»£p test CI/CD</td>
</tr>
<tr>
<td>Äáº£m báº£o backward compatibility</td>
<td>Contract test snapshot lockfile</td>
</tr>
</tbody>
</table>
<blockquote>
<p>âœ… TÃ i liá»‡u nÃ y Ä‘á»“ng bá»™ 100% vá»›i <code>openapi.yaml</code> â€“ cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ sinh test auto.</p>
</blockquote>
<hr/>
<h3 id="73-kiem-thu-phan-quyen-ieu-kien">7.3. ğŸ§ª Kiá»ƒm thá»­ phÃ¢n quyá»n &amp; Ä‘iá»u kiá»‡n<a class="headerlink" href="#73-kiem-thu-phan-quyen-ieu-kien" title="Permanent link">Â¶</a></h3>
<ul>
<li>Test thiáº¿u <code>X-Tenant-ID</code> â†’ tráº£ lá»—i 400</li>
<li>Test <code>session.read:self</code> vs <code>read:any</code> â†’ khÃ¡c nhau vá» metadata</li>
<li>Test <code>session.revoke:any</code> â†’ khÃ´ng Ä‘Æ°á»£c phÃ©p thu há»“i phiÃªn tenant khÃ¡c</li>
<li>Test <code>auth.token.revoked</code> â†’ emit event Ä‘Ãºng metadata</li>
</ul>
<hr/>
<h3 id="74-tich-hop-cicd">7.4. ğŸ›  TÃ­ch há»£p CI/CD<a class="headerlink" href="#74-tich-hop-cicd" title="Permanent link">Â¶</a></h3>
<ul>
<li>Má»—i PR báº¯t buá»™c cháº¡y test schema â†’ khÃ´ng cho phÃ©p thay Ä‘á»•i <code>ErrorEnvelope</code>, <code>ResponseMeta</code></li>
<li>CÃ³ rule YAML kiá»ƒm tra presence cá»§a <code>x-required-permission</code>, <code>x-condition</code> trong má»—i path</li>
</ul>
<hr/>
<h3 id="75-tich-hop-observability">7.5. ğŸ“¡ TÃ­ch há»£p observability<a class="headerlink" href="#75-tich-hop-observability" title="Permanent link">Â¶</a></h3>
<ul>
<li>Má»—i request Ä‘Æ°á»£c gÃ¡n <code>request_id</code> vÃ  trace ID Ä‘á»ƒ debug xuyÃªn service</li>
<li>Response chuáº©n hÃ³a há»— trá»£ APM/monitoring nhÆ° Datadog, Grafana Tempo, OpenTelemetry</li>
</ul>
<blockquote>
<p>âœ… Vá»›i tÃ i liá»‡u nÃ y, Ä‘á»™i frontend, backend, QA, vÃ  devops Ä‘á»u cÃ³ thá»ƒ tá»± Ä‘á»™ng hoÃ¡ quÃ¡ trÃ¬nh kiá»ƒm thá»­ vÃ  kiá»ƒm tra há»£p Ä‘á»“ng tÃ­ch há»£p xuyÃªn táº§ng má»™t cÃ¡ch chÃ­nh xÃ¡c vÃ  hiá»‡u quáº£.</p>
</blockquote>
<hr/>
<h2 id="8-tai-lieu-lien-quan">8. ğŸ“š TÃ i liá»‡u liÃªn quan<a class="headerlink" href="#8-tai-lieu-lien-quan" title="Permanent link">Â¶</a></h2>
<ul>
<li><a href="../data-model/">Data Model</a></li>
<li><a href="../openapi.yaml">OpenAPI Spec</a></li>
<li><a href="../design/">Design</a></li>
</ul>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Trá»Ÿ láº¡i má»¥c lá»¥c
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
<script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>