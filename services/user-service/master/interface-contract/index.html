
<!DOCTYPE html>

<html class="no-js" lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Service Design Document cho SPA quáº£n trá»‹ há»‡ thá»‘ng VAS DX" name="description"/>
<meta content="DX VAS Team" name="author"/>
<link href="https://ezdesign-vn.github.io/dx-vas/services/user-service/master/interface-contract/" rel="canonical"/>
<link href="../../../../assets/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>User Service Master â€“ Interface Contract - DX VAS - Docs</title>
<link href="../../../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="pink" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#user-service-master-interface-contract">
          Bá» qua
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Äáº§u trang" class="md-header__inner md-grid">
<a aria-label="DX VAS - Docs" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../../assets/images/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DX VAS - Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              User Service Master â€“ Interface Contract
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="pink" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="lime" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="TÃ¬m kiáº¿m" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="TÃ¬m kiáº¿m" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="TÃ¬m kiáº¿m" class="md-search__options">
<button aria-label="XoÃ¡" class="md-search__icon md-icon" tabindex="-1" title="XoÃ¡" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../architecture/system-diagrams/">
          
  
  
    
  
  Kiáº¿n trÃºc Há»‡ thá»‘ng

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../dev-guide/">
        
  
  
    
  
  HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../">
        
  
  
    
  
  Thiáº¿t káº¿ Services

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../ADR/">
          
  
  
    
  
  Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Thanh Ä‘iá»u hÆ°á»›ng" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DX VAS - Docs" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../../assets/images/logo.png"/>
</a>
    DX VAS - Docs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Kiáº¿n trÃºc Há»‡ thá»‘ng
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Kiáº¿n trÃºc Há»‡ thá»‘ng
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../architecture/system-diagrams/">
<span class="md-ellipsis">
    SÆ¡ Ä‘á»“ Há»‡ thá»‘ng
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../architecture/rbac-deep-dive/">
<span class="md-ellipsis">
    RBAC Chi tiáº¿t
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../dev-guide/">
<span class="md-ellipsis">
    HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../">
<span class="md-ellipsis">
    Thiáº¿t káº¿ Services
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ADR/">
<span class="md-ellipsis">
    Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Má»¥c lá»¥c" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Má»¥c lá»¥c
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-muc-ich">
<span class="md-ellipsis">
      1. ğŸ¯ Má»¥c Ä‘Ã­ch
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-pham-vi-oi-tuong-su-dung">
<span class="md-ellipsis">
      2. ğŸ§­ Pháº¡m vi &amp; Äá»‘i tÆ°á»£ng sá»­ dá»¥ng
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-phan-loai-api">
<span class="md-ellipsis">
      3. ğŸ“‚ PhÃ¢n loáº¡i API
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-danh-sach-endpoint-chinh">
<span class="md-ellipsis">
      4. ğŸ“‹ Danh sÃ¡ch endpoint chÃ­nh
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-chi-tiet-tung-api">
<span class="md-ellipsis">
      5. ğŸ“Œ Chi tiáº¿t tá»«ng API
    </span>
</a>
<nav aria-label="5. ğŸ“Œ Chi tiáº¿t tá»«ng API" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-get-users-globalby-email">
<span class="md-ellipsis">
      5.1. GET /users-global/by-email
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-post-users-global">
<span class="md-ellipsis">
      5.2. POST /users-global
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-get-tenants">
<span class="md-ellipsis">
      5.3. GET /tenants
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#54-post-tenants">
<span class="md-ellipsis">
      5.4. POST /tenants
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#55-get-user-tenant-assignments">
<span class="md-ellipsis">
      5.5. GET /user-tenant-assignments
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#56-post-user-tenant-assignments">
<span class="md-ellipsis">
      5.6. POST /user-tenant-assignments
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#57-get-global-roles-templates">
<span class="md-ellipsis">
      5.7. GET /global-roles-templates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#58-post-global-roles-templates">
<span class="md-ellipsis">
      5.8. POST /global-roles-templates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#59-get-global-permissions-templates">
<span class="md-ellipsis">
      5.9. GET /global-permissions-templates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#510-post-global-permissions-templates">
<span class="md-ellipsis">
      5.10. POST /global-permissions-templates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#511-patch-global-roles-templatestemplate_key">
<span class="md-ellipsis">
      5.11. PATCH /global-roles-templates/{template_key}
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#512-patch-global-permissions-templatesperm_key">
<span class="md-ellipsis">
      5.12. PATCH /global-permissions-templates/{perm_key}
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-su-kien-phat-ra-pubsub">
<span class="md-ellipsis">
      6. ğŸ“¡ Sá»± kiá»‡n phÃ¡t ra (Pub/Sub)
    </span>
</a>
<nav aria-label="6. ğŸ“¡ Sá»± kiá»‡n phÃ¡t ra (Pub/Sub)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-vi-du-su-kien-user_global_created">
<span class="md-ellipsis">
      6.1. ğŸ“¦ VÃ­ dá»¥: Sá»± kiá»‡n user_global_created
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-vi-du-su-kien-tenant_user_assigned">
<span class="md-ellipsis">
      6.2. ğŸ“¦ VÃ­ dá»¥: Sá»± kiá»‡n tenant_user_assigned
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-cach-su-dung-pho-bien-business-flow">
<span class="md-ellipsis">
      7. ğŸ§  CÃ¡ch sá»­ dá»¥ng phá»• biáº¿n (business flow)
    </span>
</a>
<nav aria-label="7. ğŸ§  CÃ¡ch sá»­ dá»¥ng phá»• biáº¿n (business flow)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-ang-nhap-lan-au-tao-user-toan-cuc-qua-auth-service">
<span class="md-ellipsis">
      7.1. ğŸŒ ÄÄƒng nháº­p láº§n Ä‘áº§u &amp; táº¡o user toÃ n cá»¥c (qua Auth Service)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-superadmin-tao-tenant-moi-phan-quyen">
<span class="md-ellipsis">
      7.2. ğŸ« Superadmin táº¡o tenant má»›i &amp; phÃ¢n quyá»n
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-quan-tri-rbac-toan-cuc">
<span class="md-ellipsis">
      7.3. ğŸ” Quáº£n trá»‹ RBAC toÃ n cá»¥c
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#74-ong-bo-user-cho-tenant-moi-qua-sub-service">
<span class="md-ellipsis">
      7.4. ğŸ§© Äá»“ng bá»™ user cho tenant má»›i (qua Sub Service)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ghi-chu">
<span class="md-ellipsis">
      ğŸ” Ghi chÃº
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-phu-luc">
<span class="md-ellipsis">
      8. ğŸ“ Phá»¥ lá»¥c
    </span>
</a>
<nav aria-label="8. ğŸ“ Phá»¥ lá»¥c" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#81-chuan-hoa-ma-loi-error-codes">
<span class="md-ellipsis">
      8.1. ğŸ“š Chuáº©n hÃ³a mÃ£ lá»—i (Error Codes)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#82-tai-lieu-lien-ket">
<span class="md-ellipsis">
      8.2. ğŸ“š TÃ i liá»‡u liÃªn káº¿t
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="user-service-master-interface-contract">ğŸ“˜ User Service Master â€“ Interface Contract<a class="headerlink" href="#user-service-master-interface-contract" title="Permanent link">Â¶</a></h1>
<p>TÃ i liá»‡u nÃ y Ä‘á»‹nh nghÄ©a giao diá»‡n API cá»§a dá»‹ch vá»¥ <code>user-service/master</code>, phá»¥c vá»¥ cho cÃ¡c há»‡ thá»‘ng sá»­ dá»¥ng toÃ n cá»¥c nhÆ° Superadmin Webapp, Auth Service, vÃ  cÃ¡c Sub Service. Dá»‹ch vá»¥ nÃ y chá»‹u trÃ¡ch nhiá»‡m quáº£n lÃ½ ngÆ°á»i dÃ¹ng toÃ n cá»¥c, gÃ¡n ngÆ°á»i dÃ¹ng vÃ o tenant, vÃ  Ä‘iá»u phá»‘i RBAC template.</p>
<hr/>
<h2 id="1-muc-ich">1. ğŸ¯ Má»¥c Ä‘Ã­ch<a class="headerlink" href="#1-muc-ich" title="Permanent link">Â¶</a></h2>
<p>Cung cáº¥p cÃ¡c API Ä‘á»ƒ:
- Tra cá»©u hoáº·c táº¡o ngÆ°á»i dÃ¹ng toÃ n cá»¥c theo tá»«ng provider.
- Táº¡o vÃ  quáº£n lÃ½ tenant (trÆ°á»ng há»c).
- GÃ¡n ngÆ°á»i dÃ¹ng vÃ o tenant cá»¥ thá»ƒ.
- Quáº£n lÃ½ há»‡ thá»‘ng role/permission template toÃ n cá»¥c phá»¥c vá»¥ RBAC phÃ¢n táº§ng.
- PhÃ¡t sá»± kiá»‡n Ä‘á»ƒ Ä‘á»“ng bá»™ hÃ³a tá»›i cÃ¡c Sub Service.</p>
<hr/>
<h2 id="2-pham-vi-oi-tuong-su-dung">2. ğŸ§­ Pháº¡m vi &amp; Äá»‘i tÆ°á»£ng sá»­ dá»¥ng<a class="headerlink" href="#2-pham-vi-oi-tuong-su-dung" title="Permanent link">Â¶</a></h2>
<table>
<thead>
<tr>
<th>Äá»‘i tÆ°á»£ng gá»i API</th>
<th>Má»¥c Ä‘Ã­ch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Superadmin Webapp</td>
<td>Quáº£n lÃ½ ngÆ°á»i dÃ¹ng &amp; phÃ¢n quyá»n toÃ n cá»¥c</td>
</tr>
<tr>
<td>Auth Service</td>
<td>Tra cá»©u hoáº·c táº¡o ngÆ°á»i dÃ¹ng khi login</td>
</tr>
<tr>
<td>Sub User Service</td>
<td>Äá»“ng bá»™ danh sÃ¡ch assignment, RBAC template</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="3-phan-loai-api">3. ğŸ“‚ PhÃ¢n loáº¡i API<a class="headerlink" href="#3-phan-loai-api" title="Permanent link">Â¶</a></h2>
<table>
<thead>
<tr>
<th>NhÃ³m chá»©c nÄƒng</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>User Lookup</td>
<td>Tra cá»©u ngÆ°á»i dÃ¹ng toÃ n cá»¥c</td>
</tr>
<tr>
<td>User Creation</td>
<td>Táº¡o ngÆ°á»i dÃ¹ng má»›i theo provider</td>
</tr>
<tr>
<td>Tenant Mgmt</td>
<td>Táº¡o vÃ  quáº£n lÃ½ tenant</td>
</tr>
<tr>
<td>Assignment</td>
<td>GÃ¡n user vÃ o tenant</td>
</tr>
<tr>
<td>RBAC Template</td>
<td>Quáº£n lÃ½ role/permission máº«u toÃ n cá»¥c</td>
</tr>
<tr>
<td>Event Emit</td>
<td>PhÃ¡t sá»± kiá»‡n Pub/Sub theo tiÃªu chuáº©n ADR-030</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="4-danh-sach-endpoint-chinh">4. ğŸ“‹ Danh sÃ¡ch endpoint chÃ­nh<a class="headerlink" href="#4-danh-sach-endpoint-chinh" title="Permanent link">Â¶</a></h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Path</th>
<th>MÃ´ táº£ ngáº¯n</th>
<th>Quyá»n yÃªu cáº§u</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/users-global/by-email</code></td>
<td>Tra cá»©u ngÆ°á»i dÃ¹ng toÃ n cá»¥c theo email + auth_provider</td>
<td><code>user.read</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/users-global</code></td>
<td>Táº¡o ngÆ°á»i dÃ¹ng toÃ n cá»¥c náº¿u chÆ°a tá»“n táº¡i</td>
<td><code>user.create</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/tenants</code></td>
<td>Liá»‡t kÃª cÃ¡c tenant hiá»‡n cÃ³</td>
<td><code>tenant.read</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/tenants</code></td>
<td>Táº¡o tenant má»›i (chá»‰ dÃ¹ng cho Superadmin)</td>
<td><code>tenant.create</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/user-tenant-assignments</code></td>
<td>Liá»‡t kÃª cÃ¡c tenant mÃ  má»™t user Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n</td>
<td><code>tenant_user.read</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/user-tenant-assignments</code></td>
<td>GÃ¡n ngÆ°á»i dÃ¹ng vÃ o tenant cá»¥ thá»ƒ</td>
<td><code>tenant_user.assign</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/global-roles-templates</code></td>
<td>Liá»‡t kÃª cÃ¡c role template toÃ n cá»¥c</td>
<td><code>rbac.template.read</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/global-roles-templates</code></td>
<td>Táº¡o role template má»›i toÃ n cá»¥c</td>
<td><code>rbac.template.create</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/global-permissions-templates</code></td>
<td>Liá»‡t kÃª cÃ¡c permission template toÃ n cá»¥c</td>
<td><code>rbac.template.read</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/global-permissions-templates</code></td>
<td>Táº¡o permission template má»›i toÃ n cá»¥c</td>
<td><code>rbac.template.create</code></td>
</tr>
<tr>
<td>PATCH</td>
<td><code>/global-roles-templates/{template_key}</code></td>
<td>Cáº­p nháº­t danh sÃ¡ch quyá»n trong má»™t role template cá»¥ thá»ƒ</td>
<td><code>rbac.template.update</code></td>
</tr>
<tr>
<td>PATCH</td>
<td><code>/global-permissions-templates/{perm_key}</code></td>
<td>Cáº­p nháº­t mÃ´ táº£ hoáº·c scope cá»§a permission template</td>
<td><code>rbac.template.update</code></td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="5-chi-tiet-tung-api">5. ğŸ“Œ Chi tiáº¿t tá»«ng API<a class="headerlink" href="#5-chi-tiet-tung-api" title="Permanent link">Â¶</a></h2>
<h3 id="51-get-users-globalby-email">5.1. <code>GET /users-global/by-email</code><a class="headerlink" href="#51-get-users-globalby-email" title="Permanent link">Â¶</a></h3>
<p>Tra cá»©u ngÆ°á»i dÃ¹ng toÃ n cá»¥c theo <code>email</code> vÃ  <code>auth_provider</code>. ÄÆ°á»£c sá»­ dá»¥ng bá»Ÿi Auth Service Ä‘á»ƒ kiá»ƒm tra ngÆ°á»i dÃ¹ng Ä‘Ã£ tá»“n táº¡i hay chÆ°a trÆ°á»›c khi táº¡o má»›i.</p>
<hr/>
<h4 id="request">ğŸ“¥ Request<a class="headerlink" href="#request" title="Permanent link">Â¶</a></h4>
<p><strong>Query parameters:</strong>
- <code>email</code> (string, báº¯t buá»™c) â€“ email ngÆ°á»i dÃ¹ng cáº§n tra cá»©u
- <code>auth_provider</code> (enum, báº¯t buá»™c) â€“ nhÃ  cung cáº¥p xÃ¡c thá»±c<br/>
  GiÃ¡ trá»‹ há»£p lá»‡: <code>"google"</code>, <code>"local"</code>, <code>"otp"</code></p>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<hr/>
<h4 id="response">ğŸ“¤ Response<a class="headerlink" href="#response" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usr_abc123"</span><span class="p">,</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@vas.edu.vn"</span><span class="p">,</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="nt">"auth_provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice B"</span><span class="p">,</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-01T12:00:00Z"</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡ (do Token Service phÃ¡t hÃ nh)</li>
<li><strong>Quyá»n:</strong> <code>user.read</code> (global scope)</li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p><code>auth_provider</code> pháº£i há»£p lá»‡</p>
</li>
<li>Truy cáº­p tá»« service Ä‘Æ°á»£c cáº¥p quyá»n truy váº¥n toÃ n cá»¥c (vÃ­ dá»¥: Auth Master)</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng phÃ¡t sá»± kiá»‡n.
  ÄÃ¢y lÃ  thao tÃ¡c tra cá»©u (read-only).</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u <code>email</code> hoáº·c <code>auth_provider</code>, sai Ä‘á»‹nh dáº¡ng</td>
</tr>
<tr>
<td>401</td>
<td>Thiáº¿u hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>user.read</code></td>
</tr>
<tr>
<td>404</td>
<td>KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng phÃ¹ há»£p</td>
</tr>
<tr>
<td>422</td>
<td>GiÃ¡ trá»‹ <code>auth_provider</code> khÃ´ng há»£p lá»‡</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Truy váº¥n user há»£p lá»‡ â†’ tráº£ vá» thÃ´ng tin chÃ­nh xÃ¡c</li>
<li>âŒ Truy váº¥n email khÃ´ng tá»“n táº¡i â†’ tráº£ <code>404</code></li>
<li>âŒ Thiáº¿u <code>auth_provider</code> â†’ tráº£ <code>400</code></li>
<li>âŒ Sá»­ dá»¥ng JWT khÃ´ng cÃ³ quyá»n <code>user.read</code> â†’ tráº£ <code>403</code></li>
<li>âœ… Log trace_id trong <code>meta</code> Ä‘á»ƒ Ä‘áº£m báº£o observability</li>
</ul>
<hr/>
<h3 id="52-post-users-global">5.2. <code>POST /users-global</code><a class="headerlink" href="#52-post-users-global" title="Permanent link">Â¶</a></h3>
<p>Táº¡o ngÆ°á»i dÃ¹ng toÃ n cá»¥c má»›i náº¿u chÆ°a tá»“n táº¡i, dá»±a trÃªn <code>email</code> vÃ  <code>auth_provider</code>.<br/>
Sá»­ dá»¥ng bá»Ÿi Auth Service hoáº·c Superadmin Ä‘á»ƒ khá»Ÿi táº¡o ngÆ°á»i dÃ¹ng global trong láº§n Ä‘Äƒng nháº­p Ä‘áº§u tiÃªn.</p>
<hr/>
<h4 id="request_1">ğŸ“¥ Request<a class="headerlink" href="#request_1" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Request body (JSON):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@vas.edu.vn"</span><span class="p">,</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="nt">"auth_provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nt">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice B"</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Field mÃ´ táº£:</strong></p>
<ul>
<li><code>email</code> (string, báº¯t buá»™c): email ngÆ°á»i dÃ¹ng, duy nháº¥t theo <code>auth_provider</code></li>
<li><code>auth_provider</code> (enum, báº¯t buá»™c): <code>"google"</code> | <code>"local"</code> | <code>"otp"</code></li>
<li><code>full_name</code> (string, tÃ¹y chá»n): tÃªn Ä‘áº§y Ä‘á»§</li>
</ul>
<hr/>
<h4 id="response_1">ğŸ“¤ Response<a class="headerlink" href="#response_1" title="Permanent link">Â¶</a></h4>
<p><strong>201 Created</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usr_xyz789"</span><span class="p">,</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@vas.edu.vn"</span><span class="p">,</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="nt">"auth_provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice B"</span><span class="p">,</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_1">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_1" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>user.create</code> (global scope)</li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p>Náº¿u user Ä‘Ã£ tá»“n táº¡i â†’ tráº£ <code>409</code></p>
</li>
<li>Pháº£i xÃ¡c thá»±c qua Auth Service cÃ³ quyá»n global</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_1">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_1" title="Permanent link">Â¶</a></h4>
<ul>
<li><code>user_global_created</code>
  Schema: <code>vas.user.created.v1</code>
  Ná»™i dung chá»©a: <code>user_id</code>, <code>email</code>, <code>auth_provider</code>, <code>created_at</code></li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_1">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_1" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u field báº¯t buá»™c (<code>email</code>, <code>auth_provider</code>)</td>
</tr>
<tr>
<td>401</td>
<td>Thiáº¿u JWT hoáº·c khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>user.create</code></td>
</tr>
<tr>
<td>409</td>
<td>NgÆ°á»i dÃ¹ng Ä‘Ã£ tá»“n táº¡i</td>
</tr>
<tr>
<td>422</td>
<td><code>auth_provider</code> khÃ´ng há»£p lá»‡</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_1">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_1" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Táº¡o user má»›i vá»›i email + provider há»£p lá»‡ â†’ tráº£ 201 + event</li>
<li>âŒ Táº¡o trÃ¹ng user â†’ tráº£ 409</li>
<li>âŒ Thiáº¿u <code>email</code> hoáº·c <code>auth_provider</code> â†’ tráº£ 400</li>
<li>âœ… Kiá»ƒm tra sá»± kiá»‡n <code>user_global_created</code> Ä‘Æ°á»£c phÃ¡t Ä‘Ãºng schema</li>
<li>âœ… Gá»i 2 láº§n liÃªn tiáº¿p â†’ chá»‰ 1 record Ä‘Æ°á»£c táº¡o (idempotency kiá»ƒm soÃ¡t báº±ng unique key)</li>
</ul>
<hr/>
<h3 id="53-get-tenants">5.3. <code>GET /tenants</code><a class="headerlink" href="#53-get-tenants" title="Permanent link">Â¶</a></h3>
<p>Liá»‡t kÃª danh sÃ¡ch táº¥t cáº£ cÃ¡c tenant (trÆ°á»ng há»c) hiá»‡n cÃ³ trong há»‡ thá»‘ng.<br/>
Endpoint nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi Superadmin Webapp vÃ  cÃ¡c há»‡ thá»‘ng Ä‘á»“ng bá»™ (Sub Service, SMS) Ä‘á»ƒ tra cá»©u danh sÃ¡ch tenant toÃ n cá»¥c.</p>
<hr/>
<h4 id="request_2">ğŸ“¥ Request<a class="headerlink" href="#request_2" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Query parameters (tuá»³ chá»n):</strong>
- <code>page</code>: sá»‘ trang (default = 1)
- <code>page_size</code>: sá»‘ lÆ°á»£ng báº£n ghi má»—i trang (default = 20, tá»‘i Ä‘a 100)
- <code>search</code>: chuá»—i tÃ¬m kiáº¿m theo <code>name</code> hoáº·c <code>project_id</code> (optional)</p>
<hr/>
<h4 id="response_2">ğŸ“¤ Response<a class="headerlink" href="#response_2" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant_abc123"</span><span class="p">,</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TrÆ°á»ng Viá»‡t Anh"</span><span class="p">,</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">      </span><span class="nt">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vas-tenant-001"</span><span class="p">,</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">      </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-01T12:00:00Z"</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="nt">"page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="nt">"page_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">    </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-3-15"><a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-16"><a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_2">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_2" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>tenant.read</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p>Chá»‰ cÃ³ Superadmin hoáº·c há»‡ thá»‘ng trung tÃ¢m má»›i Ä‘Æ°á»£c xem táº¥t cáº£ tenant</p>
</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_2">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_2" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng phÃ¡t sinh sá»± kiá»‡n â€“ thao tÃ¡c Ä‘á»c dá»¯ liá»‡u</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_2">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_2" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>401</td>
<td>KhÃ´ng cÃ³ hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>tenant.read</code></td>
</tr>
<tr>
<td>422</td>
<td>Tham sá»‘ <code>page</code>, <code>page_size</code> khÃ´ng há»£p lá»‡</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_2">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_2" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Gá»i vá»›i quyá»n <code>tenant.read</code> há»£p lá»‡ â†’ tráº£ danh sÃ¡ch tenant</li>
<li>âŒ Gá»i khÃ´ng JWT hoáº·c quyá»n khÃ´ng Ä‘Ãºng â†’ tráº£ 401 / 403</li>
<li>âœ… Kiá»ƒm tra paging hoáº¡t Ä‘á»™ng Ä‘Ãºng (meta.total, meta.page)</li>
<li>âœ… Kiá»ƒm tra filter <code>search</code> tráº£ vá» Ä‘Ãºng tenant liÃªn quan</li>
<li>âœ… Log trace_id trong má»—i pháº£n há»“i</li>
</ul>
<hr/>
<h3 id="54-post-tenants">5.4. <code>POST /tenants</code><a class="headerlink" href="#54-post-tenants" title="Permanent link">Â¶</a></h3>
<p>Táº¡o má»›i má»™t tenant (trÆ°á»ng há»c) trong há»‡ thá»‘ng.<br/>
Chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi Superadmin Webapp Ä‘á»ƒ khá»Ÿi táº¡o mÃ´i trÆ°á»ng Ä‘á»™c láº­p cho má»™t trÆ°á»ng.<br/>
Sau khi táº¡o, sáº½ phÃ¡t sá»± kiá»‡n <code>tenant_created</code> Ä‘á»ƒ cÃ¡c Sub Service (Auth, User, Notification, SMS...) khá»Ÿi táº¡o stack tÆ°Æ¡ng á»©ng.</p>
<hr/>
<h4 id="request_3">ğŸ“¥ Request<a class="headerlink" href="#request_3" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Request body (JSON):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TrÆ°á»ng Viá»‡t Anh"</span><span class="p">,</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="nt">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vas-tenant-001"</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>MÃ´ táº£ trÆ°á»ng dá»¯ liá»‡u:</strong></p>
<ul>
<li><code>name</code> (string, báº¯t buá»™c): tÃªn hiá»ƒn thá»‹ cá»§a tenant (vÃ­ dá»¥: â€œTrÆ°á»ng Viá»‡t Anhâ€)</li>
<li><code>project_id</code> (string, báº¯t buá»™c): mÃ£ duy nháº¥t dÃ¹ng Ä‘á»ƒ cáº¥u hÃ¬nh mÃ´i trÆ°á»ng (cloud resource, codebase,...)</li>
</ul>
<hr/>
<h4 id="response_3">ğŸ“¤ Response<a class="headerlink" href="#response_3" title="Permanent link">Â¶</a></h4>
<p><strong>201 Created</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant_xyz789"</span><span class="p">,</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TrÆ°á»ng Viá»‡t Anh"</span><span class="p">,</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="nt">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vas-tenant-001"</span><span class="p">,</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-13T08:00:00Z"</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_3">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_3" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>tenant.create</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p><code>project_id</code> pháº£i duy nháº¥t toÃ n há»‡ thá»‘ng (unique index)</p>
</li>
<li>Chá»‰ Superadmin cÃ³ quyá»n gá»i</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_3">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_3" title="Permanent link">Â¶</a></h4>
<ul>
<li><code>tenant_created</code>
  Schema: <code>vas.tenant.created.v1</code>
  Payload: <code>{ tenant_id, name, project_id, created_at }</code>
  Consumer: táº¥t cáº£ cÃ¡c Sub Service khá»Ÿi táº¡o schema, role mapping theo tenant má»›i</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_3">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_3" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u <code>name</code> hoáº·c <code>project_id</code></td>
</tr>
<tr>
<td>401</td>
<td>Thiáº¿u hoáº·c sai JWT</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>tenant.create</code></td>
</tr>
<tr>
<td>409</td>
<td><code>project_id</code> Ä‘Ã£ tá»“n táº¡i</td>
</tr>
<tr>
<td>422</td>
<td><code>project_id</code> sai Ä‘á»‹nh dáº¡ng (<code>snake-case</code> yÃªu cáº§u)</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_3">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_3" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Táº¡o tenant vá»›i <code>project_id</code> há»£p lá»‡ â†’ tráº£ 201 + phÃ¡t event</li>
<li>âŒ Gá»i láº·p láº¡i vá»›i <code>project_id</code> Ä‘Ã£ tá»“n táº¡i â†’ tráº£ 409</li>
<li>âŒ Thiáº¿u JWT hoáº·c quyá»n â†’ tráº£ 401 / 403</li>
<li>âœ… Kiá»ƒm tra log trace_id trong meta</li>
<li>âœ… Kiá»ƒm tra Sub Service nháº­n event vÃ  táº¡o schema Ä‘Ãºng</li>
</ul>
<hr/>
<h3 id="55-get-user-tenant-assignments">5.5. <code>GET /user-tenant-assignments</code><a class="headerlink" href="#55-get-user-tenant-assignments" title="Permanent link">Â¶</a></h3>
<p>Liá»‡t kÃª táº¥t cáº£ cÃ¡c tenant mÃ  má»™t ngÆ°á»i dÃ¹ng toÃ n cá»¥c Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n vÃ o.<br/>
ÄÆ°á»£c sá»­ dá»¥ng bá»Ÿi Auth Service trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh â€œscopeâ€ khi login, hoáº·c bá»Ÿi Superadmin Ä‘á»ƒ kiá»ƒm tra tráº¡ng thÃ¡i phÃ¢n quyá»n.</p>
<hr/>
<h4 id="request_4">ğŸ“¥ Request<a class="headerlink" href="#request_4" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Query parameters:</strong>
- <code>user_global_id</code> (string, báº¯t buá»™c): ID ngÆ°á»i dÃ¹ng toÃ n cá»¥c cáº§n truy váº¥n
- <code>status</code> (optional): <code>active</code> | <code>revoked</code></p>
<hr/>
<h4 id="response_4">ğŸ“¤ Response<a class="headerlink" href="#response_4" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">      </span><span class="nt">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant_abc123"</span><span class="p">,</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">      </span><span class="nt">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vas-tenant-001"</span><span class="p">,</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">      </span><span class="nt">"assigned_by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin@vas.edu.vn"</span><span class="p">,</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">      </span><span class="nt">"assigned_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-01T10:00:00Z"</span><span class="p">,</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_4">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_4" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>tenant_user.read</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p><code>user_global_id</code> pháº£i tá»“n táº¡i</p>
</li>
<li>Gá»i tá»« há»‡ thá»‘ng trung tÃ¢m cÃ³ quyá»n truy cáº­p thÃ´ng tin phÃ¢n quyá»n toÃ n cá»¥c</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_4">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_4" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng phÃ¡t sinh sá»± kiá»‡n â€“ Ä‘Ã¢y lÃ  thao tÃ¡c chá»‰ Ä‘á»c</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_4">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_4" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u <code>user_global_id</code> hoáº·c sai Ä‘á»‹nh dáº¡ng</td>
</tr>
<tr>
<td>401</td>
<td>Thiáº¿u hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>tenant_user.read</code></td>
</tr>
<tr>
<td>404</td>
<td>KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_4">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_4" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Gá»i há»£p lá»‡ â†’ tráº£ danh sÃ¡ch tenant user Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n</li>
<li>âœ… Gá»i vá»›i <code>status=revoked</code> â†’ chá»‰ tráº£ assignment Ä‘Ã£ bá»‹ thu há»“i</li>
<li>âŒ KhÃ´ng cÃ³ <code>user_global_id</code> â†’ tráº£ 400</li>
<li>âœ… Kiá»ƒm tra trace_id cÃ³ trong pháº£n há»“i</li>
<li>âŒ Gá»i vá»›i JWT khÃ´ng cÃ³ quyá»n â†’ tráº£ 403</li>
</ul>
<hr/>
<h3 id="56-post-user-tenant-assignments">5.6. <code>POST /user-tenant-assignments</code><a class="headerlink" href="#56-post-user-tenant-assignments" title="Permanent link">Â¶</a></h3>
<p>GÃ¡n má»™t ngÆ°á»i dÃ¹ng toÃ n cá»¥c (<code>user_global_id</code>) vÃ o má»™t tenant cá»¥ thá»ƒ.<br/>
ÄÆ°á»£c sá»­ dá»¥ng bá»Ÿi Superadmin Ä‘á»ƒ phÃ¢n ngÆ°á»i dÃ¹ng (há»c sinh, giÃ¡o viÃªn, nhÃ¢n viÃªn) vÃ o trÆ°á»ng.<br/>
Sau khi gÃ¡n, há»‡ thá»‘ng sáº½ phÃ¡t sá»± kiá»‡n Ä‘á»ƒ cÃ¡c Sub Service táº¡o tÃ i khoáº£n tÆ°Æ¡ng á»©ng cho user trong mÃ´i trÆ°á»ng tenant.</p>
<hr/>
<h4 id="request_5">ğŸ“¥ Request<a class="headerlink" href="#request_5" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Request body (JSON):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="nt">"user_global_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usr_abc123"</span><span class="p">,</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span><span class="nt">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant_xyz789"</span><span class="p">,</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">  </span><span class="nt">"assigned_by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin@vas.edu.vn"</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>MÃ´ táº£ field:</strong></p>
<ul>
<li><code>user_global_id</code> (string, báº¯t buá»™c): ID ngÆ°á»i dÃ¹ng toÃ n cá»¥c</li>
<li><code>tenant_id</code> (string, báº¯t buá»™c): ID tenant mÃ  ngÆ°á»i dÃ¹ng sáº½ Ä‘Æ°á»£c gÃ¡n vÃ o</li>
<li><code>assigned_by</code> (string, tÃ¹y chá»n): email hoáº·c ID cá»§a ngÆ°á»i thá»±c hiá»‡n thao tÃ¡c</li>
</ul>
<hr/>
<h4 id="response_5">ğŸ“¤ Response<a class="headerlink" href="#response_5" title="Permanent link">Â¶</a></h4>
<p><strong>201 Created</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="nt">"assignment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assign_001"</span><span class="p">,</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="nt">"user_global_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usr_abc123"</span><span class="p">,</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="nt">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant_xyz789"</span><span class="p">,</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="nt">"assigned_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-13T08:30:00Z"</span>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-12"><a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_5">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_5" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>tenant_user.assign</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p>GÃ¡n trÃ¹ng (<code>user_global_id</code> Ä‘Ã£ thuá»™c <code>tenant_id</code>) â†’ tráº£ <code>409</code></p>
</li>
<li>Sub Service chá»‰ Ä‘á»“ng bá»™ khi tráº¡ng thÃ¡i lÃ  <code>active</code></li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_5">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_5" title="Permanent link">Â¶</a></h4>
<ul>
<li><code>tenant_user_assigned</code>
  Schema: <code>vas.tenant_user.assigned.v1</code>
  Payload: <code>{ user_global_id, tenant_id, assigned_by, assigned_at }</code>
  Consumer: Sub User Service, Auth Sub, Notification Sub, LMS Sub...</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_5">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_5" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u field báº¯t buá»™c (<code>user_global_id</code>, <code>tenant_id</code>)</td>
</tr>
<tr>
<td>401</td>
<td>KhÃ´ng cÃ³ hoáº·c sai JWT</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>tenant_user.assign</code></td>
</tr>
<tr>
<td>404</td>
<td>KhÃ´ng tÃ¬m tháº¥y user hoáº·c tenant</td>
</tr>
<tr>
<td>409</td>
<td>NgÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n vÃ o tenant nÃ y</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_5">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_5" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… GÃ¡n user chÆ°a tá»«ng thuá»™c tenant â†’ 201 Created + phÃ¡t event</li>
<li>âŒ GÃ¡n láº·p láº¡i user vÃ o cÃ¹ng tenant â†’ 409 Conflict</li>
<li>âœ… Kiá»ƒm tra sá»± kiá»‡n <code>tenant_user_assigned</code> Ä‘Æ°á»£c phÃ¡t Ä‘Ãºng schema</li>
<li>âŒ Gá»i thiáº¿u field â†’ tráº£ 400</li>
<li>âœ… Gá»i sai tenant hoáº·c user khÃ´ng tá»“n táº¡i â†’ 404</li>
<li>âœ… Kiá»ƒm tra trace_id cÃ³ trong meta pháº£n há»“i</li>
</ul>
<hr/>
<h3 id="57-get-global-roles-templates">5.7. <code>GET /global-roles-templates</code><a class="headerlink" href="#57-get-global-roles-templates" title="Permanent link">Â¶</a></h3>
<p>Liá»‡t kÃª táº¥t cáº£ cÃ¡c role template toÃ n cá»¥c.<br/>
ÄÆ°á»£c sá»­ dá»¥ng bá»Ÿi Superadmin Webapp vÃ  cÃ¡c Sub Service Ä‘á»ƒ tham chiáº¿u khi Ã¡p dá»¥ng RBAC template cho user trong tá»«ng tenant.</p>
<hr/>
<h4 id="request_6">ğŸ“¥ Request<a class="headerlink" href="#request_6" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Query parameters (optional):</strong>
- <code>is_system</code> (boolean): lá»c theo role máº·c Ä‘á»‹nh há»‡ thá»‘ng (<code>true</code>) hoáº·c do ngÆ°á»i dÃ¹ng táº¡o (<code>false</code>)</p>
<hr/>
<h4 id="response_6">ğŸ“¤ Response<a class="headerlink" href="#response_6" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">      </span><span class="nt">"template_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"student_basic"</span><span class="p">,</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Há»c sinh cÆ¡ báº£n"</span><span class="p">,</span>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">      </span><span class="nt">"is_system"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Quyá»n cÆ¡ báº£n cho há»c sinh"</span><span class="p">,</span>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">      </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"report.view"</span><span class="p">,</span><span class="w"> </span><span class="s2">"notification.read"</span><span class="p">]</span>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-9-13"><a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-9-14"><a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_6">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_6" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>rbac.template.read</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p>ÄÆ°á»£c sá»­ dá»¥ng trong context Superadmin hoáº·c há»‡ thá»‘ng Ä‘á»“ng bá»™</p>
</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_6">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_6" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng cÃ³ sá»± kiá»‡n â€“ thao tÃ¡c Ä‘á»c</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_6">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_6" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>401</td>
<td>KhÃ´ng cÃ³ hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>rbac.template.read</code></td>
</tr>
<tr>
<td>422</td>
<td><code>is_system</code> khÃ´ng há»£p lá»‡ (pháº£i lÃ  true/false)</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_6">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_6" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Gá»i bÃ¬nh thÆ°á»ng â†’ tráº£ danh sÃ¡ch role template toÃ n cá»¥c</li>
<li>âœ… Gá»i vá»›i <code>is_system=true</code> â†’ chá»‰ tráº£ role máº·c Ä‘á»‹nh há»‡ thá»‘ng</li>
<li>âŒ Gá»i khÃ´ng quyá»n â†’ tráº£ 403</li>
<li>âœ… Kiá»ƒm tra trace_id trong pháº£n há»“i</li>
<li>âœ… DÃ¹ng thÃ´ng tin <code>template_key</code> Ä‘á»ƒ tra cá»©u permission tÆ°Æ¡ng á»©ng</li>
</ul>
<hr/>
<h3 id="58-post-global-roles-templates">5.8. <code>POST /global-roles-templates</code><a class="headerlink" href="#58-post-global-roles-templates" title="Permanent link">Â¶</a></h3>
<p>Táº¡o má»›i má»™t role template toÃ n cá»¥c.<br/>
ÄÆ°á»£c sá»­ dá»¥ng bá»Ÿi Superadmin Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c nhÃ³m quyá»n chuáº©n Ã¡p dá»¥ng cho user trong tenant.<br/>
Khi template Ä‘Æ°á»£c táº¡o, Sub Service sáº½ cÃ³ thá»ƒ tra cá»©u vÃ  Ã¡p dá»¥ng tÆ°Æ¡ng á»©ng khi cáº¥u hÃ¬nh RBAC.</p>
<hr/>
<h4 id="request_7">ğŸ“¥ Request<a class="headerlink" href="#request_7" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Request body (JSON):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="nt">"template_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"teacher_advanced"</span><span class="p">,</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GiÃ¡o viÃªn nÃ¢ng cao"</span><span class="p">,</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Quyá»n Ä‘áº§y Ä‘á»§ cho giÃ¡o viÃªn bá»™ mÃ´n"</span><span class="p">,</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"report.view"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lms.grade.edit"</span><span class="p">]</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>MÃ´ táº£ field:</strong></p>
<ul>
<li><code>template_key</code> (string, báº¯t buá»™c): Ä‘á»‹nh danh duy nháº¥t cho template (snake_case)</li>
<li><code>name</code> (string, báº¯t buá»™c): tÃªn hiá»ƒn thá»‹</li>
<li><code>description</code> (string, tÃ¹y chá»n): mÃ´ táº£ chá»©c nÄƒng cá»§a role</li>
<li><code>permissions</code> (array string, báº¯t buá»™c): danh sÃ¡ch <code>permission_key</code> liÃªn káº¿t vá»›i role</li>
</ul>
<hr/>
<h4 id="response_7">ğŸ“¤ Response<a class="headerlink" href="#response_7" title="Permanent link">Â¶</a></h4>
<p><strong>201 Created</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="p">{</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="nt">"template_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"teacher_advanced"</span><span class="p">,</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GiÃ¡o viÃªn nÃ¢ng cao"</span><span class="p">,</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"report.view"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lms.grade.edit"</span><span class="p">]</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_7">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_7" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>rbac.template.create</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p><code>template_key</code> duy nháº¥t (unique)</p>
</li>
<li>CÃ¡c <code>permission_key</code> pháº£i tá»“n táº¡i trong danh sÃ¡ch permission template toÃ n cá»¥c</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_7">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_7" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng phÃ¡t sá»± kiá»‡n ngay.
  Chá»‰ phÃ¡t khi cÃ³ cáº­p nháº­t (<code>PATCH</code>) template (<code>rbac_template_updated</code>)</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_7">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_7" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u field báº¯t buá»™c hoáº·c Ä‘á»‹nh dáº¡ng sai</td>
</tr>
<tr>
<td>401</td>
<td>Thiáº¿u hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>rbac.template.create</code></td>
</tr>
<tr>
<td>409</td>
<td><code>template_key</code> Ä‘Ã£ tá»“n táº¡i</td>
</tr>
<tr>
<td>422</td>
<td><code>permissions</code> chá»©a <code>permission_key</code> khÃ´ng há»£p lá»‡</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_7">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_7" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Táº¡o má»›i role template vá»›i <code>template_key</code> há»£p lá»‡ â†’ tráº£ 201</li>
<li>âŒ Táº¡o trÃ¹ng <code>template_key</code> â†’ tráº£ 409</li>
<li>âœ… Kiá»ƒm tra <code>permission_key</code> há»£p lá»‡ â†’ cháº¥p nháº­n</li>
<li>âŒ ChÃ¨n <code>permission_key</code> khÃ´ng cÃ³ â†’ tráº£ 422</li>
<li>âœ… Kiá»ƒm tra trace_id trong pháº£n há»“i</li>
</ul>
<hr/>
<h3 id="59-get-global-permissions-templates">5.9. <code>GET /global-permissions-templates</code><a class="headerlink" href="#59-get-global-permissions-templates" title="Permanent link">Â¶</a></h3>
<p>Liá»‡t kÃª táº¥t cáº£ cÃ¡c permission template toÃ n cá»¥c.<br/>
ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cáº¥u hÃ¬nh role template hoáº·c Ä‘á»ƒ gá»£i Ã½ quyá»n trong UI Superadmin Webapp.<br/>
LÃ  nguá»“n dá»¯ liá»‡u chuáº©n Ä‘á»ƒ cáº¥u trÃºc RBAC cho toÃ n há»‡ thá»‘ng theo táº§ng dá»‹ch vá»¥.</p>
<hr/>
<h4 id="request_8">ğŸ“¥ Request<a class="headerlink" href="#request_8" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Query parameters (optional):</strong>
- <code>service_scope</code> (string): lá»c cÃ¡c permission theo tÃªn service, vÃ­ dá»¥ <code>"report"</code>, <code>"lms"</code><br/>
- <code>keyword</code> (string): tÃ¬m kiáº¿m theo <code>permission_key</code> hoáº·c mÃ´ táº£</p>
<hr/>
<h4 id="response_8">ğŸ“¤ Response<a class="headerlink" href="#response_8" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="p">{</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">      </span><span class="nt">"permission_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"report.view"</span><span class="p">,</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">      </span><span class="nt">"service_scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"report"</span><span class="p">,</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Xem bÃ¡o cÃ¡o há»c táº­p"</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">      </span><span class="nt">"permission_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lms.grade.edit"</span><span class="p">,</span>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">      </span><span class="nt">"service_scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lms"</span><span class="p">,</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cháº¥m Ä‘iá»ƒm há»c viÃªn"</span>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-12-14"><a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-15"><a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-12-16"><a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-17"><a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_8">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_8" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>rbac.template.read</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p>Gá»i tá»« Superadmin Webapp hoáº·c há»‡ thá»‘ng ná»™i bá»™ trung tÃ¢m</p>
</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_8">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_8" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng cÃ³ â€“ Ä‘Ã¢y lÃ  thao tÃ¡c tra cá»©u tÄ©nh</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_8">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_8" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>401</td>
<td>KhÃ´ng cÃ³ hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>rbac.template.read</code></td>
</tr>
<tr>
<td>422</td>
<td><code>service_scope</code> khÃ´ng há»£p lá»‡ (náº¿u validate)</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_8">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_8" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Tráº£ danh sÃ¡ch Ä‘áº§y Ä‘á»§ permission template náº¿u khÃ´ng cÃ³ filter</li>
<li>âœ… Gá»i vá»›i <code>service_scope=report</code> â†’ chá»‰ tráº£ cÃ¡c permission liÃªn quan</li>
<li>âœ… Gá»i vá»›i <code>keyword=grade</code> â†’ tráº£ cÃ¡c permission cÃ³ liÃªn quan</li>
<li>âŒ Gá»i sai quyá»n hoáº·c JWT â†’ tráº£ 403 hoáº·c 401</li>
<li>âœ… Kiá»ƒm tra trace_id cÃ³ trong pháº£n há»“i</li>
</ul>
<hr/>
<h3 id="510-post-global-permissions-templates">5.10. <code>POST /global-permissions-templates</code><a class="headerlink" href="#510-post-global-permissions-templates" title="Permanent link">Â¶</a></h3>
<p>Táº¡o má»™t permission template má»›i á»Ÿ cáº¥p toÃ n cá»¥c.<br/>
ÄÆ°á»£c sá»­ dá»¥ng bá»Ÿi Superadmin Ä‘á»ƒ má»Ÿ rá»™ng há»‡ thá»‘ng quyá»n theo tá»«ng dá»‹ch vá»¥ (service_scope).<br/>
CÃ¡c permission nÃ y lÃ  Ä‘Æ¡n vá»‹ cÆ¡ báº£n Ä‘á»ƒ gÃ¡n vÃ o role template vÃ  Ã¡p dá»¥ng cho RBAC tenant.</p>
<hr/>
<h4 id="request_9">ğŸ“¥ Request<a class="headerlink" href="#request_9" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Request body (JSON):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="nt">"permission_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"finance.invoice.view"</span><span class="p">,</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="nt">"service_scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"finance"</span><span class="p">,</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Xem hÃ³a Ä‘Æ¡n há»c phÃ­"</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>MÃ´ táº£ field:</strong></p>
<ul>
<li><code>permission_key</code> (string, báº¯t buá»™c): Ä‘á»‹nh danh quyá»n (theo Ä‘á»‹nh dáº¡ng <code>scope.action</code>, vÃ­ dá»¥: <code>report.view</code>)</li>
<li><code>service_scope</code> (string, báº¯t buá»™c): tÃªn dá»‹ch vá»¥ liÃªn quan (vÃ­ dá»¥: <code>report</code>, <code>lms</code>, <code>finance</code>)</li>
<li><code>description</code> (string, tÃ¹y chá»n): mÃ´ táº£ rÃµ hÃ nh vi gáº¯n vá»›i quyá»n</li>
</ul>
<hr/>
<h4 id="response_9">ğŸ“¤ Response<a class="headerlink" href="#response_9" title="Permanent link">Â¶</a></h4>
<p><strong>201 Created</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="p">{</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="nt">"permission_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"finance.invoice.view"</span><span class="p">,</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="nt">"service_scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"finance"</span><span class="p">,</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Xem hÃ³a Ä‘Æ¡n há»c phÃ­"</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_9">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_9" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>rbac.template.create</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p><code>permission_key</code> pháº£i duy nháº¥t</p>
</li>
<li><code>permission_key</code> tuÃ¢n Ä‘á»‹nh dáº¡ng <code>service_scope.action</code> (snake_case)</li>
<li><code>service_scope</code> pháº£i Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a há»£p lá»‡ trong há»‡ thá»‘ng</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_9">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_9" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng phÃ¡t â€“ permission chá»‰ cÃ³ hiá»‡u lá»±c khi gÃ¡n vÃ o role template</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_9">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_9" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u field hoáº·c sai Ä‘á»‹nh dáº¡ng</td>
</tr>
<tr>
<td>401</td>
<td>KhÃ´ng cÃ³ hoáº·c sai JWT</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>rbac.template.create</code></td>
</tr>
<tr>
<td>409</td>
<td><code>permission_key</code> Ä‘Ã£ tá»“n táº¡i</td>
</tr>
<tr>
<td>422</td>
<td><code>permission_key</code> sai Ä‘á»‹nh dáº¡ng (<code>&lt;scope&gt;.&lt;action&gt;</code>)</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_9">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_9" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Táº¡o permission má»›i há»£p lá»‡ â†’ tráº£ 201</li>
<li>âŒ Táº¡o permission trÃ¹ng <code>permission_key</code> â†’ tráº£ 409</li>
<li>âŒ <code>permission_key</code> thiáº¿u dáº¥u cháº¥m hoáº·c sai kiá»ƒu â†’ tráº£ 422</li>
<li>âœ… Kiá»ƒm tra trace_id trong pháº£n há»“i</li>
<li>âœ… DÃ¹ng permission má»›i Ä‘á»ƒ gÃ¡n vÃ o role template vÃ  kiá»ƒm tra hiá»‡u lá»±c</li>
</ul>
<hr/>
<h3 id="511-patch-global-roles-templatestemplate_key">5.11. <code>PATCH /global-roles-templates/{template_key}</code><a class="headerlink" href="#511-patch-global-roles-templatestemplate_key" title="Permanent link">Â¶</a></h3>
<p>Cáº­p nháº­t danh sÃ¡ch quyá»n (permissions) cá»§a má»™t role template toÃ n cá»¥c.<br/>
Sau khi cáº­p nháº­t, há»‡ thá»‘ng sáº½ phÃ¡t sá»± kiá»‡n <code>rbac_template_updated</code> Ä‘á»ƒ cÃ¡c Sub Service Ä‘á»“ng bá»™ láº¡i RBAC cache cho cÃ¡c tenant.</p>
<hr/>
<h4 id="request_10">ğŸ“¥ Request<a class="headerlink" href="#request_10" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Path parameters:</strong>
- <code>template_key</code> (string, báº¯t buá»™c): Ä‘á»‹nh danh cá»§a role template cáº§n cáº­p nháº­t</p>
<p><strong>Request body (JSON):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="p">{</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">  </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"report.view"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lms.grade.edit"</span><span class="p">]</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>MÃ´ táº£ field:</strong></p>
<ul>
<li><code>permissions</code> (array string, báº¯t buá»™c): danh sÃ¡ch <code>permission_key</code> má»›i cho template nÃ y.
  Danh sÃ¡ch cÅ© sáº½ bá»‹ thay tháº¿ hoÃ n toÃ n.</li>
</ul>
<hr/>
<h4 id="response_10">ğŸ“¤ Response<a class="headerlink" href="#response_10" title="Permanent link">Â¶</a></h4>
<p><strong>200 OK</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="p">{</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="nt">"template_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"teacher_advanced"</span><span class="p">,</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="nt">"updated_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"report.view"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lms.grade.edit"</span><span class="p">]</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_10">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_10" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>rbac.template.update</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p><code>template_key</code> pháº£i tá»“n táº¡i</p>
</li>
<li>CÃ¡c <code>permission_key</code> cung cáº¥p pháº£i tá»“n táº¡i trong global permissions template</li>
<li>KhÃ´ng cho phÃ©p chá»‰nh sá»­a cÃ¡c template cÃ³ <code>is_system = true</code> (náº¿u Ã¡p dá»¥ng)</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_10">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_10" title="Permanent link">Â¶</a></h4>
<ul>
<li><code>rbac_template_updated</code>
  Schema: <code>vas.rbac.template.updated.v1</code>
  Payload: <code>{ template_key, updated_permissions, updated_at }</code>
  Consumer: táº¥t cáº£ Sub Service sá»­ dá»¥ng RBAC caching (User Sub, LMS Sub, CRM Sub...)</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_10">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_10" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Thiáº¿u hoáº·c sai Ä‘á»‹nh dáº¡ng <code>permissions</code></td>
</tr>
<tr>
<td>401</td>
<td>KhÃ´ng cÃ³ hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>rbac.template.update</code></td>
</tr>
<tr>
<td>404</td>
<td><code>template_key</code> khÃ´ng tá»“n táº¡i</td>
</tr>
<tr>
<td>422</td>
<td>CÃ³ <code>permission_key</code> khÃ´ng tá»“n táº¡i trong há»‡ thá»‘ng</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_10">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_10" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Cáº­p nháº­t role template vá»›i quyá»n há»£p lá»‡ â†’ tráº£ 200 + phÃ¡t event</li>
<li>âŒ Sá»­ dá»¥ng <code>template_key</code> khÃ´ng tá»“n táº¡i â†’ tráº£ 404</li>
<li>âŒ ChÃ¨n <code>permission_key</code> sai â†’ tráº£ 422</li>
<li>âœ… Kiá»ƒm tra event <code>rbac_template_updated</code> phÃ¡t Ä‘Ãºng schema</li>
<li>âœ… Kiá»ƒm tra trace_id cÃ³ trong pháº£n há»“i</li>
</ul>
<hr/>
<h3 id="512-patch-global-permissions-templatesperm_key">5.12. <code>PATCH /global-permissions-templates/{perm_key}</code><a class="headerlink" href="#512-patch-global-permissions-templatesperm_key" title="Permanent link">Â¶</a></h3>
<p>Cáº­p nháº­t thÃ´ng tin mÃ´ táº£ hoáº·c <code>service_scope</code> cá»§a má»™t permission template toÃ n cá»¥c.<br/>
Sá»­ dá»¥ng trong trÆ°á»ng há»£p cáº§n Ä‘iá»u chá»‰nh mÃ´ táº£ cho rÃµ rÃ ng hÆ¡n, hoáº·c chuyá»ƒn scope sang dá»‹ch vá»¥ khÃ¡c trong quÃ¡ trÃ¬nh refactor há»‡ thá»‘ng.</p>
<hr/>
<h4 id="request_11">ğŸ“¥ Request<a class="headerlink" href="#request_11" title="Permanent link">Â¶</a></h4>
<p><strong>Headers:</strong>
- <code>Authorization: Bearer &lt;JWT&gt;</code></p>
<p><strong>Path parameters:</strong>
- <code>perm_key</code> (string, báº¯t buá»™c): Ä‘á»‹nh danh cá»§a permission cáº§n cáº­p nháº­t</p>
<p><strong>Request body (JSON):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="p">{</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Quyá»n xem hÃ³a Ä‘Æ¡n há»c phÃ­"</span><span class="p">,</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="nt">"service_scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"billing"</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>MÃ´ táº£ field:</strong></p>
<ul>
<li><code>description</code> (string, optional): mÃ´ táº£ cáº­p nháº­t</li>
<li><code>service_scope</code> (string, optional): tÃªn service má»›i (náº¿u cáº§n Ä‘á»•i)</li>
</ul>
<hr/>
<h4 id="response_11">ğŸ“¤ Response<a class="headerlink" href="#response_11" title="Permanent link">Â¶</a></h4>
<p><strong>200 OK</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="nt">"permission_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"finance.invoice.view"</span><span class="p">,</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Quyá»n xem hÃ³a Ä‘Æ¡n há»c phÃ­"</span><span class="p">,</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="nt">"service_scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"billing"</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">    </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz"</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="phan-quyen-ieu-kien_11">ğŸ” PhÃ¢n quyá»n &amp; Äiá»u kiá»‡n<a class="headerlink" href="#phan-quyen-ieu-kien_11" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>YÃªu cáº§u:</strong> Bearer JWT há»£p lá»‡</li>
<li><strong>Quyá»n:</strong> <code>rbac.template.update</code></li>
<li>
<p><strong>Äiá»u kiá»‡n:</strong></p>
</li>
<li>
<p><code>perm_key</code> pháº£i tá»“n táº¡i</p>
</li>
<li>KhÃ´ng cho phÃ©p Ä‘á»•i <code>permission_key</code> (immutable)</li>
<li>Náº¿u cáº­p nháº­t <code>service_scope</code>, giÃ¡ trá»‹ má»›i pháº£i há»£p lá»‡ theo quy Æ°á»›c há»‡ thá»‘ng</li>
</ul>
<hr/>
<h4 id="su-kien-phat-ra_11">ğŸ“£ Sá»± kiá»‡n phÃ¡t ra<a class="headerlink" href="#su-kien-phat-ra_11" title="Permanent link">Â¶</a></h4>
<ul>
<li>âŒ KhÃ´ng phÃ¡t sá»± kiá»‡n â€“ vÃ¬ khÃ´ng áº£nh hÆ°á»Ÿng logic phÃ¢n quyá»n runtime
  (permission Ä‘Æ°á»£c Ã¡p dá»¥ng thÃ´ng qua role template Ä‘Ã£ cache riÃªng)</li>
</ul>
<hr/>
<h4 id="ma-loi-co-the-tra-ve_11">âŒ MÃ£ lá»—i cÃ³ thá»ƒ tráº£ vá»<a class="headerlink" href="#ma-loi-co-the-tra-ve_11" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Body rá»—ng hoáº·c khÃ´ng cÃ³ field há»£p lá»‡ Ä‘á»ƒ cáº­p nháº­t</td>
</tr>
<tr>
<td>401</td>
<td>Thiáº¿u hoáº·c JWT khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>403</td>
<td>KhÃ´ng cÃ³ quyá»n <code>rbac.template.update</code></td>
</tr>
<tr>
<td>404</td>
<td><code>perm_key</code> khÃ´ng tá»“n táº¡i</td>
</tr>
<tr>
<td>422</td>
<td><code>service_scope</code> má»›i khÃ´ng há»£p lá»‡</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu_11">ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­<a class="headerlink" href="#goi-y-kiem-thu_11" title="Permanent link">Â¶</a></h4>
<ul>
<li>âœ… Cáº­p nháº­t mÃ´ táº£ permission â†’ tráº£ 200</li>
<li>âœ… Cáº­p nháº­t <code>service_scope</code> â†’ tráº£ 200, kiá»ƒm tra hiá»ƒn thá»‹ Ä‘Ãºng nÆ¡i dÃ¹ng</li>
<li>âŒ Gá»i vá»›i <code>perm_key</code> sai â†’ tráº£ 404</li>
<li>âŒ Body rá»—ng hoáº·c khÃ´ng há»£p lá»‡ â†’ tráº£ 400</li>
<li>âœ… Kiá»ƒm tra trace_id trong pháº£n há»“i</li>
</ul>
<hr/>
<h2 id="6-su-kien-phat-ra-pubsub">6. ğŸ“¡ Sá»± kiá»‡n phÃ¡t ra (Pub/Sub)<a class="headerlink" href="#6-su-kien-phat-ra-pubsub" title="Permanent link">Â¶</a></h2>
<p><code>user-service/master</code> lÃ  nguá»“n phÃ¡t sinh má»™t sá»‘ sá»± kiá»‡n quan trá»ng phá»¥c vá»¥ cho quÃ¡ trÃ¬nh Ä‘á»“ng bá»™ dá»¯ liá»‡u ngÆ°á»i dÃ¹ng vÃ  RBAC phÃ¢n táº§ng trong toÃ n bá»™ há»‡ thá»‘ng.<br/>
CÃ¡c sá»± kiá»‡n Ä‘á»u tuÃ¢n theo chuáº©n Ä‘á»‹nh danh <code>vas.&lt;domain&gt;.&lt;action&gt;.v1</code> theo <code>adr-030-event-schema-governance.md</code>.</p>
<table>
<thead>
<tr>
<th>Event Name</th>
<th>Trigger</th>
<th>Schema</th>
<th>Consumer (vÃ­ dá»¥)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_global_created</code></td>
<td>Khi táº¡o user toÃ n cá»¥c (<code>POST /users-global</code>)</td>
<td><code>vas.user.created.v1</code></td>
<td><code>user-service/sub</code>, <code>audit-log</code></td>
</tr>
<tr>
<td><code>tenant_created</code></td>
<td>Khi táº¡o tenant má»›i (<code>POST /tenants</code>)</td>
<td><code>vas.tenant.created.v1</code></td>
<td><code>user-service/sub</code>, <code>sms-service</code></td>
</tr>
<tr>
<td><code>tenant_user_assigned</code></td>
<td>Khi gÃ¡n user vÃ o tenant (<code>POST /user-tenant-assignments</code>)</td>
<td><code>vas.tenant_user.assigned.v1</code></td>
<td><code>user-service/sub</code>, <code>auth-service/sub</code></td>
</tr>
<tr>
<td><code>rbac_template_updated</code></td>
<td>Khi cáº­p nháº­t role template (<code>PATCH /global-roles-templates/{template_key}</code>)</td>
<td><code>vas.rbac.template.updated.v1</code></td>
<td><code>user-service/sub</code>, <code>lms-service/sub</code></td>
</tr>
</tbody>
</table>
<hr/>
<p><strong>LÆ°u Ã½:</strong>
- Má»—i sá»± kiá»‡n Ä‘á»u kÃ¨m <code>trace_id</code> Ä‘á»ƒ phá»¥c vá»¥ cho audit vÃ  trace liÃªn dá»‹ch vá»¥.
- ToÃ n bá»™ schema Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a rÃµ trong <code>event-schema.yaml</code> cá»§a <code>eventing standard</code> (tham kháº£o <code>adr-030</code>).
- CÃ¡c Sub Service sáº½ dÃ¹ng consumer riÃªng biá»‡t Ä‘á»ƒ xá»­ lÃ½ sá»± kiá»‡n theo <code>tenant_id</code>.</p>
<hr/>
<h3 id="61-vi-du-su-kien-user_global_created">6.1. ğŸ“¦ VÃ­ dá»¥: Sá»± kiá»‡n <code>user_global_created</code><a class="headerlink" href="#61-vi-du-su-kien-user_global_created" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>ÄÆ°á»£c phÃ¡t bá»Ÿi:</strong> <code>POST /users-global</code></li>
<li><strong>TiÃªu chuáº©n Ä‘á»‹nh danh:</strong> <code>vas.user.created.v1</code></li>
<li><strong>Má»¥c Ä‘Ã­ch:</strong> Äá»“ng bá»™ táº¡o user tá»›i cÃ¡c Sub Service (User Sub, Notification, LMS, Audit...)</li>
</ul>
<hr/>
<h4 id="payload-mau">ğŸ“¤ Payload máº«u<a class="headerlink" href="#payload-mau" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="p">{</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">  </span><span class="nt">"event_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vas.user.created.v1"</span><span class="p">,</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">  </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc-xyz-123"</span><span class="p">,</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">  </span><span class="nt">"emitted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-13T08:35:00Z"</span><span class="p">,</span>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">    </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usr_xyz789"</span><span class="p">,</span>
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@vas.edu.vn"</span><span class="p">,</span>
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">    </span><span class="nt">"auth_provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span>
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">    </span><span class="nt">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice B"</span><span class="p">,</span>
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span>
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">    </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-13T08:30:00Z"</span>
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="mo-ta-schema">ğŸ§¾ MÃ´ táº£ schema<a class="headerlink" href="#mo-ta-schema" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Kiá»ƒu</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event_name</code></td>
<td>string</td>
<td>âœ…</td>
<td>Äá»‹nh danh sá»± kiá»‡n theo chuáº©n ADR-030</td>
</tr>
<tr>
<td><code>trace_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>ID trace phá»¥c vá»¥ observability</td>
</tr>
<tr>
<td><code>emitted_at</code></td>
<td>datetime</td>
<td>âœ…</td>
<td>Thá»i Ä‘iá»ƒm sá»± kiá»‡n Ä‘Æ°á»£c phÃ¡t</td>
</tr>
<tr>
<td><code>data.user_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>ID ngÆ°á»i dÃ¹ng toÃ n cá»¥c</td>
</tr>
<tr>
<td><code>data.email</code></td>
<td>string</td>
<td>âœ…</td>
<td>Email Ä‘Äƒng nháº­p</td>
</tr>
<tr>
<td><code>data.auth_provider</code></td>
<td>enum (<code>google</code>, <code>local</code>, <code>otp</code>)</td>
<td>âœ…</td>
<td>NhÃ  cung cáº¥p xÃ¡c thá»±c</td>
</tr>
<tr>
<td><code>data.full_name</code></td>
<td>string</td>
<td>âœ…</td>
<td>Há» tÃªn ngÆ°á»i dÃ¹ng</td>
</tr>
<tr>
<td><code>data.status</code></td>
<td>string</td>
<td>âœ…</td>
<td>Tráº¡ng thÃ¡i ban Ä‘áº§u (<code>active</code>, <code>inactive</code>)</td>
</tr>
<tr>
<td><code>data.created_at</code></td>
<td>datetime</td>
<td>âœ…</td>
<td>Thá»i Ä‘iá»ƒm khá»Ÿi táº¡o</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu-su-kien">âœ… Gá»£i Ã½ kiá»ƒm thá»­ sá»± kiá»‡n<a class="headerlink" href="#goi-y-kiem-thu-su-kien" title="Permanent link">Â¶</a></h4>
<ul>
<li>Táº¡o user má»›i â†’ kiá»ƒm tra message Ä‘Æ°á»£c Ä‘áº©y vÃ o message broker (Kafka, NATS...)</li>
<li>Kiá»ƒm tra trace_id cÃ³ máº·t á»Ÿ cáº£ phÃ­a caller láº«n message</li>
<li>Sub Service nháº­n Ä‘Ãºng schema vÃ  xá»­ lÃ½ Ä‘Ãºng logic khá»Ÿi táº¡o user ná»™i bá»™</li>
</ul>
<hr/>
<h3 id="62-vi-du-su-kien-tenant_user_assigned">6.2. ğŸ“¦ VÃ­ dá»¥: Sá»± kiá»‡n <code>tenant_user_assigned</code><a class="headerlink" href="#62-vi-du-su-kien-tenant_user_assigned" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>ÄÆ°á»£c phÃ¡t bá»Ÿi:</strong> <code>POST /user-tenant-assignments</code></li>
<li><strong>TiÃªu chuáº©n Ä‘á»‹nh danh:</strong> <code>vas.tenant_user.assigned.v1</code></li>
<li><strong>Má»¥c Ä‘Ã­ch:</strong> Äá»“ng bá»™ viá»‡c gÃ¡n user vÃ o tenant tá»›i cÃ¡c Sub Service Ä‘á»ƒ khá»Ÿi táº¡o user ná»™i bá»™ trong tenant context.</li>
</ul>
<hr/>
<h4 id="payload-mau_1">ğŸ“¤ Payload máº«u<a class="headerlink" href="#payload-mau_1" title="Permanent link">Â¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="p">{</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">  </span><span class="nt">"event_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vas.tenant_user.assigned.v1"</span><span class="p">,</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">  </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"trace-xyz-456"</span><span class="p">,</span>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">  </span><span class="nt">"emitted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-13T09:15:00Z"</span><span class="p">,</span>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="nt">"user_global_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usr_abc123"</span><span class="p">,</span>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">    </span><span class="nt">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant_vas001"</span><span class="p">,</span>
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">    </span><span class="nt">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vas-tenant-001"</span><span class="p">,</span>
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">    </span><span class="nt">"assigned_by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin@vas.edu.vn"</span><span class="p">,</span>
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">    </span><span class="nt">"assigned_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-06-13T09:14:00Z"</span>
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-12"><a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="p">}</span>
</span></code></pre></div>
<hr/>
<h4 id="mo-ta-schema_1">ğŸ§¾ MÃ´ táº£ schema<a class="headerlink" href="#mo-ta-schema_1" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Kiá»ƒu</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event_name</code></td>
<td>string</td>
<td>âœ…</td>
<td>Äá»‹nh danh sá»± kiá»‡n (theo ADR-030)</td>
</tr>
<tr>
<td><code>trace_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>Trace ID liÃªn káº¿t vá»›i luá»“ng tÆ°Æ¡ng tÃ¡c</td>
</tr>
<tr>
<td><code>emitted_at</code></td>
<td>datetime</td>
<td>âœ…</td>
<td>Thá»i Ä‘iá»ƒm phÃ¡t sá»± kiá»‡n</td>
</tr>
<tr>
<td><code>data.user_global_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>ID ngÆ°á»i dÃ¹ng toÃ n cá»¥c</td>
</tr>
<tr>
<td><code>data.tenant_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>ID tenant Ä‘Ã­ch</td>
</tr>
<tr>
<td><code>data.project_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>MÃ£ Ä‘á»‹nh danh duy nháº¥t cá»§a tenant (dÃ¹ng cho context isolation)</td>
</tr>
<tr>
<td><code>data.assigned_by</code></td>
<td>string</td>
<td>âœ…</td>
<td>NgÆ°á»i thá»±c hiá»‡n thao tÃ¡c gÃ¡n (email hoáº·c ID)</td>
</tr>
<tr>
<td><code>data.assigned_at</code></td>
<td>datetime</td>
<td>âœ…</td>
<td>Thá»i Ä‘iá»ƒm thao tÃ¡c gÃ¡n Ä‘Æ°á»£c thá»±c hiá»‡n</td>
</tr>
</tbody>
</table>
<hr/>
<h4 id="goi-y-kiem-thu-su-kien_1">âœ… Gá»£i Ã½ kiá»ƒm thá»­ sá»± kiá»‡n<a class="headerlink" href="#goi-y-kiem-thu-su-kien_1" title="Permanent link">Â¶</a></h4>
<ul>
<li>Thá»±c hiá»‡n <code>POST /user-tenant-assignments</code> â†’ kiá»ƒm tra event Ä‘Æ°á»£c Ä‘áº©y Ä‘Ãºng Ä‘á»‹nh dáº¡ng</li>
<li>Sub Service kiá»ƒm tra context <code>tenant_id + project_id</code> Ä‘á»ƒ táº¡o schema hoáº·c account ná»™i bá»™</li>
<li>Audit Service ghi nháº­n <code>assigned_by</code> + <code>trace_id</code> Ä‘á»ƒ phá»¥c vá»¥ tra soÃ¡t</li>
<li>Kiá»ƒm tra event khÃ´ng phÃ¡t trÃ¹ng khi gÃ¡n láº¡i user cÅ©</li>
</ul>
<hr/>
<h2 id="7-cach-su-dung-pho-bien-business-flow">7. ğŸ§  CÃ¡ch sá»­ dá»¥ng phá»• biáº¿n (business flow)<a class="headerlink" href="#7-cach-su-dung-pho-bien-business-flow" title="Permanent link">Â¶</a></h2>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c luá»“ng nghiá»‡p vá»¥ chÃ­nh cÃ³ sá»± tham gia cá»§a <code>user-service/master</code>, Ä‘Ã³ng vai trÃ² trung tÃ¢m trong quáº£n lÃ½ Ä‘á»‹nh danh toÃ n cá»¥c, RBAC phÃ¢n táº§ng, vÃ  Ä‘á»“ng bá»™ user Ä‘áº¿n tá»«ng tenant.</p>
<hr/>
<h3 id="71-ang-nhap-lan-au-tao-user-toan-cuc-qua-auth-service">7.1. ğŸŒ ÄÄƒng nháº­p láº§n Ä‘áº§u &amp; táº¡o user toÃ n cá»¥c (qua Auth Service)<a class="headerlink" href="#71-ang-nhap-lan-au-tao-user-toan-cuc-qua-auth-service" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant FE as Frontend
    participant Auth as Auth Service
    participant UserMaster as User Service Master

    FE-&gt;&gt;Auth: Gá»­i mÃ£ OAuth (code)
    Auth-&gt;&gt;UserMaster: GET /users-global/by-email
    alt User chÆ°a tá»“n táº¡i
        Auth-&gt;&gt;UserMaster: POST /users-global
    end
    UserMaster--&gt;&gt;Auth: Tráº£ thÃ´ng tin user toÃ n cá»¥c
    Auth--&gt;&gt;FE: Tráº£ JWT + profile
</code></pre>
<hr/>
<h3 id="72-superadmin-tao-tenant-moi-phan-quyen">7.2. ğŸ« Superadmin táº¡o tenant má»›i &amp; phÃ¢n quyá»n<a class="headerlink" href="#72-superadmin-tao-tenant-moi-phan-quyen" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant Superadmin
    participant UserMaster as User Service Master
    participant AllSubs as Sub Services

    Superadmin-&gt;&gt;UserMaster: POST /tenants
    UserMaster--&gt;&gt;AllSubs: Emit `tenant_created`

    Superadmin-&gt;&gt;UserMaster: POST /user-tenant-assignments
    UserMaster--&gt;&gt;AllSubs: Emit `tenant_user_assigned`
</code></pre>
<hr/>
<h3 id="73-quan-tri-rbac-toan-cuc">7.3. ğŸ” Quáº£n trá»‹ RBAC toÃ n cá»¥c<a class="headerlink" href="#73-quan-tri-rbac-toan-cuc" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant Admin
    participant UserMaster as User Service Master
    participant LMSSub as LMS Sub Service

    Admin-&gt;&gt;UserMaster: POST /global-roles-templates
    Admin-&gt;&gt;UserMaster: POST /global-permissions-templates
    Admin-&gt;&gt;UserMaster: PATCH /global-roles-templates/{template_key}
    UserMaster--&gt;&gt;LMSSub: Emit `rbac_template_updated`
</code></pre>
<hr/>
<h3 id="74-ong-bo-user-cho-tenant-moi-qua-sub-service">7.4. ğŸ§© Äá»“ng bá»™ user cho tenant má»›i (qua Sub Service)<a class="headerlink" href="#74-ong-bo-user-cho-tenant-moi-qua-sub-service" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant TenantFE as Tenant Webapp
    participant AuthSub as Auth Sub
    participant UserSub as User Sub
    participant UserMaster as User Service Master

    TenantFE-&gt;&gt;AuthSub: ÄÄƒng nháº­p
    AuthSub-&gt;&gt;UserMaster: GET /users-global/by-email
    AuthSub-&gt;&gt;UserMaster: GET /user-tenant-assignments
    alt Náº¿u chÆ°a Ä‘Æ°á»£c gÃ¡n
        AuthSub-&gt;&gt;UserMaster: POST /user-tenant-assignments
        UserMaster--&gt;&gt;UserSub: Emit `tenant_user_assigned`
    end
    UserSub--&gt;&gt;AuthSub: Sync thÃ´ng tin user tenant
    AuthSub--&gt;&gt;TenantFE: Tráº£ JWT theo context tenant
</code></pre>
<hr/>
<h3 id="ghi-chu">ğŸ” Ghi chÃº<a class="headerlink" href="#ghi-chu" title="Permanent link">Â¶</a></h3>
<ul>
<li>Má»—i luá»“ng Ä‘á»u gáº¯n cháº·t vá»›i cÃ¡c API Ä‘Ã£ Ä‘á»‹nh nghÄ©a vÃ  sá»± kiá»‡n phÃ¡t ra tÆ°Æ¡ng á»©ng trong má»¥c 5â€“6.</li>
<li>Trace ID luÃ´n Ä‘Æ°á»£c truyá»n theo toÃ n luá»“ng, phá»¥c vá»¥ audit vÃ  debug.</li>
<li>CÃ¡c luá»“ng luÃ´n Ä‘i tá»« dá»‹ch vá»¥ trung tÃ¢m (<code>master</code>) xuá»‘ng dá»‹ch vá»¥ con (<code>sub</code>), Ä‘Ãºng vá»›i kiáº¿n trÃºc phÃ¢n táº§ng multi-tenant Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong <code>system-diagrams.md</code>.</li>
</ul>
<hr/>
<h2 id="8-phu-luc">8. ğŸ“ Phá»¥ lá»¥c<a class="headerlink" href="#8-phu-luc" title="Permanent link">Â¶</a></h2>
<h3 id="81-chuan-hoa-ma-loi-error-codes">8.1. ğŸ“š Chuáº©n hÃ³a mÃ£ lá»—i (Error Codes)<a class="headerlink" href="#81-chuan-hoa-ma-loi-error-codes" title="Permanent link">Â¶</a></h3>
<p>Táº¥t cáº£ cÃ¡c mÃ£ lá»—i (<code>error.code</code>) trong response pháº£i tuÃ¢n thá»§ theo chuáº©n Ä‘á»‹nh danh namespace Ä‘Æ°á»£c mÃ´ táº£ táº¡i:</p>
<ul>
<li><a href="../../../../standards/error-codes/">Error Codes</a></li>
<li><a href="../../../../ADR/adr-011-api-error-format/">ADR-011 Error Format</a></li>
</ul>
<p><strong>YÃªu cáº§u báº¯t buá»™c:</strong></p>
<ul>
<li>
<p>MÃ£ lá»—i pháº£i viáº¿t theo dáº¡ng <strong>snake_case</strong>, cÃ³ <strong>namespace phÃ¢n tÃ¡ch rÃµ rÃ ng</strong>, vÃ­ dá»¥:</p>
</li>
<li>
<p><code>user.user_not_found</code></p>
</li>
<li><code>auth.invalid_token</code></li>
<li><code>common.validation_failed</code></li>
<li>
<p>Má»—i response lá»—i (401, 403, 404, 422...) pháº£i tráº£ vá» Ä‘á»‘i tÆ°á»£ng <code>ErrorEnvelope</code>, gá»“m 2 pháº§n:</p>
</li>
<li>
<p><code>error</code> â€“ chá»©a <code>code</code>, <code>message</code>, <code>details</code></p>
</li>
<li><code>meta</code> â€“ chá»©a <code>trace_id</code>, <code>timestamp</code></li>
</ul>
<p><strong>Gá»£i Ã½ thá»±c hÃ nh:</strong></p>
<ul>
<li>KhÃ´ng dÃ¹ng cÃ¡c mÃ£ lá»—i chung chung nhÆ° <code>"BAD_REQUEST"</code>, <code>"NOT_FOUND"</code>, <code>"FORBIDDEN"</code></li>
<li>LuÃ´n khai bÃ¡o vÃ­ dá»¥ cá»¥ thá»ƒ (vÃ­ dá»¥ trong <code>components/examples/</code> hoáº·c inline OpenAPI) Ä‘á»ƒ giÃºp dev hiá»ƒu nhanh</li>
<li>TÃ¡i sá»­ dá»¥ng error namespace cÃ³ sáºµn tá»« <code>error-codes.md</code> hoáº·c khai bÃ¡o namespace má»›i náº¿u cáº§n</li>
</ul>
<h3 id="82-tai-lieu-lien-ket">8.2. ğŸ“š TÃ i liá»‡u liÃªn káº¿t<a class="headerlink" href="#82-tai-lieu-lien-ket" title="Permanent link">Â¶</a></h3>
<ul>
<li><a href="../design/">Design</a></li>
<li><a href="../data-model/">Data Model</a></li>
<li><a href="../openapi.yaml">OpenAPI</a></li>
<li><a href="../../../../ADR/adr-030-event-schema-governance/">ADR-030 â€“ Event Schema Governance</a></li>
<li><a href="../../../../ADR/adr-011-api-error-format/">ADR-011 Error Format</a></li>
<li><a href="../../../../ADR/adr-027-data-management-strategy/">ADR-027 Data Management Strategy</a></li>
<li><a href="../../../../standards/error-codes/">Error Codes</a></li>
</ul>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Trá»Ÿ láº¡i má»¥c lá»¥c
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
<script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>