
<!doctype html>
<html lang="vi" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Service Design Document cho SPA quản trị hệ thống VAS DX">
      
      
        <meta name="author" content="DX VAS Team">
      
      
        <link rel="canonical" href="https://ezdesign-vn.github.io/dx-vas/services/user-service/master/data-model/">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>User Service Master - Data Model - DX VAS - Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#user-service-master-data-model" class="md-skip">
          Bỏ qua
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Đầu trang">
    <a href="../../../.." title="DX VAS - Docs" class="md-header__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DX VAS - Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              User Service Master - Data Model
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Tìm kiếm" placeholder="Tìm kiếm" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Tìm kiếm">
        
        <button type="reset" class="md-search__icon md-icon" title="Xoá" aria-label="Xoá" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../architecture/system-diagrams/" class="md-tabs__link">
          
  
  
    
  
  Kiến trúc Hệ thống

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../dev-guide/" class="md-tabs__link">
        
  
  
    
  
  Hướng dẫn Phát triển

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../" class="md-tabs__link">
        
  
  
    
  
  Thiết kế Services

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../ADR/" class="md-tabs__link">
          
  
  
    
  
  Quyết định Kiến trúc (ADRs)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Thanh điều hướng" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="DX VAS - Docs" class="md-nav__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../../assets/images/logo.png" alt="logo">

    </a>
    DX VAS - Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kiến trúc Hệ thống
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kiến trúc Hệ thống
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architecture/system-diagrams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sơ đồ Hệ thống
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architecture/rbac-deep-dive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RBAC Chi tiết
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hướng dẫn Phát triển
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thiết kế Services
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../ADR/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Quyết định Kiến trúc (ADRs)
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Quyết định Kiến trúc (ADRs)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Mục lục">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Mục lục
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-gioi-thieu" class="md-nav__link">
    <span class="md-ellipsis">
      1. Giới thiệu
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-pham-vi" class="md-nav__link">
    <span class="md-ellipsis">
      2. Phạm vi
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-khong-bao-gom-out-of-scope" class="md-nav__link">
    <span class="md-ellipsis">
      3. Không bao gồm (Out of Scope)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-muc-tieu" class="md-nav__link">
    <span class="md-ellipsis">
      4. Mục tiêu
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-cac-bang-chinh-va-phan-nhom-logic" class="md-nav__link">
    <span class="md-ellipsis">
      5. Các bảng chính và phân nhóm logic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Các bảng chính và phân nhóm logic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nhom-a-inh-danh-nguoi-dung-va-phan-quyen-toan-cuc" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Nhóm A – Định danh người dùng và phân quyền toàn cục
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nhom-b-template-rbac-dung-chung" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Nhóm B – Template RBAC dùng chung
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nhom-c-ho-tro-mo-rong-tuy-chon" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Nhóm C – Hỗ trợ &amp; Mở rộng (tuỳ chọn)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-chi-tiet-bang-users_global" class="md-nav__link">
    <span class="md-ellipsis">
      6. Chi tiết bảng: users_global
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Chi tiết bảng: users_global">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-lenh-create-table" class="md-nav__link">
    <span class="md-ellipsis">
      📜 Câu lệnh CREATE TABLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-cot" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Giải thích cột
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lien-ket-chi-so" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Liên kết &amp; Chỉ số
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-chi-tiet-bang-tenants" class="md-nav__link">
    <span class="md-ellipsis">
      7. Chi tiết bảng: tenants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Chi tiết bảng: tenants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_1" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-lenh-create-table_1" class="md-nav__link">
    <span class="md-ellipsis">
      📜 Câu lệnh CREATE TABLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-cot_1" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Giải thích cột
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lien-ket-chi-so_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Liên kết &amp; Chỉ số
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-chi-tiet-bang-user_tenant_assignments" class="md-nav__link">
    <span class="md-ellipsis">
      8. Chi tiết bảng: user_tenant_assignments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Chi tiết bảng: user_tenant_assignments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_2" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-lenh-create-table_2" class="md-nav__link">
    <span class="md-ellipsis">
      📜 Câu lệnh CREATE TABLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-cot_2" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Giải thích cột
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lien-ket-chi-so_2" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Liên kết &amp; Chỉ số
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#su-kien-phat-ra" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Sự kiện phát ra
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-chi-tiet-bang-global_roles_templates" class="md-nav__link">
    <span class="md-ellipsis">
      9. Chi tiết bảng: global_roles_templates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Chi tiết bảng: global_roles_templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_3" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-lenh-create-table_3" class="md-nav__link">
    <span class="md-ellipsis">
      📜 Câu lệnh CREATE TABLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-cot_3" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Giải thích cột
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lien-ket-su-dung" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Liên kết &amp; Sử dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#su-kien-phat-ra_1" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Sự kiện phát ra
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-chi-tiet-bang-global_permissions_templates" class="md-nav__link">
    <span class="md-ellipsis">
      10. Chi tiết bảng: global_permissions_templates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Chi tiết bảng: global_permissions_templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_4" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-lenh-create-table_4" class="md-nav__link">
    <span class="md-ellipsis">
      📜 Câu lệnh CREATE TABLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-cot_4" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Giải thích cột
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lien-ket-su-dung_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Liên kết &amp; Sử dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#su-kien-phat-ra_2" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Sự kiện phát ra
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-chi-tiet-bang-global_role_permissions_templates" class="md-nav__link">
    <span class="md-ellipsis">
      11. Chi tiết bảng: global_role_permissions_templates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Chi tiết bảng: global_role_permissions_templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_5" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cau-lenh-create-table_5" class="md-nav__link">
    <span class="md-ellipsis">
      📜 Câu lệnh CREATE TABLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giai-thich-cot_5" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Giải thích cột
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lien-ket-su-dung_2" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Liên kết &amp; Sử dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#su-kien-phat-ra_3" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Sự kiện phát ra
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-cac-bang-phu-tro-phu-luc" class="md-nav__link">
    <span class="md-ellipsis">
      12. Các bảng phụ trợ &amp; phụ lục
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Các bảng phụ trợ &amp; phụ lục">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bang-processed_events" class="md-nav__link">
    <span class="md-ellipsis">
      🔄 Bảng: processed_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phu-luc-a-cac-index-quan-trong" class="md-nav__link">
    <span class="md-ellipsis">
      📘 Phụ lục A – Các Index quan trọng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phu-luc-b-rang-buoc-ac-biet" class="md-nav__link">
    <span class="md-ellipsis">
      📘 Phụ lục B – Ràng buộc đặc biệt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phu-luc-c-cac-su-kien-phat-ra-tu-user-service-master" class="md-nav__link">
    <span class="md-ellipsis">
      📘 Phụ lục C – Các sự kiện phát ra từ User Service Master
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phu-luc-d-enum-va-gia-tri-ac-biet" class="md-nav__link">
    <span class="md-ellipsis">
      📘 Phụ lục D – Enum và giá trị đặc biệt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phu-luc-e-chien-luoc-kiem-thu-lien-quan-en-mo-hinh-du-lieu" class="md-nav__link">
    <span class="md-ellipsis">
      📘 Phụ lục E – Chiến lược kiểm thử liên quan đến mô hình dữ liệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phu-luc-f-lien-ket-tai-lieu" class="md-nav__link">
    <span class="md-ellipsis">
      📘 Phụ lục F – Liên kết tài liệu
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="user-service-master-data-model">User Service Master - Data Model<a class="headerlink" href="#user-service-master-data-model" title="Permanent link">¶</a></h1>
<h2 id="1-gioi-thieu">1. Giới thiệu<a class="headerlink" href="#1-gioi-thieu" title="Permanent link">¶</a></h2>
<p>Tài liệu này mô tả chi tiết mô hình dữ liệu của <strong>User Service Master</strong> – một trong những thành phần cốt lõi của hệ thống <code>dx-vas</code> theo kiến trúc <strong>multi-tenant</strong>. Service này chịu trách nhiệm quản lý <strong>định danh toàn cục người dùng</strong>, <strong>thông tin tenant</strong>, và <strong>mẫu vai trò/quyền toàn cục (RBAC templates)</strong>.</p>
<h2 id="2-pham-vi">2. Phạm vi<a class="headerlink" href="#2-pham-vi" title="Permanent link">¶</a></h2>
<p>User Service Master bao gồm:</p>
<ul>
<li>Quản lý người dùng toàn hệ thống (<code>users_global</code>).</li>
<li>Quản lý danh sách tenant (<code>tenants</code>) và trạng thái của tenant.</li>
<li>Quản lý việc gán người dùng vào tenant (<code>user_tenant_assignments</code>).</li>
<li>Cung cấp mẫu vai trò (<code>global_roles_templates</code>) và mẫu quyền (<code>global_permissions_templates</code>) dùng chung cho các tenant.</li>
<li>Phát sự kiện tới các Sub User Services hoặc các service khác khi có thay đổi liên quan đến định danh hoặc template RBAC.</li>
</ul>
<h2 id="3-khong-bao-gom-out-of-scope">3. Không bao gồm (Out of Scope)<a class="headerlink" href="#3-khong-bao-gom-out-of-scope" title="Permanent link">¶</a></h2>
<p>User Service Master <strong>không</strong> chịu trách nhiệm:</p>
<ul>
<li>Quản lý người dùng nội bộ của từng tenant – việc này thuộc về <strong>Sub User Service</strong>.</li>
<li>Quản lý quyền cụ thể (<code>roles</code>, <code>permissions</code>, <code>mappings</code>) ở cấp tenant.</li>
<li>Xử lý xác thực đăng nhập người dùng (Google OAuth2, OTP, Local login) – thuộc về <strong>Auth Services</strong>.</li>
<li>Ghi log audit chi tiết từng thay đổi (nếu audit được xử lý bởi service riêng).</li>
</ul>
<h2 id="4-muc-tieu">4. Mục tiêu<a class="headerlink" href="#4-muc-tieu" title="Permanent link">¶</a></h2>
<ul>
<li>Trình bày cấu trúc các bảng dữ liệu cốt lõi của User Service Master.</li>
<li>Mô tả các ràng buộc dữ liệu (constraints), khóa chính/ngoại, chỉ mục.</li>
<li>Hỗ trợ cho quá trình phát triển backend, viết OpenAPI, migration, testing và bảo trì.</li>
<li>Làm nền tảng để đồng bộ schema với tài liệu <code>interface-contract.md</code>, <code>openapi.yaml</code>, và các ADR liên quan (như ADR-007, ADR-025).</li>
</ul>
<hr />
<h2 id="5-cac-bang-chinh-va-phan-nhom-logic">5. Các bảng chính và phân nhóm logic<a class="headerlink" href="#5-cac-bang-chinh-va-phan-nhom-logic" title="Permanent link">¶</a></h2>
<p>Dưới đây là danh sách các bảng chính trong cơ sở dữ liệu của <strong>User Service Master</strong>, được chia thành 3 nhóm logic rõ ràng:</p>
<hr />
<h3 id="nhom-a-inh-danh-nguoi-dung-va-phan-quyen-toan-cuc">🔹 Nhóm A – Định danh người dùng và phân quyền toàn cục<a class="headerlink" href="#nhom-a-inh-danh-nguoi-dung-va-phan-quyen-toan-cuc" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tên bảng</th>
<th>Vai trò chính</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>users_global</code></td>
<td>Lưu trữ thông tin định danh người dùng toàn cục.</td>
</tr>
<tr>
<td><code>tenants</code></td>
<td>Lưu trữ thông tin các tenant trong hệ thống.</td>
</tr>
<tr>
<td><code>user_tenant_assignments</code></td>
<td>Mapping giữa người dùng toàn cục và các tenant, kèm trạng thái.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="nhom-b-template-rbac-dung-chung">🔹 Nhóm B – Template RBAC dùng chung<a class="headerlink" href="#nhom-b-template-rbac-dung-chung" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tên bảng</th>
<th>Vai trò chính</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>global_roles_templates</code></td>
<td>Danh sách vai trò mẫu dùng để khởi tạo RBAC trong mỗi tenant.</td>
</tr>
<tr>
<td><code>global_permissions_templates</code></td>
<td>Danh sách quyền mẫu, gắn với role templates.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="nhom-c-ho-tro-mo-rong-tuy-chon">🔹 Nhóm C – Hỗ trợ &amp; Mở rộng (tuỳ chọn)<a class="headerlink" href="#nhom-c-ho-tro-mo-rong-tuy-chon" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tên bảng</th>
<th>Vai trò chính</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>processed_events</code></td>
<td>Lưu các <code>event_id</code> đã xử lý (idempotency khi nhận lại message Pub/Sub).</td>
</tr>
<tr>
<td><code>audit_log_users_master</code></td>
<td>(Tuỳ chọn) Lưu log audit các thao tác trong User Service Master.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🔍 Ghi chú:
- Các bảng ở Nhóm A là bắt buộc và trung tâm của toàn bộ service.
- Nhóm B hỗ trợ việc chuẩn hoá và đồng bộ RBAC giữa Master và Sub User Service.
- Nhóm C phục vụ khả năng mở rộng, theo dõi và debug nếu cần.</p>
</blockquote>
<hr />
<h2 id="6-chi-tiet-bang-users_global">6. Chi tiết bảng: <code>users_global</code><a class="headerlink" href="#6-chi-tiet-bang-users_global" title="Permanent link">¶</a></h2>
<h3 id="muc-ich">🧾 Mục đích<a class="headerlink" href="#muc-ich" title="Permanent link">¶</a></h3>
<p>Bảng <code>users_global</code> lưu trữ thông tin định danh cốt lõi của người dùng trong toàn bộ hệ thống. Đây là nơi duy nhất lưu thông tin người dùng cấp toàn cục, bất kể họ thuộc tenant nào.</p>
<hr />
<h3 id="cau-lenh-create-table">📜 Câu lệnh <code>CREATE TABLE</code><a class="headerlink" href="#cau-lenh-create-table" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users_global</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">                         </span><span class="c1">-- 🔑 ID định danh toàn cục</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="n">full_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                          </span><span class="c1">-- Họ tên người dùng</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="n">email</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                              </span><span class="c1">-- Email (dùng cho xác thực OAuth2 hoặc liên hệ)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="n">phone</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                       </span><span class="c1">-- Số điện thoại (nếu có)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="n">auth_provider</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                      </span><span class="c1">-- Hệ thống xác thực (e.g., &quot;google&quot;, &quot;local&quot;, &quot;zalo&quot;)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">    </span><span class="c1">-- Thời điểm tạo</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">    </span><span class="c1">-- Thời điểm cập nhật gần nhất</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">auth_provider</span><span class="p">),</span><span class="w">                    </span><span class="c1">-- 🔐 Mỗi email chỉ được dùng một lần trong cùng một hệ thống xác thực</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">  </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">auth_provider</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;google&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;otp&#39;</span><span class="p">))</span><span class="w">  </span><span class="c1">-- 🛡️ Ràng buộc giá trị hợp lệ</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">);</span>
</span></code></pre></div>
<hr />
<h3 id="giai-thich-cot">🧩 Giải thích cột<a class="headerlink" href="#giai-thich-cot" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Cột</th>
<th>Kiểu dữ liệu</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_id</code></td>
<td>UUID</td>
<td>Khóa chính toàn cục, dùng để liên kết với tất cả bảng khác</td>
</tr>
<tr>
<td><code>full_name</code></td>
<td>TEXT</td>
<td>Tên đầy đủ của người dùng</td>
</tr>
<tr>
<td><code>email</code></td>
<td>TEXT</td>
<td>Email người dùng – duy nhất trong phạm vi <code>auth_provider</code></td>
</tr>
<tr>
<td><code>phone</code></td>
<td>TEXT</td>
<td>Số điện thoại (tùy chọn)</td>
</tr>
<tr>
<td><code>auth_provider</code></td>
<td>TEXT</td>
<td>Hệ thống xác thực (OAuth2, OTP local...)</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Thời điểm tạo bản ghi</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Thời điểm cập nhật cuối cùng</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="lien-ket-chi-so">🔗 Liên kết &amp; Chỉ số<a class="headerlink" href="#lien-ket-chi-so" title="Permanent link">¶</a></h3>
<ul>
<li>✅ <strong>Unique Constraint:</strong> <code>(email, auth_provider)</code> giúp hỗ trợ nhiều provider nhưng vẫn đảm bảo tính duy nhất.</li>
<li>📌 <strong>Index khuyến nghị:</strong> tạo thêm index trên <code>(auth_provider, email)</code> để tối ưu tra cứu khi đăng nhập.</li>
<li>🧩 <strong>Mối liên hệ:</strong> <code>user_id</code> được tham chiếu bởi:<ul>
<li><code>user_tenant_assignments.user_id_global</code></li>
<li><code>audit_log_users_master.actor_id</code> (nếu có)</li>
<li>Các bảng Sub User Service: <code>users_in_tenant.user_id_global</code></li>
</ul>
</li>
</ul>
<hr />
<h2 id="7-chi-tiet-bang-tenants">7. Chi tiết bảng: <code>tenants</code><a class="headerlink" href="#7-chi-tiet-bang-tenants" title="Permanent link">¶</a></h2>
<h3 id="muc-ich_1">🧾 Mục đích<a class="headerlink" href="#muc-ich_1" title="Permanent link">¶</a></h3>
<p>Bảng <code>tenants</code> lưu thông tin nhận diện các tenant (trường thành viên) trong hệ thống. Mỗi tenant tương ứng với một trường hoặc tổ chức riêng biệt, có hệ thống phụ trợ riêng (Sub Services).</p>
<hr />
<h3 id="cau-lenh-create-table_1">📜 Câu lệnh <code>CREATE TABLE</code><a class="headerlink" href="#cau-lenh-create-table_1" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tenants</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="n">tenant_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">                          </span><span class="c1">-- 🔑 Mã định danh duy nhất cho tenant (ví dụ: &quot;va_camau&quot;)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="n">tenant_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                           </span><span class="c1">-- Tên hiển thị của tenant</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w">               </span><span class="c1">-- Trạng thái: active, suspended, deleted...</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="n">logo_url</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                       </span><span class="c1">-- Logo đại diện (tùy chọn)</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="n">project_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                     </span><span class="c1">-- GCP Project ID gắn với tenant này (nếu có)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;suspended&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;deleted&#39;</span><span class="p">))</span><span class="w"> </span><span class="c1">-- 🛡️ Trạng thái hợp lệ</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="p">);</span>
</span></code></pre></div>
<hr />
<h3 id="giai-thich-cot_1">🧩 Giải thích cột<a class="headerlink" href="#giai-thich-cot_1" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Cột</th>
<th>Kiểu dữ liệu</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tenant_id</code></td>
<td>TEXT</td>
<td>Mã định danh duy nhất cho tenant (viết thường, snake_case)</td>
</tr>
<tr>
<td><code>tenant_name</code></td>
<td>TEXT</td>
<td>Tên đầy đủ, thân thiện với người dùng</td>
</tr>
<tr>
<td><code>status</code></td>
<td>TEXT</td>
<td>Trạng thái hoạt động của tenant (<code>active</code>, <code>suspended</code>, <code>deleted</code>)</td>
</tr>
<tr>
<td><code>logo_url</code></td>
<td>TEXT</td>
<td>Link logo (nếu có), dùng cho hiển thị branding</td>
</tr>
<tr>
<td><code>project_id</code></td>
<td>TEXT</td>
<td>GCP Project ID nếu mỗi tenant có stack riêng biệt</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Thời điểm tạo</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Thời điểm cập nhật cuối cùng</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="lien-ket-chi-so_1">🔗 Liên kết &amp; Chỉ số<a class="headerlink" href="#lien-ket-chi-so_1" title="Permanent link">¶</a></h3>
<ul>
<li>📌 <strong>Tenant ID</strong> sẽ được tham chiếu bởi:<ul>
<li><code>user_tenant_assignments.tenant_id</code></li>
<li>Sub services dùng để định tuyến và phân quyền</li>
</ul>
</li>
<li>✅ <strong>Index khuyến nghị:</strong> index trên <code>status</code> để lọc nhanh các tenant đang hoạt động</li>
</ul>
<hr />
<h2 id="8-chi-tiet-bang-user_tenant_assignments">8. Chi tiết bảng: <code>user_tenant_assignments</code><a class="headerlink" href="#8-chi-tiet-bang-user_tenant_assignments" title="Permanent link">¶</a></h2>
<h3 id="muc-ich_2">🧾 Mục đích<a class="headerlink" href="#muc-ich_2" title="Permanent link">¶</a></h3>
<p>Bảng <code>user_tenant_assignments</code> lưu thông tin người dùng nào được gán vào tenant nào. Đây là cầu nối giữa <code>users_global</code> và các tenant, xác định quyền truy cập của một người dùng toàn cục vào tenant cụ thể.</p>
<hr />
<h3 id="cau-lenh-create-table_2">📜 Câu lệnh <code>CREATE TABLE</code><a class="headerlink" href="#cau-lenh-create-table_2" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">user_tenant_assignments</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span><span class="w">       </span><span class="c1">-- 🔑 ID duy nhất cho mỗi lần gán</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="n">user_id_global</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users_global</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span><span class="w"> </span><span class="c1">-- 🔗 Người dùng toàn cục</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="n">tenant_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">tenants</span><span class="p">(</span><span class="n">tenant_id</span><span class="p">),</span><span class="w">         </span><span class="c1">-- 🔗 Tenant được gán</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="n">assignment_status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w">     </span><span class="c1">-- Trạng thái: active, revoked</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="n">assigned_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">       </span><span class="c1">-- ⏱️ Thời điểm gán</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="p">,</span><span class="w">                               </span><span class="c1">-- ⏱️ Thời điểm hủy gán (nếu có)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="n">assigned_by</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span><span class="w">                                     </span><span class="c1">-- 🔗 Người gán (user_id_global) – thường là Superadmin</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="n">user_id_global</span><span class="p">,</span><span class="w"> </span><span class="n">tenant_id</span><span class="p">),</span><span class="w">                   </span><span class="c1">-- 🛡️ Không thể gán trùng người dùng vào cùng tenant</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">assignment_status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;revoked&#39;</span><span class="p">))</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="p">);</span>
</span></code></pre></div>
<hr />
<h3 id="giai-thich-cot_2">🧩 Giải thích cột<a class="headerlink" href="#giai-thich-cot_2" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Cột</th>
<th>Kiểu dữ liệu</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>UUID</td>
<td>ID duy nhất cho bản ghi (dùng cho tra cứu, cập nhật trạng thái)</td>
</tr>
<tr>
<td><code>user_id_global</code></td>
<td>UUID</td>
<td>Người dùng toàn cục được gán vào tenant này</td>
</tr>
<tr>
<td><code>tenant_id</code></td>
<td>TEXT</td>
<td>Tenant cụ thể</td>
</tr>
<tr>
<td><code>assignment_status</code></td>
<td>TEXT</td>
<td>Trạng thái hiện tại: active / revoked</td>
</tr>
<tr>
<td><code>assigned_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Thời điểm thực hiện gán</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Thời điểm hủy quyền truy cập (nếu có)</td>
</tr>
<tr>
<td><code>assigned_by</code></td>
<td>UUID</td>
<td>ID của user thực hiện thao tác gán (thường là superadmin)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="lien-ket-chi-so_2">🔗 Liên kết &amp; Chỉ số<a class="headerlink" href="#lien-ket-chi-so_2" title="Permanent link">¶</a></h3>
<ul>
<li>🔁 Dùng để xác định quyền truy cập tenant khi người dùng đăng nhập (Auth Service)</li>
<li>🧠 Gateway có thể cache <code>user_id_global</code> ↔ danh sách <code>tenant_id</code> để tối ưu hiệu suất</li>
<li>✅ Cần index trên <code>user_id_global</code>, <code>tenant_id</code>, và <code>assignment_status</code> cho tra cứu nhanh</li>
</ul>
<hr />
<h3 id="su-kien-phat-ra">📤 Sự kiện phát ra<a class="headerlink" href="#su-kien-phat-ra" title="Permanent link">¶</a></h3>
<ul>
<li><code>tenant_user_assigned</code>: Khi một user được gán vào tenant (assignment mới)</li>
<li><code>tenant_user_revoked</code>: Khi quyền truy cập của user vào tenant bị hủy (status chuyển sang <code>revoked</code>)</li>
</ul>
<hr />
<h2 id="9-chi-tiet-bang-global_roles_templates">9. Chi tiết bảng: <code>global_roles_templates</code><a class="headerlink" href="#9-chi-tiet-bang-global_roles_templates" title="Permanent link">¶</a></h2>
<h3 id="muc-ich_3">🧾 Mục đích<a class="headerlink" href="#muc-ich_3" title="Permanent link">¶</a></h3>
<p>Bảng <code>global_roles_templates</code> lưu trữ các mẫu vai trò dùng chung toàn hệ thống. Các vai trò này được thiết kế bởi superadmin để làm nền tảng gán role mặc định cho từng tenant trong hệ thống multi-tenant. Đây là phần cốt lõi của cơ chế RBAC phân tầng, giúp tiêu chuẩn hóa quản lý quyền truy cập theo từng loại người dùng (admin, teacher, parent...).</p>
<hr />
<h3 id="cau-lenh-create-table_3">📜 Câu lệnh <code>CREATE TABLE</code><a class="headerlink" href="#cau-lenh-create-table_3" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">global_roles_templates</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="n">role_template_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="n">template_key</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="n">template_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span><span class="n">is_system</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="n">created_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users_global</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span><span class="n">updated_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users_global</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="p">);</span>
</span></code></pre></div>
<hr />
<h3 id="giai-thich-cot_3">🧩 Giải thích cột<a class="headerlink" href="#giai-thich-cot_3" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Cột</th>
<th>Kiểu dữ liệu</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>role_template_id</code></td>
<td><code>UUID</code></td>
<td>Mã định danh duy nhất cho template</td>
</tr>
<tr>
<td><code>template_key</code></td>
<td><code>TEXT</code></td>
<td>Khóa kỹ thuật duy nhất (e.g., <code>teacher_default</code>, <code>admin_basic</code>)</td>
</tr>
<tr>
<td><code>template_name</code></td>
<td><code>TEXT</code></td>
<td>Tên hiển thị của template</td>
</tr>
<tr>
<td><code>description</code></td>
<td><code>TEXT</code></td>
<td>Mô tả chức năng của role này</td>
</tr>
<tr>
<td><code>is_system</code></td>
<td><code>BOOLEAN</code></td>
<td>Đánh dấu vai trò hệ thống (không cho xóa)</td>
</tr>
<tr>
<td><code>created_by</code></td>
<td><code>UUID</code></td>
<td>ID người dùng toàn cục tạo template (superadmin)</td>
</tr>
<tr>
<td><code>updated_by</code></td>
<td><code>UUID</code></td>
<td>ID người dùng toàn cục cập nhật gần nhất</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>TIMESTAMPTZ</code></td>
<td>Thời điểm tạo template</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td><code>TIMESTAMPTZ</code></td>
<td>Thời điểm cập nhật gần nhất</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="lien-ket-su-dung">🔗 Liên kết &amp; Sử dụng<a class="headerlink" href="#lien-ket-su-dung" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Liên kết 1-n với</strong>: <code>global_permissions_templates</code> thông qua bảng phụ <code>global_role_permissions_templates</code></li>
<li>
<p><strong>Được dùng khi</strong>:</p>
</li>
<li>
<p>Giao diện quản trị tạo hoặc sửa mẫu role</p>
</li>
<li>Gán vai trò mặc định khi khởi tạo tenant mới</li>
<li>Đồng bộ RBAC từ master → sub</li>
</ul>
<hr />
<h3 id="su-kien-phat-ra_1">📤 Sự kiện phát ra<a class="headerlink" href="#su-kien-phat-ra_1" title="Permanent link">¶</a></h3>
<ul>
<li><code>role_template.created</code>: Khi superadmin tạo mẫu vai trò mới</li>
<li><code>role_template.updated</code>: Khi cập nhật nội dung role hoặc quyền liên quan</li>
<li>Các sự kiện này được phát qua Pub/Sub để đồng bộ xuống <code>user-service/sub</code> theo từng tenant nếu có yêu cầu áp dụng mẫu.</li>
</ul>
<hr />
<h2 id="10-chi-tiet-bang-global_permissions_templates">10. Chi tiết bảng: <code>global_permissions_templates</code><a class="headerlink" href="#10-chi-tiet-bang-global_permissions_templates" title="Permanent link">¶</a></h2>
<hr />
<h3 id="muc-ich_4">🧾 Mục đích<a class="headerlink" href="#muc-ich_4" title="Permanent link">¶</a></h3>
<p>Bảng <code>global_permissions_templates</code> định nghĩa tập các quyền (permission) dùng chung trên toàn hệ thống, đóng vai trò là mẫu nền tảng cho cơ chế RBAC phân tầng. Các quyền này sẽ được liên kết với <code>global_roles_templates</code> để tạo thành cấu trúc role-permission mặc định cho mỗi tenant. Chúng đảm bảo sự thống nhất, an toàn và dễ mở rộng trong quản lý phân quyền hệ thống.</p>
<hr />
<h3 id="cau-lenh-create-table_4">📜 Câu lệnh <code>CREATE TABLE</code><a class="headerlink" href="#cau-lenh-create-table_4" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">global_permissions_templates</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="n">permission_template_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="n">permission_key</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="n">permission_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="n">service_scope</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="n">created_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users_global</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="n">updated_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users_global</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="p">);</span>
</span></code></pre></div>
<hr />
<h3 id="giai-thich-cot_4">🧩 Giải thích cột<a class="headerlink" href="#giai-thich-cot_4" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Cột</th>
<th>Kiểu dữ liệu</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>permission_template_id</code></td>
<td><code>UUID</code></td>
<td>Mã định danh của mẫu quyền</td>
</tr>
<tr>
<td><code>permission_key</code></td>
<td><code>TEXT</code></td>
<td>Khóa kỹ thuật, định danh duy nhất (e.g., <code>user.read:any</code>, <code>tenant.update</code>)</td>
</tr>
<tr>
<td><code>permission_name</code></td>
<td><code>TEXT</code></td>
<td>Tên hiển thị thân thiện của quyền</td>
</tr>
<tr>
<td><code>description</code></td>
<td><code>TEXT</code></td>
<td>Mô tả chức năng quyền</td>
</tr>
<tr>
<td><code>service_scope</code></td>
<td><code>TEXT</code></td>
<td>Tên service liên quan (e.g., <code>user-service</code>, <code>tenant-service</code>)</td>
</tr>
<tr>
<td><code>created_by</code></td>
<td><code>UUID</code></td>
<td>ID người dùng toàn cục tạo quyền</td>
</tr>
<tr>
<td><code>updated_by</code></td>
<td><code>UUID</code></td>
<td>ID người dùng toàn cục cập nhật gần nhất</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>TIMESTAMPTZ</code></td>
<td>Thời điểm tạo mẫu quyền</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td><code>TIMESTAMPTZ</code></td>
<td>Thời điểm cập nhật gần nhất</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="lien-ket-su-dung_1">🔗 Liên kết &amp; Sử dụng<a class="headerlink" href="#lien-ket-su-dung_1" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Liên kết 1-n với</strong>: <code>global_roles_templates</code> qua bảng trung gian <code>global_role_permissions_templates</code></li>
<li>
<p><strong>Được sử dụng khi</strong>:</p>
</li>
<li>
<p>Khởi tạo hệ thống phân quyền tenant mới</p>
</li>
<li>Hiển thị danh sách quyền cho UI quản trị hệ thống</li>
<li>Phân quyền mặc định trong các service sử dụng RBAC (Auth, User, Token…)</li>
</ul>
<hr />
<h3 id="su-kien-phat-ra_2">📤 Sự kiện phát ra<a class="headerlink" href="#su-kien-phat-ra_2" title="Permanent link">¶</a></h3>
<ul>
<li><code>permission_template.created</code>: Khi superadmin tạo quyền mới</li>
<li><code>permission_template.updated</code>: Khi cập nhật mô tả hoặc phạm vi quyền</li>
<li>Các sự kiện này được publish qua Pub/Sub để phục vụ audit logging và/hoặc đồng bộ định nghĩa quyền tới các hệ thống phụ trợ nếu cần.</li>
</ul>
<hr />
<h2 id="11-chi-tiet-bang-global_role_permissions_templates">11. Chi tiết bảng: <code>global_role_permissions_templates</code><a class="headerlink" href="#11-chi-tiet-bang-global_role_permissions_templates" title="Permanent link">¶</a></h2>
<hr />
<h3 id="muc-ich_5">🧾 Mục đích<a class="headerlink" href="#muc-ich_5" title="Permanent link">¶</a></h3>
<p>Bảng <code>global_role_permissions_templates</code> định nghĩa quan hệ nhiều-nhiều giữa các vai trò mẫu (<code>global_roles_templates</code>) và các quyền mẫu (<code>global_permissions_templates</code>). Đây là bảng trung gian quan trọng giúp ánh xạ cấu trúc phân quyền mặc định cho từng loại người dùng, đóng vai trò làm nền cho quá trình khởi tạo RBAC cho từng tenant mới trong hệ thống multi-tenant.</p>
<hr />
<h3 id="cau-lenh-create-table_5">📜 Câu lệnh <code>CREATE TABLE</code><a class="headerlink" href="#cau-lenh-create-table_5" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">global_role_permissions_templates</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="n">role_template_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">global_roles_templates</span><span class="p">(</span><span class="n">role_template_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="n">permission_template_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">global_permissions_templates</span><span class="p">(</span><span class="n">permission_template_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">role_template_id</span><span class="p">,</span><span class="w"> </span><span class="n">permission_template_id</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="p">);</span>
</span></code></pre></div>
<hr />
<h3 id="giai-thich-cot_5">🧩 Giải thích cột<a class="headerlink" href="#giai-thich-cot_5" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Cột</th>
<th>Kiểu dữ liệu</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>role_template_id</code></td>
<td><code>UUID</code></td>
<td>Khóa ngoại đến bảng mẫu vai trò</td>
</tr>
<tr>
<td><code>permission_template_id</code></td>
<td><code>UUID</code></td>
<td>Khóa ngoại đến bảng mẫu quyền</td>
</tr>
<tr>
<td><strong>PRIMARY KEY</strong></td>
<td><code>(role_template_id, permission_template_id)</code></td>
<td>Đảm bảo duy nhất mỗi cặp role-permission</td>
</tr>
</tbody>
</table>
<ul>
<li><code>ON DELETE CASCADE</code> đảm bảo nếu role hoặc permission bị xóa, các ánh xạ liên quan cũng bị xóa theo → tránh orphan records.</li>
</ul>
<hr />
<h3 id="lien-ket-su-dung_2">🔗 Liên kết &amp; Sử dụng<a class="headerlink" href="#lien-ket-su-dung_2" title="Permanent link">¶</a></h3>
<ul>
<li>
<p><strong>Liên kết 1-n từ</strong>:</p>
</li>
<li>
<p><code>global_roles_templates.role_template_id</code></p>
</li>
<li>
<p><code>global_permissions_templates.permission_template_id</code></p>
</li>
<li>
<p><strong>Được sử dụng khi</strong>:</p>
</li>
<li>
<p>Tạo mới hoặc chỉnh sửa mẫu vai trò trong UI quản trị hệ thống</p>
</li>
<li>Khởi tạo dữ liệu RBAC mặc định cho tenant mới (phân phối role → permission)</li>
<li>Đồng bộ dữ liệu RBAC từ master → sub khi có cập nhật quyền hệ thống</li>
</ul>
<hr />
<h3 id="su-kien-phat-ra_3">📤 Sự kiện phát ra<a class="headerlink" href="#su-kien-phat-ra_3" title="Permanent link">¶</a></h3>
<ul>
<li>Không phát sinh sự kiện riêng từ bảng này.</li>
<li>Tuy nhiên, khi cập nhật mapping này (thêm/xóa permission trong role), các service cần phát <code>role_template.updated</code> từ logic nghiệp vụ ở tầng ứng dụng.</li>
</ul>
<hr />
<h2 id="12-cac-bang-phu-tro-phu-luc">12. Các bảng phụ trợ &amp; phụ lục<a class="headerlink" href="#12-cac-bang-phu-tro-phu-luc" title="Permanent link">¶</a></h2>
<hr />
<h3 id="bang-processed_events">🔄 Bảng: <code>processed_events</code><a class="headerlink" href="#bang-processed_events" title="Permanent link">¶</a></h3>
<h4 id="muc-ich_6">📌 Mục đích<a class="headerlink" href="#muc-ich_6" title="Permanent link">¶</a></h4>
<p>Ghi lại các sự kiện đã xử lý để đảm bảo tính idempotent trong hệ thống Event-Driven (ví dụ: khi nhận lại cùng một sự kiện từ Pub/Sub).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">processed_events</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="n">event_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">              </span><span class="c1">-- 🔑 ID duy nhất của sự kiện</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="n">service_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">             </span><span class="c1">-- 🧭 Tên service xử lý sự kiện</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="n">processed_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w">  </span><span class="c1">-- ⏱️ Thời điểm xử lý</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="p">);</span>
</span></code></pre></div>
<h4 id="giai-thich">📋 Giải thích<a class="headerlink" href="#giai-thich" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Cột</th>
<th>Kiểu dữ liệu</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event_id</code></td>
<td>UUID</td>
<td>ID sự kiện (thường đến từ metadata của Pub/Sub)</td>
</tr>
<tr>
<td><code>service_name</code></td>
<td>TEXT</td>
<td>Tên service đã xử lý sự kiện này</td>
</tr>
<tr>
<td><code>processed_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Thời điểm xử lý</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="phu-luc-a-cac-index-quan-trong">📘 Phụ lục A – Các Index quan trọng<a class="headerlink" href="#phu-luc-a-cac-index-quan-trong" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Bảng</th>
<th>Cột</th>
<th>Loại Index</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>users_global</code></td>
<td><code>(email, auth_provider)</code></td>
<td>UNIQUE INDEX</td>
</tr>
<tr>
<td><code>user_tenant_assignments</code></td>
<td><code>(user_id_global, tenant_id)</code></td>
<td>UNIQUE INDEX</td>
</tr>
<tr>
<td><code>tenants</code></td>
<td><code>tenant_id</code></td>
<td>PRIMARY KEY</td>
</tr>
<tr>
<td><code>global_roles_templates</code></td>
<td><code>template_code</code></td>
<td>UNIQUE INDEX</td>
</tr>
<tr>
<td><code>global_permissions_templates</code></td>
<td><code>permission_code</code></td>
<td>UNIQUE INDEX</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="phu-luc-b-rang-buoc-ac-biet">📘 Phụ lục B – Ràng buộc đặc biệt<a class="headerlink" href="#phu-luc-b-rang-buoc-ac-biet" title="Permanent link">¶</a></h3>
<ul>
<li><code>users_global.email</code> chỉ là UNIQUE trong phạm vi <code>auth_provider</code> (nếu muốn hỗ trợ nhiều provider).</li>
<li><code>user_tenant_assignments</code> có thể được mở rộng để lưu cả trạng thái <code>invited</code>, <code>active</code>, <code>revoked</code>.</li>
</ul>
<hr />
<h3 id="phu-luc-c-cac-su-kien-phat-ra-tu-user-service-master">📘 Phụ lục C – Các sự kiện phát ra từ User Service Master<a class="headerlink" href="#phu-luc-c-cac-su-kien-phat-ra-tu-user-service-master" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Sự kiện</th>
<th>Trigger</th>
<th>Mục đích</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_global_created</code></td>
<td>Khi tạo user mới</td>
<td>Cho phép các service khác khởi tạo liên kết</td>
</tr>
<tr>
<td><code>tenant_created</code></td>
<td>Khi tạo tenant</td>
<td>Cho phép Sub Service tạo môi trường dữ liệu</td>
</tr>
<tr>
<td><code>tenant_user_assigned</code></td>
<td>Khi gán user vào tenant</td>
<td>Đồng bộ RBAC và tạo user cục bộ ở Sub Service</td>
</tr>
<tr>
<td><code>rbac_template_updated</code></td>
<td>Khi cập nhật role/permission templates</td>
<td>Thông báo Sub Service cập nhật cấu hình RBAC</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="phu-luc-d-enum-va-gia-tri-ac-biet">📘 Phụ lục D – Enum và giá trị đặc biệt<a class="headerlink" href="#phu-luc-d-enum-va-gia-tri-ac-biet" title="Permanent link">¶</a></h3>
<ul>
<li><code>auth_provider</code>:</li>
<li><code>google</code></li>
<li><code>local</code></li>
<li><code>otp</code></li>
<li><code>user_tenant_assignments.status</code> (nếu có mở rộng):</li>
<li><code>active</code></li>
<li><code>revoked</code></li>
<li><code>invited</code></li>
</ul>
<hr />
<h3 id="phu-luc-e-chien-luoc-kiem-thu-lien-quan-en-mo-hinh-du-lieu">📘 Phụ lục E – Chiến lược kiểm thử liên quan đến mô hình dữ liệu<a class="headerlink" href="#phu-luc-e-chien-luoc-kiem-thu-lien-quan-en-mo-hinh-du-lieu" title="Permanent link">¶</a></h3>
<hr />
<h4 id="1-kiem-thu-muc-co-so-du-lieu-database-level">🔍 1. Kiểm thử mức cơ sở dữ liệu (Database-level)<a class="headerlink" href="#1-kiem-thu-muc-co-so-du-lieu-database-level" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Loại kiểm thử</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td>✅ Ràng buộc PK/FK</td>
<td>Đảm bảo không thể insert/update dữ liệu sai liên kết giữa các bảng</td>
</tr>
<tr>
<td>✅ Ràng buộc UNIQUE</td>
<td>Kiểm thử các cột <code>email</code>, <code>template_code</code>, <code>permission_code</code> không bị trùng</td>
</tr>
<tr>
<td>✅ Enum/Constraint logic</td>
<td>Kiểm thử giá trị hợp lệ của <code>auth_provider</code>, <code>status</code>, v.v.</td>
</tr>
<tr>
<td>✅ Trigger (nếu có)</td>
<td>Nếu sử dụng trigger (ví dụ: audit log, cascading update), cần test kỹ</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="2-kiem-thu-tinh-toan-ven-du-lieu-xuyen-suot-integration-data-consistency">🔄 2. Kiểm thử tính toàn vẹn dữ liệu xuyên suốt (Integration Data Consistency)<a class="headerlink" href="#2-kiem-thu-tinh-toan-ven-du-lieu-xuyen-suot-integration-data-consistency" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Tình huống kiểm thử</th>
<th>Mong đợi</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tạo user mới → Gán vào tenant</td>
<td>Ghi đúng <code>users_global</code>, <code>user_tenant_assignments</code>, phát đúng event</td>
</tr>
<tr>
<td>Cập nhật template RBAC</td>
<td>Ghi đúng bảng template, phát sự kiện <code>rbac_template_updated</code></td>
</tr>
<tr>
<td>Gỡ user khỏi tenant</td>
<td>Không còn entry trong <code>user_tenant_assignments</code>, phát sự kiện nếu cần</td>
</tr>
<tr>
<td>Xử lý lại event trùng (<code>processed_events</code>)</td>
<td>Event không bị xử lý lại nhiều lần</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="3-kiem-thu-voi-du-lieu-mau">⚙️ 3. Kiểm thử với dữ liệu mẫu<a class="headerlink" href="#3-kiem-thu-voi-du-lieu-mau" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Tên tập dữ liệu</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test_user_1.json</code></td>
<td>Một user Google, đã gán vào 2 tenants</td>
</tr>
<tr>
<td><code>test_templates.yaml</code></td>
<td>Role template với nhiều permission có <code>default_condition</code> phức tạp</td>
</tr>
<tr>
<td><code>test_event.json</code></td>
<td>Sự kiện giả lập <code>tenant_user_assigned</code> để test idempotency</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="4-kiem-thu-bao-mat-du-lieu-security-focused-db-tests">🛡️ 4. Kiểm thử bảo mật dữ liệu (Security-focused DB tests)<a class="headerlink" href="#4-kiem-thu-bao-mat-du-lieu-security-focused-db-tests" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Loại kiểm thử</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td>Truy cập trái phép dữ liệu tenant khác</td>
<td>Đảm bảo query luôn có điều kiện <code>tenant_id</code>, không rò rỉ dữ liệu</td>
</tr>
<tr>
<td>SQL Injection / Escaping</td>
<td>Kiểm thử các cột dạng TEXT để đảm bảo escaping đúng (qua ORM)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="5-goi-y-cong-cu-ho-tro">📂 5. Gợi ý công cụ hỗ trợ<a class="headerlink" href="#5-goi-y-cong-cu-ho-tro" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Migration Tool:</strong> Alembic / Prisma / Liquibase (tuỳ stack)</li>
<li><strong>DB Unit Testing:</strong> pgTAP (PostgreSQL), DBUnit (Java), pytest-postgresql</li>
<li><strong>Event Testing:</strong> Mock Pub/Sub + Log capture</li>
</ul>
<hr />
<h4 id="tham-chieu-cheo">📘 Tham chiếu chéo<a class="headerlink" href="#tham-chieu-cheo" title="Permanent link">¶</a></h4>
<ul>
<li><a href="../design/">Thiết kế tổng quan (<code>design.md</code>)</a> – phần "Chiến lược Test"</li>
<li><a href="../openapi.yaml">OpenAPI (<code>openapi.yaml</code>)</a> – để mock endpoint kiểm thử dữ liệu</li>
<li><a href="../../../adr-008-audit-logging.md">Audit Strategy (<code>adr-008-audit-logging.md</code>)</a></li>
</ul>
<hr />
<h3 id="phu-luc-f-lien-ket-tai-lieu">📘 Phụ lục F – Liên kết tài liệu<a class="headerlink" href="#phu-luc-f-lien-ket-tai-lieu" title="Permanent link">¶</a></h3>
<ul>
<li><a href="../interface-contract/">Interface Contract</a></li>
<li><a href="../openapi.yaml">OpenAPI Spec</a></li>
<li><a href="../design/">Design</a></li>
<li><a href="../../../rbac-deep-dive.md">RBAC Deep Dive</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Trở lại mục lục
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>