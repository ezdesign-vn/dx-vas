
<!DOCTYPE html>

<html class="no-js" lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Tài liệu kiến trúc và phát triển cho dự án Chuyển đổi số Trường Việt Anh." name="description"/>
<meta content="DX VAS Team" name="author"/>
<link href="https://ezdesign-vn.github.io/dx-vas/services/reporting-service/data-model/" rel="canonical"/>
<link href="../../../assets/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Reporting Service - Data Model - DX VAS - Docs</title>
<link href="../../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="pink" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#reporting-service-data-model">
          Bỏ qua
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Đầu trang" class="md-header__inner md-grid">
<a aria-label="DX VAS - Docs" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../assets/images/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DX VAS - Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Reporting Service - Data Model
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="pink" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="lime" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Tìm kiếm" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Tìm kiếm" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Tìm kiếm" class="md-search__options">
<button aria-label="Xoá" class="md-search__icon md-icon" tabindex="-1" title="Xoá" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../architecture/system-diagrams/">
          
  
  
    
  
  Kiến trúc Hệ thống

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../dev-guide/">
        
  
  
    
  
  Hướng dẫn Phát triển

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../">
        
  
  
    
  
  Thiết kế Services

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../ADR/">
          
  
  
    
  
  Quyết định Kiến trúc (ADRs)

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Thanh điều hướng" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DX VAS - Docs" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../assets/images/logo.png"/>
</a>
    DX VAS - Docs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Kiến trúc Hệ thống
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Kiến trúc Hệ thống
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../architecture/system-diagrams/">
<span class="md-ellipsis">
    Sơ đồ Hệ thống
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../architecture/rbac-deep-dive/">
<span class="md-ellipsis">
    RBAC Chi tiết
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../dev-guide/">
<span class="md-ellipsis">
    Hướng dẫn Phát triển
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    Thiết kế Services
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../ADR/">
<span class="md-ellipsis">
    Quyết định Kiến trúc (ADRs)
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Quyết định Kiến trúc (ADRs)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Mục lục" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Mục lục
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-gioi-thieu">
<span class="md-ellipsis">
      1. Giới thiệu
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-pham-vi-du-lieu-quan-ly-scope">
<span class="md-ellipsis">
      2. Phạm vi Dữ liệu Quản lý (Scope)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-ngoai-pham-vi-out-of-scope">
<span class="md-ellipsis">
      3. Ngoài Phạm Vi (Out of Scope)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-muc-tieu-cua-tai-lieu-mo-hinh-du-lieu">
<span class="md-ellipsis">
      4. Mục tiêu của Tài liệu Mô hình Dữ liệu
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-so-o-erd-entity-relationship-diagram">
<span class="md-ellipsis">
      5. Sơ đồ ERD (Entity Relationship Diagram)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-mo-ta-chi-tiet-tung-bang">
<span class="md-ellipsis">
      6. Mô tả chi tiết từng bảng
    </span>
</a>
<nav aria-label="6. Mô tả chi tiết từng bảng" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-report_templates">
<span class="md-ellipsis">
      6.1. report_templates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-report_query_logs">
<span class="md-ellipsis">
      6.2. report_query_logs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-saved_report_configs">
<span class="md-ellipsis">
      6.3. saved_report_configs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-saved_dashboard_layouts">
<span class="md-ellipsis">
      6.4. saved_dashboard_layouts
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-cac-bang-phu-tro">
<span class="md-ellipsis">
      7. Các bảng phụ trợ
    </span>
</a>
<nav aria-label="7. Các bảng phụ trợ" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-report_template_versions">
<span class="md-ellipsis">
      7.1. report_template_versions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-report_template_permissions">
<span class="md-ellipsis">
      7.2. report_template_permissions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-report_query_status_logs">
<span class="md-ellipsis">
      7.3. report_query_status_logs
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-indexes-constraints">
<span class="md-ellipsis">
      8. Indexes &amp; Constraints
    </span>
</a>
<nav aria-label="8. Indexes &amp; Constraints" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#81-report_templates">
<span class="md-ellipsis">
      8.1. report_templates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#82-report_query_logs">
<span class="md-ellipsis">
      8.2. report_query_logs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#83-saved_report_configs">
<span class="md-ellipsis">
      8.3. saved_report_configs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#84-saved_dashboard_layouts">
<span class="md-ellipsis">
      8.4. saved_dashboard_layouts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#85-report_template_versions">
<span class="md-ellipsis">
      8.5. report_template_versions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#86-report_template_permissions">
<span class="md-ellipsis">
      8.6. report_template_permissions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-chinh-sach-luu-tru-xoa-du-lieu-retention">
<span class="md-ellipsis">
      9. Chính sách Lưu trữ &amp; Xóa dữ liệu (Retention)
    </span>
</a>
<nav aria-label="9. Chính sách Lưu trữ &amp; Xóa dữ liệu (Retention)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#91-report_query_logs">
<span class="md-ellipsis">
      9.1. report_query_logs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#92-report_template_versions">
<span class="md-ellipsis">
      9.2. report_template_versions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#93-saved_report_configs-saved_dashboard_layouts">
<span class="md-ellipsis">
      9.3. saved_report_configs &amp; saved_dashboard_layouts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#94-report_template_permissions">
<span class="md-ellipsis">
      9.4. report_template_permissions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#95-tuan-thu-adr-024">
<span class="md-ellipsis">
      9.5. Tuân thủ ADR-024
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-phan-quyen-truy-cap-du-lieu">
<span class="md-ellipsis">
      10. Phân quyền truy cập dữ liệu
    </span>
</a>
<nav aria-label="10. Phân quyền truy cập dữ liệu" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#101-truy-van-bao-cao-reportsquery">
<span class="md-ellipsis">
      10.1. Truy vấn báo cáo (/reports/query)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#102-quan-ly-template-report-templates">
<span class="md-ellipsis">
      10.2. Quản lý Template (/report-templates/**)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#103-saved-report-configs-dashboards-saved-configs-dashboards">
<span class="md-ellipsis">
      10.3. Saved Report Configs &amp; Dashboards (/saved-configs, /dashboards)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#104-logging-truy-vet">
<span class="md-ellipsis">
      10.4. Logging &amp; Truy vết
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#105-co-che-kiem-soat-phan-quyen">
<span class="md-ellipsis">
      10.5. Cơ chế kiểm soát phân quyền
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#106-lien-ket-adr">
<span class="md-ellipsis">
      10.6. Liên kết ADR
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11-mo-rong-trong-tuong-lai">
<span class="md-ellipsis">
      11. Mở rộng trong tương lai
    </span>
</a>
<nav aria-label="11. Mở rộng trong tương lai" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111-mo-rong-schema-template">
<span class="md-ellipsis">
      11.1. Mở rộng Schema Template
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#112-cau-truc-template-ong-theo-tung-nhom-bao-cao">
<span class="md-ellipsis">
      11.2. Cấu trúc Template động theo từng nhóm báo cáo
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#113-dashboard-config-nang-cao">
<span class="md-ellipsis">
      11.3. Dashboard Config nâng cao
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#114-audit-log-nang-cao">
<span class="md-ellipsis">
      11.4. Audit Log nâng cao
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#115-chuan-bi-cho-ai-agent">
<span class="md-ellipsis">
      11.5. Chuẩn bị cho AI Agent
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#116-truy-van-thoi-gian-thuc-streaming-report">
<span class="md-ellipsis">
      11.6. Truy vấn thời gian thực (Streaming Report)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#117-tich-hop-to-chuc-thu-3-external-systems">
<span class="md-ellipsis">
      11.7. Tích hợp tổ chức thứ 3 (External Systems)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-enum">
<span class="md-ellipsis">
      12. ENUM
    </span>
</a>
<nav aria-label="12. ENUM" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#121-status-trong-report_query_logs">
<span class="md-ellipsis">
      12.1. status trong report_query_logs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#122-layout_type-trong-saved_dashboard_layouts">
<span class="md-ellipsis">
      12.2. layout_type trong saved_dashboard_layouts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#123-input_type-trong-report_template_versionsinput_parameters_schema">
<span class="md-ellipsis">
      12.3. input_type trong report_template_versions.input_parameters_schema
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#124-permission_code-vi-du">
<span class="md-ellipsis">
      12.4. permission_code (ví dụ)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-enum-duoi-dang-bang-phu-tro">
<span class="md-ellipsis">
      📑 13. ENUM dưới dạng bảng phụ trợ
    </span>
</a>
<nav aria-label="📑 13. ENUM dưới dạng bảng phụ trợ" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#131-report_statuses">
<span class="md-ellipsis">
      13.1. 📄 report_statuses
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#132-dashboard_layout_types">
<span class="md-ellipsis">
      13.2. 📄 dashboard_layout_types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ap-dung">
<span class="md-ellipsis">
      🔗 Áp dụng
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14-tai-lieu-lien-ket">
<span class="md-ellipsis">
      14. 📚 Tài liệu liên kết
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="reporting-service-data-model">🗃️ Reporting Service - Data Model<a class="headerlink" href="#reporting-service-data-model" title="Permanent link">¶</a></h1>
<h2 id="1-gioi-thieu">1. Giới thiệu<a class="headerlink" href="#1-gioi-thieu" title="Permanent link">¶</a></h2>
<p>Tài liệu này mô tả chi tiết mô hình dữ liệu của <strong>Reporting Service</strong>. Service này là một thành phần <strong>cốt lõi</strong> trong hệ thống <code>dx-vas</code>, hoạt động theo kiến trúc <strong>multi-tenant</strong>, phục vụ nhu cầu báo cáo và phân tích hệ thống của cả cấp Superadmin lẫn từng tenant riêng biệt.</p>
<p><strong>Reporting Service</strong> chịu trách nhiệm quản lý các loại dữ liệu chính sau:
-   Các cấu hình mẫu báo cáo (<code>report_templates</code>)
-   Lịch sử truy vấn và kết quả báo cáo (<code>report_query_logs</code>)
-   Cấu hình báo cáo đã lưu của người dùng (<code>saved_report_configs</code>)
-   Cấu hình hiển thị dashboard (<code>saved_dashboard_layouts</code>)</p>
<p>Mô hình dữ liệu này là cơ sở cho việc phát triển backend, định nghĩa API, thực hiện schema migration, đảm bảo tính nhất quán dữ liệu, và đồng thời phục vụ cho việc truy vấn tới hệ thống Data Warehouse như BigQuery.</p>
<h2 id="2-pham-vi-du-lieu-quan-ly-scope">2. Phạm vi Dữ liệu Quản lý (Scope)<a class="headerlink" href="#2-pham-vi-du-lieu-quan-ly-scope" title="Permanent link">¶</a></h2>
<p>Reporting Service bao gồm việc quản lý:
-   Danh sách các mẫu báo cáo được định nghĩa sẵn (<code>report_templates</code>)
-   Các truy vấn được thực thi dựa trên các template (<code>report_query_logs</code>)
-   Cấu hình báo cáo được người dùng lưu lại (<code>saved_report_configs</code>)
-   Cấu hình dashboard của người dùng (<code>saved_dashboard_layouts</code>)</p>
<h2 id="3-ngoai-pham-vi-out-of-scope">3. Ngoài Phạm Vi (Out of Scope)<a class="headerlink" href="#3-ngoai-pham-vi-out-of-scope" title="Permanent link">¶</a></h2>
<p>Reporting Service <strong>không</strong> chịu trách nhiệm quản lý:
-   ❌ Dữ liệu thô (raw data) từ các hệ thống nguồn – đã được ETL đưa vào Data Warehouse.
-   ❌ Truy cập trực tiếp vào các table nghiệp vụ cụ thể của CRM/SIS/LMS – được truy vấn gián tiếp qua BigQuery.
-   ❌ Quản lý quyền truy cập người dùng – thực hiện thông qua API Gateway và RBAC Service.</p>
<h2 id="4-muc-tieu-cua-tai-lieu-mo-hinh-du-lieu">4. Mục tiêu của Tài liệu Mô hình Dữ liệu<a class="headerlink" href="#4-muc-tieu-cua-tai-lieu-mo-hinh-du-lieu" title="Permanent link">¶</a></h2>
<ul>
<li>Trình bày cấu trúc các bảng dữ liệu cốt lõi của Reporting Service.</li>
<li>Mô tả các ràng buộc dữ liệu (constraints), khóa chính/ngoại, chỉ mục (indexes).</li>
<li>Hỗ trợ cho quá trình phát triển backend, viết đặc tả OpenAPI, thực hiện schema migration, kiểm thử và bảo trì service.</li>
<li>Làm nền tảng để đảm bảo tính nhất quán schema với các tài liệu liên quan như <code>design.md</code>, <code>interface-contract.md</code>, <code>openapi.yaml</code>, và các ADRs như [ADR-028 Reporting Architecture], [ADR-029 Report Template Schema], và [ADR-030 Event Schema Governance].</li>
</ul>
<hr/>
<h2 id="5-so-o-erd-entity-relationship-diagram">5. Sơ đồ ERD (Entity Relationship Diagram)<a class="headerlink" href="#5-so-o-erd-entity-relationship-diagram" title="Permanent link">¶</a></h2>
<p><strong>Sơ đồ sơ bộ</strong>
<pre class="mermaid"><code>erDiagram

  report_templates ||--o{ report_query_logs : generates
  report_templates ||--o{ saved_report_configs : based_on
  saved_report_configs ||--o{ saved_dashboard_layouts : uses

  report_templates {
    string id PK
    string name
    string description
    jsonb input_parameters
    string data_view
    string query_template
    jsonb required_permission
    string version
    boolean is_active
    timestamp created_at
    timestamp updated_at
  }

  report_query_logs {
    string id PK
    string template_id FK
    string user_id
    string tenant_id
    jsonb input_used
    timestamp executed_at
    float query_duration_ms
    string status
    jsonb metadata
  }

  saved_report_configs {
    string id PK
    string user_id
    string tenant_id
    string template_id FK
    string name
    jsonb input_parameters
    timestamp created_at
    timestamp updated_at
  }

  saved_dashboard_layouts {
    string id PK
    string config_id FK
    string user_id
    string layout_type
    jsonb widget_arrangement
    timestamp created_at
    timestamp updated_at
  }
</code></pre></p>
<blockquote>
<p>📝 Ghi chú:</p>
<ul>
<li><code>report_templates</code>: Định nghĩa mẫu báo cáo, do Superadmin tạo hoặc hệ thống cài sẵn.</li>
<li><code>report_query_logs</code>: Ghi nhận các lần người dùng truy vấn theo mẫu.</li>
<li><code>saved_report_configs</code>: Cho phép người dùng lưu cấu hình để tái sử dụng.</li>
<li><code>saved_dashboard_layouts</code>: Cho phép người dùng tự cấu hình dashboard từ nhiều config.</li>
</ul>
</blockquote>
<p><strong>Sơ đồ chi tiết</strong>
<pre class="mermaid"><code>erDiagram

report_templates {
  string template_id PK
  string name
  string description
  string data_view
  boolean is_active
  string created_by
  timestamp created_at
}

report_template_versions {
  string version PK
  string template_id FK
  string query_template
  jsonb input_parameters_schema
  timestamp created_at
  string created_by
}

report_template_permissions {
  string template_id FK
  string permission_code
}

report_query_logs {
  string log_id PK
  string user_id
  string tenant_id
  string template_id FK
  jsonb input_used
  string status
  int query_duration_ms
  timestamp executed_at
}

saved_report_configs {
  string config_id PK
  string user_id
  string tenant_id
  string template_id FK
  jsonb input_parameters
  string name
  timestamp created_at
}

saved_dashboard_layouts {
  string layout_id PK
  string user_id
  string config_id FK
  jsonb layout
  string layout_type
  timestamp updated_at
}

report_templates ||--o{ report_template_versions : has
report_templates ||--o{ report_template_permissions : has
report_templates ||--o{ report_query_logs : used_in
report_templates ||--o{ saved_report_configs : config_of
saved_report_configs ||--o{ saved_dashboard_layouts : contains
</code></pre></p>
<hr/>
<h2 id="6-mo-ta-chi-tiet-tung-bang">6. Mô tả chi tiết từng bảng<a class="headerlink" href="#6-mo-ta-chi-tiet-tung-bang" title="Permanent link">¶</a></h2>
<h3 id="61-report_templates">6.1. <code>report_templates</code><a class="headerlink" href="#61-report_templates" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">report_templates</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="n">template_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="n">data_view</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="n">is_active</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="n">created_by</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="p">);</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Mã định danh duy nhất của template</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Tên hiển thị của template</td>
</tr>
<tr>
<td><code>description</code></td>
<td><code>string</code></td>
<td>⛔</td>
<td>Mô tả ngắn về báo cáo</td>
</tr>
<tr>
<td><code>input_parameters</code></td>
<td><code>jsonb</code></td>
<td>✅</td>
<td>Danh sách các tham số người dùng cần nhập</td>
</tr>
<tr>
<td><code>data_view</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>View/table trong Data Warehouse mà query_template sử dụng</td>
</tr>
<tr>
<td><code>query_template</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Câu truy vấn động với placeholder</td>
</tr>
<tr>
<td><code>required_permission</code></td>
<td><code>jsonb</code></td>
<td>✅</td>
<td>Danh sách quyền cần có để truy cập</td>
</tr>
<tr>
<td><code>version</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Phiên bản của template, ví dụ: "v1", "v2"</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td><code>boolean</code></td>
<td>✅</td>
<td>Đánh dấu template đã bị vô hiệu hóa chưa</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Ngày tạo</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Ngày cập nhật cuối cùng</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="62-report_query_logs">6.2. <code>report_query_logs</code><a class="headerlink" href="#62-report_query_logs" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">report_query_logs</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="n">log_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="n">tenant_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="n">template_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">,</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">  </span><span class="n">input_used</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">'success'</span><span class="p">,</span><span class="w"> </span><span class="s1">'error'</span><span class="p">,</span><span class="w"> </span><span class="s1">'timeout'</span><span class="p">,</span><span class="w"> </span><span class="s1">'unauthorized'</span><span class="p">,</span><span class="w"> </span><span class="s1">'validation_failed'</span><span class="p">)),</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">  </span><span class="n">query_duration_ms</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">  </span><span class="n">executed_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">report_templates</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="p">);</span>
</span></code></pre></div>
<blockquote>
<p>📝 Giải thích: Chúng ta dùng ON DELETE SET NULL cho logs để vẫn giữ log truy vấn dù template bị xóa.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID của log</td>
</tr>
<tr>
<td><code>template_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Template mà truy vấn dựa trên</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID người dùng thực hiện truy vấn</td>
</tr>
<tr>
<td><code>tenant_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID tenant</td>
</tr>
<tr>
<td><code>input_used</code></td>
<td><code>jsonb</code></td>
<td>✅</td>
<td>Tham số truy vấn sử dụng</td>
</tr>
<tr>
<td><code>executed_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Thời điểm thực hiện truy vấn</td>
</tr>
<tr>
<td><code>query_duration_ms</code></td>
<td><code>float</code></td>
<td>✅</td>
<td>Thời gian thực thi</td>
</tr>
<tr>
<td><code>status</code></td>
<td><code>string</code></td>
<td>✅</td>
<td><code>success</code>, <code>error</code>, <code>timeout</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>jsonb</code></td>
<td>⛔</td>
<td>Thông tin thêm: source IP, user-agent, etc.</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="63-saved_report_configs">6.3. <code>saved_report_configs</code><a class="headerlink" href="#63-saved_report_configs" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">saved_report_configs</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="n">config_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="n">tenant_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="n">template_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="n">input_parameters</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">report_templates</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="p">);</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID cấu hình</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Người tạo</td>
</tr>
<tr>
<td><code>tenant_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Tenant tương ứng</td>
</tr>
<tr>
<td><code>template_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Template được sử dụng</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Tên cấu hình người dùng tự đặt</td>
</tr>
<tr>
<td><code>input_parameters</code></td>
<td><code>jsonb</code></td>
<td>✅</td>
<td>Tham số điền sẵn</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Ngày tạo</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Ngày cập nhật gần nhất</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="64-saved_dashboard_layouts">6.4. <code>saved_dashboard_layouts</code><a class="headerlink" href="#64-saved_dashboard_layouts" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">saved_dashboard_layouts</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="n">layout_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="n">config_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="n">layout</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">  </span><span class="n">layout_type</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">layout_type</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">'chart'</span><span class="p">,</span><span class="w"> </span><span class="s1">'table'</span><span class="p">,</span><span class="w"> </span><span class="s1">'dashboard_grid'</span><span class="p">)),</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">config_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">saved_report_configs</span><span class="p">(</span><span class="n">config_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="p">);</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID layout</td>
</tr>
<tr>
<td><code>config_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Liên kết tới <code>saved_report_configs</code></td>
</tr>
<tr>
<td><code>user_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Người sở hữu</td>
</tr>
<tr>
<td><code>layout_type</code></td>
<td><code>string</code></td>
<td>✅</td>
<td><code>grid</code>, <code>tabbed</code>, etc.</td>
</tr>
<tr>
<td><code>widget_arrangement</code></td>
<td><code>jsonb</code></td>
<td>✅</td>
<td>JSON định nghĩa layout UI</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Thời điểm tạo</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Lần cập nhật cuối</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="7-cac-bang-phu-tro">7. Các bảng phụ trợ<a class="headerlink" href="#7-cac-bang-phu-tro" title="Permanent link">¶</a></h2>
<h3 id="71-report_template_versions">7.1. <code>report_template_versions</code><a class="headerlink" href="#71-report_template_versions" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">report_template_versions</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="k">version</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="n">template_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span><span class="n">query_template</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="n">input_parameters_schema</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">  </span><span class="n">created_by</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">template_id</span><span class="p">,</span><span class="w"> </span><span class="k">version</span><span class="p">),</span>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">report_templates</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="p">);</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID bản ghi</td>
</tr>
<tr>
<td><code>template_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Liên kết tới template chính</td>
</tr>
<tr>
<td><code>version</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Số phiên bản (ví dụ: "v1", "v2")</td>
</tr>
<tr>
<td><code>query_template</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Nội dung query tương ứng với phiên bản này</td>
</tr>
<tr>
<td><code>input_parameters</code></td>
<td><code>jsonb</code></td>
<td>✅</td>
<td>Định nghĩa tham số tương ứng</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Thời điểm tạo bản này</td>
</tr>
<tr>
<td><code>created_by</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Người tạo phiên bản này</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🎯 Dùng để lưu trữ các phiên bản cũ của report template, giúp rollback dễ dàng hoặc theo dõi lịch sử.</p>
</blockquote>
<hr/>
<h3 id="72-report_template_permissions">7.2. <code>report_template_permissions</code><a class="headerlink" href="#72-report_template_permissions" title="Permanent link">¶</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">report_template_permissions</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="n">template_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">  </span><span class="n">permission_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">template_id</span><span class="p">,</span><span class="w"> </span><span class="n">permission_code</span><span class="p">),</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">report_templates</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">);</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>template_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID template</td>
</tr>
<tr>
<td><code>permission_code</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>Mã quyền yêu cầu (ví dụ: <code>report.view_finance</code>)</td>
</tr>
<tr>
<td><code>is_required</code></td>
<td><code>bool</code></td>
<td>✅</td>
<td><code>true</code> = bắt buộc, <code>false</code> = tùy chọn</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Ngày thêm quyền này vào template</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🎯 Cho phép tách riêng quyền kiểm soát truy cập với từng template thay vì nhét toàn bộ trong 1 cột JSON.</p>
</blockquote>
<hr/>
<h3 id="73-report_query_status_logs">7.3. <code>report_query_status_logs</code><a class="headerlink" href="#73-report_query_status_logs" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID log</td>
</tr>
<tr>
<td><code>query_id</code></td>
<td><code>string</code></td>
<td>✅</td>
<td>ID từ bảng <code>report_query_logs</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td><code>string</code></td>
<td>✅</td>
<td><code>started</code>, <code>running</code>, <code>success</code>, <code>error</code>, <code>timeout</code></td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td><code>timestamp</code></td>
<td>✅</td>
<td>Thời điểm log</td>
</tr>
<tr>
<td><code>message</code></td>
<td><code>string</code></td>
<td>⛔</td>
<td>Mô tả chi tiết hoặc lỗi</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🎯 Ghi nhận chi tiết lifecycle của truy vấn để phục vụ debug và audit.</p>
</blockquote>
<hr/>
<h2 id="8-indexes-constraints">8. Indexes &amp; Constraints<a class="headerlink" href="#8-indexes-constraints" title="Permanent link">¶</a></h2>
<p>Dưới đây là các chỉ mục và ràng buộc quan trọng nhằm đảm bảo hiệu năng truy vấn và tính toàn vẹn dữ liệu trong hệ thống.</p>
<hr/>
<h3 id="81-report_templates">8.1. <code>report_templates</code><a class="headerlink" href="#81-report_templates" title="Permanent link">¶</a></h3>
<p><strong>Indexes:</strong>
- <code>idx_report_templates_active</code>: (<code>is_active</code>)
- <code>idx_report_templates_name</code>: (<code>name</code>)
- <code>idx_report_templates_data_view</code>: (<code>data_view</code>)</p>
<p><strong>Constraints:</strong>
- <code>UNIQUE(template_id, version)</code>
- <code>CHECK (version ~ '^v[0-9]+$')</code> – đảm bảo version hợp lệ</p>
<hr/>
<h3 id="82-report_query_logs">8.2. <code>report_query_logs</code><a class="headerlink" href="#82-report_query_logs" title="Permanent link">¶</a></h3>
<p><strong>Indexes:</strong>
- <code>idx_query_logs_user</code>: (<code>user_id</code>)
- <code>idx_query_logs_template</code>: (<code>template_id</code>)
- <code>idx_query_logs_tenant_time</code>: (<code>tenant_id</code>, <code>executed_at</code> DESC)</p>
<p><strong>Constraints:</strong>
- <code>CHECK (query_duration_ms &gt;= 0)</code>
- <code>CHECK (status IN ('success', 'error', 'timeout'))</code></p>
<hr/>
<h3 id="83-saved_report_configs">8.3. <code>saved_report_configs</code><a class="headerlink" href="#83-saved_report_configs" title="Permanent link">¶</a></h3>
<p><strong>Indexes:</strong>
- <code>idx_saved_config_user</code>: (<code>user_id</code>)
- <code>idx_saved_config_tenant</code>: (<code>tenant_id</code>)
- <code>idx_saved_config_template</code>: (<code>template_id</code>)</p>
<p><strong>Constraints:</strong>
- <code>UNIQUE(user_id, name)</code> – mỗi người dùng không được đặt tên trùng nhau cho cấu hình đã lưu
- <code>CHECK (input_parameters IS NOT NULL)</code></p>
<hr/>
<h3 id="84-saved_dashboard_layouts">8.4. <code>saved_dashboard_layouts</code><a class="headerlink" href="#84-saved_dashboard_layouts" title="Permanent link">¶</a></h3>
<p><strong>Indexes:</strong>
- <code>idx_dashboard_layout_user</code>: (<code>user_id</code>)
- <code>idx_dashboard_layout_config</code>: (<code>config_id</code>)</p>
<p><strong>Constraints:</strong>
- <code>CHECK (layout_type IN ('grid', 'tabbed', 'freeform'))</code></p>
<hr/>
<h3 id="85-report_template_versions">8.5. <code>report_template_versions</code><a class="headerlink" href="#85-report_template_versions" title="Permanent link">¶</a></h3>
<p><strong>Indexes:</strong>
- <code>idx_versions_template</code>: (<code>template_id</code>)
- <code>idx_versions_created_by</code>: (<code>created_by</code>)</p>
<p><strong>Constraints:</strong>
- <code>UNIQUE(template_id, version)</code>
- <code>CHECK (version ~ '^v[0-9]+$')</code></p>
<hr/>
<h3 id="86-report_template_permissions">8.6. <code>report_template_permissions</code><a class="headerlink" href="#86-report_template_permissions" title="Permanent link">¶</a></h3>
<p><strong>Indexes:</strong>
- <code>idx_permissions_template</code>: (<code>template_id</code>)
- <code>idx_permissions_code</code>: (<code>permission_code</code>)</p>
<p><strong>Constraints:</strong>
- <code>UNIQUE(template_id, permission_code)</code></p>
<hr/>
<h2 id="9-chinh-sach-luu-tru-xoa-du-lieu-retention">9. Chính sách Lưu trữ &amp; Xóa dữ liệu (Retention)<a class="headerlink" href="#9-chinh-sach-luu-tru-xoa-du-lieu-retention" title="Permanent link">¶</a></h2>
<p>Hệ thống Reporting Service cần áp dụng các chính sách lưu trữ phù hợp để cân bằng giữa truy xuất hiệu quả, chi phí lưu trữ và yêu cầu tuân thủ pháp lý.</p>
<hr/>
<h3 id="91-report_query_logs">9.1. <code>report_query_logs</code><a class="headerlink" href="#91-report_query_logs" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Thời gian giữ:</strong> 12 tháng</li>
<li><strong>Cơ chế xóa:</strong> Tự động thông qua batch job định kỳ (ví dụ: Cloud Scheduler + Cloud Function)</li>
<li><strong>Lý do:</strong> Log này phục vụ thống kê hiệu năng và truy vết người dùng. Sau 12 tháng, dữ liệu cũ ít giá trị sử dụng.</li>
</ul>
<hr/>
<h3 id="92-report_template_versions">9.2. <code>report_template_versions</code><a class="headerlink" href="#92-report_template_versions" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Thời gian giữ:</strong> Vĩnh viễn (hoặc cho đến khi template chính bị xóa)</li>
<li><strong>Cơ chế xóa:</strong> Chỉ xóa khi Superadmin hoặc hệ thống quyết định xóa template chính</li>
<li><strong>Lý do:</strong> Cần lưu lịch sử để rollback hoặc kiểm tra thay đổi.</li>
</ul>
<hr/>
<h3 id="93-saved_report_configs-saved_dashboard_layouts">9.3. <code>saved_report_configs</code> &amp; <code>saved_dashboard_layouts</code><a class="headerlink" href="#93-saved_report_configs-saved_dashboard_layouts" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Thời gian giữ:</strong> Vĩnh viễn (miễn là user còn hoạt động)</li>
<li><strong>Cơ chế xóa:</strong> Theo yêu cầu người dùng hoặc khi user bị xóa khỏi hệ thống</li>
<li><strong>Lý do:</strong> Đây là dữ liệu do người dùng lưu thủ công, nên cần tôn trọng quyền sở hữu.</li>
</ul>
<hr/>
<h3 id="94-report_template_permissions">9.4. <code>report_template_permissions</code><a class="headerlink" href="#94-report_template_permissions" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Thời gian giữ:</strong> Vĩnh viễn</li>
<li><strong>Lý do:</strong> Là một phần cấu trúc quyền của template, luôn cần cho xác thực truy cập.</li>
</ul>
<hr/>
<h3 id="95-tuan-thu-adr-024">9.5. Tuân thủ ADR-024<a class="headerlink" href="#95-tuan-thu-adr-024" title="Permanent link">¶</a></h3>
<p>Tất cả các bảng log và dữ liệu có thể chứa thông tin cá nhân (như <code>user_id</code>, <code>input_used</code>, <code>tenant_id</code>) đều:
- Tuân thủ chính sách ẩn danh hóa theo <a href="../../../ADR/adr-024-data-anonymization-retention.md">ADR-024 - Data Anonymization &amp; Retention</a>
- Cần kiểm tra masking hợp lý trước khi lưu log truy vấn hoặc log dashboard</p>
<hr/>
<h2 id="10-phan-quyen-truy-cap-du-lieu">10. Phân quyền truy cập dữ liệu<a class="headerlink" href="#10-phan-quyen-truy-cap-du-lieu" title="Permanent link">¶</a></h2>
<p>Toàn bộ hệ thống Reporting Service tuân thủ mô hình phân quyền động (RBAC) đã được mô tả trong <a href="../../../ADR/adr-007-rbac.md">ADR-007</a> và <a href="../../../rbac-deep-dive.md">rbac-deep-dive.md</a>.</p>
<hr/>
<h3 id="101-truy-van-bao-cao-reportsquery">10.1. Truy vấn báo cáo (<code>/reports/query</code>)<a class="headerlink" href="#101-truy-van-bao-cao-reportsquery" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Kiểm tra quyền truy cập:</strong></li>
<li>Mỗi <code>report_template</code> khai báo một hoặc nhiều <code>required_permission</code>.</li>
<li>Tại thời điểm truy vấn, <code>RBAC Validator</code> sẽ kiểm tra xem user có đủ các permission cần thiết trong context tenant hay không.</li>
<li>Việc này được thực hiện <strong>ở tầng API Gateway</strong> (dựa trên <code>x-required-permission</code>) và <strong>ở tầng Reporting Service</strong> như lớp kiểm tra bổ sung (fail-safe).</li>
<li><strong>Ví dụ permission code:</strong></li>
<li><code>report.view_financial_summary</code></li>
<li><code>report.view_user_growth</code></li>
</ul>
<hr/>
<h3 id="102-quan-ly-template-report-templates">10.2. Quản lý Template (<code>/report-templates/**</code>)<a class="headerlink" href="#102-quan-ly-template-report-templates" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Chỉ Superadmin</strong> có quyền thực hiện các thao tác tạo, cập nhật, vô hiệu hóa template.</li>
<li>Permission áp dụng:</li>
<li><code>report.manage_templates</code></li>
<li><code>report.view_templates</code></li>
</ul>
<hr/>
<h3 id="103-saved-report-configs-dashboards-saved-configs-dashboards">10.3. Saved Report Configs &amp; Dashboards (<code>/saved-configs</code>, <code>/dashboards</code>)<a class="headerlink" href="#103-saved-report-configs-dashboards-saved-configs-dashboards" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Quyền theo người dùng:</strong></li>
<li>Người dùng chỉ được phép xem/chỉnh sửa/lưu dashboard của chính mình (<code>user_id</code>)</li>
<li><strong>RBAC nâng cao (nếu áp dụng):</strong></li>
<li>Có thể thêm permission như <code>report.save_config</code>, <code>report.share_dashboard</code> nếu muốn mở rộng chia sẻ trong tương lai.</li>
</ul>
<hr/>
<h3 id="104-logging-truy-vet">10.4. Logging &amp; Truy vết<a class="headerlink" href="#104-logging-truy-vet" title="Permanent link">¶</a></h3>
<ul>
<li>Dữ liệu log (<code>report_query_logs</code>) được ghi lại cho mỗi truy vấn nhưng chỉ Superadmin và các Auditor mới có quyền truy cập để xem toàn bộ.</li>
<li>API log truy vấn không public trong OpenAPI.</li>
</ul>
<hr/>
<h3 id="105-co-che-kiem-soat-phan-quyen">10.5. Cơ chế kiểm soát phân quyền<a class="headerlink" href="#105-co-che-kiem-soat-phan-quyen" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tầng kiểm soát</th>
<th>Vai trò</th>
</tr>
</thead>
<tbody>
<tr>
<td>API Gateway</td>
<td>Enforce <code>x-required-permission</code> từ template</td>
</tr>
<tr>
<td>Reporting Service</td>
<td>Kiểm tra lại bằng RBACValidator nội bộ</td>
</tr>
<tr>
<td>Database</td>
<td>Không để lộ dữ liệu nhạy cảm; xác thực ở tầng truy vấn</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="106-lien-ket-adr">10.6. Liên kết ADR<a class="headerlink" href="#106-lien-ket-adr" title="Permanent link">¶</a></h3>
<ul>
<li><a href="../../../ADR/adr-007-rbac.md">ADR-007 - RBAC Architecture</a></li>
<li><a href="../../../ADR/adr-028-reporting-architecture.md">ADR-028 - Reporting Architecture</a></li>
<li><a href="../../../ADR/adr-029-report-template-schema.md">ADR-029 - Report Template Schema</a></li>
</ul>
<hr/>
<h2 id="11-mo-rong-trong-tuong-lai">11. Mở rộng trong tương lai<a class="headerlink" href="#11-mo-rong-trong-tuong-lai" title="Permanent link">¶</a></h2>
<p>Hệ thống dữ liệu của Reporting Service được thiết kế với khả năng mở rộng cao nhằm đáp ứng các nhu cầu mới của tổ chức và tích hợp các công nghệ hiện đại như AI, multi-tenant reporting, và dashboard động.</p>
<hr/>
<h3 id="111-mo-rong-schema-template">11.1. Mở rộng Schema Template<a class="headerlink" href="#111-mo-rong-schema-template" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Thêm các loại input parameter mới:</strong></li>
<li><code>multi-select enum</code>, <code>daterange</code>, <code>autocomplete query</code>, <code>dynamic metric</code></li>
<li><strong>Support các rule validate nâng cao:</strong></li>
<li>Theo <code>regex</code>, <code>min/max</code>, hoặc phụ thuộc lẫn nhau giữa các parameter</li>
</ul>
<hr/>
<h3 id="112-cau-truc-template-ong-theo-tung-nhom-bao-cao">11.2. Cấu trúc Template động theo từng nhóm báo cáo<a class="headerlink" href="#112-cau-truc-template-ong-theo-tung-nhom-bao-cao" title="Permanent link">¶</a></h3>
<ul>
<li>Tách các bảng <code>report_templates</code> và <code>report_template_versions</code> thành các nhóm (module hóa) theo lĩnh vực: <code>user_growth</code>, <code>revenue</code>, <code>admissions</code>, v.v.</li>
<li>Hỗ trợ đa ngôn ngữ cho <code>name</code>, <code>description</code></li>
</ul>
<hr/>
<h3 id="113-dashboard-config-nang-cao">11.3. Dashboard Config nâng cao<a class="headerlink" href="#113-dashboard-config-nang-cao" title="Permanent link">¶</a></h3>
<ul>
<li>Cho phép:</li>
<li>Lưu dashboard chia sẻ được giữa nhiều người</li>
<li>Có trạng thái "private/public"</li>
<li>Dashboard phân quyền theo role</li>
</ul>
<hr/>
<h3 id="114-audit-log-nang-cao">11.4. Audit Log nâng cao<a class="headerlink" href="#114-audit-log-nang-cao" title="Permanent link">¶</a></h3>
<ul>
<li>Mở rộng thêm bảng <code>report_audit_logs</code>:</li>
<li>Lưu lại truy vấn, hành động chỉnh sửa template, quyền truy cập dữ liệu theo user</li>
<li>Tuân thủ <a href="../../../ADR/adr-008-audit-logging.md">ADR-008 - Audit Logging</a></li>
</ul>
<hr/>
<h3 id="115-chuan-bi-cho-ai-agent">11.5. Chuẩn bị cho AI Agent<a class="headerlink" href="#115-chuan-bi-cho-ai-agent" title="Permanent link">¶</a></h3>
<ul>
<li>Thiết kế schema <code>report_query_logs</code> và <code>saved_configs</code> có thể phục vụ recommendation engine:</li>
<li>Dự đoán báo cáo thường dùng</li>
<li>Tự động đề xuất dashboard cho từng nhóm người dùng</li>
<li>Lưu metadata đủ phong phú để AI dễ phân tích hành vi</li>
</ul>
<hr/>
<h3 id="116-truy-van-thoi-gian-thuc-streaming-report">11.6. Truy vấn thời gian thực (Streaming Report)<a class="headerlink" href="#116-truy-van-thoi-gian-thuc-streaming-report" title="Permanent link">¶</a></h3>
<ul>
<li>Kết nối với BigQuery Streaming hoặc hệ thống OLAP (Clickhouse, Pinot) để hỗ trợ báo cáo gần real-time.</li>
<li>Thêm cột <code>is_streaming_enabled</code> trong <code>report_templates</code></li>
</ul>
<hr/>
<h3 id="117-tich-hop-to-chuc-thu-3-external-systems">11.7. Tích hợp tổ chức thứ 3 (External Systems)<a class="headerlink" href="#117-tich-hop-to-chuc-thu-3-external-systems" title="Permanent link">¶</a></h3>
<ul>
<li>Cho phép ghi <code>report_query_logs</code> vào hệ thống giám sát như:</li>
<li>GCP Cloud Logging</li>
<li>Elastic Stack</li>
<li>Cho phép gọi webhook khi một loại báo cáo được truy cập đủ nhiều (dùng cho cảnh báo hệ thống)</li>
</ul>
<hr/>
<h2 id="12-enum">12. ENUM<a class="headerlink" href="#12-enum" title="Permanent link">¶</a></h2>
<p>Dưới đây là các giá trị ENUM được sử dụng trong schema của Reporting Service. Các enum này nên được lưu trữ tập trung trong file schema hoặc table config (nếu cần mở rộng động).</p>
<hr/>
<h3 id="121-status-trong-report_query_logs">12.1. <code>status</code> trong <code>report_query_logs</code><a class="headerlink" href="#121-status-trong-report_query_logs" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>success</code></td>
<td>Truy vấn thành công</td>
</tr>
<tr>
<td><code>error</code></td>
<td>Lỗi trong quá trình truy vấn</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>Truy vấn bị timeout</td>
</tr>
<tr>
<td><code>unauthorized</code></td>
<td>Người dùng không có quyền</td>
</tr>
<tr>
<td><code>validation_failed</code></td>
<td>Sai định dạng hoặc thiếu tham số</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="122-layout_type-trong-saved_dashboard_layouts">12.2. <code>layout_type</code> trong <code>saved_dashboard_layouts</code><a class="headerlink" href="#122-layout_type-trong-saved_dashboard_layouts" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>chart</code></td>
<td>Biểu đồ đơn</td>
</tr>
<tr>
<td><code>table</code></td>
<td>Dạng bảng</td>
</tr>
<tr>
<td><code>dashboard_grid</code></td>
<td>Giao diện nhiều biểu đồ</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="123-input_type-trong-report_template_versionsinput_parameters_schema">12.3. <code>input_type</code> trong <code>report_template_versions.input_parameters_schema</code><a class="headerlink" href="#123-input_type-trong-report_template_versionsinput_parameters_schema" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td>Chuỗi văn bản</td>
</tr>
<tr>
<td><code>number</code></td>
<td>Số</td>
</tr>
<tr>
<td><code>date</code></td>
<td>Ngày</td>
</tr>
<tr>
<td><code>enum</code></td>
<td>Tập giá trị lựa chọn</td>
</tr>
<tr>
<td><code>multi-select</code></td>
<td>Chọn nhiều giá trị</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td>Đúng/Sai</td>
</tr>
<tr>
<td><code>daterange</code></td>
<td>Khoảng thời gian</td>
</tr>
<tr>
<td><code>autocomplete</code></td>
<td>Gợi ý từ danh sách</td>
</tr>
<tr>
<td><code>query-select</code></td>
<td>Truy vấn động danh sách từ data_view</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="124-permission_code-vi-du">12.4. <code>permission_code</code> (ví dụ)<a class="headerlink" href="#124-permission_code-vi-du" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>report.view_financial_summary</code></td>
<td>Xem báo cáo tài chính tổng quan</td>
</tr>
<tr>
<td><code>report.manage_report_templates</code></td>
<td>Quản lý mẫu báo cáo</td>
</tr>
<tr>
<td><code>report.view_user_growth</code></td>
<td>Xem tăng trưởng người dùng</td>
</tr>
<tr>
<td><code>report.save_config</code></td>
<td>Lưu cấu hình báo cáo cá nhân</td>
</tr>
</tbody>
</table>
<hr/>
<p><strong>Lưu ý:</strong> Các enum này được dùng trong schema <code>report_template_versions.input_parameters_schema</code>, các cấu hình template, và cơ chế phân quyền động.</p>
<hr/>
<p>Dưới đây là <strong>MARKDOWN BLOCK</strong> cho phần mới <code>📑 13. ENUM dưới dạng bảng phụ trợ</code>, giúp bạn quản lý các enum dưới dạng bảng dữ liệu thay vì chỉ là <code>CHECK</code>. Cách này giúp:</p>
<ul>
<li>Dễ cập nhật, tra cứu, hỗ trợ dashboard quản trị.</li>
<li>Cho phép mapping mô tả và metadata (ngôn ngữ, màu sắc, v.v.).</li>
<li>Thân thiện hơn nếu bạn dùng BigQuery hoặc dashboard tùy biến.</li>
</ul>
<hr/>
<h2 id="13-enum-duoi-dang-bang-phu-tro">📑 13. ENUM dưới dạng bảng phụ trợ<a class="headerlink" href="#13-enum-duoi-dang-bang-phu-tro" title="Permanent link">¶</a></h2>
<p>Thay vì sử dụng <code>CHECK constraint</code>, hệ thống sẽ quản lý các giá trị enum quan trọng dưới dạng bảng phụ trợ (lookup tables). Điều này tăng tính linh hoạt và khả năng mở rộng.</p>
<hr/>
<h3 id="131-report_statuses">13.1. 📄 report_statuses<a class="headerlink" href="#131-report_statuses" title="Permanent link">¶</a></h3>
<p>Trạng thái trả về khi thực hiện một truy vấn báo cáo.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">report_statuses</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">  </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">  </span><span class="n">color</span><span class="w"> </span><span class="nb">TEXT</span><span class="w">  </span><span class="c1">-- ví dụ: dùng cho dashboard UI</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="p">);</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">report_statuses</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">  </span><span class="p">(</span><span class="s1">'success'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Truy vấn thành công'</span><span class="p">,</span><span class="w"> </span><span class="s1">'green'</span><span class="p">),</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">  </span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Lỗi không xác định'</span><span class="p">,</span><span class="w"> </span><span class="s1">'red'</span><span class="p">),</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">  </span><span class="p">(</span><span class="s1">'timeout'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Quá thời gian xử lý'</span><span class="p">,</span><span class="w"> </span><span class="s1">'orange'</span><span class="p">),</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">  </span><span class="p">(</span><span class="s1">'unauthorized'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Không đủ quyền truy cập'</span><span class="p">,</span><span class="w"> </span><span class="s1">'gray'</span><span class="p">),</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">  </span><span class="p">(</span><span class="s1">'validation_failed'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Tham số đầu vào không hợp lệ'</span><span class="p">,</span><span class="w"> </span><span class="s1">'yellow'</span><span class="p">);</span>
</span></code></pre></div>
<p>Bảng này thay thế <code>CHECK(status IN ...)</code> trong <code>report_query_logs</code>.</p>
<hr/>
<h3 id="132-dashboard_layout_types">13.2. 📄 dashboard_layout_types<a class="headerlink" href="#132-dashboard_layout_types" title="Permanent link">¶</a></h3>
<p>Các kiểu layout dashboard cho phép.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dashboard_layout_types</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="n">layout_type</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="p">);</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">dashboard_layout_types</span><span class="w"> </span><span class="p">(</span><span class="n">layout_type</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">  </span><span class="p">(</span><span class="s1">'chart'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Hiển thị dạng biểu đồ'</span><span class="p">),</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">  </span><span class="p">(</span><span class="s1">'table'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Hiển thị dạng bảng'</span><span class="p">),</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">  </span><span class="p">(</span><span class="s1">'dashboard_grid'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Dạng lưới kết hợp'</span><span class="p">);</span>
</span></code></pre></div>
<p>Thay thế <code>CHECK(layout_type IN ...)</code> trong <code>saved_dashboard_layouts</code>.</p>
<hr/>
<h3 id="ap-dung">🔗 Áp dụng<a class="headerlink" href="#ap-dung" title="Permanent link">¶</a></h3>
<p>Các bảng như <code>report_query_logs</code>, <code>saved_dashboard_layouts</code> sẽ tham chiếu qua <code>FOREIGN KEY</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">report_statuses</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">layout_type</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">dashboard_layout_types</span><span class="p">(</span><span class="n">layout_type</span><span class="p">)</span>
</span></code></pre></div>
<hr/>
<p>🎯 Lợi ích:</p>
<ul>
<li>Hỗ trợ hiển thị UI phong phú (label, color, v.v.).</li>
<li>Dễ thay đổi, mở rộng mà không cần ALTER TABLE.</li>
<li>Có thể đồng bộ và quản lý qua giao diện admin.</li>
</ul>
<h2 id="14-tai-lieu-lien-ket">14. 📚 Tài liệu liên kết<a class="headerlink" href="#14-tai-lieu-lien-ket" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../interface-contract/">Interface Contract</a></li>
<li><a href="../openapi.yaml">OpenAPI Spec</a></li>
<li><a href="../design/">Design</a></li>
</ul>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Trở lại mục lục
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>