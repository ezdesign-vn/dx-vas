
<!doctype html>
<html lang="vi" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tài liệu kiến trúc và phát triển cho dự án Chuyển đổi số Trường Việt Anh.">
      
      
        <meta name="author" content="DX VAS Team">
      
      
        <link rel="canonical" href="https://ezdesign-vn.github.io/dx-vas/services/notification-service/sub/interface-contract/">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Notification Sub Service - Interface Contract - DX VAS - Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#notification-sub-service-interface-contract" class="md-skip">
          Bỏ qua
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Đầu trang">
    <a href="../../../.." title="DX VAS - Docs" class="md-header__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DX VAS - Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Notification Sub Service - Interface Contract
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Tìm kiếm" placeholder="Tìm kiếm" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Tìm kiếm">
        
        <button type="reset" class="md-search__icon md-icon" title="Xoá" aria-label="Xoá" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../architecture/system-diagrams/" class="md-tabs__link">
          
  
  
    
  
  Kiến trúc Hệ thống

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../dev-guide/" class="md-tabs__link">
        
  
  
    
  
  Hướng dẫn Phát triển

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../" class="md-tabs__link">
        
  
  
    
  
  Thiết kế Services

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../ADR/" class="md-tabs__link">
          
  
  
    
  
  Quyết định Kiến trúc (ADRs)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Thanh điều hướng" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="DX VAS - Docs" class="md-nav__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../../assets/images/logo.png" alt="logo">

    </a>
    DX VAS - Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kiến trúc Hệ thống
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kiến trúc Hệ thống
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architecture/system-diagrams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sơ đồ Hệ thống
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architecture/rbac-deep-dive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RBAC Chi tiết
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hướng dẫn Phát triển
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thiết kế Services
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../ADR/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Quyết định Kiến trúc (ADRs)
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Quyết định Kiến trúc (ADRs)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Mục lục">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Mục lục
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-pham-vi-scope" class="md-nav__link">
    <span class="md-ellipsis">
      1. Phạm vi (Scope)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-api-notificationslogs" class="md-nav__link">
    <span class="md-ellipsis">
      2. 📌 API: /notifications/logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-api-notificationstest" class="md-nav__link">
    <span class="md-ellipsis">
      3. 📌 API: /notifications/test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-api-notificationstemplates" class="md-nav__link">
    <span class="md-ellipsis">
      4. 📌 API: /notifications/templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phu-luc-bang-permission-code" class="md-nav__link">
    <span class="md-ellipsis">
      📌 Phụ lục: Bảng Permission Code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="notification-sub-service-interface-contract">📘 Notification Sub Service – Interface Contract<a class="headerlink" href="#notification-sub-service-interface-contract" title="Permanent link">¶</a></h1>
<p>Service này cung cấp các API phục vụ việc:
- Tra cứu danh sách notification đã gửi theo nhiều tiêu chí (tenant, trạng thái, channel…)
- Gửi thử một template notification (cho mục đích kiểm tra, sandbox)
- Tra cứu danh sách template hiện hành (per tenant)</p>
<h2 id="1-pham-vi-scope">1. Phạm vi (Scope)<a class="headerlink" href="#1-pham-vi-scope" title="Permanent link">¶</a></h2>
<p>Notification Sub Service chịu trách nhiệm xử lý các hành động sau:</p>
<p>✅ <strong>Trong phạm vi</strong>:
- Thực thi việc <strong>gửi notification thực tế</strong> dựa trên sự kiện <code>notification.triggered.v1</code> nhận từ Pub/Sub
- <strong>Ghi nhận log gửi</strong> (thành công/thất bại/fallback) cho mỗi tenant
- <strong>Cung cấp API truy vấn log đã gửi</strong> để phục vụ giao diện quản trị
- <strong>Cho phép gửi thử</strong> (test) một template tới một địa chỉ cụ thể nhằm kiểm tra cấu hình
- <strong>Cho phép xem danh sách template</strong> đang được sử dụng (metadata)
- <strong>Ghi log kiểm toán (audit)</strong> cho tất cả các hành động gửi, test, thay đổi config</p>
<p>🔒 <strong>Tất cả các API có ràng buộc <code>tenant_id</code></strong> (multi-tenant isolation theo CR-04 và <code>ADR-007</code>).</p>
<hr />
<p>🔎 <strong>Danh sách endpoint thuộc phạm vi contract:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Path</th>
<th>Mô tả chức năng</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GET</code></td>
<td><code>/notifications/logs</code></td>
<td>Truy xuất log notification đã gửi</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/notifications/test</code></td>
<td>Gửi thử một notification (dry-run)</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/notifications/templates</code></td>
<td>Truy xuất danh sách template (metadata)</td>
</tr>
</tbody>
</table>
<hr />
<p>❌ <strong>Ngoài phạm vi</strong>:
- Không nhận request gửi thật từ client (frontend)
- Không quản lý người nhận, trạng thái đọc/unread
- Không tạo/sửa template qua API (template được quản lý ngoài service này)
- Không quản lý opt-in/opt-out của người dùng (handled tại User Profile hoặc Master)
- Không phát sinh sự kiện outbound ra Pub/Sub</p>
<hr />
<blockquote>
<p>🧭 <strong>Nguyên tắc chung (General Principles):</strong>
- Tất cả API yêu cầu header <code>Authorization: Bearer &lt;JWT&gt;</code> (theo ADR-006).
- API tuân thủ cấu trúc response chuẩn theo <a href="../../../../ADR/adr-012-response-structure/">ADR-012</a>.
- Mọi lỗi đều tuân thủ <a href="../../../../ADR/adr-011-api-error-format/">ADR-011</a> và <a href="../../../../standards/error-codes/">Error Codes</a>
- Một số API yêu cầu <code>x-condition: tenant_id = {{X-Tenant-ID}}</code>.</p>
</blockquote>
<hr />
<h2 id="2-api-notificationslogs">2. 📌 API: <code>/notifications/logs</code><a class="headerlink" href="#2-api-notificationslogs" title="Permanent link">¶</a></h2>
<p>API dùng để liệt kê các notification đã gửi thành công hoặc thất bại của tenant hiện tại. Cho phép lọc theo trạng thái, kênh gửi, sự kiện hoặc người nhận.<br />
Hữu ích cho mục đích giám sát, hỗ trợ người dùng và truy vết sự cố.</p>
<hr />
<h4 id="request">📥 Request<a class="headerlink" href="#request" title="Permanent link">¶</a></h4>
<div class="language-http highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="err">GET /notifications/logs?page=1&amp;page_size=20&amp;status=sent&amp;channel=email</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="err">Authorization: Bearer &lt;JWT&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="err">X-Tenant-ID: tenant-vas-001</span>
</span></code></pre></div>
<p><strong>Query Parameters (tùy chọn):</strong></p>
<table>
<thead>
<tr>
<th>Tên</th>
<th>Kiểu</th>
<th>Mặc định</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>page</code></td>
<td>integer</td>
<td>1</td>
<td>Trang thứ mấy</td>
</tr>
<tr>
<td><code>page_size</code></td>
<td>integer</td>
<td>20</td>
<td>Số kết quả mỗi trang (max: 100)</td>
</tr>
<tr>
<td><code>status</code></td>
<td>string</td>
<td></td>
<td><code>sent</code>, <code>failed</code>, <code>queued</code>, <code>fallback</code></td>
</tr>
<tr>
<td><code>channel</code></td>
<td>string</td>
<td></td>
<td><code>email</code>, <code>sms</code>, <code>push</code></td>
</tr>
<tr>
<td><code>event_code</code></td>
<td>string</td>
<td></td>
<td>Mã sự kiện (<code>user.welcome</code>, v.v.)</td>
</tr>
<tr>
<td><code>recipient</code></td>
<td>string</td>
<td></td>
<td>Email/số điện thoại người nhận</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="response">📤 Response<a class="headerlink" href="#response" title="Permanent link">¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">&quot;page&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">&quot;page_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">&quot;total_pages&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="nt">&quot;total_items&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c3017c2b-5ef0-44a9-9274-06d9ab3f6cf7&quot;</span><span class="p">,</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">      </span><span class="nt">&quot;event_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user.welcome&quot;</span><span class="p">,</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">      </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sent&quot;</span><span class="p">,</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">      </span><span class="nt">&quot;recipient&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.edu.vn&quot;</span><span class="p">,</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">      </span><span class="nt">&quot;template_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tmpl-welcome-01&quot;</span><span class="p">,</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">      </span><span class="nt">&quot;sent_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-13T09:45:00Z&quot;</span><span class="p">,</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">      </span><span class="nt">&quot;retry&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">      </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x-trace-123abc&quot;</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>Response tuân theo chuẩn <code>Envelope</code> định nghĩa tại <code>ADR-012</code>.</p>
</blockquote>
<hr />
<h4 id="phan-quyen-ieu-kien">🔐 Phân quyền &amp; Điều kiện<a class="headerlink" href="#phan-quyen-ieu-kien" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Thuộc tính</th>
<th>Giá trị</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x-required-permission</code></td>
<td><code>notif.read.log</code></td>
</tr>
<tr>
<td><code>x-condition</code></td>
<td><code>tenant_id = {{X-Tenant-ID}}</code></td>
</tr>
</tbody>
</table>
<p>JWT phải chứa <code>tenant_id</code>, <code>sub</code>, và <code>permissions</code> hợp lệ.</p>
<hr />
<h4 id="su-kien-phat-ra">📣 Sự kiện phát ra<a class="headerlink" href="#su-kien-phat-ra" title="Permanent link">¶</a></h4>
<p>Không phát sinh sự kiện. API này chỉ phục vụ mục đích <strong>read-only</strong> và <strong>truy vết log</strong>.</p>
<hr />
<h4 id="ma-loi-co-the-tra-ve">❌ Mã lỗi có thể trả về<a class="headerlink" href="#ma-loi-co-the-tra-ve" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>HTTP</th>
<th><code>error_code</code></th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>Thiếu hoặc sai JWT token</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.permission_denied</code></td>
<td>Không có quyền <code>notif.read.log</code></td>
</tr>
<tr>
<td>400</td>
<td><code>common.validation_failed</code></td>
<td>Tham số query không hợp lệ</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>Gửi quá nhanh, bị giới hạn truy cập</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_server_error</code></td>
<td>Lỗi nội bộ không xác định</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Danh sách mã lỗi tuân thủ định nghĩa trong <a href="../../../../standards/error-codes/">Error Codes</a></p>
</blockquote>
<hr />
<h4 id="goi-y-kiem-thu">🧪 Gợi ý kiểm thử<a class="headerlink" href="#goi-y-kiem-thu" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Tình huống</th>
<th>Kết quả mong đợi</th>
</tr>
</thead>
<tbody>
<tr>
<td>Không có <code>Authorization</code> header</td>
<td>401 + <code>auth.unauthorized</code></td>
</tr>
<tr>
<td>Token không có quyền <code>notif.read.log</code></td>
<td>403 + <code>auth.permission_denied</code></td>
</tr>
<tr>
<td><code>page = -1</code> hoặc <code>page_size = 0</code></td>
<td>400 + <code>common.validation_failed</code></td>
</tr>
<tr>
<td>Token hợp lệ, có quyền</td>
<td>200, trả đúng danh sách theo filter</td>
</tr>
<tr>
<td><code>recipient</code> không tồn tại</td>
<td>200, <code>data=[]</code>, không có lỗi</td>
</tr>
<tr>
<td>Truy vấn quá nhiều lần</td>
<td>429 + <code>common.rate_limited</code></td>
</tr>
</tbody>
</table>
<hr />
<p>Dưới đây là phần mô tả chi tiết chuẩn 5★ cho API <code>POST /notifications/test</code>, đảm bảo đồng bộ với <code>design.md</code>, <code>error-codes.md</code>, <code>adr-012</code>, <code>adr-011</code>, và hỗ trợ kiểm thử cấu hình gửi thông báo trong môi trường multi-tenant:</p>
<hr />
<h2 id="3-api-notificationstest">3. 📌 API: <code>/notifications/test</code><a class="headerlink" href="#3-api-notificationstest" title="Permanent link">¶</a></h2>
<p>API dùng để gửi thử một notification dựa trên template hiện có, dùng cho mục đích kiểm tra kênh gửi (email/SMS) và nội dung hiển thị.<br />
Chỉ gửi đến một <code>recipient</code> duy nhất, không log lại trong hệ thống chính, không ảnh hưởng dữ liệu thật.<br />
Thường được dùng trong trang cấu hình kênh gửi hoặc giao diện test template.</p>
<hr />
<h4 id="request_1">📥 Request<a class="headerlink" href="#request_1" title="Permanent link">¶</a></h4>
<div class="language-http highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="err">POST /notifications/test</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="err">Authorization: Bearer &lt;JWT&gt;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="err">Content-Type: application/json</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="err">X-Tenant-ID: tenant-vas-001</span>
</span></code></pre></div>
<p><strong>Payload:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">&quot;recipient&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test@example.com&quot;</span><span class="p">,</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nt">&quot;event_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user.welcome&quot;</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="nt">&quot;full_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Lê Minh&quot;</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="nt">&quot;class&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5A&quot;</span><span class="p">,</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="nt">&quot;school&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Trường Việt Anh&quot;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Mô tả field:</strong></p>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Kiểu</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>channel</code></td>
<td>string</td>
<td>✅</td>
<td><code>email</code>, <code>sms</code>, <code>push</code></td>
</tr>
<tr>
<td><code>recipient</code></td>
<td>string</td>
<td>✅</td>
<td>Địa chỉ email/số điện thoại nhận test</td>
</tr>
<tr>
<td><code>event_code</code></td>
<td>string</td>
<td>✅</td>
<td>Mã sự kiện (template) để gửi thử</td>
</tr>
<tr>
<td><code>params</code></td>
<td>object</td>
<td>⛔</td>
<td>Dữ liệu sẽ được render vào template</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="response_1">📤 Response<a class="headerlink" href="#response_1" title="Permanent link">¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;trace-x123&quot;</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sent&quot;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="nt">&quot;recipient&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test@example.com&quot;</span><span class="p">,</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="nt">&quot;event_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user.welcome&quot;</span><span class="p">,</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="nt">&quot;template_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tmpl-welcome-01&quot;</span><span class="p">,</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="nt">&quot;preview&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;p&gt;Xin chào Lê Minh, chào mừng bạn đến lớp 5A!&lt;/p&gt;&quot;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>Trường <code>preview</code> chứa nội dung đã được render – hữu ích để kiểm thử cấu trúc template.</p>
</blockquote>
<hr />
<h4 id="phan-quyen-ieu-kien_1">🔐 Phân quyền &amp; Điều kiện<a class="headerlink" href="#phan-quyen-ieu-kien_1" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Thuộc tính</th>
<th>Giá trị</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x-required-permission</code></td>
<td><code>notif.send.test</code></td>
</tr>
<tr>
<td><code>x-condition</code></td>
<td><code>tenant_id = {{X-Tenant-ID}}</code></td>
</tr>
</tbody>
</table>
<hr />
<h4 id="su-kien-phat-ra_1">📣 Sự kiện phát ra<a class="headerlink" href="#su-kien-phat-ra_1" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Tên sự kiện</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>notification.test_sent</code></td>
<td>Log kiểm toán cho việc test gửi notification</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Sự kiện sẽ được gửi async tới <code>audit-logging-service</code>, không đưa vào luồng gửi thật.</p>
</blockquote>
<hr />
<h4 id="ma-loi-co-the-tra-ve_1">❌ Mã lỗi có thể trả về<a class="headerlink" href="#ma-loi-co-the-tra-ve_1" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>HTTP</th>
<th><code>error_code</code></th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>Thiếu hoặc sai JWT token</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.permission_denied</code></td>
<td>Không có quyền <code>notif.send.test</code></td>
</tr>
<tr>
<td>400</td>
<td><code>notif.template_not_found</code></td>
<td>Không tìm thấy template tương ứng <code>event_code</code></td>
</tr>
<tr>
<td>400</td>
<td><code>notif.invalid_recipient</code></td>
<td>Sai định dạng email hoặc số điện thoại</td>
</tr>
<tr>
<td>400</td>
<td><code>common.validation_failed</code></td>
<td>Payload không hợp lệ (thiếu field)</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>Gửi thử quá nhanh trong thời gian ngắn</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_server_error</code></td>
<td>Lỗi hệ thống khi gửi thử notification</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Mọi mã lỗi tuân thủ định nghĩa trong <a href="../../../../standards/error-codes/">Error Codes</a></p>
</blockquote>
<hr />
<h4 id="goi-y-kiem-thu_1">🧪 Gợi ý kiểm thử<a class="headerlink" href="#goi-y-kiem-thu_1" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Tình huống</th>
<th>Kết quả mong đợi</th>
</tr>
</thead>
<tbody>
<tr>
<td>Không có token</td>
<td><code>401 unauthorized</code></td>
</tr>
<tr>
<td>Token không có quyền</td>
<td><code>403 permission_denied</code></td>
</tr>
<tr>
<td>Sai <code>event_code</code></td>
<td><code>400 notif.template_not_found</code></td>
</tr>
<tr>
<td>Sai <code>recipient</code></td>
<td><code>400 notif.invalid_recipient</code></td>
</tr>
<tr>
<td>Thiếu <code>channel</code></td>
<td><code>400 common.validation_failed</code></td>
</tr>
<tr>
<td>Gửi thử thành công</td>
<td><code>200</code>, status = <code>sent</code>, có <code>preview</code> HTML</td>
</tr>
<tr>
<td>Gửi quá nhanh</td>
<td><code>429 common.rate_limited</code></td>
</tr>
<tr>
<td>Gửi bằng token tenant khác</td>
<td><code>403 permission_denied</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-api-notificationstemplates">4. 📌 API: <code>/notifications/templates</code><a class="headerlink" href="#4-api-notificationstemplates" title="Permanent link">¶</a></h2>
<p>API dùng để liệt kê danh sách metadata của các template notification đang được áp dụng cho <code>tenant</code> hiện tại.<br />
Không trả nội dung đầy đủ (body), chỉ metadata cần thiết phục vụ giao diện chọn template.</p>
<hr />
<h4 id="request_2">📥 Request<a class="headerlink" href="#request_2" title="Permanent link">¶</a></h4>
<div class="language-http highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="err">GET /notifications/templates</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="err">Authorization: Bearer &lt;JWT&gt;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="err">X-Tenant-ID: tenant-vas-001</span>
</span></code></pre></div>
<p><strong>Query Parameters (tuỳ chọn):</strong></p>
<table>
<thead>
<tr>
<th>Tên</th>
<th>Kiểu</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>channel</code></td>
<td>string</td>
<td>Lọc theo kênh (<code>email</code>, <code>sms</code>)</td>
</tr>
<tr>
<td><code>active</code></td>
<td>boolean</td>
<td>Lọc theo trạng thái đang bật</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="response_2">📤 Response<a class="headerlink" href="#response_2" title="Permanent link">¶</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="nt">&quot;total_items&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">      </span><span class="nt">&quot;template_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tmpl-welcome-01&quot;</span><span class="p">,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">      </span><span class="nt">&quot;event_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user.welcome&quot;</span><span class="p">,</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">      </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">      </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vi&quot;</span><span class="p">,</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">      </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">      </span><span class="nt">&quot;updated_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-01T08:00:00Z&quot;</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">      </span><span class="nt">&quot;template_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tmpl-resetpass-01&quot;</span><span class="p">,</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">      </span><span class="nt">&quot;event_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user.reset_password&quot;</span><span class="p">,</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">      </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">      </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">      </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">      </span><span class="nt">&quot;updated_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-05-10T14:32:12Z&quot;</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>Response sử dụng <code>Envelope</code> theo <code>ADR-012</code>.</p>
</blockquote>
<hr />
<h4 id="phan-quyen-ieu-kien_2">🔐 Phân quyền &amp; Điều kiện<a class="headerlink" href="#phan-quyen-ieu-kien_2" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Thuộc tính</th>
<th>Giá trị</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x-required-permission</code></td>
<td><code>notif.read.template</code></td>
</tr>
<tr>
<td><code>x-condition</code></td>
<td><code>tenant_id = {{X-Tenant-ID}}</code></td>
</tr>
</tbody>
</table>
<hr />
<h4 id="su-kien-phat-ra_2">📣 Sự kiện phát ra<a class="headerlink" href="#su-kien-phat-ra_2" title="Permanent link">¶</a></h4>
<p>Không phát sinh sự kiện. Đây là API dạng <em>read-only</em>, không có side effect.</p>
<hr />
<h4 id="ma-loi-co-the-tra-ve_2">❌ Mã lỗi có thể trả về<a class="headerlink" href="#ma-loi-co-the-tra-ve_2" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>HTTP</th>
<th><code>error_code</code></th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>Thiếu hoặc sai JWT token</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.permission_denied</code></td>
<td>Không có quyền <code>notif.read.template</code></td>
</tr>
<tr>
<td>400</td>
<td><code>common.validation_failed</code></td>
<td>Tham số query không hợp lệ</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>Truy cập quá nhanh, bị giới hạn</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_server_error</code></td>
<td>Lỗi không xác định từ hệ thống</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Tất cả mã lỗi tuân thủ <a href="../../../../standards/error-codes/">Error Codes</a></p>
</blockquote>
<hr />
<h4 id="goi-y-kiem-thu_2">🧪 Gợi ý kiểm thử<a class="headerlink" href="#goi-y-kiem-thu_2" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Tình huống</th>
<th>Kết quả mong đợi</th>
</tr>
</thead>
<tbody>
<tr>
<td>Token không hợp lệ</td>
<td><code>401 unauthorized</code></td>
</tr>
<tr>
<td>Thiếu quyền <code>notif.read.template</code></td>
<td><code>403 permission_denied</code></td>
</tr>
<tr>
<td>Gọi API với token hợp lệ</td>
<td>200, danh sách metadata template đúng</td>
</tr>
<tr>
<td>Lọc theo <code>channel=email</code></td>
<td>Chỉ trả các template email</td>
</tr>
<tr>
<td>Lọc theo <code>active=false</code></td>
<td>Trả các template không còn dùng</td>
</tr>
<tr>
<td>Không có template nào</td>
<td><code>data=[]</code>, không lỗi</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="phu-luc-bang-permission-code">📌 Phụ lục: Bảng Permission Code<a class="headerlink" href="#phu-luc-bang-permission-code" title="Permanent link">¶</a></h2>
<p>Dưới đây là bảng phân quyền (RBAC) áp dụng cho <code>notification-service/sub/</code>.<br />
Mỗi permission xác định rõ hành động cho một loại tài nguyên và phạm vi (scope).<br />
Permission được kiểm tra dựa trên JWT claim (<code>permissions</code>) kết hợp với điều kiện <code>tenant_id</code>.</p>
<table>
<thead>
<tr>
<th><code>permission_code</code></th>
<th>Mô tả quyền</th>
<th>Áp dụng cho API</th>
<th><code>resource</code></th>
<th><code>scope</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>notif.read.log</code></td>
<td>Truy vấn log notification đã gửi</td>
<td><code>GET /notifications/logs</code></td>
<td><code>NotificationLog</code></td>
<td><code>read</code></td>
</tr>
<tr>
<td><code>notif.send.test</code></td>
<td>Gửi thử notification bằng template</td>
<td><code>POST /notifications/test</code></td>
<td><code>NotificationSendTest</code></td>
<td><code>write</code></td>
</tr>
<tr>
<td><code>notif.read.template</code></td>
<td>Truy vấn metadata template của tenant</td>
<td><code>GET /notifications/templates</code></td>
<td><code>NotificationTemplate</code></td>
<td><code>read</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>✅ Tất cả các permission đều được kiểm tra cùng <code>x-condition: tenant_id = {{X-Tenant-ID}}</code> để đảm bảo isolation giữa các tenant.</p>
</blockquote>
<hr />
<p>🔒 <strong>Best Practice</strong>:
- Các role như <code>notification_admin</code>, <code>tenant_config_editor</code> có thể được gán những permission này.
- Không nên gán trực tiếp cho end-user frontend, chỉ áp dụng cho Admin Webapp hoặc hệ thống liên kết.</p>
<hr />
<p>📚 <strong>Tài liệu liên quan:</strong></p>
<ul>
<li><a href="../data-model/">Data Model</a></li>
<li><a href="../openapi.yaml">OpenAPI Spec</a></li>
<li><a href="../design/">Design</a></li>
<li><a href="../../../../ADR/adr-012-response-structure/">ADR-012 – Response Structure</a></li>
<li><a href="../../../../ADR/adr-011-api-error-format/">ADR-011 – Error Format</a></li>
<li><a href="../../../../standards/error-codes/">Error Codes</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Trở lại mục lục
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>