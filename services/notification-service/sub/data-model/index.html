
<!DOCTYPE html>

<html class="no-js" lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="TÃ i liá»‡u kiáº¿n trÃºc vÃ  phÃ¡t triá»ƒn cho dá»± Ã¡n Chuyá»ƒn Ä‘á»•i sá»‘ TrÆ°á»ng Viá»‡t Anh." name="description"/>
<meta content="DX VAS Team" name="author"/>
<link href="https://ezdesign-vn.github.io/dx-vas/services/notification-service/sub/data-model/" rel="canonical"/>
<link href="../../../../assets/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Notification Sub Service â€“ Data Model - DX VAS - Docs</title>
<link href="../../../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="pink" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#notification-sub-service-data-model">
          Bá» qua
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Äáº§u trang" class="md-header__inner md-grid">
<a aria-label="DX VAS - Docs" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../../assets/images/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DX VAS - Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Notification Sub Service â€“ Data Model
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="pink" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="lime" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="TÃ¬m kiáº¿m" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="TÃ¬m kiáº¿m" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="TÃ¬m kiáº¿m" class="md-search__options">
<button aria-label="XoÃ¡" class="md-search__icon md-icon" tabindex="-1" title="XoÃ¡" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../architecture/system-diagrams/">
          
  
  
    
  
  Kiáº¿n trÃºc Há»‡ thá»‘ng

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../dev-guide/">
        
  
  
    
  
  HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../">
        
  
  
    
  
  Thiáº¿t káº¿ Services

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../ADR/">
          
  
  
    
  
  Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Thanh Ä‘iá»u hÆ°á»›ng" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DX VAS - Docs" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="DX VAS - Docs">
<img alt="logo" src="../../../../assets/images/logo.png"/>
</a>
    DX VAS - Docs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Kiáº¿n trÃºc Há»‡ thá»‘ng
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Kiáº¿n trÃºc Há»‡ thá»‘ng
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../architecture/system-diagrams/">
<span class="md-ellipsis">
    SÆ¡ Ä‘á»“ Há»‡ thá»‘ng
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../architecture/rbac-deep-dive/">
<span class="md-ellipsis">
    RBAC Chi tiáº¿t
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../dev-guide/">
<span class="md-ellipsis">
    HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../">
<span class="md-ellipsis">
    Thiáº¿t káº¿ Services
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ADR/">
<span class="md-ellipsis">
    Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Má»¥c lá»¥c" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Má»¥c lá»¥c
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-muc-tieu-pham-vi">
<span class="md-ellipsis">
      1. ğŸ¯ Má»¥c tiÃªu &amp; Pháº¡m vi
    </span>
</a>
<nav aria-label="1. ğŸ¯ Má»¥c tiÃªu &amp; Pháº¡m vi" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#muc-tieu">
<span class="md-ellipsis">
      ğŸ¯ Má»¥c tiÃªu
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pham-vi-du-lieu-uoc-quan-ly">
<span class="md-ellipsis">
      ğŸ“¦ Pháº¡m vi dá»¯ liá»‡u Ä‘Æ°á»£c quáº£n lÃ½
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nguyen-tac-thiet-ke-du-lieu">
<span class="md-ellipsis">
      ğŸ”’ NguyÃªn táº¯c thiáº¿t káº¿ dá»¯ liá»‡u
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#khong-nam-trong-pham-vi">
<span class="md-ellipsis">
      â›” KhÃ´ng náº±m trong pháº¡m vi
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-mo-hinh-du-lieu-tong-the">
<span class="md-ellipsis">
      2. ğŸ”¢ MÃ´ hÃ¬nh dá»¯ liá»‡u tá»•ng thá»ƒ
    </span>
</a>
<nav aria-label="2. ğŸ”¢ MÃ´ hÃ¬nh dá»¯ liá»‡u tá»•ng thá»ƒ" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#moi-quan-he-giua-cac-thuc-the">
<span class="md-ellipsis">
      ğŸ§­ Má»‘i quan há»‡ giá»¯a cÃ¡c thá»±c thá»ƒ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#giai-thich-tong-quan-cac-bang">
<span class="md-ellipsis">
      ğŸ“Œ Giáº£i thÃ­ch tá»•ng quan cÃ¡c báº£ng
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#thiet-ke-ho-tro">
<span class="md-ellipsis">
      ğŸ§© Thiáº¿t káº¿ há»— trá»£:
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-chi-tiet-cac-bang">
<span class="md-ellipsis">
      3. ğŸ“š Chi tiáº¿t cÃ¡c báº£ng
    </span>
</a>
<nav aria-label="3. ğŸ“š Chi tiáº¿t cÃ¡c báº£ng" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-notificationtemplate">
<span class="md-ellipsis">
      3.1. NotificationTemplate
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-notificationlog">
<span class="md-ellipsis">
      3.2. NotificationLog
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#33-notificationchannelcfg">
<span class="md-ellipsis">
      3.3. NotificationChannelCfg
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-chinh-sach-bao-mat-a-tenant">
<span class="md-ellipsis">
      4. ğŸ” ChÃ­nh sÃ¡ch báº£o máº­t &amp; Ä‘a tenant
    </span>
</a>
<nav aria-label="4. ğŸ” ChÃ­nh sÃ¡ch báº£o máº­t &amp; Ä‘a tenant" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-tach-biet-theo-tenant-tenant-isolation">
<span class="md-ellipsis">
      4.1. ğŸ§± TÃ¡ch biá»‡t theo tenant (Tenant Isolation)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-bao-ve-du-lieu-ca-nhan">
<span class="md-ellipsis">
      4.2. ğŸ›¡ï¸ Báº£o vá»‡ dá»¯ liá»‡u cÃ¡ nhÃ¢n
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#43-chinh-sach-giu-du-lieu-retention">
<span class="md-ellipsis">
      4.3. ğŸ•“ ChÃ­nh sÃ¡ch giá»¯ dá»¯ liá»‡u (Retention)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#44-giam-sat-kiem-toan">
<span class="md-ellipsis">
      4.4. ğŸ” GiÃ¡m sÃ¡t &amp; kiá»ƒm toÃ¡n
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#45-checklist-tuan-thu-bao-mat-a-tenant">
<span class="md-ellipsis">
      4.5. âœ… Checklist tuÃ¢n thá»§ báº£o máº­t &amp; Ä‘a tenant
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-mapping-sang-cac-api">
<span class="md-ellipsis">
      5. ğŸ§© Mapping sang cÃ¡c API
    </span>
</a>
<nav aria-label="5. ğŸ§© Mapping sang cÃ¡c API" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-chi-tiet-truy-xuat-ghi-du-lieu-theo-api">
<span class="md-ellipsis">
      5.1. ğŸ“Œ Chi tiáº¿t truy xuáº¥t &amp; ghi dá»¯ liá»‡u theo API
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-rbac-mapping">
<span class="md-ellipsis">
      5.2. ğŸ” RBAC Mapping
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-schema-versioning-kiem-thu-schema">
<span class="md-ellipsis">
      6. ğŸ“Œ Schema versioning &amp; kiá»ƒm thá»­ schema
    </span>
</a>
<nav aria-label="6. ğŸ“Œ Schema versioning &amp; kiá»ƒm thá»­ schema" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-muc-tieu">
<span class="md-ellipsis">
      6.1. ğŸ¯ Má»¥c tiÃªu
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-vi-tri-version-trong-he-thong">
<span class="md-ellipsis">
      6.2. ğŸ“š Vá»‹ trÃ­ version trong há»‡ thá»‘ng
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-co-che-kiem-thu-schema">
<span class="md-ellipsis">
      6.3. ğŸ§ª CÆ¡ cháº¿ kiá»ƒm thá»­ schema
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-co-che-quan-ly-template-theo-version">
<span class="md-ellipsis">
      6.4. ğŸ§© CÆ¡ cháº¿ quáº£n lÃ½ template theo version
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#65-kiem-thu-schema-nen-bao-gom">
<span class="md-ellipsis">
      6.5. âœ… Kiá»ƒm thá»­ schema nÃªn bao gá»“m:
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-goi-y-kiem-thu-du-lieu">
<span class="md-ellipsis">
      7. ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­ dá»¯ liá»‡u
    </span>
</a>
<nav aria-label="7. ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­ dá»¯ liá»‡u" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-kiem-thu-tao-truy-van-log-gui">
<span class="md-ellipsis">
      7.1. ğŸ”„ Kiá»ƒm thá»­ táº¡o &amp; truy váº¥n log gá»­i
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-kiem-thu-template">
<span class="md-ellipsis">
      7.2. ğŸ“„ Kiá»ƒm thá»­ template
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-kiem-thu-lien-quan-bao-mat-phan-vung-tenant">
<span class="md-ellipsis">
      7.3. ğŸ” Kiá»ƒm thá»­ liÃªn quan báº£o máº­t &amp; phÃ¢n vÃ¹ng tenant
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#74-kiem-thu-toan-ven-du-lieu">
<span class="md-ellipsis">
      7.4. ğŸ§© Kiá»ƒm thá»­ toÃ n váº¹n dá»¯ liá»‡u
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#75-checklist-xac-nhan-du-lieu">
<span class="md-ellipsis">
      7.5. âœ… Checklist xÃ¡c nháº­n dá»¯ liá»‡u
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-tai-lieu-lien-quan">
<span class="md-ellipsis">
      8. ğŸ“š TÃ i liá»‡u liÃªn quan
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="notification-sub-service-data-model">ğŸ“¦ Notification Sub Service â€“ Data Model<a class="headerlink" href="#notification-sub-service-data-model" title="Permanent link">Â¶</a></h1>
<p>TÃ i liá»‡u nÃ y mÃ´ táº£ chi tiáº¿t cÃ¡c thá»±c thá»ƒ dá»¯ liá»‡u cá»‘t lÃµi cá»§a Notification Sub Service, bao gá»“m schema, quan há»‡, vÃ  cÃ¡c lÆ°u Ã½ vá» báº£o máº­t, áº©n danh vÃ  chuáº©n hÃ³a schema theo chuáº©n Ä‘a tenant.</p>
<hr/>
<h2 id="1-muc-tieu-pham-vi">1. ğŸ¯ Má»¥c tiÃªu &amp; Pháº¡m vi<a class="headerlink" href="#1-muc-tieu-pham-vi" title="Permanent link">Â¶</a></h2>
<p>Pháº§n nÃ y xÃ¡c Ä‘á»‹nh rÃµ pháº¡m vi dá»¯ liá»‡u mÃ  Notification Sub Service quáº£n lÃ½, Ä‘á»“ng thá»i nháº¥n máº¡nh má»¥c tiÃªu thiáº¿t káº¿ dá»¯ liá»‡u Ä‘a tenant, cÃ³ kháº£ nÄƒng má»Ÿ rá»™ng, kiá»ƒm thá»­ vÃ  truy váº¿t.</p>
<hr/>
<h3 id="muc-tieu">ğŸ¯ Má»¥c tiÃªu<a class="headerlink" href="#muc-tieu" title="Permanent link">Â¶</a></h3>
<ul>
<li>Cung cáº¥p <strong>mÃ´ hÃ¬nh dá»¯ liá»‡u chuáº©n hÃ³a</strong> Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c hoáº¡t Ä‘á»™ng gá»­i notification cho tá»«ng tenant.</li>
<li>Há»— trá»£ viá»‡c <strong>truy váº¥n hiá»‡u quáº£</strong> thÃ´ng tin log Ä‘Ã£ gá»­i theo nhiá»u tiÃªu chÃ­: event, channel, tráº¡ng thÃ¡i, ngÆ°á»i nháº­n.</li>
<li>Cho phÃ©p <strong>mapping Ä‘á»™ng giá»¯a event_code + channel â†’ template</strong> tÃ¹y theo tenant.</li>
<li>LÆ°u trá»¯ <strong>cáº¥u hÃ¬nh kÃªnh gá»­i riÃªng</strong> cho má»—i tenant vá»›i kháº£ nÄƒng báº­t/táº¯t vÃ  fallback.</li>
<li>Äáº£m báº£o dá»¯ liá»‡u phÃ¹ há»£p vá»›i cÃ¡c yÃªu cáº§u:</li>
<li><strong>Audit &amp; Compliance</strong> theo <code>ADR-008</code></li>
<li><strong>Retention &amp; Anonymization</strong> theo <code>ADR-024</code></li>
<li><strong>Multi-tenant Isolation</strong> theo CR-04 &amp; <code>ADR-025</code></li>
</ul>
<hr/>
<h3 id="pham-vi-du-lieu-uoc-quan-ly">ğŸ“¦ Pháº¡m vi dá»¯ liá»‡u Ä‘Æ°á»£c quáº£n lÃ½<a class="headerlink" href="#pham-vi-du-lieu-uoc-quan-ly" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>NhÃ³m dá»¯ liá»‡u</th>
<th>MÃ´ táº£ ngáº¯n gá»n</th>
</tr>
</thead>
<tbody>
<tr>
<td>Notification Template</td>
<td>Metadata vÃ  ná»™i dung template notification per tenant + channel</td>
</tr>
<tr>
<td>Notification Log</td>
<td>Log gá»­i thá»±c táº¿, bao gá»“m trace, status, lá»—i, thá»i gian gá»­i</td>
</tr>
<tr>
<td>Notification Channel Config</td>
<td>Cáº¥u hÃ¬nh kÃªnh gá»­i Ä‘á»™ng (SMTP, SMS Provider, â€¦) cho má»—i tenant</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="nguyen-tac-thiet-ke-du-lieu">ğŸ”’ NguyÃªn táº¯c thiáº¿t káº¿ dá»¯ liá»‡u<a class="headerlink" href="#nguyen-tac-thiet-ke-du-lieu" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TiÃªu chÃ­</th>
<th>Giáº£i thÃ­ch cá»¥ thá»ƒ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Multi-Tenant Isolation</strong></td>
<td>Má»i báº£n ghi Ä‘á»u báº¯t buá»™c cÃ³ <code>tenant_id</code> vÃ  Ä‘Æ°á»£c truy váº¥n dÆ°á»›i Ä‘iá»u kiá»‡n isolation</td>
</tr>
<tr>
<td><strong>Traceability</strong></td>
<td>Má»—i notification log gáº¯n <code>trace_id</code> xuyÃªn suá»‘t há»‡ thá»‘ng</td>
</tr>
<tr>
<td><strong>Versioning</strong></td>
<td>Template cÃ³ <code>version</code>, log lÆ°u <code>template_id</code> Ä‘á»ƒ Ä‘áº£m báº£o tÃ¡i hiá»‡n</td>
</tr>
<tr>
<td><strong>Anonymization</strong> <em>(optional)</em></td>
<td>Má»™t sá»‘ trÆ°á»ng nhÆ° <code>recipient</code>, <code>payload</code> cÃ³ thá»ƒ hash theo <code>ADR-024</code></td>
</tr>
<tr>
<td><strong>Retention &amp; Deletion</strong></td>
<td>Cho phÃ©p xÃ³a má»m hoáº·c xÃ³a vÄ©nh viá»…n sau thá»i gian theo policy</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="khong-nam-trong-pham-vi">â›” KhÃ´ng náº±m trong pháº¡m vi<a class="headerlink" href="#khong-nam-trong-pham-vi" title="Permanent link">Â¶</a></h3>
<ul>
<li>KhÃ´ng lÆ°u tráº¡ng thÃ¡i Ä‘á»c / unread</li>
<li>KhÃ´ng lÆ°u tráº¡ng thÃ¡i gá»­i real-time cá»§a client (client-side delivery)</li>
<li>KhÃ´ng lÆ°u full render HTML trá»« khi cáº§n audit (tuá»³ cáº¥u hÃ¬nh)</li>
<li>KhÃ´ng quáº£n lÃ½ luá»“ng trigger gá»­i (thuá»™c vá» Notification Master)</li>
</ul>
<hr/>
<h2 id="2-mo-hinh-du-lieu-tong-the">2. ğŸ”¢ MÃ´ hÃ¬nh dá»¯ liá»‡u tá»•ng thá»ƒ<a class="headerlink" href="#2-mo-hinh-du-lieu-tong-the" title="Permanent link">Â¶</a></h2>
<p>Há»‡ thá»‘ng Notification Sub quáº£n lÃ½ ba thá»±c thá»ƒ chÃ­nh:</p>
<ol>
<li><strong>NotificationTemplate</strong> â€“ Metadata template gáº¯n vá»›i <code>event_code</code>, <code>channel</code>, vÃ  <code>tenant</code></li>
<li><strong>NotificationLog</strong> â€“ LÆ°u láº¡i tá»«ng láº§n gá»­i thá»±c táº¿, bao gá»“m trace, lá»—i, ngÆ°á»i nháº­n</li>
<li><strong>NotificationChannelCfg</strong> â€“ Cáº¥u hÃ¬nh kÃªnh gá»­i cho má»—i <code>tenant</code> vÃ  <code>channel</code></li>
</ol>
<p>MÃ´ hÃ¬nh tuÃ¢n thá»§ cháº·t cháº½ kiáº¿n trÃºc multi-tenant, há»— trá»£ versioning, tracing vÃ  kháº£ nÄƒng kiá»ƒm toÃ¡n Ä‘áº§y Ä‘á»§.</p>
<hr/>
<h3 id="moi-quan-he-giua-cac-thuc-the">ğŸ§­ Má»‘i quan há»‡ giá»¯a cÃ¡c thá»±c thá»ƒ<a class="headerlink" href="#moi-quan-he-giua-cac-thuc-the" title="Permanent link">Â¶</a></h3>
<p>```mermaid
erDiagram
  NotificationTemplate ||--o{ NotificationLog : used_by
  NotificationChannelCfg ||--o{ NotificationTemplate : configures</p>
<p>NotificationTemplate {
    UUID id PK
    STRING event_code
    STRING channel
    TEXT template_body
    JSONB default_params
    BOOLEAN is_active
    INTEGER version
    STRING tenant_id
    TIMESTAMPTZ updated_at
  }</p>
<p>NotificationLog {
    UUID id PK
    UUID template_id FK
    STRING recipient
    STRING status
    TEXT error_message
    JSONB payload
    STRING tenant_id
    TIMESTAMPTZ sent_at
    STRING event_code
    STRING channel
    BOOLEAN retry
    STRING trace_id
  }</p>
<p>NotificationChannelCfg {
    STRING channel PK
    STRING provider
    JSONB config
    BOOLEAN is_enabled
    STRING tenant_id
    TIMESTAMPTZ updated_at
  }
````</p>
<hr/>
<h3 id="giai-thich-tong-quan-cac-bang">ğŸ“Œ Giáº£i thÃ­ch tá»•ng quan cÃ¡c báº£ng<a class="headerlink" href="#giai-thich-tong-quan-cac-bang" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Báº£ng</th>
<th>Vai trÃ² chÃ­nh</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NotificationTemplate</code></td>
<td>Template chuáº©n hoÃ¡ mapping tá»« <code>event_code</code> + <code>channel</code> â†’ body gá»­i</td>
</tr>
<tr>
<td><code>NotificationLog</code></td>
<td>Log tá»«ng láº§n gá»­i: tráº¡ng thÃ¡i, lá»—i, trace_id, thÃ´ng tin ngÆ°á»i nháº­n</td>
</tr>
<tr>
<td><code>NotificationChannelCfg</code></td>
<td>LÆ°u thÃ´ng tin SMTP, SMS API, push key cá»§a tá»«ng tenant + tráº¡ng thÃ¡i kÃªnh</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="thiet-ke-ho-tro">ğŸ§© Thiáº¿t káº¿ há»— trá»£:<a class="headerlink" href="#thiet-ke-ho-tro" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃ­nh nÄƒng</th>
<th>CÃ¡ch thá»±c hiá»‡n</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Multi-tenant isolation</strong></td>
<td>TrÆ°á»ng <code>tenant_id</code> lÃ  báº¯t buá»™c trong táº¥t cáº£ cÃ¡c báº£ng</td>
</tr>
<tr>
<td><strong>Traceability (X-Trace-ID)</strong></td>
<td>Log gáº¯n <code>trace_id</code>, audit event cÃ³ thá»ƒ liÃªn káº¿t Ä‘Æ°á»£c</td>
</tr>
<tr>
<td><strong>Versioning Template</strong></td>
<td>Template cÃ³ trÆ°á»ng <code>version</code>; log lÆ°u <code>template_id</code> Ä‘á»ƒ tÃ¡i hiá»‡n</td>
</tr>
<tr>
<td><strong>Soft-delete hoáº·c TTL</strong></td>
<td>Log cÃ³ thá»ƒ xÃ³a má»m theo config hoáº·c dá»n dáº¹p theo <code>retention_days</code></td>
</tr>
<tr>
<td><strong>Anonymization (opt-in)</strong></td>
<td>CÃ¡c trÆ°á»ng <code>recipient</code>, <code>payload</code> cÃ³ thá»ƒ Ä‘Æ°á»£c mÃ£ hÃ³a/anonymize</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="3-chi-tiet-cac-bang">3. ğŸ“š Chi tiáº¿t cÃ¡c báº£ng<a class="headerlink" href="#3-chi-tiet-cac-bang" title="Permanent link">Â¶</a></h2>
<hr/>
<h3 id="31-notificationtemplate">3.1. <code>NotificationTemplate</code><a class="headerlink" href="#31-notificationtemplate" title="Permanent link">Â¶</a></h3>
<p>LÆ°u trá»¯ metadata vÃ  ná»™i dung template cho tá»«ng <code>event_code</code> vÃ  <code>channel</code>. Há»— trá»£ versioning, ngÃ´n ngá»¯, tráº¡ng thÃ¡i báº­t/táº¯t vÃ  kiá»ƒm tra render (qua <code>POST /notifications/test</code>).</p>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Kiá»ƒu</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>UUID</td>
<td>âœ…</td>
<td>MÃ£ Ä‘á»‹nh danh template (PK)</td>
</tr>
<tr>
<td><code>tenant_id</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>Tenant sá»Ÿ há»¯u template</td>
</tr>
<tr>
<td><code>event_code</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>MÃ£ sá»± kiá»‡n nghiá»‡p vá»¥, vÃ­ dá»¥ <code>user.welcome</code></td>
</tr>
<tr>
<td><code>channel</code></td>
<td>STRING</td>
<td>âœ…</td>
<td><code>email</code>, <code>sms</code>, <code>push</code>,...</td>
</tr>
<tr>
<td><code>language</code></td>
<td>STRING</td>
<td>â›”</td>
<td>ISO code: <code>vi</code>, <code>en</code>,...</td>
</tr>
<tr>
<td><code>version</code></td>
<td>INTEGER</td>
<td>âœ…</td>
<td>Version template</td>
</tr>
<tr>
<td><code>template_body</code></td>
<td>TEXT</td>
<td>âœ…</td>
<td>Ná»™i dung chá»©a biáº¿n (Jinja2 format)</td>
</tr>
<tr>
<td><code>default_params</code></td>
<td>JSONB</td>
<td>â›”</td>
<td>GiÃ¡ trá»‹ máº·c Ä‘á»‹nh náº¿u <code>params</code> khÃ´ng cung cáº¥p</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>âœ…</td>
<td>Template cÃ²n hiá»‡u lá»±c hay khÃ´ng</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMPTZ</td>
<td>âœ…</td>
<td>Thá»i Ä‘iá»ƒm cáº­p nháº­t gáº§n nháº¥t</td>
</tr>
</tbody>
</table>
<p>ğŸ” <strong>RÃ ng buá»™c quan trá»ng:</strong>
- Unique constraint: <code>(tenant_id, event_code, channel, language, version)</code>
- CÃ³ index trÃªn <code>tenant_id</code>, <code>event_code</code>, <code>channel</code>, <code>is_active</code></p>
<hr/>
<h3 id="32-notificationlog">3.2. <code>NotificationLog</code><a class="headerlink" href="#32-notificationlog" title="Permanent link">Â¶</a></h3>
<p>LÆ°u láº¡i tá»«ng láº§n gá»­i notification (gá»­i tháº­t hoáº·c test). Phá»¥c vá»¥ audit, kiá»ƒm tra lá»—i, thá»‘ng kÃª.</p>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Kiá»ƒu</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>UUID</td>
<td>âœ…</td>
<td>MÃ£ log gá»­i notification (PK)</td>
</tr>
<tr>
<td><code>tenant_id</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>Tenant thá»±c hiá»‡n gá»­i</td>
</tr>
<tr>
<td><code>template_id</code></td>
<td>UUID</td>
<td>â›”</td>
<td>Template sá»­ dá»¥ng Ä‘á»ƒ gá»­i (nullable náº¿u gá»­i khÃ´ng qua template)</td>
</tr>
<tr>
<td><code>event_code</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>Ghi láº¡i event_code á»©ng vá»›i log nÃ y</td>
</tr>
<tr>
<td><code>channel</code></td>
<td>STRING</td>
<td>âœ…</td>
<td><code>email</code>, <code>sms</code>, <code>push</code>,...</td>
</tr>
<tr>
<td><code>recipient</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>Email/sá»‘ Ä‘iá»‡n thoáº¡i ngÆ°á»i nháº­n (cÃ³ thá»ƒ hash náº¿u config)</td>
</tr>
<tr>
<td><code>status</code></td>
<td>STRING</td>
<td>âœ…</td>
<td><code>sent</code>, <code>failed</code>, <code>queued</code>, <code>fallback</code></td>
</tr>
<tr>
<td><code>error_message</code></td>
<td>TEXT</td>
<td>â›”</td>
<td>ThÃ´ng bÃ¡o lá»—i (náº¿u tháº¥t báº¡i)</td>
</tr>
<tr>
<td><code>payload</code></td>
<td>JSONB</td>
<td>âœ…</td>
<td>Ná»™i dung notification Ä‘Ã£ render (hoáº·c thÃ´ng tin Ä‘áº§u vÃ o)</td>
</tr>
<tr>
<td><code>retry</code></td>
<td>BOOLEAN</td>
<td>âœ…</td>
<td>Gá»­i láº¡i tá»« láº§n trÆ°á»›c (retry hoáº·c fallback)</td>
</tr>
<tr>
<td><code>trace_id</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>Trace Ä‘á»ƒ liÃªn káº¿t vá»›i luá»“ng Master</td>
</tr>
<tr>
<td><code>sent_at</code></td>
<td>TIMESTAMPTZ</td>
<td>âœ…</td>
<td>Thá»i gian gá»­i thá»±c táº¿ (hoáº·c giáº£ láº­p náº¿u test)</td>
</tr>
</tbody>
</table>
<p>ğŸ” <strong>LÆ°u Ã½:</strong>
- CÃ³ index trÃªn <code>tenant_id</code>, <code>event_code</code>, <code>status</code>, <code>sent_at</code>, <code>recipient</code>
- CÃ³ thá»ƒ xÃ³a má»m hoáº·c TTL 30 ngÃ y theo <code>ADR-024</code></p>
<hr/>
<h3 id="33-notificationchannelcfg">3.3. <code>NotificationChannelCfg</code><a class="headerlink" href="#33-notificationchannelcfg" title="Permanent link">Â¶</a></h3>
<p>LÆ°u cáº¥u hÃ¬nh kÃªnh gá»­i (SMTP, SMS provider...) riÃªng cho tá»«ng tenant. Há»— trá»£ báº­t/táº¯t Ä‘á»™ng, fallback hoáº·c dry-run.</p>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Kiá»ƒu</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>channel</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>KÃªnh gá»­i (<code>email</code>, <code>sms</code>, <code>push</code>)</td>
</tr>
<tr>
<td><code>tenant_id</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>Tenant sá»Ÿ há»¯u cáº¥u hÃ¬nh nÃ y</td>
</tr>
<tr>
<td><code>provider</code></td>
<td>STRING</td>
<td>âœ…</td>
<td>TÃªn provider (<code>smtp</code>, <code>twilio</code>,...)</td>
</tr>
<tr>
<td><code>config</code></td>
<td>JSONB</td>
<td>âœ…</td>
<td>Config tÃ¹y thuá»™c provider (host, port, api_key...)</td>
</tr>
<tr>
<td><code>is_enabled</code></td>
<td>BOOLEAN</td>
<td>âœ…</td>
<td>Cho phÃ©p báº­t/táº¯t kÃªnh gá»­i</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMPTZ</td>
<td>âœ…</td>
<td>Láº§n cáº­p nháº­t cuá»‘i cÃ¹ng</td>
</tr>
</tbody>
</table>
<p>ğŸ” <strong>Best Practice:</strong>
- Config Ä‘Æ°á»£c load tá»« cache, invalidate khi cÃ³ cáº­p nháº­t
- CÃ³ thá»ƒ cÃ³ thÃªm trÆ°á»ng <code>test_email</code>, <code>test_number</code> dÃ¹ng cho <code>POST /notifications/test</code></p>
<hr/>
<p>ğŸ“Œ <strong>Gá»£i Ã½ má»Ÿ rá»™ng tÆ°Æ¡ng lai (optional):</strong></p>
<table>
<thead>
<tr>
<th>TrÆ°á»ng gá»£i Ã½ thÃªm</th>
<th>Ãp dá»¥ng cho</th>
<th>Gá»£i Ã½</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>archived_at</code></td>
<td>All tables</td>
<td>Há»— trá»£ soft-delete cÃ³ TTL tá»± Ä‘á»™ng</td>
</tr>
<tr>
<td><code>created_by</code></td>
<td>Template</td>
<td>Ghi láº¡i ai táº¡o template</td>
</tr>
<tr>
<td><code>rendered_preview</code></td>
<td>Log</td>
<td>LÆ°u báº£n HTML Ä‘Ã£ render (náº¿u báº­t audit nÃ¢ng cao)</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="4-chinh-sach-bao-mat-a-tenant">4. ğŸ” ChÃ­nh sÃ¡ch báº£o máº­t &amp; Ä‘a tenant<a class="headerlink" href="#4-chinh-sach-bao-mat-a-tenant" title="Permanent link">Â¶</a></h2>
<p>Thiáº¿t káº¿ dá»¯ liá»‡u cá»§a Notification Sub Service Ä‘áº·t trá»ng tÃ¢m vÃ o <strong>tÃ¡ch biá»‡t dá»¯ liá»‡u tenant</strong>, <strong>báº£o máº­t thÃ´ng tin cÃ¡ nhÃ¢n</strong>, vÃ  <strong>tuÃ¢n thá»§ chÃ­nh sÃ¡ch kiá»ƒm toÃ¡n &amp; lÆ°u trá»¯</strong>.<br/>
CÃ¡c nguyÃªn táº¯c sau Ä‘Æ°á»£c Ã¡p dá»¥ng á»Ÿ má»i táº§ng: schema, query, API, log vÃ  pipeline event.</p>
<hr/>
<h3 id="41-tach-biet-theo-tenant-tenant-isolation">4.1. ğŸ§± TÃ¡ch biá»‡t theo tenant (Tenant Isolation)<a class="headerlink" href="#41-tach-biet-theo-tenant-tenant-isolation" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Biá»‡n phÃ¡p</th>
<th>Giáº£i thÃ­ch</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tenant_id</code> báº¯t buá»™c</td>
<td>Má»i báº£ng dá»¯ liá»‡u Ä‘á»u báº¯t buá»™c cÃ³ <code>tenant_id</code>, khÃ´ng cÃ³ giÃ¡ trá»‹ <code>NULL</code></td>
</tr>
<tr>
<td>RÃ ng buá»™c truy váº¥n (<code>x-condition</code>)</td>
<td>Táº¥t cáº£ API &amp; query Ä‘á»u sá»­ dá»¥ng <code>WHERE tenant_id = {{X-Tenant-ID}}</code></td>
</tr>
<tr>
<td>Index hÃ³a theo <code>tenant_id</code></td>
<td>Tá»‘i Æ°u hÃ³a hiá»‡u nÄƒng cho mÃ´ hÃ¬nh multi-tenant tÃ¡ch biá»‡t</td>
</tr>
<tr>
<td>KhÃ´ng chia sáº» cáº¥u hÃ¬nh</td>
<td>Má»—i tenant cÃ³ <code>NotificationChannelCfg</code> Ä‘á»™c láº­p, khÃ´ng káº¿ thá»«a máº·c Ä‘á»‹nh</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ” TuÃ¢n thá»§ <code>ADR-025 â€“ Multi-Tenant Versioning</code>, <code>ADR-007 â€“ RBAC</code>, <code>CR-04 â€“ PhÃ¢n vÃ¹ng tenant váº­t lÃ½/logic</code></p>
</blockquote>
<hr/>
<h3 id="42-bao-ve-du-lieu-ca-nhan">4.2. ğŸ›¡ï¸ Báº£o vá»‡ dá»¯ liá»‡u cÃ¡ nhÃ¢n<a class="headerlink" href="#42-bao-ve-du-lieu-ca-nhan" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TrÆ°á»ng nháº¡y cáº£m</th>
<th>Biá»‡n phÃ¡p báº£o vá»‡</th>
<th>TÃ¹y chá»‰nh</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>recipient</code></td>
<td>CÃ³ thá»ƒ <strong>bÄƒm SHA256 + salt riÃªng theo tenant</strong></td>
<td>CÃ³ cáº¥u hÃ¬nh báº­t/táº¯t</td>
</tr>
<tr>
<td><code>payload</code></td>
<td>CÃ³ thá»ƒ <strong>áº©n má»™t sá»‘ key nháº¡y cáº£m</strong></td>
<td>Cáº¥u hÃ¬nh whitelist field</td>
</tr>
<tr>
<td><code>error_message</code></td>
<td>Chá»‰ hiá»ƒn thá»‹ ná»™i bá»™, khÃ´ng lá»™ cho ngÆ°á»i dÃ¹ng</td>
<td>Máº·c Ä‘á»‹nh khÃ´ng expose qua UI</td>
</tr>
<tr>
<td><code>config</code> trong channel</td>
<td>KhÃ´ng tráº£ qua API</td>
<td>Chá»‰ dÃ¹ng ná»™i bá»™ khi gá»­i</td>
</tr>
</tbody>
</table>
<blockquote>
<p>TuÃ¢n thá»§ <code>ADR-024 â€“ Data Anonymization &amp; Retention</code></p>
</blockquote>
<hr/>
<h3 id="43-chinh-sach-giu-du-lieu-retention">4.3. ğŸ•“ ChÃ­nh sÃ¡ch giá»¯ dá»¯ liá»‡u (Retention)<a class="headerlink" href="#43-chinh-sach-giu-du-lieu-retention" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Loáº¡i dá»¯ liá»‡u</th>
<th>ChÃ­nh sÃ¡ch gá»£i Ã½</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NotificationLog</code></td>
<td>XoÃ¡ vÄ©nh viá»…n sau 30 ngÃ y (<code>hard delete</code>)</td>
</tr>
<tr>
<td><code>Template</code></td>
<td>KhÃ´ng xoÃ¡ â€“ chá»‰ Ä‘Ã¡nh dáº¥u <code>is_active=false</code></td>
</tr>
<tr>
<td><code>ChannelCfg</code></td>
<td>Ghi Ä‘Ã¨ theo tenant, giá»¯ phiÃªn báº£n cuá»‘i cÃ¹ng</td>
</tr>
<tr>
<td>Audit event</td>
<td>Do <code>audit-logging-service</code> lÆ°u, TTL = 90 ngÃ y</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Náº¿u cáº§n soft-delete (dÃ¹ng <code>archived_at</code>), nÃªn thÃªm theo <code>ADR-026 â€“ Hard Delete Policy</code></p>
</blockquote>
<hr/>
<h3 id="44-giam-sat-kiem-toan">4.4. ğŸ” GiÃ¡m sÃ¡t &amp; kiá»ƒm toÃ¡n<a class="headerlink" href="#44-giam-sat-kiem-toan" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Má»¥c tiÃªu</th>
<th>Biá»‡n phÃ¡p triá»ƒn khai</th>
</tr>
</thead>
<tbody>
<tr>
<td>Truy váº¿t hÃ nh vi ngÆ°á»i dÃ¹ng</td>
<td>Log <code>POST /notifications/test</code>, <code>GET /logs</code> vÃ o audit</td>
</tr>
<tr>
<td>Trace toÃ n há»‡ thá»‘ng</td>
<td>Gáº¯n <code>trace_id</code> tá»« Master xuyÃªn suá»‘t qua log gá»­i</td>
</tr>
<tr>
<td>GiÃ¡m sÃ¡t channel usage</td>
<td>Má»—i gá»­i log sáº½ emit counter theo channel + status</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="45-checklist-tuan-thu-bao-mat-a-tenant">4.5. âœ… Checklist tuÃ¢n thá»§ báº£o máº­t &amp; Ä‘a tenant<a class="headerlink" href="#45-checklist-tuan-thu-bao-mat-a-tenant" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TiÃªu chÃ­</th>
<th>Tráº¡ng thÃ¡i</th>
</tr>
</thead>
<tbody>
<tr>
<td>Má»i báº£ng cÃ³ <code>tenant_id</code>, cÃ³ index phÃ¹ há»£p</td>
<td>âœ…</td>
</tr>
<tr>
<td>KhÃ´ng cÃ³ API nÃ o tráº£ <code>config</code> hoáº·c <code>template_body</code> sai tenant</td>
<td>âœ…</td>
</tr>
<tr>
<td>Log khÃ´ng lá»™ thÃ´ng tin cÃ¡ nhÃ¢n náº¿u cáº¥u hÃ¬nh áº©n danh báº­t</td>
<td>âœ…</td>
</tr>
<tr>
<td>Dá»¯ liá»‡u nháº¡y cáº£m cÃ³ thá»ƒ xÃ³a sau 30 ngÃ y</td>
<td>âœ…</td>
</tr>
<tr>
<td>RBAC tÃ¡ch biá»‡t rÃµ tá»«ng permission cho tá»«ng API</td>
<td>âœ…</td>
</tr>
<tr>
<td>Sá»± kiá»‡n gá»­i thá»­ Ä‘Æ°á»£c log láº¡i phá»¥c vá»¥ audit</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="5-mapping-sang-cac-api">5. ğŸ§© Mapping sang cÃ¡c API<a class="headerlink" href="#5-mapping-sang-cac-api" title="Permanent link">Â¶</a></h2>
<p>Báº£ng dÆ°á»›i Ä‘Ã¢y trÃ¬nh bÃ y má»‘i quan há»‡ giá»¯a tá»«ng API vÃ  cÃ¡c báº£ng dá»¯ liá»‡u liÃªn quan.<br/>
Má»¥c tiÃªu lÃ  Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n giá»¯a luá»“ng nghiá»‡p vá»¥, dá»¯ liá»‡u lÆ°u trá»¯, vÃ  há»£p Ä‘á»“ng giao tiáº¿p (interface contract).</p>
<table>
<thead>
<tr>
<th>API Endpoint</th>
<th>Method</th>
<th>Thá»±c thá»ƒ liÃªn quan</th>
<th>Field truy cáº­p/chá»‰nh sá»­a chÃ­nh</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/notifications/logs</code></td>
<td><code>GET</code></td>
<td><code>NotificationLog</code></td>
<td><code>status</code>, <code>recipient</code>, <code>event_code</code>, <code>channel</code>, <code>sent_at</code></td>
</tr>
<tr>
<td><code>/notifications/test</code></td>
<td><code>POST</code></td>
<td><code>NotificationTemplate</code>, <code>NotificationChannelCfg</code></td>
<td><code>template_body</code>, <code>channel</code>, <code>event_code</code>, <code>params</code>, <code>config</code>, <code>recipient</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td>â†’ log test cÅ©ng ghi vÃ o <code>NotificationLog</code> (loáº¡i: test)</td>
<td><code>status=test</code>, <code>retry=false</code>, <code>trace_id</code>, <code>payload</code></td>
</tr>
<tr>
<td><code>/notifications/templates</code></td>
<td><code>GET</code></td>
<td><code>NotificationTemplate</code></td>
<td><code>event_code</code>, <code>channel</code>, <code>language</code>, <code>version</code>, <code>is_active</code>, <code>updated_at</code></td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="51-chi-tiet-truy-xuat-ghi-du-lieu-theo-api">5.1. ğŸ“Œ Chi tiáº¿t truy xuáº¥t &amp; ghi dá»¯ liá»‡u theo API<a class="headerlink" href="#51-chi-tiet-truy-xuat-ghi-du-lieu-theo-api" title="Permanent link">Â¶</a></h3>
<h4 id="get-notificationslogs">ğŸ” <code>GET /notifications/logs</code><a class="headerlink" href="#get-notificationslogs" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>Read-only</strong></li>
<li>Truy váº¥n trÃªn báº£ng <code>NotificationLog</code></li>
<li>Dá»±a trÃªn <code>tenant_id</code>, cÃ³ thá»ƒ filter theo <code>status</code>, <code>channel</code>, <code>event_code</code>, <code>recipient</code></li>
</ul>
<h4 id="post-notificationstest">ğŸ§ª <code>POST /notifications/test</code><a class="headerlink" href="#post-notificationstest" title="Permanent link">Â¶</a></h4>
<ul>
<li>Truy xuáº¥t <code>NotificationTemplate</code> Ä‘á»ƒ render</li>
<li>Truy xuáº¥t <code>NotificationChannelCfg</code> Ä‘á»ƒ kiá»ƒm tra config kÃªnh gá»­i</li>
<li>Ghi log gá»­i thá»­ vÃ o <code>NotificationLog</code> (dáº¡ng test, khÃ´ng áº£nh hÆ°á»Ÿng thá»‘ng kÃª chÃ­nh)</li>
<li>Gáº¯n <code>trace_id</code>, status: <code>sent</code>, <code>failed</code>, <code>test_only: true</code></li>
</ul>
<h4 id="get-notificationstemplates">ğŸ“‘ <code>GET /notifications/templates</code><a class="headerlink" href="#get-notificationstemplates" title="Permanent link">Â¶</a></h4>
<ul>
<li>Truy xuáº¥t tá»« <code>NotificationTemplate</code> vá»›i <code>tenant_id</code> tÆ°Æ¡ng á»©ng</li>
<li>KhÃ´ng tráº£ <code>template_body</code>, chá»‰ metadata Ä‘á»ƒ UI lá»±a chá»n</li>
</ul>
<hr/>
<h3 id="52-rbac-mapping">5.2. ğŸ” RBAC Mapping<a class="headerlink" href="#52-rbac-mapping" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>API</th>
<th>Permission Code</th>
<th>Thá»±c thá»ƒ báº£o vá»‡</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GET /notifications/logs</code></td>
<td><code>notif.read.log</code></td>
<td><code>NotificationLog</code></td>
</tr>
<tr>
<td><code>POST /notifications/test</code></td>
<td><code>notif.send.test</code></td>
<td><code>NotificationTemplate</code>, <code>ChannelCfg</code></td>
</tr>
<tr>
<td><code>GET /notifications/templates</code></td>
<td><code>notif.read.template</code></td>
<td><code>NotificationTemplate</code></td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="6-schema-versioning-kiem-thu-schema">6. ğŸ“Œ Schema versioning &amp; kiá»ƒm thá»­ schema<a class="headerlink" href="#6-schema-versioning-kiem-thu-schema" title="Permanent link">Â¶</a></h2>
<hr/>
<h3 id="61-muc-tieu">6.1. ğŸ¯ Má»¥c tiÃªu<a class="headerlink" href="#61-muc-tieu" title="Permanent link">Â¶</a></h3>
<p>Viá»‡c version hÃ³a schema giÃºp Ä‘áº£m báº£o:
- TÆ°Æ¡ng thÃ­ch ngÆ°á»£c khi template thay Ä‘á»•i cáº¥u trÃºc
- Há»— trá»£ A/B testing hoáº·c rollback khi cáº¥u hÃ¬nh gá»­i thay Ä‘á»•i
- Cho phÃ©p kiá»ƒm tra tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a schema trÆ°á»›c khi gá»­i thá»±c táº¿</p>
<hr/>
<h3 id="62-vi-tri-version-trong-he-thong">6.2. ğŸ“š Vá»‹ trÃ­ version trong há»‡ thá»‘ng<a class="headerlink" href="#62-vi-tri-version-trong-he-thong" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>ThÃ nh pháº§n</th>
<th>CÃ¡ch version hÃ³a</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NotificationTemplate</code></td>
<td>TrÆ°á»ng <code>version</code> (sá»‘ nguyÃªn tÄƒng dáº§n)</td>
</tr>
<tr>
<td><code>NotificationLog</code></td>
<td>TrÆ°á»ng <code>template_id</code> vÃ  <code>event_code</code> lÆ°u theo thá»i Ä‘iá»ƒm gá»­i</td>
</tr>
<tr>
<td>API gá»­i thá»­ (<code>/test</code>)</td>
<td>Sá»­ dá»¥ng <code>event_code</code>, há»‡ thá»‘ng láº¥y template <code>is_active=true</code>, <code>version=max</code></td>
</tr>
<tr>
<td>Event payload</td>
<td>Schema validation thá»±c hiá»‡n theo template tÆ°Æ¡ng á»©ng</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Há»‡ thá»‘ng KHÃ”NG nhÃºng version vÃ o <code>event_code</code> â€“ theo khuyáº¿n nghá»‹ cá»§a <code>ADR-030</code>.</p>
</blockquote>
<hr/>
<h3 id="63-co-che-kiem-thu-schema">6.3. ğŸ§ª CÆ¡ cháº¿ kiá»ƒm thá»­ schema<a class="headerlink" href="#63-co-che-kiem-thu-schema" title="Permanent link">Â¶</a></h3>
<p><strong>Gá»­i thá»­ (<code>POST /notifications/test</code>) Ä‘Ã³ng vai trÃ² lÃ  cÆ¡ cháº¿ kiá»ƒm thá»­ schema Ä‘á»™ng.</strong></p>
<table>
<thead>
<tr>
<th>BÆ°á»›c</th>
<th>Diá»…n giáº£i</th>
</tr>
</thead>
<tbody>
<tr>
<td>1ï¸âƒ£</td>
<td>NgÆ°á»i dÃ¹ng chá»n <code>event_code</code>, <code>channel</code>, nháº­p <code>recipient</code> vÃ  <code>params</code></td>
</tr>
<tr>
<td>2ï¸âƒ£</td>
<td>Há»‡ thá»‘ng láº¥y template Ä‘ang <code>active</code> cÃ³ <code>version = max</code> cá»§a tenant</td>
</tr>
<tr>
<td>3ï¸âƒ£</td>
<td>Thá»±c hiá»‡n render (Jinja2), náº¿u lá»—i sáº½ tráº£ vá» <code>notif.render_failed</code></td>
</tr>
<tr>
<td>4ï¸âƒ£</td>
<td>Náº¿u render thÃ nh cÃ´ng, thá»±c hiá»‡n gá»­i thá»­ (tÃ¹y kÃªnh)</td>
</tr>
<tr>
<td>5ï¸âƒ£</td>
<td>Tráº£ vá» preview HTML + tráº¡ng thÃ¡i gá»­i</td>
</tr>
</tbody>
</table>
<blockquote>
<p>â— CÃ¡c lá»—i render, thiáº¿u biáº¿n, sai kiá»ƒu sáº½ Ä‘Æ°á»£c phÃ¡t hiá»‡n táº¡i bÆ°á»›c 3 â€“ khÃ´ng Ä‘Æ°á»£c phÃ©p Ä‘áº¿n bÆ°á»›c gá»­i.</p>
</blockquote>
<hr/>
<h3 id="64-co-che-quan-ly-template-theo-version">6.4. ğŸ§© CÆ¡ cháº¿ quáº£n lÃ½ template theo version<a class="headerlink" href="#64-co-che-quan-ly-template-theo-version" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>version</code></td>
<td>ÄÆ°á»£c há»‡ thá»‘ng auto tÄƒng khi thÃªm template má»›i</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>Chá»‰ má»™t báº£n active táº¡i 1 thá»i Ä‘iá»ƒm vá»›i <code>event_code + channel + language</code></td>
</tr>
<tr>
<td><code>template_id</code></td>
<td>Gáº¯n vÃ o má»—i <code>NotificationLog</code> Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ná»™i dung Ä‘Ã£ dÃ¹ng khi gá»­i</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>Phá»¥c vá»¥ kiá»ƒm tra lá»‹ch sá»­ vÃ  kiá»ƒm toÃ¡n</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="65-kiem-thu-schema-nen-bao-gom">6.5. âœ… Kiá»ƒm thá»­ schema nÃªn bao gá»“m:<a class="headerlink" href="#65-kiem-thu-schema-nen-bao-gom" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Loáº¡i kiá»ƒm thá»­</th>
<th>Má»¥c tiÃªu</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gá»­i test thiáº¿u biáº¿n (<code>params</code>)</td>
<td>PhÃ¡t hiá»‡n lá»—i render Ä‘á»™ng</td>
</tr>
<tr>
<td>Gá»­i test vá»›i biáº¿n sai kiá»ƒu</td>
<td>Báº¯t lá»—i schema khÃ´ng khá»›p</td>
</tr>
<tr>
<td>Gá»­i test khi cÃ³ version má»›i</td>
<td>Äáº£m báº£o láº¥y Ä‘Ãºng version má»›i nháº¥t</td>
</tr>
<tr>
<td>So sÃ¡nh version giá»¯a cÃ¡c tenant</td>
<td>Äáº£m báº£o isolation, khÃ´ng xung Ä‘á»™t</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="7-goi-y-kiem-thu-du-lieu">7. ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­ dá»¯ liá»‡u<a class="headerlink" href="#7-goi-y-kiem-thu-du-lieu" title="Permanent link">Â¶</a></h2>
<p>CÃ¡c trÆ°á»ng há»£p kiá»ƒm thá»­ dÆ°á»›i Ä‘Ã¢y nháº±m Ä‘áº£m báº£o há»‡ thá»‘ng lÆ°u trá»¯ dá»¯ liá»‡u Ä‘Ãºng, pháº£n Ã¡nh chÃ­nh xÃ¡c luá»“ng nghiá»‡p vá»¥, Ä‘á»“ng thá»i há»— trá»£ audit vÃ  phÃ¢n tÃ­ch sá»± cá»‘ dá»… dÃ ng.</p>
<hr/>
<h3 id="71-kiem-thu-tao-truy-van-log-gui">7.1. ğŸ”„ Kiá»ƒm thá»­ táº¡o &amp; truy váº¥n log gá»­i<a class="headerlink" href="#71-kiem-thu-tao-truy-van-log-gui" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃ¬nh huá»‘ng</th>
<th>Má»¥c tiÃªu kiá»ƒm thá»­</th>
<th>Káº¿t quáº£ mong Ä‘á»£i</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gá»­i thá»­ má»™t template thÃ nh cÃ´ng</td>
<td>Log ghi nháº­n Ä‘áº§y Ä‘á»§ thÃ´ng tin (trace, status, payload)</td>
<td>Tráº¡ng thÃ¡i <code>sent</code>, cÃ³ trace_id</td>
</tr>
<tr>
<td>Gá»­i thá»­ template thiáº¿u biáº¿n</td>
<td>Kiá»ƒm tra lá»—i render template</td>
<td>Tráº¡ng thÃ¡i <code>failed</code>, <code>error_message</code> rÃµ rÃ ng</td>
</tr>
<tr>
<td>Gá»­i test vá»›i <code>recipient</code> áº©n danh</td>
<td>Kiá»ƒm tra cÆ¡ cháº¿ hash <code>recipient</code></td>
<td>Recipient bá»‹ mÃ£ hÃ³a theo cáº¥u hÃ¬nh</td>
</tr>
<tr>
<td>Truy váº¥n log vá»›i <code>status=sent</code></td>
<td>Lá»c log chÃ­nh xÃ¡c theo tráº¡ng thÃ¡i</td>
<td>Káº¿t quáº£ Ä‘Ãºng, khÃ´ng chá»©a log <code>failed</code></td>
</tr>
<tr>
<td>Truy váº¥n log theo <code>event_code</code> cá»¥ thá»ƒ</td>
<td>Kiá»ƒm tra chá»‰ láº¥y log Ä‘Ãºng loáº¡i sá»± kiá»‡n</td>
<td><code>event_code</code> khá»›p toÃ n bá»™ trong response</td>
</tr>
<tr>
<td>Truy váº¥n log sai tenant</td>
<td>Äáº£m báº£o isolation dá»¯ liá»‡u giá»¯a tenants</td>
<td>Káº¿t quáº£ rá»—ng, khÃ´ng cÃ³ dá»¯ liá»‡u lá»™</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="72-kiem-thu-template">7.2. ğŸ“„ Kiá»ƒm thá»­ template<a class="headerlink" href="#72-kiem-thu-template" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃ¬nh huá»‘ng</th>
<th>Má»¥c tiÃªu kiá»ƒm thá»­</th>
<th>Káº¿t quáº£ mong Ä‘á»£i</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gá»­i test vá»›i <code>event_code</code> khÃ´ng tá»“n táº¡i</td>
<td>Xá»­ lÃ½ trÆ°á»ng há»£p template khÃ´ng há»£p lá»‡</td>
<td>400 + <code>notif.template_not_found</code></td>
</tr>
<tr>
<td>Gá»­i test vá»›i template <code>is_active=false</code></td>
<td>KhÃ´ng cho phÃ©p gá»­i test template Ä‘Ã£ táº¯t</td>
<td>400 + <code>notif.template_inactive</code></td>
</tr>
<tr>
<td>Truy váº¥n danh sÃ¡ch template</td>
<td>Äáº£m báº£o tráº£ metadata Ä‘Ãºng</td>
<td>CÃ³ <code>event_code</code>, <code>channel</code>, <code>version</code></td>
</tr>
<tr>
<td>CÃ³ nhiá»u version cÃ¹ng <code>event_code</code></td>
<td>Há»‡ thá»‘ng chá»n Ä‘Ãºng <code>version=max</code> khi gá»­i test</td>
<td>Gá»­i Ä‘Ãºng template má»›i nháº¥t</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="73-kiem-thu-lien-quan-bao-mat-phan-vung-tenant">7.3. ğŸ” Kiá»ƒm thá»­ liÃªn quan báº£o máº­t &amp; phÃ¢n vÃ¹ng tenant<a class="headerlink" href="#73-kiem-thu-lien-quan-bao-mat-phan-vung-tenant" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃ¬nh huá»‘ng</th>
<th>Má»¥c tiÃªu kiá»ƒm thá»­</th>
<th>Káº¿t quáº£ mong Ä‘á»£i</th>
</tr>
</thead>
<tbody>
<tr>
<td>Truy váº¥n log tá»« tenant khÃ¡c</td>
<td>Báº£o vá»‡ phÃ¢n vÃ¹ng dá»¯ liá»‡u giá»¯a tenants</td>
<td>403 hoáº·c 200 + <code>data=[]</code></td>
</tr>
<tr>
<td>CÃ¹ng <code>event_code</code>, khÃ¡c tenant</td>
<td>Template Ä‘á»™c láº­p, khÃ´ng bá»‹ láº«n nhau</td>
<td>Káº¿t quáº£ Ä‘Ãºng theo tá»«ng tenant</td>
</tr>
<tr>
<td>Gá»­i thá»­ vá»›i cáº¥u hÃ¬nh channel bá»‹ táº¯t</td>
<td>KhÃ´ng gá»­i, bÃ¡o lá»—i cáº¥u hÃ¬nh</td>
<td>400 + <code>notif.channel_disabled</code></td>
</tr>
<tr>
<td>Thá»­ cáº¥u hÃ¬nh kÃªnh khÃ´ng há»£p lá»‡</td>
<td>PhÃ¡t hiá»‡n config sai (vÃ­ dá»¥ thiáº¿u SMTP host)</td>
<td>500 + <code>notif.channel_config_invalid</code></td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="74-kiem-thu-toan-ven-du-lieu">7.4. ğŸ§© Kiá»ƒm thá»­ toÃ n váº¹n dá»¯ liá»‡u<a class="headerlink" href="#74-kiem-thu-toan-ven-du-lieu" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃ¬nh huá»‘ng</th>
<th>Má»¥c tiÃªu kiá»ƒm thá»­</th>
<th>Káº¿t quáº£ mong Ä‘á»£i</th>
</tr>
</thead>
<tbody>
<tr>
<td>Log khÃ´ng cÃ³ <code>template_id</code> (trÆ°á»ng há»£p test JSON thuáº§n)</td>
<td>Äáº£m báº£o nullable hoáº¡t Ä‘á»™ng Ä‘Ãºng</td>
<td>Ghi log vá»›i <code>template_id = null</code></td>
</tr>
<tr>
<td>Log cÃ³ <code>trace_id</code> trÃ¹ng vá»›i Master</td>
<td>Cho phÃ©p liÃªn káº¿t xuyÃªn trace</td>
<td>Dá»¯ liá»‡u khá»›p trace</td>
</tr>
<tr>
<td>TTL dá»n log sau 30 ngÃ y</td>
<td>Dá»¯ liá»‡u Ä‘Æ°á»£c xÃ³a Ä‘á»‹nh ká»³ theo retention policy</td>
<td>KhÃ´ng cÃ²n dá»¯ liá»‡u cÅ©</td>
</tr>
</tbody>
</table>
<hr/>
<h3 id="75-checklist-xac-nhan-du-lieu">7.5. âœ… Checklist xÃ¡c nháº­n dá»¯ liá»‡u<a class="headerlink" href="#75-checklist-xac-nhan-du-lieu" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TiÃªu chÃ­</th>
<th>Tráº¡ng thÃ¡i</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tenant_id</code> luÃ´n Ä‘Æ°á»£c kiá»ƒm tra trong má»i truy váº¥n</td>
<td>âœ…</td>
</tr>
<tr>
<td>CÃ¡c báº£n ghi log cÃ³ <code>trace_id</code> há»£p lá»‡</td>
<td>âœ…</td>
</tr>
<tr>
<td>Template khÃ´ng thá»ƒ bá»‹ gá»­i náº¿u khÃ´ng active</td>
<td>âœ…</td>
</tr>
<tr>
<td>Dá»¯ liá»‡u test khÃ´ng Ä‘Æ°á»£c dÃ¹ng cho thá»‘ng kÃª tháº­t</td>
<td>âœ…</td>
</tr>
<tr>
<td>CÃ³ thá»ƒ kiá»ƒm tra láº¡i dá»¯ liá»‡u tá»« log + trace</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="8-tai-lieu-lien-quan">8. ğŸ“š TÃ i liá»‡u liÃªn quan<a class="headerlink" href="#8-tai-lieu-lien-quan" title="Permanent link">Â¶</a></h2>
<ul>
<li><a href="../design/">Design.md</a></li>
<li><a href="../interface-contract/">Interface Contract</a></li>
<li><a href="../openapi.yaml">OpenAPI Spec</a></li>
<li><a href="../../../../ADR/adr-030-event-schema-governance/">ADR-030 â€“ Event Schema Governance</a></li>
<li><a href="../../../../ADR/adr-024-data-anonymization-retention/">ADR-024 â€“ Data Anonymization &amp; Retention</a></li>
<li><a href="../../../../ADR/adr-025-multi-tenant-versioning/">ADR-025 â€“ Multi-Tenant Versioning</a></li>
<li><a href="../../../../ADR/adr-007-rbac/">ADR-007 â€“ RBAC</a></li>
</ul>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Trá»Ÿ láº¡i má»¥c lá»¥c
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
<script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
</body>
</html>