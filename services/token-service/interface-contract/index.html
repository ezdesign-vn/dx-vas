
<!doctype html>
<html lang="vi" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tài liệu kiến trúc và phát triển cho dự án Chuyển đổi số Trường Việt Anh.">
      
      
        <meta name="author" content="DX VAS Team">
      
      
        <link rel="canonical" href="https://ezdesign-vn.github.io/dx-vas/services/token-service/interface-contract/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Token Service – Interface Contract - DX VAS - Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#token-service-interface-contract" class="md-skip">
          Bỏ qua
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Đầu trang">
    <a href="../../.." title="DX VAS - Docs" class="md-header__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DX VAS - Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Token Service – Interface Contract
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Tìm kiếm" placeholder="Tìm kiếm" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Tìm kiếm">
        
        <button type="reset" class="md-search__icon md-icon" title="Xoá" aria-label="Xoá" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../architecture/system-diagrams/" class="md-tabs__link">
          
  
  
    
  
  Kiến trúc Hệ thống

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../dev-guide/" class="md-tabs__link">
        
  
  
    
  
  Hướng dẫn Phát triển

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
  
    
  
  Thiết kế Services

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ADR/" class="md-tabs__link">
          
  
  
    
  
  Quyết định Kiến trúc (ADRs)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Thanh điều hướng" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DX VAS - Docs" class="md-nav__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../assets/images/logo.png" alt="logo">

    </a>
    DX VAS - Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mã nguồn" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kiến trúc Hệ thống
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kiến trúc Hệ thống
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/system-diagrams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sơ đồ Hệ thống
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/rbac-deep-dive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RBAC Chi tiết
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hướng dẫn Phát triển
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thiết kế Services
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../ADR/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Quyết định Kiến trúc (ADRs)
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Quyết định Kiến trúc (ADRs)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Mục lục">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Mục lục
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tong-quan-api" class="md-nav__link">
    <span class="md-ellipsis">
      📌 Tổng quan API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-post-v1tokenissue" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ 1. POST /v1/token/issue
    </span>
  </a>
  
    <nav class="md-nav" aria-label="✅ 1. POST /v1/token/issue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau" class="md-nav__link">
    <span class="md-ellipsis">
      🔐 Headers yêu cầu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body" class="md-nav__link">
    <span class="md-ellipsis">
      📥 Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-headers" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Response Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-example-200" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Response Example (200)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-post-v1tokenrefresh" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ 2. POST /v1/token/refresh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="✅ 2. POST /v1/token/refresh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_1" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔐 Headers yêu cầu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body_1" class="md-nav__link">
    <span class="md-ellipsis">
      📥 Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_1" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-headers_1" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Response Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-example-200_1" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Response Example (200)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses_1" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-post-v1tokenrevoke" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ 3. POST /v1/token/revoke
    </span>
  </a>
  
    <nav class="md-nav" aria-label="✅ 3. POST /v1/token/revoke">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_2" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau_2" class="md-nav__link">
    <span class="md-ellipsis">
      🔐 Headers yêu cầu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body_2" class="md-nav__link">
    <span class="md-ellipsis">
      📥 Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-204-no-content" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Response (204 No Content)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses_2" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-post-v1tokenintrospect" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ 4. POST /v1/token/introspect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="✅ 4. POST /v1/token/introspect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_3" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau_3" class="md-nav__link">
    <span class="md-ellipsis">
      🔐 Headers yêu cầu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body_3" class="md-nav__link">
    <span class="md-ellipsis">
      📥 Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-200-ok" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Response (200 OK)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses_3" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-get-well-knownjwksjson" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ 5. GET /.well-known/jwks.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="✅ 5. GET /.well-known/jwks.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_4" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Mục đích
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      🔓 Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-200-ok_1" class="md-nav__link">
    <span class="md-ellipsis">
      📤 Response (200 OK)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotation-va-cache" class="md-nav__link">
    <span class="md-ellipsis">
      ♻️ Rotation và cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ung-dung" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Ứng dụng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghi-chu-ve-jwksjson-va-caching-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      🔐 Ghi chú về /jwks.json và Caching Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enum-su-dung" class="md-nav__link">
    <span class="md-ellipsis">
      📎 ENUM sử dụng
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📎 ENUM sử dụng">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-token_type" class="md-nav__link">
    <span class="md-ellipsis">
      1. token_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-grant_type" class="md-nav__link">
    <span class="md-ellipsis">
      2. grant_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-device_type" class="md-nav__link">
    <span class="md-ellipsis">
      3. device_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-session_status-du-phong-cho-mo-rong-tuong-lai" class="md-nav__link">
    <span class="md-ellipsis">
      4. session_status (dự phòng cho mở rộng tương lai)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-login_method" class="md-nav__link">
    <span class="md-ellipsis">
      5. login_method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      📎 Permission Mapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-event-names-follow-adr-030-v1" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Note: Event names follow ADR-030 (*.v1)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="&gt; Note: Event names follow ADR-030 (*.v1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cac-permission-ap-dung-cho-token-service" class="md-nav__link">
    <span class="md-ellipsis">
      🔒 Các permission áp dụng cho token-service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du-cau-truc-claim-permissions-trong-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Ví dụ cấu trúc claim permissions trong access token:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ap-dung-trong-openapi" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Áp dụng trong OpenAPI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-codes-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      🛡️ Error Codes &amp; Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🛡️ Error Codes &amp; Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bang-ma-loi-chi-tiet" class="md-nav__link">
    <span class="md-ellipsis">
      🔒 Bảng mã lỗi chi tiết
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#header-ratelimit-remaining-va-retry-after-uoc-tra-ve-khi-gan-het-hoac-a-vuot-qua-nguong-tuan-theo-khuyen-nghi-adr-022-slaslo-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Header RateLimit-Remaining và Retry-After được trả về khi gần hết hoặc đã vượt quá ngưỡng, tuân theo khuyến nghị ADR-022 SLA/SLO Monitoring.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-du-curl" class="md-nav__link">
    <span class="md-ellipsis">
      📝 Ví dụ Curl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📝 Ví dụ Curl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ang-nhap-e-lay-token-moi" class="md-nav__link">
    <span class="md-ellipsis">
      🔑 1. Đăng nhập để lấy token mới
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-lam-moi-token" class="md-nav__link">
    <span class="md-ellipsis">
      ♻️ 2. Làm mới token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-thu-hoi-token-logout-toan-bo-thiet-bi" class="md-nav__link">
    <span class="md-ellipsis">
      🛑 3. Thu hồi token (logout toàn bộ thiết bị)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-kiem-tra-token-introspect" class="md-nav__link">
    <span class="md-ellipsis">
      🧐 4. Kiểm tra token (introspect)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-lay-jwks-key" class="md-nav__link">
    <span class="md-ellipsis">
      🔐 5. Lấy JWKS key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghi-chu" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Ghi chú
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tai-lieu-lien-quan" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Tài liệu liên quan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Tài liệu liên quan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cac-quyet-inh-kien-truc-adr" class="md-nav__link">
    <span class="md-ellipsis">
      🔖 Các Quyết định Kiến trúc (ADR)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="token-service-interface-contract">📄 Token Service – Interface Contract<a class="headerlink" href="#token-service-interface-contract" title="Permanent link">¶</a></h1>
<p>Token Service cung cấp các API trung tâm để phát hành, làm mới, thu hồi và xác minh token (access/refresh/JWT) theo chuẩn của hệ thống DX-VAS.</p>
<hr />
<h2 id="tong-quan-api">📌 Tổng quan API<a class="headerlink" href="#tong-quan-api" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Mô tả</th>
<th>Bảo mật</th>
<th>Ghi chú</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/v1/token</code></td>
<td>Cấp token mới dựa trên thông tin người dùng</td>
<td>🔒 Auth</td>
<td>Được gọi bởi <code>auth-service/sub</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/v1/token/refresh</code></td>
<td>Làm mới token bằng refresh token</td>
<td>🔒</td>
<td>Gọi trực tiếp từ client</td>
</tr>
<tr>
<td>POST</td>
<td><code>/v1/token/revoke</code></td>
<td>Thu hồi 1 token cụ thể hoặc theo <code>sub</code></td>
<td>🔒</td>
<td>Sử dụng Redis để blacklist <code>jti</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/v1/token/introspect</code></td>
<td>Kiểm tra tính hợp lệ của token</td>
<td>🔒 Internal</td>
<td>Sử dụng bởi <code>api-gateway</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/.well-known/jwks.json</code></td>
<td>Trả về public keys để xác thực chữ ký JWT</td>
<td>🔓 Public</td>
<td>Dùng cho các service verify token</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Quy ước path versioning</strong><br />
Mọi endpoint của Token Service tuân định dạng <strong><code>/v{major}/…</code></strong> – ví dụ<br />
<code>/v1/token</code>, <code>/v1/token/refresh</code>. Quy tắc này lấy từ <strong>ADR-009 (API Governance)</strong><br />
và <strong>ADR-013 (Path Naming Convention)</strong> để đảm bảo khả năng thay đổi phiên bản mà<br />
không phá vỡ client.</p>
</blockquote>
<hr />
<h2 id="1-post-v1tokenissue">✅ 1. POST <code>/v1/token/issue</code><a class="headerlink" href="#1-post-v1tokenissue" title="Permanent link">¶</a></h2>
<h3 id="muc-ich">🎯 Mục đích<a class="headerlink" href="#muc-ich" title="Permanent link">¶</a></h3>
<p>Phát hành cặp token (access_token, refresh_token) mới cho user đã được xác thực trước đó. API này được gọi nội bộ bởi auth-service (Master hoặc Sub) sau khi xác thực danh tính người dùng thành công.</p>
<hr />
<h3 id="headers-yeu-cau">🔐 Headers yêu cầu<a class="headerlink" href="#headers-yeu-cau" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tên Header</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>✅</td>
<td>ID truy vết request, sẽ được trả về trong <code>meta.trace_id</code>.</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>✅</td>
<td>Định danh tenant đang thực hiện yêu cầu.</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>✅</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>✅</td>
<td>Token xác thực của service gọi đến (ví dụ: service account token của Auth Service), chứng minh quyền được gọi <code>token.issue</code>.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body">📥 Request Body<a class="headerlink" href="#request-body" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;teacher&quot;</span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;report.view_login_by_tenant&quot;</span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sess-abc-123&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="nt">&quot;login_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;otp&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="nt">&quot;session_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nt">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;113.23.45.12&quot;</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="nt">&quot;device_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;android&quot;</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nt">&quot;user_agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mozilla/5.0&quot;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Bắt buộc</th>
<th>Kiểu DL</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sub</code></td>
<td>✅</td>
<td>string</td>
<td>Global User ID của người dùng cần cấp token.</td>
</tr>
<tr>
<td><code>roles</code></td>
<td>✅</td>
<td>array</td>
<td>Danh sách các <code>role_code</code> của người dùng trong tenant hiện tại.</td>
</tr>
<tr>
<td><code>permissions</code></td>
<td>✅</td>
<td>array</td>
<td>Danh sách các <code>permission_code</code> người dùng có.</td>
</tr>
<tr>
<td><code>session_id</code></td>
<td>✅</td>
<td>string</td>
<td>ID của phiên đăng nhập, lấy từ bảng <code>auth_sessions</code>.</td>
</tr>
<tr>
<td><code>login_method</code></td>
<td>✅</td>
<td>string</td>
<td><code>google</code> / <code>otp</code> / <code>local</code></td>
</tr>
<tr>
<td><code>session_metadata</code></td>
<td>❌</td>
<td>object</td>
<td>IP, thiết bị, trình duyệt (ghi log)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response">📤 Response<a class="headerlink" href="#response" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;req-uuid&quot;</span><span class="p">,</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T14:35:00Z&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="response-headers">📤 Response Headers<a class="headerlink" href="#response-headers" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Header</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>Echo lại ID request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>Echo lại tenant</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-example-200">🧪 Response Example (200)<a class="headerlink" href="#response-example-200" title="Permanent link">¶</a></h3>
<div class="language-http highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="na">X-Request-ID</span><span class="o">:</span> <span class="l">abc123</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="na">X-Tenant-ID</span><span class="o">:</span> <span class="l">vas-001</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T14:35:00Z&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="error-responses">❌ Error Responses<a class="headerlink" href="#error-responses" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>common.validation_error</code></td>
<td>Token yêu cầu không hợp lệ</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>Không có quyền phát hành token</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.tenant.mismatch</code></td>
<td>Tenant không khớp với user</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON hợp lệ nhưng không thoả điều kiện nghiệp vụ</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>Vượt ngưỡng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lỗi hệ thống nội bộ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>❗ <strong>Note</strong>: Tất cả lỗi đều trả về dưới dạng <code>ErrorEnvelope</code> theo <a href="../../../ADR/adr-011-api-error-format/">ADR-011</a></p>
</blockquote>
<hr />
<h2 id="2-post-v1tokenrefresh">✅ 2. POST <code>/v1/token/refresh</code><a class="headerlink" href="#2-post-v1tokenrefresh" title="Permanent link">¶</a></h2>
<h3 id="muc-ich_1">🎯 Mục đích<a class="headerlink" href="#muc-ich_1" title="Permanent link">¶</a></h3>
<p>Phát hành cặp token mới dựa trên <code>refresh_token</code> hợp lệ. API này cho phép client duy trì đăng nhập mà không cần nhập lại mật khẩu. Được gọi trực tiếp từ client (mobile/web app) hoặc từ <code>auth-service/sub</code>.</p>
<hr />
<h3 id="headers-yeu-cau_1">🔐 Headers yêu cầu<a class="headerlink" href="#headers-yeu-cau_1" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tên Header</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>✅</td>
<td>ID truy vết request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>✅</td>
<td>Tenant hiện hành</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>✅</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>✅</td>
<td><code>Bearer &lt;refresh_token&gt;</code> – được cấp từ lần đăng nhập trước</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body_1">📥 Request Body<a class="headerlink" href="#request-body_1" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;session-abc-uuid&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Bắt buộc</th>
<th>Kiểu DL</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>session_id</code></td>
<td>✅</td>
<td>string</td>
<td>ID phiên cần làm mới token</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response_1">📤 Response<a class="headerlink" href="#response_1" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T15:00:00Z&quot;</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="response-headers_1">📤 Response Headers<a class="headerlink" href="#response-headers_1" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Header</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>Echo lại ID request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>Echo lại tenant</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-example-200_1">🧪 Response Example (200)<a class="headerlink" href="#response-example-200_1" title="Permanent link">¶</a></h3>
<div class="language-http highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="na">X-Request-ID</span><span class="o">:</span> <span class="l">abc123</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="na">X-Tenant-ID</span><span class="o">:</span> <span class="l">vas-001</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">{</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T15:00:00Z&quot;</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="error-responses_1">❌ Error Responses<a class="headerlink" href="#error-responses_1" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>auth.refresh.invalid</code></td>
<td>Token refresh không hợp lệ hoặc đã hết hạn</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>Không có quyền làm mới token</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.session.revoked</code></td>
<td>Phiên đã bị thu hồi hoặc bị chặn</td>
</tr>
<tr>
<td>404</td>
<td><code>auth.session.not_found</code></td>
<td>Không tìm thấy phiên tương ứng</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON hợp lệ nhưng không thoả điều kiện nghiệp vụ</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>Vượt ngưỡng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lỗi hệ thống</td>
</tr>
</tbody>
</table>
<blockquote>
<p>❗ <strong>Ghi chú:</strong> Đáp ứng chuẩn <a href="../../../ADR/adr-011-api-error-format/">ADR-011 - Error Format</a></p>
</blockquote>
<hr />
<h2 id="3-post-v1tokenrevoke">✅ 3. POST <code>/v1/token/revoke</code><a class="headerlink" href="#3-post-v1tokenrevoke" title="Permanent link">¶</a></h2>
<h3 id="muc-ich_2">🎯 Mục đích<a class="headerlink" href="#muc-ich_2" title="Permanent link">¶</a></h3>
<p>Thu hồi một phiên đăng nhập (session) cụ thể, chấm dứt hiệu lực của cả access token và refresh token tương ứng.<br />
API này được sử dụng khi người dùng chủ động đăng xuất khỏi một thiết bị cụ thể hoặc toàn bộ hệ thống.</p>
<hr />
<h3 id="headers-yeu-cau_2">🔐 Headers yêu cầu<a class="headerlink" href="#headers-yeu-cau_2" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tên Header</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>✅</td>
<td>ID truy vết request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>✅</td>
<td>Tenant hiện hành</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>✅</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>✅</td>
<td>Access Token hợp lệ để xác định <code>sub</code> thực hiện yêu cầu</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body_2">📥 Request Body<a class="headerlink" href="#request-body_2" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;session-abc-uuid&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Bắt buộc</th>
<th>Kiểu DL</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>session_id</code></td>
<td>✅</td>
<td>string</td>
<td>ID của phiên cần thu hồi</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-204-no-content">📤 Response (204 No Content)<a class="headerlink" href="#response-204-no-content" title="Permanent link">¶</a></h3>
<div class="language-http highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="na">X-Request-ID</span><span class="o">:</span> <span class="l">abc123</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="na">X-Tenant-ID</span><span class="o">:</span> <span class="l">vas-001</span>
</span></code></pre></div>
<p>✅ Không có response body nếu thành công. Phản hồi <code>204</code> thể hiện rằng session đã được thu hồi (hoặc không tồn tại nhưng xử lý idempotent).</p>
<hr />
<h3 id="error-responses_2">❌ Error Responses<a class="headerlink" href="#error-responses_2" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>auth.revoke.invalid</code></td>
<td>Dữ liệu yêu cầu không hợp lệ</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>Không có quyền thu hồi phiên</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.session.forbidden</code></td>
<td>Session không thuộc về user hiện tại</td>
</tr>
<tr>
<td>404</td>
<td><code>auth.session.not_found</code></td>
<td>Không tìm thấy session được yêu cầu</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON hợp lệ nhưng không thoả điều kiện nghiệp vụ</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>Vượt ngưỡng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lỗi hệ thống nội bộ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>❗ <strong>Note:</strong> Mọi lỗi đều sử dụng chuẩn <code>ErrorEnvelope</code> từ <a href="../../../ADR/adr-011-api-error-format/">ADR-011</a></p>
</blockquote>
<hr />
<h2 id="4-post-v1tokenintrospect">✅ 4. POST <code>/v1/token/introspect</code><a class="headerlink" href="#4-post-v1tokenintrospect" title="Permanent link">¶</a></h2>
<h3 id="muc-ich_3">🎯 Mục đích<a class="headerlink" href="#muc-ich_3" title="Permanent link">¶</a></h3>
<p>Kiểm tra tính hợp lệ của một access token hoặc refresh token. Trả về metadata nếu hợp lệ, hoặc trạng thái <code>active: false</code> nếu không hợp lệ.<br />
API được dùng chủ yếu bởi các hệ thống backend như API Gateway hoặc các service phụ trợ muốn xác minh thông tin token (khi không dùng JWKS trực tiếp).</p>
<hr />
<h3 id="headers-yeu-cau_3">🔐 Headers yêu cầu<a class="headerlink" href="#headers-yeu-cau_3" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Tên Header</th>
<th>Bắt buộc</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>✅</td>
<td>ID truy vết request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>✅</td>
<td>Tenant hiện hành</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>✅</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>✅</td>
<td>Access token có quyền introspect token (thường là hệ thống nội bộ)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body_3">📥 Request Body<a class="headerlink" href="#request-body_3" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Bắt buộc</th>
<th>Kiểu DL</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token</code></td>
<td>✅</td>
<td>string</td>
<td>JWT token cần kiểm tra</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-200-ok">📤 Response (200 OK)<a class="headerlink" href="#response-200-ok" title="Permanent link">¶</a></h3>
<p>Trường <code>active</code> cho biết token có hợp lệ không. Nếu <code>active: false</code>, các trường còn lại có thể rỗng hoặc không tồn tại.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dx-vas&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1711111111</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1711100000</span><span class="p">,</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;read write&quot;</span><span class="p">,</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;access&quot;</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;session-abc-uuid&quot;</span><span class="p">,</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">  </span><span class="nt">&quot;client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;frontend-app&quot;</span><span class="p">,</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">  </span><span class="nt">&quot;login_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;otp&quot;</span><span class="p">,</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="nt">&quot;device_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;web&quot;</span><span class="p">,</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="nt">&quot;ip_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.10&quot;</span><span class="p">,</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="nt">&quot;user_agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mozilla/5.0&quot;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>active</code></td>
<td>Token hợp lệ (<code>true</code>) hay không (<code>false</code>)</td>
</tr>
<tr>
<td><code>sub</code></td>
<td>ID người dùng</td>
</tr>
<tr>
<td><code>exp</code>, <code>iat</code></td>
<td>Thời điểm hết hạn / phát hành</td>
</tr>
<tr>
<td><code>token_type</code></td>
<td>access / refresh</td>
</tr>
<tr>
<td><code>session_id</code></td>
<td>Gắn với bảng <code>auth_sessions</code></td>
</tr>
<tr>
<td><code>meta</code></td>
<td>Dữ liệu bổ sung (IP, thiết bị, agent...)</td>
</tr>
<tr>
<td><code>login_method</code></td>
<td>Phương thức đăng nhập ban đầu của session (<code>otp</code>, <code>google</code>, <code>local</code>)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="error-responses_3">❌ Error Responses<a class="headerlink" href="#error-responses_3" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>auth.introspect.invalid</code></td>
<td>Token đầu vào không hợp lệ</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>Không có quyền introspect token</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON hợp lệ nhưng không thoả điều kiện nghiệp vụ</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>Vượt ngưỡng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lỗi hệ thống</td>
</tr>
</tbody>
</table>
<blockquote>
<p>❗ API trả về <code>200 OK</code> với <code>active: false</code> nếu token không hợp lệ – không trả về <code>401</code> để đảm bảo không tiết lộ thông tin cho attacker.</p>
</blockquote>
<hr />
<h2 id="5-get-well-knownjwksjson">✅ 5. GET <code>/.well-known/jwks.json</code><a class="headerlink" href="#5-get-well-knownjwksjson" title="Permanent link">¶</a></h2>
<h3 id="muc-ich_4">🎯 Mục đích<a class="headerlink" href="#muc-ich_4" title="Permanent link">¶</a></h3>
<p>Cung cấp danh sách public key hiện hành dùng để xác minh chữ ký JWT do <code>token-service</code> phát hành.<br />
Endpoint này phục vụ cho việc <strong>verify token phía client</strong>, API Gateway, hoặc các service khác thông qua <code>kid</code> trong header của JWT.</p>
<hr />
<h3 id="authorization">🔓 Authorization<a class="headerlink" href="#authorization" title="Permanent link">¶</a></h3>
<ul>
<li>❌ <strong>Không yêu cầu xác thực</strong></li>
<li>✅ <strong>Public endpoint</strong>, có thể được truy cập bởi bất kỳ hệ thống nào cần verify chữ ký</li>
</ul>
<hr />
<h3 id="response-200-ok_1">📤 Response (200 OK)<a class="headerlink" href="#response-200-ok_1" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-rotation-1&quot;</span><span class="p">,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">      </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uA6kkl5e8fKNS3k0_4ZFnN...&quot;</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-fallback&quot;</span><span class="p">,</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">      </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;zN9uhNfUJ73hdJs0_qlmv...&quot;</span><span class="p">,</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Trường</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kid</code></td>
<td>Key ID – dùng để khớp với <code>kid</code> trong JWT header</td>
</tr>
<tr>
<td><code>alg</code></td>
<td>Thuật toán chữ ký – thường là <code>RS256</code></td>
</tr>
<tr>
<td><code>kty</code></td>
<td>Loại key, ví dụ <code>RSA</code></td>
</tr>
<tr>
<td><code>use</code></td>
<td>Mục đích – ở đây là <code>"sig"</code> để ký token</td>
</tr>
<tr>
<td><code>n</code>, <code>e</code></td>
<td>Thành phần của public key (modulus và exponent)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="rotation-va-cache">♻️ Rotation và cache<a class="headerlink" href="#rotation-va-cache" title="Permanent link">¶</a></h3>
<ul>
<li>Các public key sẽ được xoay vòng định kỳ theo chính sách từ <a href="../../03-cr-token-service.md">03-cr-token-service.md</a></li>
<li>Thời gian cache: <code>max-age=3600</code> (1h) khuyến nghị để tránh gọi lại liên tục</li>
</ul>
<div class="language-http highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="err">Cache-Control: public, max-age=3600</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="err">Content-Type: application/json</span>
</span></code></pre></div>
<hr />
<h3 id="ung-dung">✅ Ứng dụng<a class="headerlink" href="#ung-dung" title="Permanent link">¶</a></h3>
<ul>
<li>Các service hoặc gateway chỉ cần lấy public key từ endpoint này và lưu vào cache.</li>
<li>Sử dụng thư viện xác thực JWT (như <code>jsonwebtoken</code>, <code>pyjwt</code>, <code>jose</code>) để verify chữ ký dựa trên <code>kid</code>.</li>
</ul>
<hr />
<h3 id="ghi-chu-ve-jwksjson-va-caching-strategy">🔐 Ghi chú về <code>/jwks.json</code> và Caching Strategy<a class="headerlink" href="#ghi-chu-ve-jwksjson-va-caching-strategy" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>Endpoint <code>/.well-known/jwks.json</code> là <strong>public</strong>, không yêu cầu xác thực, và được các service khác sử dụng để <strong>verify chữ ký JWT</strong>.</p>
</li>
<li>
<p>Để <strong>tăng hiệu suất và giảm tải</strong> cho <code>token-service</code>, trong môi trường <strong>Production</strong>, endpoint này <strong>nên được cache bởi Public API Gateway hoặc CDN (như Cloudflare, Cloud CDN)</strong>.</p>
</li>
</ul>
<h4 id="goi-y-cau-hinh-caching">🔄 Gợi ý cấu hình caching:<a class="headerlink" href="#goi-y-cau-hinh-caching" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Header</th>
<th>Giá trị đề xuất</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cache-Control</code></td>
<td><code>public, max-age=3600</code></td>
<td>Cho phép cache trong 1 giờ</td>
</tr>
<tr>
<td><code>ETag</code></td>
<td><code>"&lt;fingerprint&gt;"</code></td>
<td>Cho phép client check bằng <code>If-None-Match</code></td>
</tr>
<tr>
<td><code>Last-Modified</code></td>
<td><code>ISO timestamp</code></td>
<td>Hỗ trợ cache theo thời gian cập nhật</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🔐 JWKS chỉ nên thay đổi khi rotate public keys. Khi đó cần <code>purge cache</code> hoặc invalidate.</p>
</blockquote>
<hr />
<p>📌 Nếu triển khai trên <strong>GCP API Gateway</strong>, bạn có thể dùng cấu hình <code>x-google-backend.cacheControl</code> hoặc gắn cache layer riêng tại Cloud CDN.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">/.well-known/jwks.json</span><span class="p">:</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JWKS public keys</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">        </span><span class="s">&#39;200&#39;</span><span class="p p-Indicator">:</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">          </span><span class="nt">headers</span><span class="p">:</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">            </span><span class="nt">Cache-Control</span><span class="p">:</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">              </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public, max-age=3600</span>
</span></code></pre></div>
<hr />
<h2 id="enum-su-dung">📎 ENUM sử dụng<a class="headerlink" href="#enum-su-dung" title="Permanent link">¶</a></h2>
<p>Trong quá trình thiết kế API của <code>token-service</code>, một số enum đã được chuẩn hóa để đảm bảo tính rõ ràng, mở rộng và hỗ trợ tốt cho UI/UX, kiểm thử và i18n. Dưới đây là danh sách các enum đang được sử dụng.</p>
<hr />
<h3 id="1-token_type">1. <code>token_type</code><a class="headerlink" href="#1-token_type" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>access</code></td>
<td>Token truy cập, có thời hạn ngắn (~15 phút)</td>
</tr>
<tr>
<td><code>refresh</code></td>
<td>Token làm mới, dùng để lấy access token mới</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🔐 Enum này được dùng trong response của <code>/v1/token/introspect</code> để phân biệt loại token đang được kiểm tra.</p>
</blockquote>
<hr />
<h3 id="2-grant_type">2. <code>grant_type</code><a class="headerlink" href="#2-grant_type" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>password</code></td>
<td>Đăng nhập qua email/password truyền thống</td>
</tr>
<tr>
<td><code>refresh_token</code></td>
<td>Làm mới token thông qua refresh token</td>
</tr>
<tr>
<td><code>jwt_bearer</code></td>
<td>Grant flow nội bộ sử dụng JWT đã được xác thực trước đó</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🔄 Enum này giúp mở rộng cho các luồng xác thực OAuth2 trong tương lai.</p>
</blockquote>
<hr />
<h3 id="3-device_type">3. <code>device_type</code><a class="headerlink" href="#3-device_type" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>web</code></td>
<td>Trình duyệt web thông thường</td>
</tr>
<tr>
<td><code>android</code></td>
<td>Thiết bị Android</td>
</tr>
<tr>
<td><code>ios</code></td>
<td>Thiết bị iOS</td>
</tr>
</tbody>
</table>
<blockquote>
<p>📱 Được dùng trong metadata của <code>auth_sessions</code> và introspection response để phục vụ thống kê, cảnh báo bảo mật, và phân tích hành vi người dùng.</p>
</blockquote>
<hr />
<h3 id="4-session_status-du-phong-cho-mo-rong-tuong-lai">4. <code>session_status</code> (dự phòng cho mở rộng tương lai)<a class="headerlink" href="#4-session_status-du-phong-cho-mo-rong-tuong-lai" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>active</code></td>
<td>Phiên đang hoạt động và có thể sử dụng</td>
</tr>
<tr>
<td><code>revoked</code></td>
<td>Phiên đã bị thu hồi bởi người dùng hoặc hệ thống</td>
</tr>
<tr>
<td><code>expired</code></td>
<td>Phiên đã hết hạn theo thời gian cấu hình</td>
</tr>
</tbody>
</table>
<blockquote>
<p>⏳ Enum này sẽ hữu ích nếu hệ thống mở rộng logic quản lý session nâng cao.</p>
</blockquote>
<hr />
<h3 id="5-login_method">5. <code>login_method</code><a class="headerlink" href="#5-login_method" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Giá trị</th>
<th>Mô tả</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>google</code></td>
<td>Đăng nhập bằng Google OAuth2</td>
</tr>
<tr>
<td><code>otp</code></td>
<td>Đăng nhập bằng mã OTP</td>
</tr>
<tr>
<td><code>local</code></td>
<td>Đăng nhập bằng tài khoản nội bộ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>🔐 Dùng để xác định phương thức xác thực đã được sử dụng khi phát hành token/session.</p>
</blockquote>
<hr />
<h2 id="permission-mapping">📎 Permission Mapping<a class="headerlink" href="#permission-mapping" title="Permanent link">¶</a></h2>
<p>Mặc dù <code>token-service</code> không trực tiếp quản lý người dùng hoặc phân quyền truy cập tài nguyên, nhưng vẫn cần định nghĩa rõ các quyền (permissions) áp dụng cho các hệ thống gọi đến các endpoint đặc thù như introspect hoặc revoke. Điều này đảm bảo kiểm soát truy cập, tuân thủ nguyên tắc Principle of Least Privilege (ADR-004, ADR-006, ADR-007).</p>
<h2 id="note-event-names-follow-adr-030-v1">&gt; <strong>Note:</strong> Event names follow ADR-030 (*.v1)<a class="headerlink" href="#note-event-names-follow-adr-030-v1" title="Permanent link">¶</a></h2>
<h3 id="cac-permission-ap-dung-cho-token-service">🔒 Các permission áp dụng cho <code>token-service</code><a class="headerlink" href="#cac-permission-ap-dung-cho-token-service" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Permission Key</th>
<th>Mô tả</th>
<th>Endpoint yêu cầu</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token.generate</code></td>
<td>Cho phép tạo access token / refresh token (nội bộ)</td>
<td><code>POST /v1/token</code></td>
</tr>
<tr>
<td><code>token.refresh</code></td>
<td>Cho phép làm mới access token thông qua refresh token</td>
<td><code>POST /v1/token/refresh</code></td>
</tr>
<tr>
<td><code>token.revoke</code></td>
<td>Cho phép thu hồi (revoke) một session token cụ thể</td>
<td><code>POST /v1/token/revoke</code></td>
</tr>
<tr>
<td><code>token.introspect</code></td>
<td>Cho phép kiểm tra thông tin và trạng thái của token</td>
<td><code>POST /v1/token/introspect</code></td>
</tr>
<tr>
<td><code>token.jwks.read</code></td>
<td>Quyền public, không cần auth – dùng cho <code>GET /.well-known/jwks.json</code></td>
<td>❌ (public)</td>
</tr>
</tbody>
</table>
<blockquote>
<p>📌 Trong hầu hết các trường hợp, <code>token-service</code> hoạt động như service nội bộ nên các quyền này được kiểm tra bằng service-to-service authentication (JWT có embedded scope/permission claim).</p>
</blockquote>
<hr />
<h3 id="vi-du-cau-truc-claim-permissions-trong-access-token">🧩 Ví dụ cấu trúc claim <code>permissions</code> trong access token:<a class="headerlink" href="#vi-du-cau-truc-claim-permissions-trong-access-token" title="Permanent link">¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-abc-123&quot;</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;read write&quot;</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="s2">&quot;user.read&quot;</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="s2">&quot;token.introspect&quot;</span><span class="p">,</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="s2">&quot;token.revoke&quot;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dx-vas&quot;</span><span class="p">,</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1712345678</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="ap-dung-trong-openapi">✅ Áp dụng trong OpenAPI<a class="headerlink" href="#ap-dung-trong-openapi" title="Permanent link">¶</a></h3>
<p>Mỗi operation trong <code>openapi.yaml</code> nên khai báo custom field:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">x-required-permission</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">token.introspect</span>
</span></code></pre></div>
<p>Hoặc nếu operation không cần quyền cụ thể (ví dụ: <code>/.well-known/jwks.json</code>) thì <strong>không cần khai báo permission</strong>.</p>
<hr />
<h2 id="error-codes-envelope">🛡️ Error Codes &amp; Envelope<a class="headerlink" href="#error-codes-envelope" title="Permanent link">¶</a></h2>
<p>Tất cả lỗi được trả về dưới dạng chuẩn <code>ErrorEnvelope</code> (ADR-011), đảm bảo nhất quán trong toàn hệ thống.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;token.expired&quot;</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Token has expired&quot;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3&quot;</span><span class="p">,</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T10:30:00Z&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="bang-ma-loi-chi-tiet">🔒 Bảng mã lỗi chi tiết<a class="headerlink" href="#bang-ma-loi-chi-tiet" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Mã lỗi (<code>error.code</code>)</th>
<th>Mô tả</th>
<th>HTTP Status</th>
<th>Áp dụng cho endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token.invalid</code></td>
<td>Access token không hợp lệ</td>
<td>401</td>
<td><code>/v1/token/introspect</code></td>
</tr>
<tr>
<td><code>token.expired</code></td>
<td>Token đã hết hạn</td>
<td>401</td>
<td><code>/v1/token/refresh</code>, introspect</td>
</tr>
<tr>
<td><code>token.revoked</code></td>
<td>Token đã bị thu hồi</td>
<td>401</td>
<td><code>/v1/token/refresh</code>, introspect</td>
</tr>
<tr>
<td><code>token.unknown_jti</code></td>
<td>Token không nằm trong danh sách thu hồi</td>
<td>400</td>
<td><code>/v1/token/revoke</code></td>
</tr>
<tr>
<td><code>session.not_found</code></td>
<td>Không tìm thấy phiên đăng nhập</td>
<td>404</td>
<td><code>/v1/token/revoke</code></td>
</tr>
<tr>
<td><code>session.inactive</code></td>
<td>Phiên đăng nhập đã bị hủy</td>
<td>403</td>
<td><code>/v1/token/refresh</code>, <code>/v1/token/revoke</code></td>
</tr>
<tr>
<td><code>jwks.not_found</code></td>
<td>Không tìm thấy khoá công khai JWKS</td>
<td>500</td>
<td><code>/.well-known/jwks.json</code></td>
</tr>
<tr>
<td><code>common.validation_error</code></td>
<td>Dữ liệu gửi lên không hợp lệ</td>
<td>400</td>
<td>Mọi endpoint <code>POST</code></td>
</tr>
<tr>
<td><code>common.missing_param</code></td>
<td>Thiếu tham số bắt buộc (<code>grant_type</code>, <code>refresh_token</code>)</td>
<td>400</td>
<td><code>/v1/token</code>, <code>/v1/token/refresh</code></td>
</tr>
<tr>
<td><code>common.unauthorized</code></td>
<td>Thiếu token hoặc token không hợp lệ</td>
<td>401</td>
<td>Tất cả endpoint bảo vệ</td>
</tr>
<tr>
<td><code>common.forbidden</code></td>
<td>Không đủ quyền thực hiện hành động</td>
<td>403</td>
<td>Theo <code>x-required-permission</code></td>
</tr>
<tr>
<td><code>common.validation_error</code></td>
<td>JSON hợp lệ nhưng không thoả điều kiện nghiệp vụ</td>
<td>422</td>
<td>Mọi endpoint</td>
</tr>
<tr>
<td><code>common.rate_limited</code></td>
<td>Vượt ngưỡng RPS/burst (theo ADR-022)</td>
<td>429</td>
<td>Mọi endpoint</td>
</tr>
<tr>
<td><code>common.internal_error</code></td>
<td>Lỗi không xác định từ phía server</td>
<td>500</td>
<td>Mọi endpoint</td>
</tr>
</tbody>
</table>
<h4 id="response-headers-rate-limiting-adr-022">Response Headers – Rate Limiting  <em>(ADR-022)</em><a class="headerlink" href="#response-headers-rate-limiting-adr-022" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Header</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RateLimit-Limit</code></td>
<td>Giới hạn tối đa request trong 1 cửa sổ (per tenant / client).</td>
<td><code>120</code></td>
</tr>
<tr>
<td><code>RateLimit-Remaining</code></td>
<td>Số request còn lại trong cửa sổ hiện tại. Chỉ xuất hiện khi còn &gt; 0.</td>
<td><code>17</code></td>
</tr>
<tr>
<td><code>Retry-After</code></td>
<td>Thời gian (giây) cần chờ trước khi gửi lại request, kèm theo HTTP 429.</td>
<td><code>42</code></td>
</tr>
</tbody>
</table>
<h2 id="header-ratelimit-remaining-va-retry-after-uoc-tra-ve-khi-gan-het-hoac-a-vuot-qua-nguong-tuan-theo-khuyen-nghi-adr-022-slaslo-monitoring">&gt; Header <code>RateLimit-Remaining</code> và <code>Retry-After</code> được trả về khi <strong>gần hết</strong> hoặc đã vượt quá ngưỡng, tuân theo khuyến nghị <strong>ADR-022 SLA/SLO Monitoring</strong>.<a class="headerlink" href="#header-ratelimit-remaining-va-retry-after-uoc-tra-ve-khi-gan-het-hoac-a-vuot-qua-nguong-tuan-theo-khuyen-nghi-adr-022-slaslo-monitoring" title="Permanent link">¶</a></h2>
<p>📌 <strong>Mọi lỗi đều trả về kèm <code>X-Request-ID</code> trong response headers</strong> và được ghi log (audit + cloud logging).</p>
<hr />
<h2 id="vi-du-curl">📝 Ví dụ Curl<a class="headerlink" href="#vi-du-curl" title="Permanent link">¶</a></h2>
<p>Dưới đây là các ví dụ <code>curl</code> minh họa cách sử dụng các API chính của <code>token-service</code>. Các ví dụ này dùng để kiểm thử nhanh, tích hợp CI pipeline, hoặc hướng dẫn frontend/backend team tích hợp.</p>
<hr />
<h3 id="1-ang-nhap-e-lay-token-moi">🔑 1. Đăng nhập để lấy token mới<a class="headerlink" href="#1-ang-nhap-e-lay-token-moi" title="Permanent link">¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-001&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-primary&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;service-token&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="s1">    &quot;sub&quot;: &quot;user-123&quot;,</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="s1">    &quot;roles&quot;: [&quot;teacher&quot;],</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="s1">    &quot;permissions&quot;: [&quot;report.view_login_by_tenant&quot;],</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="s1">    &quot;session_id&quot;: &quot;sess-abc-123&quot;,</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="s1">    &quot;login_method&quot;: &quot;otp&quot;,</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="s1">    &quot;session_metadata&quot;: {</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="s1">      &quot;ip&quot;: &quot;113.23.45.12&quot;,</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="s1">      &quot;device_type&quot;: &quot;android&quot;</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="s1">    }</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p>📌 <em>Trả về access_token + refresh_token nếu hợp lệ.</em></p>
<hr />
<h3 id="2-lam-moi-token">♻️ 2. Làm mới token<a class="headerlink" href="#2-lam-moi-token" title="Permanent link">¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token/refresh<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-002&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-truongvietanh&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="s1">    &quot;refresh_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsIn...&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p>📌 <em>Trả về cặp token mới nếu refresh token hợp lệ.</em></p>
<hr />
<h3 id="3-thu-hoi-token-logout-toan-bo-thiet-bi">🛑 3. Thu hồi token (logout toàn bộ thiết bị)<a class="headerlink" href="#3-thu-hoi-token-logout-toan-bo-thiet-bi" title="Permanent link">¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token/revoke<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;access_token&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-003&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-truongvietanh&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{}&#39;</span>
</span></code></pre></div>
<p>📌 <em>Thu hồi session hiện tại (access + refresh token).</em></p>
<hr />
<h3 id="4-kiem-tra-token-introspect">🧐 4. Kiểm tra token (introspect)<a class="headerlink" href="#4-kiem-tra-token-introspect" title="Permanent link">¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token/introspect<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;access_token&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-004&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-truongvietanh&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="s1">    &quot;token&quot;: &quot;eyJhbGciOiJIUzI1NiIsIn...&quot;</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p>📌 <em>Trả về thông tin token, trạng thái (active/revoked/expired), claims.</em></p>
<hr />
<h3 id="5-lay-jwks-key">🔐 5. Lấy JWKS key<a class="headerlink" href="#5-lay-jwks-key" title="Permanent link">¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>https://api.truongvietanh.edu.vn/.well-known/jwks.json
</span></code></pre></div>
<p>📌 <em>Trả về public key JWKS để hệ thống khác verify chữ ký JWT.</em></p>
<hr />
<h3 id="ghi-chu">🧪 Ghi chú<a class="headerlink" href="#ghi-chu" title="Permanent link">¶</a></h3>
<ul>
<li><code>X-Request-ID</code> là bắt buộc để trace log.</li>
<li><code>X-Tenant-ID</code> giúp multi-tenant isolation (bắt buộc).</li>
<li>Bạn có thể test JWT validity với <a href="https://jwt.io">jwt.io</a>.</li>
<li>Token mẫu để test có thể lấy từ Auth Web hoặc Dev Tool gắn với <code>auth-service</code>.</li>
</ul>
<hr />
<h2 id="tai-lieu-lien-quan">📚 Tài liệu liên quan<a class="headerlink" href="#tai-lieu-lien-quan" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../design/">Design</a></li>
<li><a href="../data-model/">Data Model</a></li>
<li><a href="../openapi.yaml">OpenAPI Spec</a></li>
</ul>
<h3 id="cac-quyet-inh-kien-truc-adr">🔖 Các Quyết định Kiến trúc (ADR)<a class="headerlink" href="#cac-quyet-inh-kien-truc-adr" title="Permanent link">¶</a></h3>
<ul>
<li><a href="../../../ADR/adr-003-secrets/">ADR-003 Secrets Management</a>: Quy trình lưu trữ &amp; xoay khóa bí mật an toàn.  </li>
<li><a href="../../../ADR/adr-004-security/">ADR-004 Security Policy</a>: Chính sách bảo mật tổng thể.  </li>
<li><a href="../../../ADR/adr-005-env-config/">ADR-005 Environment Configuration Strategy</a>: Chuẩn tách cấu hình – <code>SERVICE__SECTION__KEY</code>.  </li>
<li><a href="../../../ADR/adr-006-auth-strategy/">ADR-006 Auth Strategy</a>: Chiến lược xác thực người dùng và cấp phát token.  </li>
<li><a href="../../../ADR/adr-009-api-governance/">ADR-009 API Governance</a>: Quy tắc versioning, naming và style REST.  </li>
<li><a href="../../../ADR/adr-011-api-error-format/">ADR-011 API Error Format</a>: Quy ước mã lỗi &amp; thông điệp lỗi (<code>namespace.snake_case</code>).  </li>
<li><a href="../../../ADR/adr-012-response-structure/">ADR-012 Response Structure</a>: Chuẩn hóa cấu trúc JSON response cho API.</li>
<li><a href="../../../ADR/adr-018-release-approval-policy/">ADR-018 Release Approval Policy</a>: Quy trình phê duyệt phát hành.</li>
<li><a href="../../../ADR/adr-022-sla-slo-monitoring/">ADR-022 SLA &amp; SLO Monitoring</a>: Khung giám sát &amp; định nghĩa SLO.</li>
<li><a href="../../../ADR/adr-023-schema-migration-strategy/">ADR-023 Schema Migration Strategy</a>: 3-phase migration (Prepare → Transition → Cleanup).  </li>
<li><a href="../../../ADR/adr-024-data-anonymization-retention/">ADR-024 Data Anonymization &amp; Retention</a>: Ẩn danh PII và TTL dữ liệu.  </li>
<li><a href="../../../ADR/adr-026-hard-delete-policy/">ADR-026 Hard-Delete Policy</a>: Quy trình xoá vĩnh viễn &amp; purge log.  </li>
<li><a href="../../../ADR/adr-030-event-schema-governance/">ADR-030 Event Schema Governance</a>: Đặt tên &amp; version sự kiện <code>*.v{n}</code>.</li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Trở lại mục lục
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>