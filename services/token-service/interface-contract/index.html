
<!doctype html>
<html lang="vi" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="TÃ i liá»‡u kiáº¿n trÃºc vÃ  phÃ¡t triá»ƒn cho dá»± Ã¡n Chuyá»ƒn Ä‘á»•i sá»‘ TrÆ°á»ng Viá»‡t Anh.">
      
      
        <meta name="author" content="DX VAS Team">
      
      
        <link rel="canonical" href="https://ezdesign-vn.github.io/dx-vas/services/token-service/interface-contract/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Token Service â€“ Interface Contract - DX VAS - Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#token-service-interface-contract" class="md-skip">
          Bá» qua
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Äáº§u trang">
    <a href="../../.." title="DX VAS - Docs" class="md-header__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DX VAS - Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Token Service â€“ Interface Contract
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="TÃ¬m kiáº¿m" placeholder="TÃ¬m kiáº¿m" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="TÃ¬m kiáº¿m">
        
        <button type="reset" class="md-search__icon md-icon" title="XoÃ¡" aria-label="XoÃ¡" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../architecture/system-diagrams/" class="md-tabs__link">
          
  
  
    
  
  Kiáº¿n trÃºc Há»‡ thá»‘ng

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../dev-guide/" class="md-tabs__link">
        
  
  
    
  
  HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
  
    
  
  Thiáº¿t káº¿ Services

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ADR/" class="md-tabs__link">
          
  
  
    
  
  Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Thanh Ä‘iá»u hÆ°á»›ng" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DX VAS - Docs" class="md-nav__button md-logo" aria-label="DX VAS - Docs" data-md-component="logo">
      
  <img src="../../../assets/images/logo.png" alt="logo">

    </a>
    DX VAS - Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ezdesign-vn/dx-vas.git" title="Xem mÃ£ nguá»“n" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ezdesign.vn/dx-vas
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kiáº¿n trÃºc Há»‡ thá»‘ng
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kiáº¿n trÃºc Há»‡ thá»‘ng
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/system-diagrams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SÆ¡ Ä‘á»“ Há»‡ thá»‘ng
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/rbac-deep-dive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RBAC Chi tiáº¿t
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HÆ°á»›ng dáº«n PhÃ¡t triá»ƒn
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thiáº¿t káº¿ Services
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../ADR/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADRs)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Má»¥c lá»¥c">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Má»¥c lá»¥c
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tong-quan-api" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“Œ Tá»•ng quan API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-post-v1tokenissue" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… 1. POST /v1/token/issue
    </span>
  </a>
  
    <nav class="md-nav" aria-label="âœ… 1. POST /v1/token/issue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ¯ Má»¥c Ä‘Ã­ch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ” Headers yÃªu cáº§u
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¥ Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¤ Response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-headers" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¤ Response Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-example-200" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ§ª Response Example (200)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      âŒ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-post-v1tokenrefresh" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… 2. POST /v1/token/refresh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="âœ… 2. POST /v1/token/refresh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_1" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ¯ Má»¥c Ä‘Ã­ch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau_1" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ” Headers yÃªu cáº§u
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body_1" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¥ Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_1" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¤ Response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-headers_1" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¤ Response Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-example-200_1" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ§ª Response Example (200)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses_1" class="md-nav__link">
    <span class="md-ellipsis">
      âŒ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-post-v1tokenrevoke" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… 3. POST /v1/token/revoke
    </span>
  </a>
  
    <nav class="md-nav" aria-label="âœ… 3. POST /v1/token/revoke">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_2" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ¯ Má»¥c Ä‘Ã­ch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau_2" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ” Headers yÃªu cáº§u
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body_2" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¥ Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-204-no-content" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¤ Response (204 No Content)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses_2" class="md-nav__link">
    <span class="md-ellipsis">
      âŒ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-post-v1tokenintrospect" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… 4. POST /v1/token/introspect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="âœ… 4. POST /v1/token/introspect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_3" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ¯ Má»¥c Ä‘Ã­ch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-yeu-cau_3" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ” Headers yÃªu cáº§u
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body_3" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¥ Request Body
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-200-ok" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¤ Response (200 OK)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-responses_3" class="md-nav__link">
    <span class="md-ellipsis">
      âŒ Error Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-get-well-knownjwksjson" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… 5. GET /.well-known/jwks.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="âœ… 5. GET /.well-known/jwks.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#muc-ich_4" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ¯ Má»¥c Ä‘Ã­ch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”“ Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-200-ok_1" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“¤ Response (200 OK)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotation-va-cache" class="md-nav__link">
    <span class="md-ellipsis">
      â™»ï¸ Rotation vÃ  cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ung-dung" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… á»¨ng dá»¥ng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghi-chu-ve-jwksjson-va-caching-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ” Ghi chÃº vá» /jwks.json vÃ  Caching Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enum-su-dung" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“ ENUM sá»­ dá»¥ng
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ“ ENUM sá»­ dá»¥ng">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-token_type" class="md-nav__link">
    <span class="md-ellipsis">
      1. token_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-grant_type" class="md-nav__link">
    <span class="md-ellipsis">
      2. grant_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-device_type" class="md-nav__link">
    <span class="md-ellipsis">
      3. device_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-session_status-du-phong-cho-mo-rong-tuong-lai" class="md-nav__link">
    <span class="md-ellipsis">
      4. session_status (dá»± phÃ²ng cho má»Ÿ rá»™ng tÆ°Æ¡ng lai)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-login_method" class="md-nav__link">
    <span class="md-ellipsis">
      5. login_method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“ Permission Mapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-event-names-follow-adr-030-v1" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Note: Event names follow ADR-030 (*.v1)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="&gt; Note: Event names follow ADR-030 (*.v1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cac-permission-ap-dung-cho-token-service" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”’ CÃ¡c permission Ã¡p dá»¥ng cho token-service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du-cau-truc-claim-permissions-trong-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ§© VÃ­ dá»¥ cáº¥u trÃºc claim permissions trong access token:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ap-dung-trong-openapi" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… Ãp dá»¥ng trong OpenAPI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-codes-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ›¡ï¸ Error Codes &amp; Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ›¡ï¸ Error Codes &amp; Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bang-ma-loi-chi-tiet" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”’ Báº£ng mÃ£ lá»—i chi tiáº¿t
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#header-ratelimit-remaining-va-retry-after-uoc-tra-ve-khi-gan-het-hoac-a-vuot-qua-nguong-tuan-theo-khuyen-nghi-adr-022-slaslo-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Header RateLimit-Remaining vÃ  Retry-After Ä‘Æ°á»£c tráº£ vá» khi gáº§n háº¿t hoáº·c Ä‘Ã£ vÆ°á»£t quÃ¡ ngÆ°á»¡ng, tuÃ¢n theo khuyáº¿n nghá»‹ ADR-022 SLA/SLO Monitoring.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-du-curl" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“ VÃ­ dá»¥ Curl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ“ VÃ­ dá»¥ Curl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ang-nhap-e-lay-token-moi" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”‘ 1. ÄÄƒng nháº­p Ä‘á»ƒ láº¥y token má»›i
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-lam-moi-token" class="md-nav__link">
    <span class="md-ellipsis">
      â™»ï¸ 2. LÃ m má»›i token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-thu-hoi-token-logout-toan-bo-thiet-bi" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ›‘ 3. Thu há»“i token (logout toÃ n bá»™ thiáº¿t bá»‹)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-kiem-tra-token-introspect" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ§ 4. Kiá»ƒm tra token (introspect)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-lay-jwks-key" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ” 5. Láº¥y JWKS key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghi-chu" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ§ª Ghi chÃº
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tai-lieu-lien-quan" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“š TÃ i liá»‡u liÃªn quan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ“š TÃ i liá»‡u liÃªn quan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cac-quyet-inh-kien-truc-adr" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”– CÃ¡c Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADR)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="token-service-interface-contract">ğŸ“„ Token Service â€“ Interface Contract<a class="headerlink" href="#token-service-interface-contract" title="Permanent link">Â¶</a></h1>
<p>Token Service cung cáº¥p cÃ¡c API trung tÃ¢m Ä‘á»ƒ phÃ¡t hÃ nh, lÃ m má»›i, thu há»“i vÃ  xÃ¡c minh token (access/refresh/JWT) theo chuáº©n cá»§a há»‡ thá»‘ng DX-VAS.</p>
<hr />
<h2 id="tong-quan-api">ğŸ“Œ Tá»•ng quan API<a class="headerlink" href="#tong-quan-api" title="Permanent link">Â¶</a></h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>MÃ´ táº£</th>
<th>Báº£o máº­t</th>
<th>Ghi chÃº</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/v1/token</code></td>
<td>Cáº¥p token má»›i dá»±a trÃªn thÃ´ng tin ngÆ°á»i dÃ¹ng</td>
<td>ğŸ”’ Auth</td>
<td>ÄÆ°á»£c gá»i bá»Ÿi <code>auth-service/sub</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/v1/token/refresh</code></td>
<td>LÃ m má»›i token báº±ng refresh token</td>
<td>ğŸ”’</td>
<td>Gá»i trá»±c tiáº¿p tá»« client</td>
</tr>
<tr>
<td>POST</td>
<td><code>/v1/token/revoke</code></td>
<td>Thu há»“i 1 token cá»¥ thá»ƒ hoáº·c theo <code>sub</code></td>
<td>ğŸ”’</td>
<td>Sá»­ dá»¥ng Redis Ä‘á»ƒ blacklist <code>jti</code></td>
</tr>
<tr>
<td>POST</td>
<td><code>/v1/token/introspect</code></td>
<td>Kiá»ƒm tra tÃ­nh há»£p lá»‡ cá»§a token</td>
<td>ğŸ”’ Internal</td>
<td>Sá»­ dá»¥ng bá»Ÿi <code>api-gateway</code></td>
</tr>
<tr>
<td>GET</td>
<td><code>/.well-known/jwks.json</code></td>
<td>Tráº£ vá» public keys Ä‘á»ƒ xÃ¡c thá»±c chá»¯ kÃ½ JWT</td>
<td>ğŸ”“ Public</td>
<td>DÃ¹ng cho cÃ¡c service verify token</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Quy Æ°á»›c path versioning</strong><br />
Má»i endpoint cá»§a Token Service tuÃ¢n Ä‘á»‹nh dáº¡ng <strong><code>/v{major}/â€¦</code></strong> â€“ vÃ­ dá»¥<br />
<code>/v1/token</code>, <code>/v1/token/refresh</code>. Quy táº¯c nÃ y láº¥y tá»« <strong>ADR-009 (API Governance)</strong><br />
vÃ  <strong>ADR-013 (Path Naming Convention)</strong> Ä‘á»ƒ Ä‘áº£m báº£o kháº£ nÄƒng thay Ä‘á»•i phiÃªn báº£n mÃ <br />
khÃ´ng phÃ¡ vá»¡ client.</p>
</blockquote>
<hr />
<h2 id="1-post-v1tokenissue">âœ… 1. POST <code>/v1/token/issue</code><a class="headerlink" href="#1-post-v1tokenissue" title="Permanent link">Â¶</a></h2>
<h3 id="muc-ich">ğŸ¯ Má»¥c Ä‘Ã­ch<a class="headerlink" href="#muc-ich" title="Permanent link">Â¶</a></h3>
<p>PhÃ¡t hÃ nh cáº·p token (access_token, refresh_token) má»›i cho user Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c thá»±c trÆ°á»›c Ä‘Ã³. API nÃ y Ä‘Æ°á»£c gá»i ná»™i bá»™ bá»Ÿi auth-service (Master hoáº·c Sub) sau khi xÃ¡c thá»±c danh tÃ­nh ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng.</p>
<hr />
<h3 id="headers-yeu-cau">ğŸ” Headers yÃªu cáº§u<a class="headerlink" href="#headers-yeu-cau" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃªn Header</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>âœ…</td>
<td>ID truy váº¿t request, sáº½ Ä‘Æ°á»£c tráº£ vá» trong <code>meta.trace_id</code>.</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>Äá»‹nh danh tenant Ä‘ang thá»±c hiá»‡n yÃªu cáº§u.</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>âœ…</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>âœ…</td>
<td>Token xÃ¡c thá»±c cá»§a service gá»i Ä‘áº¿n (vÃ­ dá»¥: service account token cá»§a Auth Service), chá»©ng minh quyá»n Ä‘Æ°á»£c gá»i <code>token.issue</code>.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body">ğŸ“¥ Request Body<a class="headerlink" href="#request-body" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;teacher&quot;</span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;report.view_login_by_tenant&quot;</span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sess-abc-123&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="nt">&quot;login_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;otp&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="nt">&quot;session_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nt">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;113.23.45.12&quot;</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="nt">&quot;device_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;android&quot;</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nt">&quot;user_agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mozilla/5.0&quot;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Báº¯t buá»™c</th>
<th>Kiá»ƒu DL</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sub</code></td>
<td>âœ…</td>
<td>string</td>
<td>Global User ID cá»§a ngÆ°á»i dÃ¹ng cáº§n cáº¥p token.</td>
</tr>
<tr>
<td><code>roles</code></td>
<td>âœ…</td>
<td>array</td>
<td>Danh sÃ¡ch cÃ¡c <code>role_code</code> cá»§a ngÆ°á»i dÃ¹ng trong tenant hiá»‡n táº¡i.</td>
</tr>
<tr>
<td><code>permissions</code></td>
<td>âœ…</td>
<td>array</td>
<td>Danh sÃ¡ch cÃ¡c <code>permission_code</code> ngÆ°á»i dÃ¹ng cÃ³.</td>
</tr>
<tr>
<td><code>session_id</code></td>
<td>âœ…</td>
<td>string</td>
<td>ID cá»§a phiÃªn Ä‘Äƒng nháº­p, láº¥y tá»« báº£ng <code>auth_sessions</code>.</td>
</tr>
<tr>
<td><code>login_method</code></td>
<td>âœ…</td>
<td>string</td>
<td><code>google</code> / <code>otp</code> / <code>local</code></td>
</tr>
<tr>
<td><code>session_metadata</code></td>
<td>âŒ</td>
<td>object</td>
<td>IP, thiáº¿t bá»‹, trÃ¬nh duyá»‡t (ghi log)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response">ğŸ“¤ Response<a class="headerlink" href="#response" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;req-uuid&quot;</span><span class="p">,</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T14:35:00Z&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="response-headers">ğŸ“¤ Response Headers<a class="headerlink" href="#response-headers" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Header</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>Echo láº¡i ID request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>Echo láº¡i tenant</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-example-200">ğŸ§ª Response Example (200)<a class="headerlink" href="#response-example-200" title="Permanent link">Â¶</a></h3>
<div class="language-http highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="na">X-Request-ID</span><span class="o">:</span> <span class="l">abc123</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="na">X-Tenant-ID</span><span class="o">:</span> <span class="l">vas-001</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T14:35:00Z&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="error-responses">âŒ Error Responses<a class="headerlink" href="#error-responses" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>common.validation_error</code></td>
<td>Token yÃªu cáº§u khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>KhÃ´ng cÃ³ quyá»n phÃ¡t hÃ nh token</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.tenant.mismatch</code></td>
<td>Tenant khÃ´ng khá»›p vá»›i user</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON há»£p lá»‡ nhÆ°ng khÃ´ng thoáº£ Ä‘iá»u kiá»‡n nghiá»‡p vá»¥</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>VÆ°á»£t ngÆ°á»¡ng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lá»—i há»‡ thá»‘ng ná»™i bá»™</td>
</tr>
</tbody>
</table>
<blockquote>
<p>â— <strong>Note</strong>: Táº¥t cáº£ lá»—i Ä‘á»u tráº£ vá» dÆ°á»›i dáº¡ng <code>ErrorEnvelope</code> theo <a href="../../../ADR/adr-011-api-error-format/">ADR-011</a></p>
</blockquote>
<hr />
<h2 id="2-post-v1tokenrefresh">âœ… 2. POST <code>/v1/token/refresh</code><a class="headerlink" href="#2-post-v1tokenrefresh" title="Permanent link">Â¶</a></h2>
<h3 id="muc-ich_1">ğŸ¯ Má»¥c Ä‘Ã­ch<a class="headerlink" href="#muc-ich_1" title="Permanent link">Â¶</a></h3>
<p>PhÃ¡t hÃ nh cáº·p token má»›i dá»±a trÃªn <code>refresh_token</code> há»£p lá»‡. API nÃ y cho phÃ©p client duy trÃ¬ Ä‘Äƒng nháº­p mÃ  khÃ´ng cáº§n nháº­p láº¡i máº­t kháº©u. ÄÆ°á»£c gá»i trá»±c tiáº¿p tá»« client (mobile/web app) hoáº·c tá»« <code>auth-service/sub</code>.</p>
<hr />
<h3 id="headers-yeu-cau_1">ğŸ” Headers yÃªu cáº§u<a class="headerlink" href="#headers-yeu-cau_1" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃªn Header</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>âœ…</td>
<td>ID truy váº¿t request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>Tenant hiá»‡n hÃ nh</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>âœ…</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>âœ…</td>
<td><code>Bearer &lt;refresh_token&gt;</code> â€“ Ä‘Æ°á»£c cáº¥p tá»« láº§n Ä‘Äƒng nháº­p trÆ°á»›c</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body_1">ğŸ“¥ Request Body<a class="headerlink" href="#request-body_1" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;session-abc-uuid&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Báº¯t buá»™c</th>
<th>Kiá»ƒu DL</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>session_id</code></td>
<td>âœ…</td>
<td>string</td>
<td>ID phiÃªn cáº§n lÃ m má»›i token</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response_1">ğŸ“¤ Response<a class="headerlink" href="#response_1" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T15:00:00Z&quot;</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="response-headers_1">ğŸ“¤ Response Headers<a class="headerlink" href="#response-headers_1" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Header</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>Echo láº¡i ID request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>Echo láº¡i tenant</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-example-200_1">ğŸ§ª Response Example (200)<a class="headerlink" href="#response-example-200_1" title="Permanent link">Â¶</a></h3>
<div class="language-http highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="na">X-Request-ID</span><span class="o">:</span> <span class="l">abc123</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="na">X-Tenant-ID</span><span class="o">:</span> <span class="l">vas-001</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">{</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOi...&quot;</span><span class="p">,</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T15:00:00Z&quot;</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="error-responses_1">âŒ Error Responses<a class="headerlink" href="#error-responses_1" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>auth.refresh.invalid</code></td>
<td>Token refresh khÃ´ng há»£p lá»‡ hoáº·c Ä‘Ã£ háº¿t háº¡n</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>KhÃ´ng cÃ³ quyá»n lÃ m má»›i token</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.session.revoked</code></td>
<td>PhiÃªn Ä‘Ã£ bá»‹ thu há»“i hoáº·c bá»‹ cháº·n</td>
</tr>
<tr>
<td>404</td>
<td><code>auth.session.not_found</code></td>
<td>KhÃ´ng tÃ¬m tháº¥y phiÃªn tÆ°Æ¡ng á»©ng</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON há»£p lá»‡ nhÆ°ng khÃ´ng thoáº£ Ä‘iá»u kiá»‡n nghiá»‡p vá»¥</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>VÆ°á»£t ngÆ°á»¡ng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lá»—i há»‡ thá»‘ng</td>
</tr>
</tbody>
</table>
<blockquote>
<p>â— <strong>Ghi chÃº:</strong> ÄÃ¡p á»©ng chuáº©n <a href="../../../ADR/adr-011-api-error-format/">ADR-011 - Error Format</a></p>
</blockquote>
<hr />
<h2 id="3-post-v1tokenrevoke">âœ… 3. POST <code>/v1/token/revoke</code><a class="headerlink" href="#3-post-v1tokenrevoke" title="Permanent link">Â¶</a></h2>
<h3 id="muc-ich_2">ğŸ¯ Má»¥c Ä‘Ã­ch<a class="headerlink" href="#muc-ich_2" title="Permanent link">Â¶</a></h3>
<p>Thu há»“i má»™t phiÃªn Ä‘Äƒng nháº­p (session) cá»¥ thá»ƒ, cháº¥m dá»©t hiá»‡u lá»±c cá»§a cáº£ access token vÃ  refresh token tÆ°Æ¡ng á»©ng.<br />
API nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng khi ngÆ°á»i dÃ¹ng chá»§ Ä‘á»™ng Ä‘Äƒng xuáº¥t khá»i má»™t thiáº¿t bá»‹ cá»¥ thá»ƒ hoáº·c toÃ n bá»™ há»‡ thá»‘ng.</p>
<hr />
<h3 id="headers-yeu-cau_2">ğŸ” Headers yÃªu cáº§u<a class="headerlink" href="#headers-yeu-cau_2" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃªn Header</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>âœ…</td>
<td>ID truy váº¿t request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>Tenant hiá»‡n hÃ nh</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>âœ…</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>âœ…</td>
<td>Access Token há»£p lá»‡ Ä‘á»ƒ xÃ¡c Ä‘á»‹nh <code>sub</code> thá»±c hiá»‡n yÃªu cáº§u</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body_2">ğŸ“¥ Request Body<a class="headerlink" href="#request-body_2" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;session-abc-uuid&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Báº¯t buá»™c</th>
<th>Kiá»ƒu DL</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>session_id</code></td>
<td>âœ…</td>
<td>string</td>
<td>ID cá»§a phiÃªn cáº§n thu há»“i</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-204-no-content">ğŸ“¤ Response (204 No Content)<a class="headerlink" href="#response-204-no-content" title="Permanent link">Â¶</a></h3>
<div class="language-http highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="na">X-Request-ID</span><span class="o">:</span> <span class="l">abc123</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="na">X-Tenant-ID</span><span class="o">:</span> <span class="l">vas-001</span>
</span></code></pre></div>
<p>âœ… KhÃ´ng cÃ³ response body náº¿u thÃ nh cÃ´ng. Pháº£n há»“i <code>204</code> thá»ƒ hiá»‡n ráº±ng session Ä‘Ã£ Ä‘Æ°á»£c thu há»“i (hoáº·c khÃ´ng tá»“n táº¡i nhÆ°ng xá»­ lÃ½ idempotent).</p>
<hr />
<h3 id="error-responses_2">âŒ Error Responses<a class="headerlink" href="#error-responses_2" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>auth.revoke.invalid</code></td>
<td>Dá»¯ liá»‡u yÃªu cáº§u khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>KhÃ´ng cÃ³ quyá»n thu há»“i phiÃªn</td>
</tr>
<tr>
<td>403</td>
<td><code>auth.session.forbidden</code></td>
<td>Session khÃ´ng thuá»™c vá» user hiá»‡n táº¡i</td>
</tr>
<tr>
<td>404</td>
<td><code>auth.session.not_found</code></td>
<td>KhÃ´ng tÃ¬m tháº¥y session Ä‘Æ°á»£c yÃªu cáº§u</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON há»£p lá»‡ nhÆ°ng khÃ´ng thoáº£ Ä‘iá»u kiá»‡n nghiá»‡p vá»¥</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>VÆ°á»£t ngÆ°á»¡ng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lá»—i há»‡ thá»‘ng ná»™i bá»™</td>
</tr>
</tbody>
</table>
<blockquote>
<p>â— <strong>Note:</strong> Má»i lá»—i Ä‘á»u sá»­ dá»¥ng chuáº©n <code>ErrorEnvelope</code> tá»« <a href="../../../ADR/adr-011-api-error-format/">ADR-011</a></p>
</blockquote>
<hr />
<h2 id="4-post-v1tokenintrospect">âœ… 4. POST <code>/v1/token/introspect</code><a class="headerlink" href="#4-post-v1tokenintrospect" title="Permanent link">Â¶</a></h2>
<h3 id="muc-ich_3">ğŸ¯ Má»¥c Ä‘Ã­ch<a class="headerlink" href="#muc-ich_3" title="Permanent link">Â¶</a></h3>
<p>Kiá»ƒm tra tÃ­nh há»£p lá»‡ cá»§a má»™t access token hoáº·c refresh token. Tráº£ vá» metadata náº¿u há»£p lá»‡, hoáº·c tráº¡ng thÃ¡i <code>active: false</code> náº¿u khÃ´ng há»£p lá»‡.<br />
API Ä‘Æ°á»£c dÃ¹ng chá»§ yáº¿u bá»Ÿi cÃ¡c há»‡ thá»‘ng backend nhÆ° API Gateway hoáº·c cÃ¡c service phá»¥ trá»£ muá»‘n xÃ¡c minh thÃ´ng tin token (khi khÃ´ng dÃ¹ng JWKS trá»±c tiáº¿p).</p>
<hr />
<h3 id="headers-yeu-cau_3">ğŸ” Headers yÃªu cáº§u<a class="headerlink" href="#headers-yeu-cau_3" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>TÃªn Header</th>
<th>Báº¯t buá»™c</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>X-Request-ID</code></td>
<td>âœ…</td>
<td>ID truy váº¿t request</td>
</tr>
<tr>
<td><code>X-Tenant-ID</code></td>
<td>âœ…</td>
<td>Tenant hiá»‡n hÃ nh</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>âœ…</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>Authorization</code></td>
<td>âœ…</td>
<td>Access token cÃ³ quyá»n introspect token (thÆ°á»ng lÃ  há»‡ thá»‘ng ná»™i bá»™)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="request-body_3">ğŸ“¥ Request Body<a class="headerlink" href="#request-body_3" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>Báº¯t buá»™c</th>
<th>Kiá»ƒu DL</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token</code></td>
<td>âœ…</td>
<td>string</td>
<td>JWT token cáº§n kiá»ƒm tra</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="response-200-ok">ğŸ“¤ Response (200 OK)<a class="headerlink" href="#response-200-ok" title="Permanent link">Â¶</a></h3>
<p>TrÆ°á»ng <code>active</code> cho biáº¿t token cÃ³ há»£p lá»‡ khÃ´ng. Náº¿u <code>active: false</code>, cÃ¡c trÆ°á»ng cÃ²n láº¡i cÃ³ thá»ƒ rá»—ng hoáº·c khÃ´ng tá»“n táº¡i.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dx-vas&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1711111111</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1711100000</span><span class="p">,</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;read write&quot;</span><span class="p">,</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;access&quot;</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;session-abc-uuid&quot;</span><span class="p">,</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">  </span><span class="nt">&quot;client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;frontend-app&quot;</span><span class="p">,</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">  </span><span class="nt">&quot;login_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;otp&quot;</span><span class="p">,</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="nt">&quot;device_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;web&quot;</span><span class="p">,</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="nt">&quot;ip_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.10&quot;</span><span class="p">,</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="nt">&quot;user_agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mozilla/5.0&quot;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>active</code></td>
<td>Token há»£p lá»‡ (<code>true</code>) hay khÃ´ng (<code>false</code>)</td>
</tr>
<tr>
<td><code>sub</code></td>
<td>ID ngÆ°á»i dÃ¹ng</td>
</tr>
<tr>
<td><code>exp</code>, <code>iat</code></td>
<td>Thá»i Ä‘iá»ƒm háº¿t háº¡n / phÃ¡t hÃ nh</td>
</tr>
<tr>
<td><code>token_type</code></td>
<td>access / refresh</td>
</tr>
<tr>
<td><code>session_id</code></td>
<td>Gáº¯n vá»›i báº£ng <code>auth_sessions</code></td>
</tr>
<tr>
<td><code>meta</code></td>
<td>Dá»¯ liá»‡u bá»• sung (IP, thiáº¿t bá»‹, agent...)</td>
</tr>
<tr>
<td><code>login_method</code></td>
<td>PhÆ°Æ¡ng thá»©c Ä‘Äƒng nháº­p ban Ä‘áº§u cá»§a session (<code>otp</code>, <code>google</code>, <code>local</code>)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="error-responses_3">âŒ Error Responses<a class="headerlink" href="#error-responses_3" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>code</th>
<th>message</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td><code>auth.introspect.invalid</code></td>
<td>Token Ä‘áº§u vÃ o khÃ´ng há»£p lá»‡</td>
</tr>
<tr>
<td>401</td>
<td><code>auth.unauthorized</code></td>
<td>KhÃ´ng cÃ³ quyá»n introspect token</td>
</tr>
<tr>
<td>422</td>
<td><code>common.validation_error</code></td>
<td>JSON há»£p lá»‡ nhÆ°ng khÃ´ng thoáº£ Ä‘iá»u kiá»‡n nghiá»‡p vá»¥</td>
</tr>
<tr>
<td>429</td>
<td><code>common.rate_limited</code></td>
<td>VÆ°á»£t ngÆ°á»¡ng RPS/burst (theo ADR-022)</td>
</tr>
<tr>
<td>500</td>
<td><code>common.internal_error</code></td>
<td>Lá»—i há»‡ thá»‘ng</td>
</tr>
</tbody>
</table>
<blockquote>
<p>â— API tráº£ vá» <code>200 OK</code> vá»›i <code>active: false</code> náº¿u token khÃ´ng há»£p lá»‡ â€“ khÃ´ng tráº£ vá» <code>401</code> Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng tiáº¿t lá»™ thÃ´ng tin cho attacker.</p>
</blockquote>
<hr />
<h2 id="5-get-well-knownjwksjson">âœ… 5. GET <code>/.well-known/jwks.json</code><a class="headerlink" href="#5-get-well-knownjwksjson" title="Permanent link">Â¶</a></h2>
<h3 id="muc-ich_4">ğŸ¯ Má»¥c Ä‘Ã­ch<a class="headerlink" href="#muc-ich_4" title="Permanent link">Â¶</a></h3>
<p>Cung cáº¥p danh sÃ¡ch public key hiá»‡n hÃ nh dÃ¹ng Ä‘á»ƒ xÃ¡c minh chá»¯ kÃ½ JWT do <code>token-service</code> phÃ¡t hÃ nh.<br />
Endpoint nÃ y phá»¥c vá»¥ cho viá»‡c <strong>verify token phÃ­a client</strong>, API Gateway, hoáº·c cÃ¡c service khÃ¡c thÃ´ng qua <code>kid</code> trong header cá»§a JWT.</p>
<hr />
<h3 id="authorization">ğŸ”“ Authorization<a class="headerlink" href="#authorization" title="Permanent link">Â¶</a></h3>
<ul>
<li>âŒ <strong>KhÃ´ng yÃªu cáº§u xÃ¡c thá»±c</strong></li>
<li>âœ… <strong>Public endpoint</strong>, cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p bá»Ÿi báº¥t ká»³ há»‡ thá»‘ng nÃ o cáº§n verify chá»¯ kÃ½</li>
</ul>
<hr />
<h3 id="response-200-ok_1">ğŸ“¤ Response (200 OK)<a class="headerlink" href="#response-200-ok_1" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-rotation-1&quot;</span><span class="p">,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">      </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uA6kkl5e8fKNS3k0_4ZFnN...&quot;</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-fallback&quot;</span><span class="p">,</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">      </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;zN9uhNfUJ73hdJs0_qlmv...&quot;</span><span class="p">,</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>TrÆ°á»ng</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kid</code></td>
<td>Key ID â€“ dÃ¹ng Ä‘á»ƒ khá»›p vá»›i <code>kid</code> trong JWT header</td>
</tr>
<tr>
<td><code>alg</code></td>
<td>Thuáº­t toÃ¡n chá»¯ kÃ½ â€“ thÆ°á»ng lÃ  <code>RS256</code></td>
</tr>
<tr>
<td><code>kty</code></td>
<td>Loáº¡i key, vÃ­ dá»¥ <code>RSA</code></td>
</tr>
<tr>
<td><code>use</code></td>
<td>Má»¥c Ä‘Ã­ch â€“ á»Ÿ Ä‘Ã¢y lÃ  <code>"sig"</code> Ä‘á»ƒ kÃ½ token</td>
</tr>
<tr>
<td><code>n</code>, <code>e</code></td>
<td>ThÃ nh pháº§n cá»§a public key (modulus vÃ  exponent)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="rotation-va-cache">â™»ï¸ Rotation vÃ  cache<a class="headerlink" href="#rotation-va-cache" title="Permanent link">Â¶</a></h3>
<ul>
<li>CÃ¡c public key sáº½ Ä‘Æ°á»£c xoay vÃ²ng Ä‘á»‹nh ká»³ theo chÃ­nh sÃ¡ch tá»« <a href="../../03-cr-token-service.md">03-cr-token-service.md</a></li>
<li>Thá»i gian cache: <code>max-age=3600</code> (1h) khuyáº¿n nghá»‹ Ä‘á»ƒ trÃ¡nh gá»i láº¡i liÃªn tá»¥c</li>
</ul>
<div class="language-http highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="err">Cache-Control: public, max-age=3600</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="err">Content-Type: application/json</span>
</span></code></pre></div>
<hr />
<h3 id="ung-dung">âœ… á»¨ng dá»¥ng<a class="headerlink" href="#ung-dung" title="Permanent link">Â¶</a></h3>
<ul>
<li>CÃ¡c service hoáº·c gateway chá»‰ cáº§n láº¥y public key tá»« endpoint nÃ y vÃ  lÆ°u vÃ o cache.</li>
<li>Sá»­ dá»¥ng thÆ° viá»‡n xÃ¡c thá»±c JWT (nhÆ° <code>jsonwebtoken</code>, <code>pyjwt</code>, <code>jose</code>) Ä‘á»ƒ verify chá»¯ kÃ½ dá»±a trÃªn <code>kid</code>.</li>
</ul>
<hr />
<h3 id="ghi-chu-ve-jwksjson-va-caching-strategy">ğŸ” Ghi chÃº vá» <code>/jwks.json</code> vÃ  Caching Strategy<a class="headerlink" href="#ghi-chu-ve-jwksjson-va-caching-strategy" title="Permanent link">Â¶</a></h3>
<ul>
<li>
<p>Endpoint <code>/.well-known/jwks.json</code> lÃ  <strong>public</strong>, khÃ´ng yÃªu cáº§u xÃ¡c thá»±c, vÃ  Ä‘Æ°á»£c cÃ¡c service khÃ¡c sá»­ dá»¥ng Ä‘á»ƒ <strong>verify chá»¯ kÃ½ JWT</strong>.</p>
</li>
<li>
<p>Äá»ƒ <strong>tÄƒng hiá»‡u suáº¥t vÃ  giáº£m táº£i</strong> cho <code>token-service</code>, trong mÃ´i trÆ°á»ng <strong>Production</strong>, endpoint nÃ y <strong>nÃªn Ä‘Æ°á»£c cache bá»Ÿi Public API Gateway hoáº·c CDN (nhÆ° Cloudflare, Cloud CDN)</strong>.</p>
</li>
</ul>
<h4 id="goi-y-cau-hinh-caching">ğŸ”„ Gá»£i Ã½ cáº¥u hÃ¬nh caching:<a class="headerlink" href="#goi-y-cau-hinh-caching" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Header</th>
<th>GiÃ¡ trá»‹ Ä‘á» xuáº¥t</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cache-Control</code></td>
<td><code>public, max-age=3600</code></td>
<td>Cho phÃ©p cache trong 1 giá»</td>
</tr>
<tr>
<td><code>ETag</code></td>
<td><code>"&lt;fingerprint&gt;"</code></td>
<td>Cho phÃ©p client check báº±ng <code>If-None-Match</code></td>
</tr>
<tr>
<td><code>Last-Modified</code></td>
<td><code>ISO timestamp</code></td>
<td>Há»— trá»£ cache theo thá»i gian cáº­p nháº­t</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ” JWKS chá»‰ nÃªn thay Ä‘á»•i khi rotate public keys. Khi Ä‘Ã³ cáº§n <code>purge cache</code> hoáº·c invalidate.</p>
</blockquote>
<hr />
<p>ğŸ“Œ Náº¿u triá»ƒn khai trÃªn <strong>GCP API Gateway</strong>, báº¡n cÃ³ thá»ƒ dÃ¹ng cáº¥u hÃ¬nh <code>x-google-backend.cacheControl</code> hoáº·c gáº¯n cache layer riÃªng táº¡i Cloud CDN.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">/.well-known/jwks.json</span><span class="p">:</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JWKS public keys</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">        </span><span class="s">&#39;200&#39;</span><span class="p p-Indicator">:</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">          </span><span class="nt">headers</span><span class="p">:</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">            </span><span class="nt">Cache-Control</span><span class="p">:</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">              </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public, max-age=3600</span>
</span></code></pre></div>
<hr />
<h2 id="enum-su-dung">ğŸ“ ENUM sá»­ dá»¥ng<a class="headerlink" href="#enum-su-dung" title="Permanent link">Â¶</a></h2>
<p>Trong quÃ¡ trÃ¬nh thiáº¿t káº¿ API cá»§a <code>token-service</code>, má»™t sá»‘ enum Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hÃ³a Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh rÃµ rÃ ng, má»Ÿ rá»™ng vÃ  há»— trá»£ tá»‘t cho UI/UX, kiá»ƒm thá»­ vÃ  i18n. DÆ°á»›i Ä‘Ã¢y lÃ  danh sÃ¡ch cÃ¡c enum Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng.</p>
<hr />
<h3 id="1-token_type">1. <code>token_type</code><a class="headerlink" href="#1-token_type" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>GiÃ¡ trá»‹</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>access</code></td>
<td>Token truy cáº­p, cÃ³ thá»i háº¡n ngáº¯n (~15 phÃºt)</td>
</tr>
<tr>
<td><code>refresh</code></td>
<td>Token lÃ m má»›i, dÃ¹ng Ä‘á»ƒ láº¥y access token má»›i</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ” Enum nÃ y Ä‘Æ°á»£c dÃ¹ng trong response cá»§a <code>/v1/token/introspect</code> Ä‘á»ƒ phÃ¢n biá»‡t loáº¡i token Ä‘ang Ä‘Æ°á»£c kiá»ƒm tra.</p>
</blockquote>
<hr />
<h3 id="2-grant_type">2. <code>grant_type</code><a class="headerlink" href="#2-grant_type" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>GiÃ¡ trá»‹</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>password</code></td>
<td>ÄÄƒng nháº­p qua email/password truyá»n thá»‘ng</td>
</tr>
<tr>
<td><code>refresh_token</code></td>
<td>LÃ m má»›i token thÃ´ng qua refresh token</td>
</tr>
<tr>
<td><code>jwt_bearer</code></td>
<td>Grant flow ná»™i bá»™ sá»­ dá»¥ng JWT Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c thá»±c trÆ°á»›c Ä‘Ã³</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ”„ Enum nÃ y giÃºp má»Ÿ rá»™ng cho cÃ¡c luá»“ng xÃ¡c thá»±c OAuth2 trong tÆ°Æ¡ng lai.</p>
</blockquote>
<hr />
<h3 id="3-device_type">3. <code>device_type</code><a class="headerlink" href="#3-device_type" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>GiÃ¡ trá»‹</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>web</code></td>
<td>TrÃ¬nh duyá»‡t web thÃ´ng thÆ°á»ng</td>
</tr>
<tr>
<td><code>android</code></td>
<td>Thiáº¿t bá»‹ Android</td>
</tr>
<tr>
<td><code>ios</code></td>
<td>Thiáº¿t bá»‹ iOS</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ“± ÄÆ°á»£c dÃ¹ng trong metadata cá»§a <code>auth_sessions</code> vÃ  introspection response Ä‘á»ƒ phá»¥c vá»¥ thá»‘ng kÃª, cáº£nh bÃ¡o báº£o máº­t, vÃ  phÃ¢n tÃ­ch hÃ nh vi ngÆ°á»i dÃ¹ng.</p>
</blockquote>
<hr />
<h3 id="4-session_status-du-phong-cho-mo-rong-tuong-lai">4. <code>session_status</code> (dá»± phÃ²ng cho má»Ÿ rá»™ng tÆ°Æ¡ng lai)<a class="headerlink" href="#4-session_status-du-phong-cho-mo-rong-tuong-lai" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>GiÃ¡ trá»‹</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>active</code></td>
<td>PhiÃªn Ä‘ang hoáº¡t Ä‘á»™ng vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng</td>
</tr>
<tr>
<td><code>revoked</code></td>
<td>PhiÃªn Ä‘Ã£ bá»‹ thu há»“i bá»Ÿi ngÆ°á»i dÃ¹ng hoáº·c há»‡ thá»‘ng</td>
</tr>
<tr>
<td><code>expired</code></td>
<td>PhiÃªn Ä‘Ã£ háº¿t háº¡n theo thá»i gian cáº¥u hÃ¬nh</td>
</tr>
</tbody>
</table>
<blockquote>
<p>â³ Enum nÃ y sáº½ há»¯u Ã­ch náº¿u há»‡ thá»‘ng má»Ÿ rá»™ng logic quáº£n lÃ½ session nÃ¢ng cao.</p>
</blockquote>
<hr />
<h3 id="5-login_method">5. <code>login_method</code><a class="headerlink" href="#5-login_method" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>GiÃ¡ trá»‹</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>google</code></td>
<td>ÄÄƒng nháº­p báº±ng Google OAuth2</td>
</tr>
<tr>
<td><code>otp</code></td>
<td>ÄÄƒng nháº­p báº±ng mÃ£ OTP</td>
</tr>
<tr>
<td><code>local</code></td>
<td>ÄÄƒng nháº­p báº±ng tÃ i khoáº£n ná»™i bá»™</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ” DÃ¹ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh phÆ°Æ¡ng thá»©c xÃ¡c thá»±c Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng khi phÃ¡t hÃ nh token/session.</p>
</blockquote>
<hr />
<h2 id="permission-mapping">ğŸ“ Permission Mapping<a class="headerlink" href="#permission-mapping" title="Permanent link">Â¶</a></h2>
<p>Máº·c dÃ¹ <code>token-service</code> khÃ´ng trá»±c tiáº¿p quáº£n lÃ½ ngÆ°á»i dÃ¹ng hoáº·c phÃ¢n quyá»n truy cáº­p tÃ i nguyÃªn, nhÆ°ng váº«n cáº§n Ä‘á»‹nh nghÄ©a rÃµ cÃ¡c quyá»n (permissions) Ã¡p dá»¥ng cho cÃ¡c há»‡ thá»‘ng gá»i Ä‘áº¿n cÃ¡c endpoint Ä‘áº·c thÃ¹ nhÆ° introspect hoáº·c revoke. Äiá»u nÃ y Ä‘áº£m báº£o kiá»ƒm soÃ¡t truy cáº­p, tuÃ¢n thá»§ nguyÃªn táº¯c Principle of Least Privilege (ADR-004, ADR-006, ADR-007).</p>
<h2 id="note-event-names-follow-adr-030-v1">&gt; <strong>Note:</strong> Event names follow ADR-030 (*.v1)<a class="headerlink" href="#note-event-names-follow-adr-030-v1" title="Permanent link">Â¶</a></h2>
<h3 id="cac-permission-ap-dung-cho-token-service">ğŸ”’ CÃ¡c permission Ã¡p dá»¥ng cho <code>token-service</code><a class="headerlink" href="#cac-permission-ap-dung-cho-token-service" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Permission Key</th>
<th>MÃ´ táº£</th>
<th>Endpoint yÃªu cáº§u</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token.generate</code></td>
<td>Cho phÃ©p táº¡o access token / refresh token (ná»™i bá»™)</td>
<td><code>POST /v1/token</code></td>
</tr>
<tr>
<td><code>token.refresh</code></td>
<td>Cho phÃ©p lÃ m má»›i access token thÃ´ng qua refresh token</td>
<td><code>POST /v1/token/refresh</code></td>
</tr>
<tr>
<td><code>token.revoke</code></td>
<td>Cho phÃ©p thu há»“i (revoke) má»™t session token cá»¥ thá»ƒ</td>
<td><code>POST /v1/token/revoke</code></td>
</tr>
<tr>
<td><code>token.introspect</code></td>
<td>Cho phÃ©p kiá»ƒm tra thÃ´ng tin vÃ  tráº¡ng thÃ¡i cá»§a token</td>
<td><code>POST /v1/token/introspect</code></td>
</tr>
<tr>
<td><code>token.jwks.read</code></td>
<td>Quyá»n public, khÃ´ng cáº§n auth â€“ dÃ¹ng cho <code>GET /.well-known/jwks.json</code></td>
<td>âŒ (public)</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ğŸ“Œ Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, <code>token-service</code> hoáº¡t Ä‘á»™ng nhÆ° service ná»™i bá»™ nÃªn cÃ¡c quyá»n nÃ y Ä‘Æ°á»£c kiá»ƒm tra báº±ng service-to-service authentication (JWT cÃ³ embedded scope/permission claim).</p>
</blockquote>
<hr />
<h3 id="vi-du-cau-truc-claim-permissions-trong-access-token">ğŸ§© VÃ­ dá»¥ cáº¥u trÃºc claim <code>permissions</code> trong access token:<a class="headerlink" href="#vi-du-cau-truc-claim-permissions-trong-access-token" title="Permanent link">Â¶</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-abc-123&quot;</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;read write&quot;</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="s2">&quot;user.read&quot;</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="s2">&quot;token.introspect&quot;</span><span class="p">,</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="s2">&quot;token.revoke&quot;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dx-vas&quot;</span><span class="p">,</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1712345678</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="ap-dung-trong-openapi">âœ… Ãp dá»¥ng trong OpenAPI<a class="headerlink" href="#ap-dung-trong-openapi" title="Permanent link">Â¶</a></h3>
<p>Má»—i operation trong <code>openapi.yaml</code> nÃªn khai bÃ¡o custom field:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">x-required-permission</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">token.introspect</span>
</span></code></pre></div>
<p>Hoáº·c náº¿u operation khÃ´ng cáº§n quyá»n cá»¥ thá»ƒ (vÃ­ dá»¥: <code>/.well-known/jwks.json</code>) thÃ¬ <strong>khÃ´ng cáº§n khai bÃ¡o permission</strong>.</p>
<hr />
<h2 id="error-codes-envelope">ğŸ›¡ï¸ Error Codes &amp; Envelope<a class="headerlink" href="#error-codes-envelope" title="Permanent link">Â¶</a></h2>
<p>Táº¥t cáº£ lá»—i Ä‘Æ°á»£c tráº£ vá» dÆ°á»›i dáº¡ng chuáº©n <code>ErrorEnvelope</code> (ADR-011), Ä‘áº£m báº£o nháº¥t quÃ¡n trong toÃ n há»‡ thá»‘ng.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;token.expired&quot;</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Token has expired&quot;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3&quot;</span><span class="p">,</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-07T10:30:00Z&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="bang-ma-loi-chi-tiet">ğŸ”’ Báº£ng mÃ£ lá»—i chi tiáº¿t<a class="headerlink" href="#bang-ma-loi-chi-tiet" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>MÃ£ lá»—i (<code>error.code</code>)</th>
<th>MÃ´ táº£</th>
<th>HTTP Status</th>
<th>Ãp dá»¥ng cho endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>token.invalid</code></td>
<td>Access token khÃ´ng há»£p lá»‡</td>
<td>401</td>
<td><code>/v1/token/introspect</code></td>
</tr>
<tr>
<td><code>token.expired</code></td>
<td>Token Ä‘Ã£ háº¿t háº¡n</td>
<td>401</td>
<td><code>/v1/token/refresh</code>, introspect</td>
</tr>
<tr>
<td><code>token.revoked</code></td>
<td>Token Ä‘Ã£ bá»‹ thu há»“i</td>
<td>401</td>
<td><code>/v1/token/refresh</code>, introspect</td>
</tr>
<tr>
<td><code>token.unknown_jti</code></td>
<td>Token khÃ´ng náº±m trong danh sÃ¡ch thu há»“i</td>
<td>400</td>
<td><code>/v1/token/revoke</code></td>
</tr>
<tr>
<td><code>session.not_found</code></td>
<td>KhÃ´ng tÃ¬m tháº¥y phiÃªn Ä‘Äƒng nháº­p</td>
<td>404</td>
<td><code>/v1/token/revoke</code></td>
</tr>
<tr>
<td><code>session.inactive</code></td>
<td>PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ bá»‹ há»§y</td>
<td>403</td>
<td><code>/v1/token/refresh</code>, <code>/v1/token/revoke</code></td>
</tr>
<tr>
<td><code>jwks.not_found</code></td>
<td>KhÃ´ng tÃ¬m tháº¥y khoÃ¡ cÃ´ng khai JWKS</td>
<td>500</td>
<td><code>/.well-known/jwks.json</code></td>
</tr>
<tr>
<td><code>common.validation_error</code></td>
<td>Dá»¯ liá»‡u gá»­i lÃªn khÃ´ng há»£p lá»‡</td>
<td>400</td>
<td>Má»i endpoint <code>POST</code></td>
</tr>
<tr>
<td><code>common.missing_param</code></td>
<td>Thiáº¿u tham sá»‘ báº¯t buá»™c (<code>grant_type</code>, <code>refresh_token</code>)</td>
<td>400</td>
<td><code>/v1/token</code>, <code>/v1/token/refresh</code></td>
</tr>
<tr>
<td><code>common.unauthorized</code></td>
<td>Thiáº¿u token hoáº·c token khÃ´ng há»£p lá»‡</td>
<td>401</td>
<td>Táº¥t cáº£ endpoint báº£o vá»‡</td>
</tr>
<tr>
<td><code>common.forbidden</code></td>
<td>KhÃ´ng Ä‘á»§ quyá»n thá»±c hiá»‡n hÃ nh Ä‘á»™ng</td>
<td>403</td>
<td>Theo <code>x-required-permission</code></td>
</tr>
<tr>
<td><code>common.validation_error</code></td>
<td>JSON há»£p lá»‡ nhÆ°ng khÃ´ng thoáº£ Ä‘iá»u kiá»‡n nghiá»‡p vá»¥</td>
<td>422</td>
<td>Má»i endpoint</td>
</tr>
<tr>
<td><code>common.rate_limited</code></td>
<td>VÆ°á»£t ngÆ°á»¡ng RPS/burst (theo ADR-022)</td>
<td>429</td>
<td>Má»i endpoint</td>
</tr>
<tr>
<td><code>common.internal_error</code></td>
<td>Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh tá»« phÃ­a server</td>
<td>500</td>
<td>Má»i endpoint</td>
</tr>
</tbody>
</table>
<h4 id="response-headers-rate-limiting-adr-022">Response Headers â€“ Rate Limiting  <em>(ADR-022)</em><a class="headerlink" href="#response-headers-rate-limiting-adr-022" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Header</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RateLimit-Limit</code></td>
<td>Giá»›i háº¡n tá»‘i Ä‘a request trong 1 cá»­a sá»• (per tenant / client).</td>
<td><code>120</code></td>
</tr>
<tr>
<td><code>RateLimit-Remaining</code></td>
<td>Sá»‘ request cÃ²n láº¡i trong cá»­a sá»• hiá»‡n táº¡i. Chá»‰ xuáº¥t hiá»‡n khi cÃ²n &gt; 0.</td>
<td><code>17</code></td>
</tr>
<tr>
<td><code>Retry-After</code></td>
<td>Thá»i gian (giÃ¢y) cáº§n chá» trÆ°á»›c khi gá»­i láº¡i request, kÃ¨m theo HTTP 429.</td>
<td><code>42</code></td>
</tr>
</tbody>
</table>
<h2 id="header-ratelimit-remaining-va-retry-after-uoc-tra-ve-khi-gan-het-hoac-a-vuot-qua-nguong-tuan-theo-khuyen-nghi-adr-022-slaslo-monitoring">&gt; Header <code>RateLimit-Remaining</code> vÃ  <code>Retry-After</code> Ä‘Æ°á»£c tráº£ vá» khi <strong>gáº§n háº¿t</strong> hoáº·c Ä‘Ã£ vÆ°á»£t quÃ¡ ngÆ°á»¡ng, tuÃ¢n theo khuyáº¿n nghá»‹ <strong>ADR-022 SLA/SLO Monitoring</strong>.<a class="headerlink" href="#header-ratelimit-remaining-va-retry-after-uoc-tra-ve-khi-gan-het-hoac-a-vuot-qua-nguong-tuan-theo-khuyen-nghi-adr-022-slaslo-monitoring" title="Permanent link">Â¶</a></h2>
<p>ğŸ“Œ <strong>Má»i lá»—i Ä‘á»u tráº£ vá» kÃ¨m <code>X-Request-ID</code> trong response headers</strong> vÃ  Ä‘Æ°á»£c ghi log (audit + cloud logging).</p>
<hr />
<h2 id="vi-du-curl">ğŸ“ VÃ­ dá»¥ Curl<a class="headerlink" href="#vi-du-curl" title="Permanent link">Â¶</a></h2>
<p>DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c vÃ­ dá»¥ <code>curl</code> minh há»a cÃ¡ch sá»­ dá»¥ng cÃ¡c API chÃ­nh cá»§a <code>token-service</code>. CÃ¡c vÃ­ dá»¥ nÃ y dÃ¹ng Ä‘á»ƒ kiá»ƒm thá»­ nhanh, tÃ­ch há»£p CI pipeline, hoáº·c hÆ°á»›ng dáº«n frontend/backend team tÃ­ch há»£p.</p>
<hr />
<h3 id="1-ang-nhap-e-lay-token-moi">ğŸ”‘ 1. ÄÄƒng nháº­p Ä‘á»ƒ láº¥y token má»›i<a class="headerlink" href="#1-ang-nhap-e-lay-token-moi" title="Permanent link">Â¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-001&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-primary&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;service-token&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="s1">    &quot;sub&quot;: &quot;user-123&quot;,</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="s1">    &quot;roles&quot;: [&quot;teacher&quot;],</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="s1">    &quot;permissions&quot;: [&quot;report.view_login_by_tenant&quot;],</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="s1">    &quot;session_id&quot;: &quot;sess-abc-123&quot;,</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="s1">    &quot;login_method&quot;: &quot;otp&quot;,</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="s1">    &quot;session_metadata&quot;: {</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="s1">      &quot;ip&quot;: &quot;113.23.45.12&quot;,</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="s1">      &quot;device_type&quot;: &quot;android&quot;</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="s1">    }</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p>ğŸ“Œ <em>Tráº£ vá» access_token + refresh_token náº¿u há»£p lá»‡.</em></p>
<hr />
<h3 id="2-lam-moi-token">â™»ï¸ 2. LÃ m má»›i token<a class="headerlink" href="#2-lam-moi-token" title="Permanent link">Â¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token/refresh<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-002&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-truongvietanh&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="s1">    &quot;refresh_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsIn...&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p>ğŸ“Œ <em>Tráº£ vá» cáº·p token má»›i náº¿u refresh token há»£p lá»‡.</em></p>
<hr />
<h3 id="3-thu-hoi-token-logout-toan-bo-thiet-bi">ğŸ›‘ 3. Thu há»“i token (logout toÃ n bá»™ thiáº¿t bá»‹)<a class="headerlink" href="#3-thu-hoi-token-logout-toan-bo-thiet-bi" title="Permanent link">Â¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token/revoke<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;access_token&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-003&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-truongvietanh&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{}&#39;</span>
</span></code></pre></div>
<p>ğŸ“Œ <em>Thu há»“i session hiá»‡n táº¡i (access + refresh token).</em></p>
<hr />
<h3 id="4-kiem-tra-token-introspect">ğŸ§ 4. Kiá»ƒm tra token (introspect)<a class="headerlink" href="#4-kiem-tra-token-introspect" title="Permanent link">Â¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>https://api.truongvietanh.edu.vn/v1/token/introspect<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;access_token&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Request-ID: req-004&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-Tenant-ID: vas-truongvietanh&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="s1">    &quot;token&quot;: &quot;eyJhbGciOiJIUzI1NiIsIn...&quot;</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p>ğŸ“Œ <em>Tráº£ vá» thÃ´ng tin token, tráº¡ng thÃ¡i (active/revoked/expired), claims.</em></p>
<hr />
<h3 id="5-lay-jwks-key">ğŸ” 5. Láº¥y JWKS key<a class="headerlink" href="#5-lay-jwks-key" title="Permanent link">Â¶</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>https://api.truongvietanh.edu.vn/.well-known/jwks.json
</span></code></pre></div>
<p>ğŸ“Œ <em>Tráº£ vá» public key JWKS Ä‘á»ƒ há»‡ thá»‘ng khÃ¡c verify chá»¯ kÃ½ JWT.</em></p>
<hr />
<h3 id="ghi-chu">ğŸ§ª Ghi chÃº<a class="headerlink" href="#ghi-chu" title="Permanent link">Â¶</a></h3>
<ul>
<li><code>X-Request-ID</code> lÃ  báº¯t buá»™c Ä‘á»ƒ trace log.</li>
<li><code>X-Tenant-ID</code> giÃºp multi-tenant isolation (báº¯t buá»™c).</li>
<li>Báº¡n cÃ³ thá»ƒ test JWT validity vá»›i <a href="https://jwt.io">jwt.io</a>.</li>
<li>Token máº«u Ä‘á»ƒ test cÃ³ thá»ƒ láº¥y tá»« Auth Web hoáº·c Dev Tool gáº¯n vá»›i <code>auth-service</code>.</li>
</ul>
<hr />
<h2 id="tai-lieu-lien-quan">ğŸ“š TÃ i liá»‡u liÃªn quan<a class="headerlink" href="#tai-lieu-lien-quan" title="Permanent link">Â¶</a></h2>
<ul>
<li><a href="../design/">Design</a></li>
<li><a href="../data-model/">Data Model</a></li>
<li><a href="../openapi.yaml">OpenAPI Spec</a></li>
</ul>
<h3 id="cac-quyet-inh-kien-truc-adr">ğŸ”– CÃ¡c Quyáº¿t Ä‘á»‹nh Kiáº¿n trÃºc (ADR)<a class="headerlink" href="#cac-quyet-inh-kien-truc-adr" title="Permanent link">Â¶</a></h3>
<ul>
<li><a href="../../../ADR/adr-003-secrets/">ADR-003 Secrets Management</a>: Quy trÃ¬nh lÆ°u trá»¯ &amp; xoay khÃ³a bÃ­ máº­t an toÃ n.  </li>
<li><a href="../../../ADR/adr-004-security/">ADR-004 Security Policy</a>: ChÃ­nh sÃ¡ch báº£o máº­t tá»•ng thá»ƒ.  </li>
<li><a href="../../../ADR/adr-005-env-config/">ADR-005 Environment Configuration Strategy</a>: Chuáº©n tÃ¡ch cáº¥u hÃ¬nh â€“ <code>SERVICE__SECTION__KEY</code>.  </li>
<li><a href="../../../ADR/adr-006-auth-strategy/">ADR-006 Auth Strategy</a>: Chiáº¿n lÆ°á»£c xÃ¡c thá»±c ngÆ°á»i dÃ¹ng vÃ  cáº¥p phÃ¡t token.  </li>
<li><a href="../../../ADR/adr-009-api-governance/">ADR-009 API Governance</a>: Quy táº¯c versioning, naming vÃ  style REST.  </li>
<li><a href="../../../ADR/adr-011-api-error-format/">ADR-011 API Error Format</a>: Quy Æ°á»›c mÃ£ lá»—i &amp; thÃ´ng Ä‘iá»‡p lá»—i (<code>namespace.snake_case</code>).  </li>
<li><a href="../../../ADR/adr-012-response-structure/">ADR-012 Response Structure</a>: Chuáº©n hÃ³a cáº¥u trÃºc JSON response cho API.</li>
<li><a href="../../../ADR/adr-018-release-approval-policy/">ADR-018 Release Approval Policy</a>: Quy trÃ¬nh phÃª duyá»‡t phÃ¡t hÃ nh.</li>
<li><a href="../../../ADR/adr-022-sla-slo-monitoring/">ADR-022 SLA &amp; SLO Monitoring</a>: Khung giÃ¡m sÃ¡t &amp; Ä‘á»‹nh nghÄ©a SLO.</li>
<li><a href="../../../ADR/adr-023-schema-migration-strategy/">ADR-023 Schema Migration Strategy</a>: 3-phase migration (Prepare â†’ Transition â†’ Cleanup).  </li>
<li><a href="../../../ADR/adr-024-data-anonymization-retention/">ADR-024 Data Anonymization &amp; Retention</a>: áº¨n danh PII vÃ  TTL dá»¯ liá»‡u.  </li>
<li><a href="../../../ADR/adr-026-hard-delete-policy/">ADR-026 Hard-Delete Policy</a>: Quy trÃ¬nh xoÃ¡ vÄ©nh viá»…n &amp; purge log.  </li>
<li><a href="../../../ADR/adr-030-event-schema-governance/">ADR-030 Event Schema Governance</a>: Äáº·t tÃªn &amp; version sá»± kiá»‡n <code>*.v{n}</code>.</li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Trá»Ÿ láº¡i má»¥c lá»¥c
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>