# üìò [T√äN_SERVICE] ‚Äì Interface Contract

> **[H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG TEMPLATE N√ÄY:]**
> 1. Sao ch√©p to√†n b·ªô n·ªôi dung file n√†y v√†o m·ªôt file `interface-contract.md` m·ªõi trong th∆∞ m·ª•c service c·ªßa b·∫°n.
> 2. T√¨m v√† thay th·∫ø t·∫•t c·∫£ c√°c placeholder c√≥ d·∫°ng `[PLACEHOLDER]` ho·∫∑c c√°c comment `TODO:` b·∫±ng th√¥ng tin c·ª• th·ªÉ c·ªßa service b·∫°n.
> 3. X√≥a c√°c kh·ªëi h∆∞·ªõng d·∫´n (nh∆∞ kh·ªëi n√†y) ho·∫∑c c√°c comment kh√¥ng c·∫ßn thi·∫øt sau khi ƒë√£ ƒëi·ªÅn th√¥ng tin.
> 4. ƒê·∫£m b·∫£o t√†i li·ªáu c·ªßa b·∫°n r√µ r√†ng, chi ti·∫øt v√† tu√¢n th·ªß "Checklist Ti√™u Chu·∫©n 5‚òÖ cho File interface-contract.md".
> 5. Lu√¥n tham chi·∫øu ƒë·∫øn c√°c t√†i li·ªáu li√™n quan nh∆∞ `design.md`, `data-model.md`, `openapi.yaml` v√† c√°c ADRs.

* T√†i li·ªáu n√†y m√¥ t·∫£ c√°c API ch√≠nh m√† **[T√äN_SERVICE]** cung c·∫•p, theo phong c√°ch d·ªÖ ƒë·ªçc cho developer (backend/frontend) v√† c√°c b√™n li√™n quan. ƒê·∫∑c t·∫£ k·ªπ thu·∫≠t chi ti·∫øt (chu·∫©n m√°y ƒë·ªçc) xem th√™m t·∫°i [`openapi.yaml`](./openapi.yaml).
* _Ph·∫°m vi (Scope):_
[TODO: M√¥ t·∫£ ng·∫Øn g·ªçn ph·∫°m vi c·ªßa service n√†y. N√≥ qu·∫£n l√Ω nh·ªØng g√¨? N√≥ ph·ª•c v·ª• m·ª•c ƒë√≠ch g√¨ trong h·ªá th·ªëng t·ªïng th·ªÉ? N√≥ KH√îNG qu·∫£n l√Ω nh·ªØng g√¨ ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n v·ªõi c√°c service kh√°c?]
[V√≠ d·ª•: Service n√†y qu·∫£n l√Ω ƒë·ªãnh danh to√†n c·ª•c ng∆∞·ªùi d√πng, th√¥ng tin tenant, v√† c√°c template RBAC to√†n c·ª•c. N√≥ kh√¥ng qu·∫£n l√Ω RBAC c·ª•c b·ªô c·ªßa t·ª´ng tenant (xem Sub User Service).]

> üß≠ **Nguy√™n t·∫Øc chung (General Principles):**
> > > - V·ªõi c√°c API `PATCH`, h·ªá th·ªëng m·∫∑c ƒë·ªãnh tr·∫£ v·ªÅ `204 No Content` n·∫øu c·∫≠p nh·∫≠t th√†nh c√¥ng v√† kh√¥ng c√≥ n·ªôi dung body c·∫ßn tr·∫£ v·ªÅ, ƒë·ªÉ t·ªëi ∆∞u hi·ªáu nƒÉng v√† ƒë∆°n gi·∫£n h√≥a x·ª≠ l√Ω ph√≠a client. N·∫øu client c·∫ßn object m·ªõi nh·∫•t, n√™n th·ª±c hi·ªán `GET` sau khi c·∫≠p nh·∫≠t. (Tham kh·∫£o ADR-XYZ n·∫øu c√≥).
> - T·∫•t c·∫£ c√°c API ƒë·ªÅu y√™u c·∫ßu header `Authorization: Bearer <JWT>` tr·ª´ khi ƒë∆∞·ª£c ghi ch√∫ l√† `public`.
> - T·∫•t c·∫£ response body ƒë·ªÅu tu√¢n th·ªß c·∫•u tr√∫c chu·∫©n trong [ADR-012 Response Structure](../../../ADR/adr-012-response-structure.md).
> - T·∫•t c·∫£ l·ªói tr·∫£ v·ªÅ ƒë·ªÅu tu√¢n th·ªß ƒë·ªãnh d·∫°ng trong [ADR-011 Error Format](../../../ADR/adr-011-api-error-format.md).

---

## üìå API: `/[RESOURCE_GROUP_1]`
> **[H∆Ø·ªöNG D·∫™N:]**
> - Nh√≥m c√°c API theo t√†i nguy√™n ch√≠nh m√† ch√∫ng qu·∫£n l√Ω.
> - Cung c·∫•p b·∫£ng t√≥m t·∫Øt c√°c API trong nh√≥m n√†y.

Danh s√°ch c√°c API ph·ª•c v·ª• qu·∫£n l√Ω [M√¥ t·∫£ ng·∫Øn v·ªÅ resource group 1].

| Method | Path                                      | M√¥ t·∫£                                              | Quy·ªÅn (RBAC Permission Code)        |
| :----- | :---------------------------------------- | :------------------------------------------------- | :---------------------------------- |
| GET    | `/[resource_group_1]/{id}`                | [TODO: L·∫•y th√¥ng tin chi ti·∫øt c·ªßa m·ªôt resource]     | `[scope].read.[resource]`           |
| GET    | `/[resource_group_1]/lookup?key=value`    | [TODO: Tra c·ª©u resource theo m·ªôt thu·ªôc t√≠nh kh√°c] | `[scope].read.[resource_alternative]` |
| POST   | `/[resource_group_1]`                     | [TODO: T·∫°o m·ªõi m·ªôt resource]                       | `[scope].create.[resource]`         |
| PATCH  | `/[resource_group_1]/{id}`                | [TODO: C·∫≠p nh·∫≠t th√¥ng tin m·ªôt resource]             | `[scope].update.[resource]`         |
| DELETE | `/[resource_group_1]/{id}`                | [TODO: X√≥a m·ªôt resource (soft delete/hard delete)] | `[scope].delete.[resource]`         |
---

### üß™ Chi ti·∫øt API

> **[H∆Ø·ªöNG D·∫™N:]**
> - L·∫∑p l·∫°i c·∫•u tr√∫c n√†y cho t·ª´ng API ƒë√£ li·ªát k√™ trong b·∫£ng t√≥m t·∫Øt ·ªü tr√™n.
> - Cung c·∫•p ƒë·∫ßy ƒë·ªß th√¥ng tin: m√¥ t·∫£, tham s·ªë (n·∫øu c√≥), request body (n·∫øu c√≥) k√®m v√≠ d·ª•, response body (cho c·∫£ th√†nh c√¥ng v√† l·ªói ƒëi·ªÉn h√¨nh) k√®m v√≠ d·ª•, v√† c√°c s·ª± ki·ªán ƒë∆∞·ª£c ph√°t ra (n·∫øu c√≥).

#### 1. GET `/[resource_group_1]/{id}`
[TODO: M√¥ t·∫£ chi ti·∫øt m·ª•c ƒë√≠ch v√† h√†nh vi c·ªßa API n√†y. V√≠ d·ª•: Tr·∫£ v·ªÅ th√¥ng tin chi ti·∫øt c·ªßa m·ªôt [resource_name] d·ª±a tr√™n ID ƒë∆∞·ª£c cung c·∫•p.]

**Path Parameters:**
-   `{id}`: [Ki·ªÉu d·ªØ li·ªáu, v√≠ d·ª•: string (UUID)], b·∫Øt bu·ªôc. [TODO: M√¥ t·∫£ √Ω nghƒ©a c·ªßa path parameter n√†y].

**Response m·∫´u (200 OK):**
```json
{
  "data": {
    "id": "uuid-cua-resource",
    "[field_1]": "[value_1]",
    "[field_2]": "[value_2]"
    // ... c√°c tr∆∞·ªùng kh√°c c·ªßa resource
  },
  "meta": {
    "request_id": "req-abc-123",
    "timestamp": "YYYY-MM-DDTHH:mm:ssZ"
  }
}
````

**C√°c Status Codes c√≥ th·ªÉ c√≥:**

  - `200 OK`: Th√†nh c√¥ng, tr·∫£ v·ªÅ th√¥ng tin resource.
  - `401 Unauthorized`: Ch∆∞a x√°c th·ª±c.
  - `403 Forbidden`: Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p.
  - `404 Not Found`: Kh√¥ng t√¨m th·∫•y resource v·ªõi ID cung c·∫•p.
  - `500 Internal Server Error`: L·ªói h·ªá th·ªëng.

-----

#### 2\. GET `/[resource_group_1]/lookup?key=value`

[TODO: M√¥ t·∫£ chi ti·∫øt m·ª•c ƒë√≠ch v√† h√†nh vi c·ªßa API n√†y. V√≠ d·ª•: S·ª≠ d·ª•ng ƒë·ªÉ tra c·ª©u [resource\_name] d·ª±a tr√™n [key\_name] thay v√¨ ID ch√≠nh.]

**Query Parameters:**

  - `[key_name]`: [Ki·ªÉu d·ªØ li·ªáu, v√≠ d·ª•: string], b·∫Øt bu·ªôc. [TODO: M√¥ t·∫£ √Ω nghƒ©a c·ªßa query parameter n√†y].

**Response m·∫´u (200 OK):**

```json
{
  "data": {
    "id": "uuid-cua-resource",
    "[field_1]": "[value_1]",
    "[field_2]": "[value_2]"
  },
  "meta": {
    // ...
  }
}
```

**C√°c Status Codes c√≥ th·ªÉ c√≥:** 200, 400 (n·∫øu query param thi·∫øu/sai), 401, 403, 404, 500.

-----

#### 3\. POST `/[resource_group_1]`

[TODO: M√¥ t·∫£ chi ti·∫øt m·ª•c ƒë√≠ch v√† h√†nh vi c·ªßa API n√†y. V√≠ d·ª•: T·∫°o m·ªõi m·ªôt [resource\_name].]

**Request body:**

```json
{
  "[field_1_cho_create]": "[value_1]",
  "[field_2_cho_create]": "[value_2]"
  // ... c√°c tr∆∞·ªùng kh√°c c·∫ßn ƒë·ªÉ t·∫°o resource
}
```

**Response m·∫´u (201 Created):**

```json
{
  "data": {
    "id": "uuid-moi-cua-resource",
    "[field_1_cho_create]": "[value_1]",
    "[field_2_cho_create]": "[value_2]"
    // ... c√°c tr∆∞·ªùng kh√°c c·ªßa resource v·ª´a t·∫°o
  },
  "meta": {
    // ...
  }
}
```

**Ph√°t s·ª± ki·ªán (Emitted Events):**

  - `[resource_name]_created` (n·∫øu c√≥)
      * **Payload v√≠ d·ª•:**
        ```json
        {
          "event_type": "[resource_name]_created",
          "data": { "id": "uuid-moi-cua-resource", "[field_1]": "[value_1]" },
          "metadata": { "event_id": "uuid-event", "timestamp": "...", "actor_id": "..." }
        }
        ```

**C√°c Status Codes c√≥ th·ªÉ c√≥:** 201, 400 (validation error), 401, 403, 409 (conflict, n·∫øu resource ƒë√£ t·ªìn t·∫°i v·ªõi key duy nh·∫•t), 500.

-----

#### 4\. PATCH `/[resource_group_1]/{id}`

[TODO: M√¥ t·∫£ chi ti·∫øt m·ª•c ƒë√≠ch v√† h√†nh vi c·ªßa API n√†y. V√≠ d·ª•: C·∫≠p nh·∫≠t m·ªôt ph·∫ßn th√¥ng tin c·ªßa [resource\_name] ƒë√£ t·ªìn t·∫°i.]

**Path Parameters:**

  - `{id}`: [Ki·ªÉu d·ªØ li·ªáu], b·∫Øt bu·ªôc. [TODO: M√¥ t·∫£].

**Request body:**

```json
{
  "[field_co_the_cap_nhat_1]": "[gia_tri_moi_1]",
  "[field_co_the_cap_nhat_2]": "[gia_tri_moi_2]"
}
```

**Response (204 No Content ho·∫∑c 200 OK v·ªõi resource ƒë√£ c·∫≠p nh·∫≠t):**

  - `204 No Content` (n·∫øu kh√¥ng c√≥ body tr·∫£ v·ªÅ)
  - Ho·∫∑c (n·∫øu tr·∫£ v·ªÅ resource ƒë√£ c·∫≠p nh·∫≠t):
    ```json
    {
      "data": {
        "id": "uuid-cua-resource",
        "[field_co_the_cap_nhat_1]": "[gia_tri_moi_1]",
        // ... c√°c tr∆∞·ªùng kh√°c
      },
      "meta": {
        // ...
      }
    }
    ```

**Ph√°t s·ª± ki·ªán (Emitted Events):**

  - `[resource_name]_updated` (n·∫øu c√≥)

**C√°c Status Codes c√≥ th·ªÉ c√≥:** 204/200, 400, 401, 403, 404, 409 (n·∫øu c·∫≠p nh·∫≠t g√¢y conflict), 500.

-----

üîí **L∆∞u √Ω quy·ªÅn truy c·∫≠p cho Resource Group n√†y:**

  - [TODO: V√≠ d·ª•: C√°c API n√†y th∆∞·ªùng ƒë∆∞·ª£c g·ªçi b·ªüi [Actor1] ho·∫∑c b·ªüi [Actor2] v·ªõi quy·ªÅn [PermissionScope] ph√π h·ª£p.]

üìö **Xem th√™m t√†i li·ªáu li√™n quan cho Resource Group n√†y:**

  - [`design.md`](./design.md\#[Link t·ªõi m·ª•c li√™n quan trong design.md])
  - [`data-model.md`](./data-model.md\#[Link t·ªõi b·∫£ng li√™n quan trong data-model.md])

-----

-----

## üìå Ch√∫ th√≠ch ƒê·ªãnh d·∫°ng Response & L·ªói

T·∫•t c·∫£ c√°c API tu√¢n theo chu·∫©n ph·∫£n h·ªìi th·ªëng nh·∫•t (xem [li√™n k·∫øt ƒë√°ng ng·ªù ƒë√£ b·ªã x√≥a]):

### ‚úÖ Response Th√†nh c√¥ng (`200 OK`, `201 Created`, `204 No Content`, v.v.)

```json
// V√≠ d·ª• cho response c√≥ body (200 OK, 201 Created)
{
  "data": { /* D·ªØ li·ªáu c·ª• th·ªÉ c·ªßa response */ },
  "meta": {
    "request_id": "uuid-request-id",
    "timestamp": "YYYY-MM-DDTHH:mm:ssZ"
    // ... c√°c tr∆∞·ªùng meta kh√°c nh∆∞ pagination n·∫øu c√≥ ...
  },
  "error": null // Lu√¥n l√† null khi th√†nh c√¥ng
}
```

> ƒê·ªëi v·ªõi `204 No Content`, s·∫Ω kh√¥ng c√≥ response body.

### ‚ùå Response L·ªói (4xx/5xx)

```json
{
  "data": null, // Lu√¥n l√† null khi c√≥ l·ªói
  "meta": {
    "request_id": "uuid-request-id",
    "timestamp": "YYYY-MM-DDTHH:mm:ssZ"
  },
  "error": {
    "code": "[ERROR_CODE_STRING]", // V√≠ d·ª•: "RESOURCE_NOT_FOUND", "VALIDATION_ERROR"
    "message": "[M√¥ t·∫£ l·ªói th√¢n thi·ªán v·ªõi ng∆∞·ªùi d√πng ho·∫∑c developer]",
    "details": { /* (T√πy ch·ªçn) Chi ti·∫øt l·ªói c·ª• th·ªÉ, v√≠ d·ª•: l·ªói validation cho t·ª´ng tr∆∞·ªùng */ }
  }
}
```

Xem chi ti·∫øt danh s√°ch m√£ l·ªói v√† c·∫•u tr√∫c `details` t·∫°i [li√™n k·∫øt ƒë√°ng ng·ªù ƒë√£ b·ªã x√≥a].

-----

## üîö K·∫øt lu·∫≠n

T√†i li·ªáu n√†y ƒë·ªãnh nghƒ©a r√µ r√†ng c√°c h·ª£p ƒë·ªìng giao di·ªán (interface contract) c·ªßa **[T√äN\_SERVICE]**, bao g·ªìm:

  - Qu·∫£n l√Ω `[RESOURCE_GROUP_1]` (API group `/resource_group_1`)
  - [TODO: Li·ªát k√™ c√°c resource group kh√°c]

M·ªçi API ƒë·ªÅu √°p d·ª•ng chu·∫©n ph·∫£n h·ªìi th·ªëng nh·∫•t v√† c∆° ch·∫ø ph√¢n quy·ªÅn linh ho·∫°t d·ª±a tr√™n RBAC ƒë√£ ƒë∆∞·ª£c m√¥ t·∫£ trong [`design.md`](https://www.google.com/search?q=./design.md) v√† c√°c t√†i li·ªáu ki·∫øn tr√∫c li√™n quan c·ªßa h·ªá th·ªëng dx-vas.

üëâ **C√°c API n√†y l√† n·ªÅn t·∫£ng ƒë·ªÉ [m√¥ t·∫£ vai tr√≤ c·ªßa service trong h·ªá th·ªëng t·ªïng th·ªÉ, v√≠ d·ª•: c√°c service kh√°c t∆∞∆°ng t√°c, ho·∫∑c Superadmin Webapp ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh v√† m·ªü r·ªông linh ho·∫°t].**

-----

## üìå Ph·ª• l·ª•c: C√°c ENUM s·ª≠ d·ª•ng trong [T√äN\_SERVICE]

> **[H∆Ø·ªöNG D·∫™N:]**
>
>   - Li·ªát k√™ t·∫•t c·∫£ c√°c ENUM ƒë∆∞·ª£c s·ª≠ d·ª•ng trong request/response c·ªßa c√°c API thu·ªôc service n√†y.
>   - ƒêi·ªÅu n√†y r·∫•t quan tr·ªçng ƒë·ªÉ ƒë·∫£m b·∫£o client hi·ªÉu ƒë√∫ng c√°c gi√° tr·ªã c√≥ th·ªÉ c√≥.

| T√™n tr∆∞·ªùng (Field Name) | Enum gi√° tr·ªã h·ª£p l·ªá                | M√¥ t·∫£                                                                 |
| :---------------------- | :--------------------------------- | :------------------------------------------------------------------- |
| `[t√™n_tr∆∞·ªùng_enum_1]` | `value1`, `value2`, `value3`       | [TODO: M√¥ t·∫£ √Ω nghƒ©a c·ªßa ENUM n√†y v√† t·ª´ng gi√° tr·ªã.]                    |
| `[t√™n_tr∆∞·ªùng_enum_2]` | `option_a`, `option_b`             | [TODO: M√¥ t·∫£.]                                                       |
**Ghi ch√∫:** C√°c ENUM n√†y n√™n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a t·∫≠p trung trong codebase backend ƒë·ªÉ t√°i s·ª≠ d·ª•ng (v√≠ d·ª•: constant ho·∫∑c enum class), ƒë·ªìng th·ªùi ƒë∆∞·ª£c ph·∫£n √°nh r√µ trong `openapi.yaml` v√† c√°c v√≠ d·ª• minh ho·∫° ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh th·ªëng nh·∫•t gi·ªØa backend, frontend v√† h·ªá th·ªëng t√†i li·ªáu.

-----

## üìé Ph·ª• l·ª•c: B·∫£ng Permission Code cho [T√äN\_SERVICE]

> **[H∆Ø·ªöNG D·∫™N:]**
>
>   - Li·ªát k√™ t·∫•t c·∫£ c√°c permission code (RBAC) m√† c√°c API c·ªßa service n√†y y√™u c·∫ßu ho·∫∑c li√™n quan ƒë·∫øn.
>   - B·∫£ng n√†y gi√∫p qu·∫£n l√Ω t·∫≠p trung v√† d·ªÖ d√†ng tham chi·∫øu khi c·∫•u h√¨nh RBAC.

| `permission_code`                  | M√¥ t·∫£ ng·∫Øn g·ªçn                                        | S·ª≠ d·ª•ng b·ªüi API (v√≠ d·ª•)                       | `action` (∆∞·ªõc l∆∞·ª£ng) | `resource` (∆∞·ªõc l∆∞·ª£ng) | `default_condition` (n·∫øu c√≥) |
| :--------------------------------- | :----------------------------------------------------- | :-------------------------------------------- | :------------------ | :--------------------- | :-------------------------- |
| `[scope].read.[resource]`          | [TODO: Xem th√¥ng tin [resource]]                       | `GET /[resource_group_1]/{id}`                | `read`              | `[resource]`           | `null`                      |
| `[scope].create.[resource]`        | [TODO: T·∫°o m·ªõi [resource]]                             | `POST /[resource_group_1]`                    | `create`            | `[resource]`           | `null`                      |
| `[scope].update.[resource]`        | [TODO: C·∫≠p nh·∫≠t [resource]]                            | `PATCH /[resource_group_1]/{id}`              | `update`            | `[resource]`           | `null`                      |
| `[scope].delete.[resource]`        | [TODO: X√≥a [resource]]                                 | `DELETE /[resource_group_1]/{id}`             | `delete`            | `[resource]`           | `null`                      |
| `[scope].view_[config_resource]`   | [TODO: Xem c·∫•u h√¨nh [config\_resource]]                 | `GET /[config_resource_collection]`           | `read`              | `[config_resource]`    | `null`                      |

> üîí **Ghi ch√∫:** C√°c permission n√†y ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a v√† qu·∫£n l√Ω b·ªüi [Service n√†o, v√≠ d·ª•: User Service Master] v√† c√≥ th·ªÉ ƒë∆∞·ª£c √°nh x·∫° xu·ªëng t·ª´ng tenant th√¥ng qua [C∆° ch·∫ø n√†o, v√≠ d·ª•: Sub User Service] n·∫øu c·∫ßn thi·∫øt. C√°c `default_condition` (n·∫øu c√≥) s·∫Ω ƒë∆∞·ª£c m√¥ t·∫£ chi ti·∫øt trong ƒë·∫∑c t·∫£ RBAC c·ªßa h·ªá th·ªëng.

-----

üìé ƒê·ªÉ bi·∫øt chi ti·∫øt lu·ªìng nghi·ªáp v·ª•: xem [`design.md`](./design.md)

üì¶ ƒê·ªÉ tra c·ª©u schema CSDL chi ti·∫øt: xem [`data-model.md`](./data-model.md)

-----
