---
title: [T√äN_SERVICE_C·ª¶A_B·∫†N] - Data Model
version: "1.0"
last_updated: ["YYYY-MM-DD"]
author: "DX VAS Team"
reviewed_by: "Stephen Le"
---
# üóÉÔ∏è [T√äN_SERVICE_C·ª¶A_B·∫†N] - Data Model

> **[H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG TEMPLATE N√ÄY:]**
> 1. Sao ch√©p to√†n b·ªô n·ªôi dung file n√†y v√†o m·ªôt file `data-model.md` m·ªõi trong th∆∞ m·ª•c service c·ªßa b·∫°n.
> 2. T√¨m v√† thay th·∫ø t·∫•t c·∫£ c√°c placeholder c√≥ d·∫°ng `[PLACEHOLDER]` ho·∫∑c c√°c comment `TODO:` b·∫±ng th√¥ng tin c·ª• th·ªÉ c·ªßa service b·∫°n.
> 3. X√≥a c√°c kh·ªëi h∆∞·ªõng d·∫´n (nh∆∞ kh·ªëi n√†y) ho·∫∑c c√°c comment kh√¥ng c·∫ßn thi·∫øt sau khi ƒë√£ ƒëi·ªÅn th√¥ng tin.
> 4. ƒê·∫£m b·∫£o t√†i li·ªáu c·ªßa b·∫°n r√µ r√†ng, chi ti·∫øt v√† tu√¢n th·ªß "Checklist Ti√™u Chu·∫©n 5‚òÖ cho File data-model.md".
> 5. Lu√¥n tham chi·∫øu ƒë·∫øn c√°c t√†i li·ªáu li√™n quan nh∆∞ `design.md`, `interface-contract.md`, `openapi.yaml` v√† c√°c ADRs.

## 1. Gi·ªõi thi·ªáu

> **[H∆Ø·ªöNG D·∫™N - M·ª§C 1: GI·ªöI THI·ªÜU]**
> - N√™u r√µ t√™n service v√† vai tr√≤ c·ªßa t√†i li·ªáu m√¥ h√¨nh d·ªØ li·ªáu n√†y.
> - M√¥ t·∫£ ng·∫Øn g·ªçn b·ªëi c·∫£nh ho·∫°t ƒë·ªông c·ªßa service (v√≠ d·ª•: multi-tenant, core service, sub service).
> - Li·ªát k√™ c√°c tr√°ch nhi·ªám ch√≠nh c·ªßa service li√™n quan ƒë·∫øn d·ªØ li·ªáu.
> - V√≠ d·ª• t·ª´ User Service Master: "T√†i li·ªáu n√†y m√¥ t·∫£ chi ti·∫øt m√¥ h√¨nh d·ªØ li·ªáu c·ªßa User Service Master... Service n√†y ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω ƒë·ªãnh danh to√†n c·ª•c ng∆∞·ªùi d√πng, th√¥ng tin tenant, v√† m·∫´u vai tr√≤/quy·ªÅn to√†n c·ª•c (RBAC templates)."

T√†i li·ªáu n√†y m√¥ t·∫£ chi ti·∫øt m√¥ h√¨nh d·ªØ li·ªáu c·ªßa **[T√äN_SERVICE_C·ª¶A_B·∫†N]**. Service n√†y l√† m·ªôt th√†nh ph·∫ßn [TODO: m√¥ t·∫£ vai tr√≤ c·ªßa service, v√≠ d·ª•: c·ªët l√µi, ph·ª• tr·ª£] trong h·ªá th·ªëng `dx-vas`, ho·∫°t ƒë·ªông theo ki·∫øn tr√∫c [TODO: v√≠ d·ª•: multi-tenant, event-driven].

**[T√äN_SERVICE_C·ª¶A_B·∫†N]** ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω c√°c lo·∫°i d·ªØ li·ªáu ch√≠nh sau:
-   [TODO: Lo·∫°i d·ªØ li·ªáu 1, v√≠ d·ª•: ƒê·ªãnh danh ng∆∞·ªùi d√πng to√†n c·ª•c (`users_global`)]
-   [TODO: Lo·∫°i d·ªØ li·ªáu 2, v√≠ d·ª•: Th√¥ng tin tenant (`tenants`)]
-   [TODO: Lo·∫°i d·ªØ li·ªáu 3, v√≠ d·ª•: C√°c phi√™n l√†m vi·ªác (`auth_sessions`)]

M√¥ h√¨nh d·ªØ li·ªáu n√†y l√† c∆° s·ªü cho vi·ªác ph√°t tri·ªÉn backend, ƒë·ªãnh nghƒ©a API, th·ª±c hi·ªán migration c∆° s·ªü d·ªØ li·ªáu, v√† ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n d·ªØ li·ªáu trong service.

## 2. Ph·∫°m vi D·ªØ li·ªáu Qu·∫£n l√Ω (Scope)

> **[H∆Ø·ªöNG D·∫™N - M·ª§C 2: PH·∫†M VI]**
> Li·ªát k√™ c·ª• th·ªÉ h∆°n c√°c nh√≥m ch·ª©c nƒÉng ho·∫∑c c√°c lo·∫°i d·ªØ li·ªáu m√† service n√†y qu·∫£n l√Ω.

**[T√äN_SERVICE_C·ª¶A_B·∫†N]** bao g·ªìm vi·ªác qu·∫£n l√Ω:
-   [TODO: Ch·ª©c nƒÉng/d·ªØ li·ªáu 1, v√≠ d·ª•: Ng∆∞·ªùi d√πng to√†n h·ªá th·ªëng (`users_global`).]
-   [TODO: Ch·ª©c nƒÉng/d·ªØ li·ªáu 2, v√≠ d·ª•: Danh s√°ch tenant (`tenants`) v√† tr·∫°ng th√°i c·ªßa tenant.]
-   [TODO: Ch·ª©c nƒÉng/d·ªØ li·ªáu 3, v√≠ d·ª•: Vi·ªác g√°n ng∆∞·ªùi d√πng v√†o tenant (`user_tenant_assignments`).]
-   [TODO: Ch·ª©c nƒÉng/d·ªØ li·ªáu 4, v√≠ d·ª•: Ph√°t s·ª± ki·ªán li√™n quan ƒë·∫øn thay ƒë·ªïi d·ªØ li·ªáu.]

## 3. Ngo√†i Ph·∫°m Vi (Out of Scope)

> **[H∆Ø·ªöNG D·∫™N - M·ª§C 3: NGO√ÄI PH·∫†M VI]**
> Li·ªát k√™ r√µ r√†ng nh·ªØng g√¨ service n√†y KH√îNG qu·∫£n l√Ω v·ªÅ m·∫∑t d·ªØ li·ªáu ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n.

**[T√äN_SERVICE_C·ª¶A_B·∫†N]** **kh√¥ng** ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω:
-   ‚ùå [TODO: D·ªØ li·ªáu/Ch·ª©c nƒÉng 1, v√≠ d·ª•: Qu·∫£n l√Ω ng∆∞·ªùi d√πng n·ªôi b·ªô c·ªßa t·ª´ng tenant (thu·ªôc v·ªÅ Sub User Service).]
-   ‚ùå [TODO: D·ªØ li·ªáu/Ch·ª©c nƒÉng 2, v√≠ d·ª•: X·ª≠ l√Ω x√°c th·ª±c ƒëƒÉng nh·∫≠p (thu·ªôc v·ªÅ Auth Services).]
-   ‚ùå [TODO: D·ªØ li·ªáu/Ch·ª©c nƒÉng 3, v√≠ d·ª•: D·ªØ li·ªáu nghi·ªáp v·ª• chi ti·∫øt c·ªßa t·ª´ng tenant (h·ªçc ph√≠, ƒëi·ªÉm s·ªë...).]

## 4. M·ª•c ti√™u c·ªßa T√†i li·ªáu M√¥ h√¨nh D·ªØ li·ªáu

> **[H∆Ø·ªöNG D·∫™N - M·ª§C 4: M·ª§C TI√äU T√ÄI LI·ªÜU]**
> N√™u r√µ m·ª•c ƒë√≠ch c·ªßa vi·ªác t·∫°o ra t√†i li·ªáu n√†y.

-   Tr√¨nh b√†y c·∫•u tr√∫c c√°c b·∫£ng d·ªØ li·ªáu c·ªët l√µi c·ªßa **[T√äN_SERVICE_C·ª¶A_B·∫†N]**.
-   M√¥ t·∫£ c√°c r√†ng bu·ªôc d·ªØ li·ªáu (constraints), kh√≥a ch√≠nh/ngo·∫°i, ch·ªâ m·ª•c (indexes).
-   H·ªó tr·ª£ cho qu√° tr√¨nh ph√°t tri·ªÉn backend, vi·∫øt ƒë·∫∑c t·∫£ OpenAPI, th·ª±c hi·ªán schema migration, ki·ªÉm th·ª≠ v√† b·∫£o tr√¨ service.
-   L√†m n·ªÅn t·∫£ng ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n schema v·ªõi c√°c t√†i li·ªáu li√™n quan nh∆∞ `design.md`, `interface-contract.md`, `openapi.yaml`, v√† c√°c ADRs c·ªßa h·ªá th·ªëng (v√≠ d·ª•: [ADR-007 RBAC Strategy], [ADR-027 Data Management Strategy]).

---

## 5. S∆° ƒë·ªì ERD (Entity Relationship Diagram)

> **[H∆Ø·ªöNG D·∫™N - M·ª§C 5: S∆† ƒê·ªí ERD]**
> - Cung c·∫•p m·ªôt s∆° ƒë·ªì ERD tr·ª±c quan th·ªÉ hi·ªán t·∫•t c·∫£ c√°c b·∫£ng ch√≠nh c·ªßa service v√† m·ªëi quan h·ªá gi·ªØa ch√∫ng.
> - N√™n s·ª≠ d·ª•ng Mermaid ƒë·ªÉ d·ªÖ d√†ng nh√∫ng v√† c·∫≠p nh·∫≠t.
> - Bao g·ªìm c√°c th·ª±c th·ªÉ, thu·ªôc t√≠nh ch√≠nh, kh√≥a ch√≠nh (PK), kh√≥a ngo·∫°i (FK), v√† c√°c lo·∫°i quan h·ªá (1-1, 1-n, n-n).
> - Th√™m ghi ch√∫ cho ERD n·∫øu c√≥ nh·ªØng ƒëi·ªÉm c·∫ßn l√†m r√µ (v√≠ d·ª•: ki·ªÉu d·ªØ li·ªáu ƒë·∫∑c bi·ªát trong Mermaid, m·ªëi quan h·ªá logic).
> - V√≠ d·ª• t·ª´ User Service Master ƒë√£ r·∫•t t·ªët.

```mermaid
erDiagram
    // TODO: V·∫Ω ERD cho service c·ªßa b·∫°n t·∫°i ƒë√¢y.
    // V√≠ d·ª•:
    TABLE_A {
        string id PK
        string field_a1
        string field_a2
    }
    TABLE_B {
        string id PK
        string table_a_id FK
        string field_b1
    }
    TABLE_A ||--o{ TABLE_B : "c√≥ th·ªÉ c√≥ nhi·ªÅu"

    // V√≠ d·ª• t·ª´ User Service Master:
    /*
    USERS_GLOBAL {
        UUID user_id PK
        TEXT full_name
        TEXT email
        TEXT auth_provider
        // ... c√°c tr∆∞·ªùng kh√°c
    }
    TENANTS {
        TEXT tenant_id PK
        TEXT tenant_name
        TEXT status
        // ... c√°c tr∆∞·ªùng kh√°c
    }
    USER_TENANT_ASSIGNMENTS {
        UUID id PK
        UUID user_id_global FK
        TEXT tenant_id FK
        TEXT assignment_status
        // ... c√°c tr∆∞·ªùng kh√°c
    }
    USERS_GLOBAL ||--o{ USER_TENANT_ASSIGNMENTS : "ƒë∆∞·ª£c g√°n v√†o"
    TENANTS ||--o{ USER_TENANT_ASSIGNMENTS : "c√≥ ng∆∞·ªùi d√πng ƒë∆∞·ª£c g√°n"
    */
```

> üí° **Ghi ch√∫ cho S∆° ƒë·ªì ERD:**
>
> > >   - M·ªëi quan h·ªá gi·ªØa `[B·∫¢NG_X]` v√† `[B·∫¢NG_Y]` l√† m·ªëi quan h·ªá logic, ƒë∆∞·ª£c x·ª≠ l√Ω ·ªü t·∫ßng ·ª©ng d·ª•ng, kh√¥ng c√≥ b·∫£ng join v·∫≠t l√Ω.
>
>   - Ki·ªÉu d·ªØ li·ªáu `TEXT[]` trong PostgreSQL ƒë∆∞·ª£c bi·ªÉu di·ªÖn l√† `STRING[]` (ho·∫∑c `TEXT`) trong Mermaid.
>   - C√°c r√†ng bu·ªôc `UNIQUE` kh√¥ng ƒë∆∞·ª£c th·ªÉ hi·ªán tr·ª±c ti·∫øp trong Mermaid ERD n√†y nh∆∞ng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong chi ti·∫øt b·∫£ng ho·∫∑c script SQL.

-----

## 6\. Chi ti·∫øt T·ª´ng B·∫£ng (Table Details)

> **[H∆Ø·ªöNG D·∫™N - M·ª§C 6: CHI TI·∫æT B·∫¢NG]**
>
>   - L·∫∑p l·∫°i c·∫•u tr√∫c ti·ªÉu m·ª•c n√†y cho t·ª´ng b·∫£ng ƒë√£ ƒë∆∞·ª£c gi·ªõi thi·ªáu trong ERD.
>   - M·ªói b·∫£ng c·∫ßn c√≥: M·ª•c ƒë√≠ch, C√¢u l·ªánh `CREATE TABLE` (v√≠ d·ª• SQL), B·∫£ng gi·∫£i th√≠ch c·ªôt, v√† ph·∫ßn Li√™n k·∫øt & Ch·ªâ s·ªë.
>   - Tham kh·∫£o c√°ch User Service Master m√¥ t·∫£ b·∫£ng `users_global` r·∫•t chi ti·∫øt.

### üìå B·∫£ng: `[T√äN_B·∫¢NG_1]`

#### üßæ M·ª•c ƒë√≠ch

#### üìú C√¢u l·ªánh `CREATE TABLE` (V√≠ d·ª• SQL cho PostgreSQL)

```sql
CREATE TABLE [t√™n_b·∫£ng_1_sql] (
    [t√™n_c·ªôt_1] [KI·ªÇU_DL_SQL_1] PRIMARY KEY,          -- üîë M√¥ t·∫£ c·ªôt 1 (PK)
    [t√™n_c·ªôt_2] [KI·ªÇU_DL_SQL_2] NOT NULL,             -- M√¥ t·∫£ c·ªôt 2
    [t√™n_c·ªôt_3] [KI·ªÇU_DL_SQL_3] REFERENCES [b·∫£ng_tham_chi·∫øu]([c·ªôt_tham_chi·∫øu]) ON DELETE [CASCADE/RESTRICT/SET NULL], -- üîó M√¥ t·∫£ c·ªôt 3 (FK)
    [t√™n_c·ªôt_4] [KI·ªÇU_DL_SQL_4] UNIQUE,               -- M√¥ t·∫£ c·ªôt 4 (Unique)
    [t√™n_c·ªôt_5] [KI·ªÇU_DL_SQL_5] DEFAULT [gi√°_tr·ªã_m·∫∑c_ƒë·ªãnh], -- M√¥ t·∫£ c·ªôt 5 (Default)
    [t√™n_c·ªôt_6] [KI·ªÇU_DL_SQL_6] CHECK ([ƒëi·ªÅu_ki·ªán_check]), -- üõ°Ô∏è M√¥ t·∫£ c·ªôt 6 (Check)
    created_at TIMESTAMPTZ DEFAULT now() NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT now() NOT NULL
);
```

#### üß© Gi·∫£i th√≠ch c·ªôt

| C·ªôt           | Ki·ªÉu d·ªØ li·ªáu (Logic) | R√†ng bu·ªôc      | M√¥ t·∫£ √Ω nghƒ©a nghi·ªáp v·ª•                                          |
| :------------ | :------------------- | :------------- | :-------------------------------------------------------------- |
| `[t√™n_c·ªôt_1]` | [Ki·ªÉuDL\_Logic\_1]     | PK             | [M√¥ t·∫£ chi ti·∫øt]                                                |
| `[t√™n_c·ªôt_2]` | [Ki·ªÉuDL\_Logic\_2]     | NOT NULL       | [M√¥ t·∫£ chi ti·∫øt]                                                |
| `[t√™n_c·ªôt_3]` | [Ki·ªÉuDL\_Logic\_3]     | FK             | [M√¥ t·∫£ chi ti·∫øt, tham chi·∫øu ƒë·∫øn b·∫£ng/c·ªôt n√†o]                   |
| `[t√™n_c·ªôt_4]` | [Ki·ªÉuDL\_Logic\_4]     | UNIQUE         | [M√¥ t·∫£ chi ti·∫øt]                                                |
| `[t√™n_c·ªôt_5]` | [Ki·ªÉuDL\_Logic\_5]     | DEFAULT        | [M√¥ t·∫£ chi ti·∫øt]                                                |
| `[t√™n_c·ªôt_6]` | [Ki·ªÉuDL\_Logic\_6]     | CHECK          | [M√¥ t·∫£ chi ti·∫øt]                                                |
| `created_at`  | datetime             | NOT NULL, DEFAULT | Th·ªùi ƒëi·ªÉm t·∫°o b·∫£n ghi.                                           |
| `updated_at`  | datetime             | NOT NULL, DEFAULT | Th·ªùi ƒëi·ªÉm c·∫≠p nh·∫≠t cu·ªëi c√πng (c√≥ th·ªÉ d√πng trigger ƒë·ªÉ t·ª± ƒë·ªông c·∫≠p nh·∫≠t). |

#### üîó Li√™n k·∫øt, Ch·ªâ m·ª•c & H√†nh vi Cascade

  - **Li√™n k·∫øt ch√≠nh:**
      - C·ªôt `[t√™n_c·ªôt_3]` li√™n k·∫øt ƒë·∫øn b·∫£ng `[B·∫¢NG_THAM_CHI·∫æU]`.
      - [TODO: M√¥ t·∫£ c√°c li√™n k·∫øt quan tr·ªçng kh√°c.]
  - **Ch·ªâ m·ª•c (Indexes) ƒë·ªÅ xu·∫•t:**
      - PK: `([t√™n_c·ªôt_1])` (t·ª± ƒë·ªông t·∫°o index).
      - FK: `([t√™n_c·ªôt_3])` (th∆∞·ªùng t·ª± ƒë·ªông t·∫°o index).
      - UNIQUE: `([t√™n_c·ªôt_4])` (t·ª± ƒë·ªông t·∫°o index).
      - [TODO: Index tr√™n c·ªôt `[t√™n_c·ªôt_X]` ƒë·ªÉ t·ªëi ∆∞u truy v·∫•n [lo·∫°i\_truy\_v·∫•n\_th∆∞·ªùng\_xuy√™n].]
  - **H√†nh vi Cascade:**
      - `ON DELETE [CASCADE/RESTRICT/SET NULL]` cho kh√≥a ngo·∫°i `[t√™n_c·ªôt_3]`: [Gi·∫£i th√≠ch l√Ω do ch·ªçn h√†nh vi n√†y].
      - [TODO: M√¥ t·∫£ c√°c h√†nh vi cascade kh√°c n·∫øu c√≥.]

#### üì§ S·ª± ki·ªán ph√°t ra (n·∫øu c√≥)

  - `[t√™n_b·∫£ng_1]_created`: Khi m·ªôt b·∫£n ghi m·ªõi ƒë∆∞·ª£c t·∫°o.
  - `[t√™n_b·∫£ng_1]_updated`: Khi m·ªôt b·∫£n ghi ƒë∆∞·ª£c c·∫≠p nh·∫≠t.
  - `[t√™n_b·∫£ng_1]_deleted`: Khi m·ªôt b·∫£n ghi b·ªã x√≥a (soft delete ho·∫∑c hard delete).

-----

## 7\. C√°c b·∫£ng ph·ª• tr·ª£ (Auxiliary Tables - n·∫øu c√≥)

> **[H∆Ø·ªöN D·∫™N - M·ª§C 7: B·∫¢NG PH·ª§ TR·ª¢]**
>
>   - M√¥ t·∫£ c√°c b·∫£ng kh√¥ng ph·∫£i l√† th·ª±c th·ªÉ nghi·ªáp v·ª• ch√≠nh nh∆∞ng c·∫ßn thi·∫øt cho ho·∫°t ƒë·ªông c·ªßa service.
>   - V√≠ d·ª•: b·∫£ng `processed_events` ƒë·ªÉ ƒë·∫£m b·∫£o idempotency, b·∫£ng log audit n·ªôi b·ªô (n·∫øu kh√¥ng d√πng service audit ri√™ng).
>   - Tham kh·∫£o User Service Master ƒë√£ c√≥ b·∫£ng `processed_events`.

### üîÑ B·∫£ng: `processed_events`

#### üìå M·ª•c ƒë√≠ch

Ghi l·∫°i c√°c `event_id` ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω t·ª´ message queue (v√≠ d·ª•: Kafka, Pub/Sub) ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh idempotent, tr√°nh x·ª≠ l√Ω tr√πng l·∫∑p s·ª± ki·ªán.

```sql
CREATE TABLE processed_events (
    event_id UUID PRIMARY KEY,              -- üîë ID duy nh·∫•t c·ªßa s·ª± ki·ªán (t·ª´ metadata c·ªßa message)
    consumer_group_name TEXT NOT NULL,      -- üß≠ T√™n c·ªßa consumer group ho·∫∑c service ƒë√£ x·ª≠ l√Ω
    processed_at TIMESTAMPTZ DEFAULT now() NOT NULL -- ‚è±Ô∏è Th·ªùi ƒëi·ªÉm x·ª≠ l√Ω th√†nh c√¥ng
);
```

#### üìã Gi·∫£i th√≠ch

| C·ªôt                   | Ki·ªÉu d·ªØ li·ªáu | √ù nghƒ©a                                                           |
| :-------------------- | :----------- | :---------------------------------------------------------------- |
| `event_id`            | UUID         | ID duy nh·∫•t c·ªßa s·ª± ki·ªán.                                          |
| `consumer_group_name` | TEXT         | T√™n c·ªßa consumer group/service ƒë√£ x·ª≠ l√Ω (h·ªØu √≠ch n·∫øu c√≥ nhi·ªÅu consumer). |
| `processed_at`        | TIMESTAMPTZ  | Th·ªùi ƒëi·ªÉm x·ª≠ l√Ω th√†nh c√¥ng.                                      |

-----

## 8\. Ph·ª• l·ª•c (Appendices)

> **[H∆Ø·ªöNG D·∫™N - M·ª§C 8: PH·ª§ L·ª§C]**
>
>   - Cung c·∫•p c√°c th√¥ng tin b·ªï sung gi√∫p l√†m r√µ m√¥ h√¨nh d·ªØ li·ªáu.
>   - Bao g·ªìm: C√°c Index quan tr·ªçng (t·ªïng h·ª£p l·∫°i), R√†ng bu·ªôc ƒë·∫∑c bi·ªát, Danh s√°ch s·ª± ki·ªán ph√°t ra (t·ªïng h·ª£p), ƒê·ªãnh nghƒ©a ENUMs, Chi·∫øn l∆∞·ª£c ki·ªÉm th·ª≠ li√™n quan ƒë·∫øn data model, v√† Li√™n k·∫øt t√†i li·ªáu.
>   - Tham kh·∫£o c√°c ph·ª• l·ª•c A, B, C, D, E, F trong file `data-model.md` c·ªßa User Service Master.

### üìò Ph·ª• l·ª•c A ‚Äì C√°c Index quan tr·ªçng (T·ªïng h·ª£p)

| B·∫£ng          | C·ªôt(s) ƒë∆∞·ª£c Index                | Lo·∫°i Index     | M·ª•c ƒë√≠ch                                |
| :------------ | :------------------------------- | :------------- | :-------------------------------------- |
| `[t√™n_b·∫£ng_1]`| `([t√™n_c·ªôt_pk])`                 | PRIMARY KEY    | Truy c·∫≠p nhanh theo kh√≥a ch√≠nh.         |
| `[t√™n_b·∫£ng_1]`| `([t√™n_c·ªôt_unique])`             | UNIQUE INDEX   | ƒê·∫£m b·∫£o t√≠nh duy nh·∫•t.                 |
| `[t√™n_b·∫£ng_1]`| `([t√™n_c·ªôt_fk])`                 | INDEX          | T·ªëi ∆∞u JOIN v√† truy v·∫•n theo kh√≥a ngo·∫°i.|
| `[t√™n_b·∫£ng_2]`| `([t√™n_c·ªôt_cho_filter_nhanh])`    | INDEX          | T·ªëi ∆∞u c√°c ƒëi·ªÅu ki·ªán WHERE th∆∞·ªùng g·∫∑p. |

### üìò Ph·ª• l·ª•c B ‚Äì R√†ng bu·ªôc ƒë·∫∑c bi·ªát v√† Logic Nghi·ªáp v·ª•

  - [TODO: R√†ng bu·ªôc 1, v√≠ d·ª•: C·ªôt `users_global.email` ch·ªâ l√† UNIQUE trong ph·∫°m vi `auth_provider`.]
  - [TODO: R√†ng bu·ªôc 2, v√≠ d·ª•: M·ªôt `Order` ch·ªâ c√≥ th·ªÉ chuy·ªÉn sang tr·∫°ng th√°i `SHIPPED` n·∫øu ƒë√£ ·ªü tr·∫°ng th√°i `PAID`.]

### üìò Ph·ª• l·ª•c C ‚Äì Danh s√°ch S·ª± ki·ªán Ph√°t ra t·ª´ Service (T·ªïng h·ª£p)

| S·ª± ki·ªán                          | Trigger (H√†nh ƒë·ªông/B·∫£ng b·ªã ·∫£nh h∆∞·ªüng)       | M·ª•c ƒë√≠ch ch√≠nh                                     |
| :------------------------------- | :----------------------------------------- | :------------------------------------------------- |
| `[t√™n_b·∫£ng_1]_created`           | T·∫°o b·∫£n ghi m·ªõi trong `[T√äN_B·∫¢NG_1]`         | [Th√¥ng b√°o cho c√°c service kh√°c v·ªÅ vi·ªác t·∫°o m·ªõi.] |
| `[t√™n_b·∫£ng_1]_updated`           | C·∫≠p nh·∫≠t b·∫£n ghi trong `[T√äN_B·∫¢NG_1]`        | [Th√¥ng b√°o v·ªÅ s·ª± thay ƒë·ªïi.]                       |
| `[t√™n_b·∫£ng_2]_status_changed`    | Thay ƒë·ªïi tr∆∞·ªùng `status` trong `[T√äN_B·∫¢NG_2]` | [Th√¥ng b√°o v·ªÅ thay ƒë·ªïi tr·∫°ng th√°i.]                |

### üìò Ph·ª• l·ª•c D ‚Äì Enum v√† Gi√° tr·ªã ƒê·∫∑c bi·ªát

  - **`[t√™n_tr∆∞·ªùng_enum_1]`** (B·∫£ng: `[T√äN_B·∫¢NG_X]`):
      - `VALUE_1_A`: [M√¥ t·∫£ √Ω nghƒ©a c·ªßa VALUE\_1\_A]
      - `VALUE_1_B`: [M√¥ t·∫£ √Ω nghƒ©a c·ªßa VALUE\_1\_B]
  - **`[t√™n_tr∆∞·ªùng_enum_2]`** (B·∫£ng: `[T√äN_B·∫¢NG_Y]`):
      - `VALUE_2_X`: [M√¥ t·∫£ √Ω nghƒ©a c·ªßa VALUE\_2\_X]
      - `VALUE_2_Y`: [M√¥ t·∫£ √Ω nghƒ©a c·ªßa VALUE\_2\_Y]

### üìò Ph·ª• l·ª•c E ‚Äì Chi·∫øn l∆∞·ª£c Ki·ªÉm th·ª≠ Li√™n quan ƒë·∫øn M√¥ h√¨nh D·ªØ li·ªáu

#### üîç 1. Ki·ªÉm th·ª≠ m·ª©c C∆° s·ªü d·ªØ li·ªáu (Database-level)

| Lo·∫°i ki·ªÉm th·ª≠             | M√¥ t·∫£                                                                 |
| :------------------------- | :-------------------------------------------------------------------- |
| ‚úÖ R√†ng bu·ªôc PK/FK         | ƒê·∫£m b·∫£o kh√¥ng th·ªÉ insert/update d·ªØ li·ªáu vi ph·∫°m kh√≥a ch√≠nh/ngo·∫°i.   |
| ‚úÖ R√†ng bu·ªôc UNIQUE        | Ki·ªÉm th·ª≠ c√°c c·ªôt c√≥ r√†ng bu·ªôc UNIQUE kh√¥ng b·ªã tr√πng l·∫∑p gi√° tr·ªã.        |
| ‚úÖ Enum/Constraint logic  | Ki·ªÉm th·ª≠ gi√° tr·ªã h·ª£p l·ªá c·ªßa c√°c c·ªôt ENUM ho·∫∑c c√≥ CHECK constraint.     |
| ‚úÖ Trigger (n·∫øu c√≥)        | Ki·ªÉm th·ª≠ logic c·ªßa c√°c trigger (v√≠ d·ª•: t·ª± ƒë·ªông c·∫≠p nh·∫≠t `updated_at`). |

#### üîÑ 2. Ki·ªÉm th·ª≠ T√≠nh to√†n v·∫πn D·ªØ li·ªáu Xuy√™n su·ªët (Integration Data Consistency)

| T√¨nh hu·ªëng ki·ªÉm th·ª≠                       | Mong ƒë·ª£i                                                                |
| :---------------------------------------- | :----------------------------------------------------------------------- |
| [TODO: K·ªãch b·∫£n nghi·ªáp v·ª• 1, v√≠ d·ª•: T·∫°o User m·ªõi ‚Üí G√°n v√†o Tenant] | [TODO: D·ªØ li·ªáu trong c√°c b·∫£ng li√™n quan (`users_global`, `user_tenant_assignments`) ph·∫£i nh·∫•t qu√°n, s·ª± ki·ªán ƒë∆∞·ª£c ph√°t ra ch√≠nh x√°c.] |
| [TODO: K·ªãch b·∫£n nghi·ªáp v·ª• 2, v√≠ d·ª•: C·∫≠p nh·∫≠t Template RBAC]       | [TODO: D·ªØ li·ªáu trong b·∫£ng template ƒë∆∞·ª£c c·∫≠p nh·∫≠t, s·ª± ki·ªán ƒë∆∞·ª£c ph√°t ra.]       |
| [TODO: K·ªãch b·∫£n nghi·ªáp v·ª• 3, v√≠ d·ª•: X·ª≠ l√Ω l·∫°i event ƒë√£ x·ª≠ l√Ω (idempotency)] | [TODO: D·ªØ li·ªáu kh√¥ng b·ªã thay ƒë·ªïi/t·∫°o m·ªõi m·ªôt c√°ch kh√¥ng mong mu·ªën.]          |

#### ‚öôÔ∏è 3. Ki·ªÉm th·ª≠ v·ªõi D·ªØ li·ªáu M·∫´u

| T√™n t·∫≠p d·ªØ li·ªáu         | M√¥ t·∫£                                                                    |
| :---------------------- | :----------------------------------------------------------------------- |
| `[test_data_set_1].json`| [TODO: M√¥ t·∫£, v√≠ d·ª•: D·ªØ li·ªáu cho m·ªôt User v·ªõi nhi·ªÅu assignments kh√°c nhau.] |
| `[test_data_set_2].yaml`| [TODO: M√¥ t·∫£, v√≠ d·ª•: C·∫•u h√¨nh RBAC template ph·ª©c t·∫°p.]                     |

#### üõ°Ô∏è 4. Ki·ªÉm th·ª≠ B·∫£o m·∫≠t D·ªØ li·ªáu (Security-focused DB tests - n·∫øu c√≥ logic ph·ª©c t·∫°p)

| Lo·∫°i ki·ªÉm th·ª≠                        | M√¥ t·∫£                                                                   |
| :---------------------------------- | :---------------------------------------------------------------------- |
| [TODO: K·ªãch b·∫£n 1, v√≠ d·ª•: Truy c·∫≠p d·ªØ li·ªáu tr√°i ph√©p gi·ªØa c√°c tenant (n·∫øu m√¥ h√¨nh c√≥ tenant\_id ·ªü nhi·ªÅu b·∫£ng)] | [TODO: ƒê·∫£m b·∫£o query lu√¥n c√≥ ƒëi·ªÅu ki·ªán l·ªçc ƒë√∫ng theo tenant\_id ho·∫∑c c√°c r√†ng bu·ªôc b·∫£o m·∫≠t kh√°c.] |
| [TODO: K·ªãch b·∫£n 2, v√≠ d·ª•: SQL Injection (n·∫øu c√≥ x·ª≠ l√Ω query SQL ƒë·ªông kh√¥ng an to√†n)] | [TODO: Ki·ªÉm tra c√°c input ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng c√≥ l·ªó h·ªïng SQL Injection.]     |

#### üìÇ 5. G·ª£i √Ω C√¥ng c·ª• H·ªó tr·ª£

  - **Migration Tool:** [TODO: V√≠ d·ª•: Alembic, Prisma Migrate, Liquibase] (Tu√¢n th·ªß ADR-023).
  - **DB Unit/Integration Testing:** [TODO: V√≠ d·ª•: pgTAP, DBUnit, pytest-postgresql, testcontainers].
  - **Event Testing (n·∫øu c√≥):** [TODO: V√≠ d·ª•: Mock Pub/Sub, Kafka Test, Log capture].

#### üìò Tham chi·∫øu ch√©o

  - [Thi·∫øt k·∫ø t·ªïng quan (`design.md`)](./design.md) ‚Äì M·ª•c "Chi·∫øn l∆∞·ª£c Test"
  - [ƒê·∫∑c t·∫£ OpenAPI (`openapi.yaml`)](./openapi.yaml) ‚Äì ƒê·ªÉ mock c√°c API endpoint v√† ki·ªÉm th·ª≠ d·ªØ li·ªáu tr·∫£ v·ªÅ.
  - [li√™n k·∫øt ƒë√°ng ng·ªù ƒë√£ b·ªã x√≥a] (N·∫øu c√≥ li√™n quan ƒë·∫øn vi·ªác ghi log audit t·ª´ d·ªØ li·ªáu).

-----

### üìò Ph·ª• l·ª•c F ‚Äì Li√™n k·∫øt T√†i li·ªáu

  - [Thi·∫øt k·∫ø t·ªïng quan c·ªßa Service (`design.md`)](./design.md)
  - [H·ª£p ƒë·ªìng Giao di·ªán API (`interface-contract.md`)](./interface-contract.md)
  - [ƒê·∫∑c t·∫£ OpenAPI (`openapi.yaml`)](./openapi.yaml)

-----
